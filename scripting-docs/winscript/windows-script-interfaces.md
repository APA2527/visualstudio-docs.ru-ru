---
title: Интерфейсы сценариев Windows | Документы Майкрософт
ms.custom: ''
ms.date: 01/18/2017
ms.reviewer: ''
ms.suite: ''
ms.tgt_pltfrm: ''
ms.topic: article
ms.assetid: 4c750627-6797-4857-9f5e-e5f54371f83c
caps.latest.revision: 10
author: mikejo5000
ms.author: mikejo
manager: ghogen
ms.openlocfilehash: 0aebd0857ba847d5c5eba5e3a4a8a01da73ec159
ms.sourcegitcommit: 94b3a052fb1229c7e7f8804b09c1d403385c7630
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/23/2019
ms.locfileid: "62840035"
---
# <a name="windows-script-interfaces"></a>Интерфейсы скриптов Windows

Интерфейсы сценариев Microsoft Windows позволяют добавлять в приложения сценарии и автоматизацию OLE. Серверы сценариев, использующие сценарии Windows, могут применять обработчики сценариев из разных источников и от разных поставщиков для управления сценариями между компонентами. Способ реализации сценария — язык, синтаксис, сохраняемый формат, модель выполнения и т. д. — выбирается на усмотрение поставщика скрипта.

Документация по сценариям Windows состоит из следующих разделов:

[Серверы скриптов Windows](../winscript/windows-script-hosts.md)

[Обработчики скриптов Windows](../winscript/windows-script-engines.md)

[Обзор отладки активных скриптов](../winscript/active-script-debugging-overview.md)

[Обзор профилирования активных скриптов](../winscript/active-script-profiling-overview.md)

[Справочник по интерфейсам скриптов Windows](../winscript/reference/windows-script-interfaces-reference.md)

## <a name="windows-script-background"></a>Общие сведения о сценариях Windows

Интерфейсы Windows Script разделяются на две категории: узлы Windows Script и модули Windows Script. Сервер создает обработчик сценариев и вызывает его для выполнения сценариев. Примеры серверов сценариев Windows:

- Microsoft Internet Explorer

- Средства разработки в Интернете

- Оболочка

Обработчики сценариев Windows можно разрабатывать для любого языка или среды выполнения, включая следующие:

- Язык скриптов Microsoft VBScript (Microsoft Visual Basic Scripting Edition)

- Perl

- Lisp

Чтобы сделать реализацию сервера максимально гибкой, предоставляется оболочка автоматизации OLE для сценариев Windows. Однако сервер, использующий этот объект-оболочку для создания экземпляра обработчика сценариев, не имеет того контроля над пространством имен времени выполнения, моделью сохраняемости и другими компонентами, который он имеет при использовании сценариев Windows напрямую.

Структура сценариев Windows предусматривает изоляцию элементов интерфейса, требуемых только в среде разработки, что позволяет упростить не связанные с разработкой серверы (например, браузеры и средства просмотра) и обработчики сценариев (например, VBScript).

## <a name="windows-script-basic-architecture"></a>Базовая архитектура сценариев Windows

На приведенном ниже рисунке показана взаимосвязь между сервером сценариев Windows и обработчиком сценариев Windows.

Этапы взаимодействия между сервером и обработчиком описываются в приведенном ниже списке.

1. Создайте проект. Сервер загружает проект или документ. (Этот шаг не относится напрямую к сценариям Windows, но добавлен здесь для полноты.)

2. Создается обработчик сценариев Windows. Сервер вызывает функцию `CoCreateInstance` для создания обработчика сценариев Windows, указывая идентификатор класса (CLSID) обработчика сценариев, который необходимо использовать. Например, HTML-браузер Internet Explorer получает идентификатор класса обработчика сценариев посредством атрибута CLSID= в HTML-теге \<OBJECT>.

3. Загружается сценарий. Если содержимое сценария сохранено, сервер вызывает метод `IPersist*::Load` обработчика сценариев и передает в него хранилище сценариев, поток или контейнер свойств. В противном случае сервер использует метод `IPersist*::InitNew` или [IActiveScriptParse::InitNew](../winscript/reference/iactivescriptparse-initnew.md) для создания пустого сценария. Если сервер обрабатывает сценарий в текстовой форме, он может использовать метод [IActiveScriptParse::ParseScriptText](../winscript/reference/iactivescriptparse-parsescripttext.md) для передачи текста сценария в обработчик сценариев после вызова `IActiveScriptParse::InitNew`.

4. Добавляются именованные элементы. Для каждого именованного элемента верхнего уровня (например, страницы или формы), импортируемого в пространство имен обработчика сценариев, сервер вызывает метод [IActiveScript::AddNamedItem](../winscript/reference/iactivescript-addnameditem.md), чтобы создать запись в пространстве имен обработчика. Этот шаг необязателен, если именованные элементы верхнего уровня уже являются частью сохраняемого состояния сценария, загруженного в шаге 3. Сервер не использует метод `IActiveScript::AddNamedItem` для добавления именованных элементов нижележащих уровней (например, элементов управления на HTML-странице). Вместо этого обработчик косвенно получает элементы нижележащих уровней из элементов верхнего уровня с помощью интерфейсов `ITypeInfo` и `IDispatch` сервера.

5. Выполняется сценарий. Сервер инициирует запуск сценария обработчиком, устанавливая флаг SCRIPTSTATE_CONNECTED в методе [IActiveScript::SetScriptState](../winscript/reference/iactivescript-setscriptstate.md). Этот вызов, скорее всего, приводит к выполнению всей основной работы обработчика сценариев, включая статическое связывание, привязку к событиям (см. ниже) и выполнение кода, аналогично тому, как это делает функция `main()` на основе сценария.

6. Получение сведений об элементе. Каждый раз, когда обработчику сценариев необходимо связать символ с элементом верхнего уровня, он вызывает метод [IActiveScriptSite::GetItemInfo](../winscript/reference/iactivescriptsite-getiteminfo.md), который возвращает сведения об указанном элементе.

7. Осуществляется привязка к событиям. Перед запуском самого сценария обработчик сценариев подключается к событиям всех нужных объектов через интерфейс `IConnectionPoint`.

8. Вызываются свойства и методы. В процессе выполнения сценария обработчик сценариев реализует ссылки на методы и свойства именованных объектов посредством `IDispatch::Invoke` или другого стандартного механизма связывания OLE.

## <a name="windows-script-terms"></a>Термины, связанные со сценариями Windows

Ниже даются определения связанных со сценариями терминов, которые используются в этом документе.

|Термин|Определение|
|----------|----------------|
|Объект кода|Создаваемый обработчиком сценариев экземпляр, который связан с именованным элементом, например модуль, связанный с формой, в Visual Basic, или класс C++, связанный с именованным элементом. Желательно, чтобы это был COM-объект OLE, который поддерживает автоматизацию OLE. Это позволит серверу или другой сущности, не связанной со сценариями, работать с объектом кода.|
|Именованный элемент|COM-объект OLE (желательно поддерживающий автоматизацию OLE), который расценивается сервером как представляющий интерес для сценария. Примерами могут служить HTML-страница в веб-браузере и документ и диалоговые окна в Microsoft Word.|
|Сценарий|Данные, составляющие программу, которая выполняется обработчиком сценариев. Сценарием могут быть любые непрерывные выполняемые данные, включая фрагменты текста, блоки `pcode` или даже машинно-зависимый исполняемый байтовый код. Сервер загружает сценарий в обработчик сценариев посредством одного из интерфейсов `IPersist*` или интерфейса [IActiveScriptParse](../winscript/reference/iactivescriptparse.md).|
|Обработчик сценариев|Объект OLE, который обрабатывает сценарии. Обработчик сценариев реализует интерфейс [IActiveScript](../winscript/reference/iactivescript.md), а также (необязательно) интерфейс [IActiveScriptParse](../winscript/reference/iactivescriptparse.md).|
|Сервер сценариев|Приложение или программа, которой принадлежит обработчик сценариев Windows. Сервер реализует интерфейс [IActiveScriptSite](../winscript/reference/iactivescriptsite.md) и (необязательно) интерфейс [IActiveScriptSiteWindow](../winscript/reference/iactivescriptsitewindow.md).|
|Компонент сценария|Часть сценария, присоединяемая к объекту посредством интерфейса [IActiveScriptParse](../winscript/reference/iactivescriptparse.md). Совокупность компонентов сценария образует сценарий.|
|Язык сценариев|Язык, на котором написан сценарий (например, VBScript), и семантика этого языка.|