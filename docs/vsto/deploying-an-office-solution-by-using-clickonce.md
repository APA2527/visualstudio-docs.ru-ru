---
title: Развертывание решения Office с помощью ClickOnce
ms.date: 02/02/2017
ms.topic: conceptual
dev_langs:
- VB
- CSharp
helpviewer_keywords:
- Office development in Visual Studio, deploying solutions
- ClickOnce deployment [Office development in Visual Studio], deploying solutions
author: John-Hart
ms.author: johnhart
manager: jillfra
ms.workload:
- office
ms.openlocfilehash: f4adbd08d13d26c717beeb454bd323185bb88640
ms.sourcegitcommit: b32fbbcbc43910b0ed7ce79aa9a22f2ed36ab57e
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/16/2020
ms.locfileid: "79416566"
---
# <a name="deploy-an-office-solution-by-using-clickonce"></a>Развертывание решения Office с помощью ClickOnce
  Решение Office можно развернуть быстрее, если использовать ClickOnce. При публикации обновлений решение автоматически обнаруживает и устанавливает их. Однако для использования ClickOnce необходимо устанавливать решение отдельно для каждого пользователя компьютера. Поэтому следует рассмотреть возможность использования установки Windows *(.msi),* если более одного пользователя запустит ваше решение на одном компьютере.

## <a name="in-this-topic"></a>В этом разделе

- [Публикация решения](#Publish)

- [Выбор способа предоставления доверия решению](#Trust)

- [Помощь пользователям при установке решения](#Helping)

- [Размещение документа решения на компьютере пользователя (настройки только уровня документа)](#Put)

- [Размещение документа решения на сервере с SharePoint (настройки только уровня документа)](#SharePoint)

- [Создание пользовательского установщика](#Custom)

- [Публикация обновления](#Update)

- [Изменение расположения установки решения](#Location)

- [Откат решения к более ранней версии](#Roll)

  Для получения дополнительной информации о том, как развернуть решение Office, создав файл установки Windows, [см.](../vsto/deploying-a-vsto-solution-by-using-windows-installer.md)

## <a name="publish-the-solution"></a><a name="Publish"></a>Опубликовать решение
 Вы можете опубликовать свое решение с помощью **Мастера Публикации** или **Дизайнера Проекта.** В этой процедуре вы будете использовать **проект Designer,** поскольку он предоставляет полный набор вариантов публикации. Смотрите [Издательский мастер &#40;Office развития в Visual Studio&#41;](../vsto/publish-wizard-office-development-in-visual-studio.md).

#### <a name="to-publish-the-solution"></a>Публикация решения

1. В **Solution Explorer**выберите узло, названное в честь вашего проекта.

2. В меню последовательно выберите **Проект**, *ProjectName* **Свойства**.

3. В **проекте Designer**выберите вкладку **Publish,** которая показывает следующую иллюстрацию.

    ![Вкладка публикации в конструкторе проектов](../vsto/media/vsto-publishtab.png "Вкладка публикации в конструкторе проектов")

4. В поле **Publishing Folder Location (ftp server, или файловый путь)** введите путь папки, где вы хотите, чтобы **конструктор проекта** скопировал файлы решения.

    Можно ввести путь любого из следующих типов.

   - Локальный путь (например, *C:'FolderName-FolderName).*

   - Единая Конвенция именования (UNC) путь к папке в вашей сети (например, * \\«ServerName»FolderName).*

   - Относительный путь (например, *PublishFolder\\*, который является папкой, в которую проект публикуется по умолчанию).

5. В поле **Установки Фолдер** URL,введите полностью квалифицированный путь местоположения, где конечные пользователи найдут ваше решение.

    Если вы еще не знаете место, не введите ничего в этой области. По умолчанию ClickOnce ищет обновления в папке, из которой пользователи устанавливают решение.

6. Нажмите кнопку **Необходимые компоненты** .

7. В диалоговом поле **Prerequisites** убедитесь, что **программа настройки Create для установки предпосылок для проверки компонентов** выбрана.

8. В **книге «Выбрать, какие предпосылки для установки** списка» выберите флажки для **Установки Windows 4.5** и соответствующий пакет .NET Framework.

    Например, если ваше [!INCLUDE[net_v45](../vsto/includes/net-v45-md.md)]решение нацелено на то, выберите флажки для **Windows Installer 4.5** и **Microsoft .NET Framework 4.5 Full.**

9. Если ваше решение нацелено на .NET Framework 4.5, выберите флажок **Visual Studio 2010 Для проверки Office Runtime.**

    > [!NOTE]
    > По умолчанию этот флажок не отображается. Чтобы отобразить этот флажок, необходимо создать пакет начального загрузчика. Смотрите [Создать пакет Bootstrapper для Office 2013 VSTO Add-in с Visual Studio 2012](create-vsto-add-ins-for-office-by-using-visual-studio.md).

10. В соответствии с **указанием местоположения установки для предварительных условий,** выберите один из параметров, которые появляются, а затем выберите кнопку **OK.**

     В таблице ниже представлено описание каждого из этих параметров.

    |Параметр|Описание|
    |------------|-----------------|
    |**Скачать необходимые компоненты с веб-сайта поставщика компонентов**|Пользователю будет предложено загрузить и установить эти необходимые компоненты у поставщика.|
    |**Скачать необходимые компоненты с местоположения моего приложения**|Необходимое программное обеспечение устанавливается вместе с решением. Если выбран этот параметр, Visual Studio копирует все пакеты необходимых компонентов в расположение публикации автоматически. Чтобы этот параметр действовал, пакеты необходимых компонентов должны находиться на компьютере разработки.|
    |**Скачать необходимые компоненты из следующего места**|Visual Studio скопирует все пакеты необходимых компонентов в указанное расположение и установит их вместе с решением.|

     Смотрите [поле диалога Prerequisites](../ide/reference/prerequisites-dialog-box.md).

11. Выберите кнопку **Обновления,** укажите, как часто вы хотите VSTO дополнения каждого пользователя или настройки для проверки обновлений, а затем выбрать кнопку **OK.**

    > [!NOTE]
    > Если вы развертываете с помощью компакт-диска или съемного диска, выберите кнопку **Never check for updates** option.

     Для получения информации о том, как опубликовать обновление, [см.](#Update)

12. Выберите кнопку **Параметры,** просмотрите параметры в диалоговом поле **Options,** а затем выберите кнопку **OK.**

13. Выберите кнопку **«Опубликовать сейчас».**

     Visual Studio добавить следующие папки и файлы в папку публикации, указанную ранее в этой процедуре.

    - Папка **файлов приложений.**

    - Программа установки.

    - Манифест развертывания, указывающий на манифест развертывания для последней версии.

      Папка **файлов приложений** содержит субфолдер для каждой версии, которую вы публикуете. Каждая вложенная папка для конкретной версии содержит следующие файлы.

    - Манифест приложения.

    - Манифест развертывания.

    - Сборки настройки.

      На следующем рисунке показана структура папки публикации для надстройки VSTO Outlook.

      ![Опубликовать структуру Фолдера](../vsto/media/publishfolderstructure.png "Структура папки публикации")

    > [!NOTE]
    > ClickOnce прикрепает расширение *.deploy* к сборкам, чтобы защищенная установка Информационных служб Интернета (IIS) не блокировала файлы из-за небезопасного расширения. Когда пользователь устанавливает решение, ClickOnce удаляет расширение *.deploy.*

14. Скопируйте файлы решения в папку установки, указанную ранее в этой процедуре.

## <a name="decide-how-you-want-to-grant-trust-to-the-solution"></a><a name="Trust"></a>Решите, как вы хотите доверять решению
 Прежде чем решение можно будет запускать на компьютерах пользователей, необходимо предоставить доверие. В противном случае пользователи должны будут ответить на запрос о доверии при установке решения. Чтобы предоставить доверие решению, подпишите манифест с помощью сертификата, который определяет известного и надежного издателя. Просмотрите [решение Trust, подписав манифесты приложения и развертывания.](../vsto/granting-trust-to-office-solutions.md#Signing)

 Если вы развертываете настройку на уровне документа и хотите поместить документ в папку на компьютере пользователя или сделать документ доступным на сайте SharePoint, убедитесь, что Office доверяет местонахождению документа. Смотрите [Грант доверие к документам](../vsto/granting-trust-to-documents.md).

## <a name="help-users-install-the-solution"></a><a name="Helping"></a>Помогите пользователям установить решение
 Пользователи могут установить решение, запустив программу настройки, открыв манифест развертывания или во время настройки на уровне документов, открыв документ напрямую. Рекомендуемым способом является установка решения пользователями с помощью программы установки. Два других подхода не обеспечивают установку необходимого программного обеспечения. Если пользователям необходимо открывать документ из расположения установки, они должны добавить это расположение в список надежных расположений в центре управления безопасностью приложения Office.

### <a name="opening-the-document-of-a-document-level-customization"></a>Открытие документа настройки уровня документа
 Пользователи могут открывать документы настройки уровня документа непосредственно из папки установки или путем копирования документа на локальный компьютер и открытия этой копии.

 Рекомендуется открывать копии документов на компьютерах пользователей, чтобы несколько пользователей не пытались открывать один и тот же экземпляр документа одновременно. Чтобы обеспечить выполнение этого правила, можно настроить программу установки таким образом, чтобы она копировала документ на компьютеры пользователей. Поместите [документ решения на компьютер конечного пользователя (только настройки на уровне документов).](#Put)

### <a name="install-the-solution-by-opening-the-deployment-manifest-from-an-iis-website"></a>Установите решение, открыв манифест развертывания с веб-сайта IIS
 Пользователи могут установить решение Office путем открытия манифеста развертывания из Интернета. Однако защищенная установка Информационных служб Интернета (IIS) будет блокировать файлы с расширением *.vsto.* Тип MIME должен быть определен в IIS перед развертыванием решения Office с использованием IIS.

##### <a name="to-add-the-vsto-mime-type-to-iis-60"></a>Добавление типа MIME .vsto в IIS 6.0

1. На сервере, на сервере с IIS 6.0, выберите **Менеджер службы** > **информации об административных** >  инструментах «Начать**все программы»** > **(IIS).**

2. Выберите имя компьютера, папку **веб-сайтов** или веб-узел, который вы настраиваете.

3. В баре меню выберите **Action** > **Properties.**

4. На вкладке **HTTP Headers** выберите кнопку **MIME Types.**

5. В окне **MIME Types** выберите **новую** кнопку.

6. В окне **типа MIME** введите **.vsto** в качестве расширения, введите **приложение/x-ms-vsto** в качестве типа MIME, а затем примените новые настройки.

    > [!NOTE]
    > Чтобы изменения вступили в силу, необходимо перезапустить службу веб-публикаций или подождать, пока рабочий процесс будет перезапущен. Затем необходимо промыть кэш диска браузера, а затем попытаться открыть файл *.vsto* снова.

##### <a name="to-add-the-vsto-mime-type-to-iis-70"></a>Добавление типа MIME .vsto в IIS 7,0

1. На сервере, который работает IIS 7.0, выберите **Start** > **All Programs** > **Accessories.**

2. Откройте меню ярлыка для **Командного запроса,** а затем выберите **Run в качестве администратора.**

3. В **открытой** коробке введите следующий путь, а затем выберите кнопку **OK.**

    ```cmd
    %windir%\system32\inetsrv
    ```

4. Введите следующую команду, а затем примените новые параметры.

    ```cmd
    set config /section:staticContent /+[fileExtension='.vsto',mimeType='application/x-ms-vsto']
    ```

    > [!NOTE]
    > Чтобы изменения вступили в силу, необходимо перезапустить службу веб-публикаций или подождать, пока рабочий процесс будет перезапущен. Затем необходимо промыть кэш диска браузера, а затем попытаться открыть файл *.vsto* снова.

## <a name="put-the-document-of-a-solution-onto-the-end-users-computer-document-level-customizations-only"></a><a name="Put"></a>Поместите документ решения на компьютер конечного пользователя (только настройки на уровне документов)
 Вы можете скопировать документ решения на компьютер конечного пользователя, создав действие после развертывания. Таким образом, пользователю не придется вручную копировать документ с места установки на свой компьютер после установки решения. Необходимо создать класс, определяющий действие после развертывания, создать и опубликовать решение, изменить манифест приложения и переподписать манифест приложения и развертывание.

 Следующие процедуры предполагают, что название проекта **— ExcelWorkbook** и что вы публикуете решение в созданной папке под названием **C: «опубликовать** на вашем компьютере.

### <a name="create-a-class-that-defines-the-post-deployment-action"></a>Создание класса, определяющего действие, выполняемое после развертывания

1. В панели меню выберите **Файл** > **Добавить** > **новый проект**.

2. В диалоговом окне **Добавить новый** проект в панели **установленных шаблонов** выберите папку **Windows.**

3. В панели **шаблонов** выберите шаблон **библиотеки класса.**

4. В поле **Name** введите **FileCopyPDA,** а затем выберите кнопку **OK.**

5. В **Solution Explorer**выберите проект **FileCopyPDA.**

6. В баре меню выберите **справку Project** > **Add.**

7. На вкладке **.NET** добавьте ссылки на `Microsoft.VisualStudio.Tools.Applications.Runtime` и `Microsoft.VisualStudio.Tools.Applications.ServerDocument`.

8. Переименуйте класс в `FileCopyPDA`, а затем замените содержимое файла следующим кодом. Этот код выполняет следующие задачи:

   - Копирует документ на рабочий стол пользователя.

   - Изменяет свойство _AssemblyLocation от относительного пути к полностью квалифицированного пути для манифеста развертывания.

   - Удаляет файл, когда пользователь удаляет решение.

     [!code-vb[Trin_ExcelWorkbookPDA#7](../vsto/codesnippet/VisualBasic/trin_excelworkbookpda/filecopypda/class1.vb#7)]
     [!code-csharp[Trin_ExcelWorkbookPDA#7](../vsto/codesnippet/CSharp/trin_excelworkbookpda/filecopypda/class1.cs#7)]

### <a name="build-and-publish-the-solution"></a>Сборка и публикация решения

1. В **Solution Explorer**откройте меню ярлыка для проекта **FileCopyPDA,** а затем выберите **Build.**

2. Откройте меню ярлыков для проекта **ExcelWorkbook,** а затем выберите **Build.**

3. Откройте меню ярлыка для проекта **ExcelWorkbook,** а затем выберите **Добавить справку.**

4. В диалоговом окне **Добавления** выберите вкладку **«Проекты»,** выберите **FileCopyPDA,** а затем выберите кнопку **OK.**

5. В **Solution Explorer**выберите проект **ExcelWorkbook.**

6. В баре меню выберите **Project** > **New Folder**.

7. Введите **данные,** а затем выберите ключ **Enter.**

8. В **Solution Explorer**выберите папку **данных.**

9. В панели меню выберите **Project** > **Add Existing Item.**

10. В диалоговом окне **Добавить существующий элемент** просмотрите каталог вывода для проекта **ExcelWorkbook,** выберите файл **ExcelWorkbook.xlsx,** а затем выберите кнопку **«Добавить».**

11. В **Solution Explorer** выберите файл **ExcelWorkbook.xlsx.**

12. В окне **Свойств** изменить свойство **действий сборки** на **содержимое** и свойство **каталога копирования копий,** **если новее**.

     Когда вы закончите эти шаги, ваш проект будет напоминать следующую иллюстрацию.

     ![Структура проекта в действии после развертывания.](../vsto/media/vsto-postdeployment.png "Структура проекта в действии после развертывания.")

13. Издать проект **ExcelWorkbook.**

### <a name="modify-the-application-manifest"></a>Изменение манифеста приложения

1. Откройте каталог решений, **c:'publish**, с помощью **File Explorer**.

2. Откройте папку **файлов приложений,** а затем откройте папку, соответствующую последней опубликованной версии решения.

3. Откройте файл **ExcelWorkbook.dll.manifest** в текстовом редакторе, таком как Блокнот.

4. После элемента `</vstav3:update>` добавьте следующий код. Для атрибута класса `<vstav3:entryPoint>` элемента используйте следующий синтаксис: *NamespaceName.ClassName*. В следующем примере имя класса совпадает с именем пространства имен, поэтому имя точки входа будет иметь вид `FileCopyPDA.FileCopyPDA`.

    ```xml
    <vstav3:postActions>
      <vstav3:postAction>
        <vstav3:entryPoint
          class="FileCopyPDA.FileCopyPDA">
          <assemblyIdentity
            name="FileCopyPDA"
            version="1.0.0.0"
            language="neutral"
            processorArchitecture="msil" />
        </vstav3:entryPoint>
        <vstav3:postActionData>
        </vstav3:postActionData>
      </vstav3:postAction>
    </vstav3:postActions>
    ```

### <a name="re-sign-the-application-and-deployment-manifests"></a>Повторное подписывание манифестов приложения и развертывания

1. В **папке %USERPROFILE%-Документы/Visual Studio 2013-Projects/ExcelWorkbook-ExcelWorkbook,** скопируйте файл сертификата **ExcelWorkbook_TemporaryKey.pfx,** а затем вставьте его в папку *PublishFolder* **«Файлы приложений»ExcelWorkbook**\__MostRecentPublishedVersion._

2. Откройте запрос команды Visual Studio, а затем измените каталоги на **c: «опубликовать файлы приложения»ExcelWorkbook**\__MostRecentPublishedVersion_ папку (например, **c: «опубликовать »Файлы приложения ExcelWorkbook_1_0_0_4).**

3. Подпишите обновленный манифест приложения с помощью следующей команды:

    ```cmd
    mage -sign ExcelWorkbook.dll.manifest -certfile ExcelWorkbook_TemporaryKey.pfx
    ```

     Появится сообщение "ExcelWorkbook.dll.manifest успешно подписан".

4. Изменение в **папке c:'опубликовать** папку, а затем обновить и подписать манифест развертывания, запустив следующую команду:

    ```cmd
    mage -update ExcelWorkbook.vsto -appmanifest "Application Files\Ex
    celWorkbookMostRecentVersionNumber>\ExcelWorkbook.dll.manifest" -certfile "Application Files\ExcelWorkbookMostRecentVersionNumber>\ExcelWorkbook_TemporaryKey.pfx"
    ```

    > [!NOTE]
    > В предыдущем примере замените MostRecentVersionNumber номером версии последней опубликованной версии решения (например, **1'0'0'4**).

     Появится сообщение "ExcelWorkbook.vsto успешно подписан".

5. Копируйте файл *ExcelWorkbook.vsto* в **каталоге c: «опубликовать »Файлы приложений »ExcelWorkbook**\__MostRecentVersionNumber_ каталог.

## <a name="put-the-document-of-a-solution-onto-a-server-thats-running-sharepoint-document-level-customizations-only"></a><a name="SharePoint"></a>Поместите документ решения на сервер, который работает SharePoint (только настройки на уровне документов)
 Настройки уровня документа можно публиковать для пользователей с помощью SharePoint. Когда пользователь открывает документ с сайта SharePoint, среда выполнения автоматически устанавливает решение на локальном компьютере пользователя из общей сетевой папки. После локальной установки решения настройка продолжит работать, даже если документ будет скопирован в другое место, например на рабочий стол.

#### <a name="to-put-the-document-on-a-server-thats-running-sharepoint"></a>Размещение документа на сервере с SharePoint

1. Добавьте документ решения в библиотеку документов на сайте SharePoint.

2. Воспользуйтесь одним из следующих подходов, выполнив соответствующие инструкции.

    - С помощью средства настройки Office добавьте сервер с SharePoint в центр управления безопасностью в Word или Excel на всех компьютерах пользователей.

         Ознакомьтесь [с политиками и настройками безопасности в Office 2010](/previous-versions/office/office-2010/cc178946(v=office.14)).

    - Убедитесь, что каждый пользователь выполнил следующие действия.

        1. На локальном компьютере откройте Word или Excel, выберите вкладку **Файл,** а затем выберите кнопку **Параметры.**

        2. В диалоговом окне **Целевого центра** выберите кнопку **Trusted Locations.**

        3. Выберите **кнопку «Разрешить доверенные места» в моей сети (не рекомендуется)** и затем выберите кнопку **«Добавить новое местоположение».**

        4. В поле **Путь** введите URL-адрес библиотеки документов SharePoint, содержащий *http://SharePointServerName/TeamName/ProjectName/DocumentLibraryName*загруженный документ (например, ).

             Не добавляйте имя веб-страницы по умолчанию, *например, по умолчанию.aspx* или *AllItems.aspx*.

        5. Выберите **Subfolders этого местоположения также доверенных** флажок, а затем выбрать кнопку **OK.**

             Когда пользователь откроет документ с сайта SharePoint, будут установлены настройки. Пользователь может скопировать документ себе на рабочий стол. Настройка все равно будет работать, поскольку свойства в документе указывают на сетевое расположение документа.

## <a name="create-a-custom-installer"></a><a name="Custom"></a>Создание пользовательского установщика
 Вы можете создать пользовательский установщик для решения Office, вместо того, чтобы использовать программу настройки, созданную для вас при публикации решения. Например, для запуска установки можно использовать знак в скрипте или использовать пакетный файл для установки решения без взаимодействия с пользователем. Эти сценарии оптимальны, если все необходимые компоненты уже установлены на компьютерах пользователей.

 В рамках процесса пользовательской установки позвоните в инструмент установки для решений Office *(VSTOInstaller.exe),* который установлен в следующем месте по умолчанию:

 *%commonprogramfiles%\microsoft shared\VSTO\10.0\VSTOInstaller.exe*

 Если инструмент не находится в этом месте, вы можете использовать **HKEY_LOCAL_MACHINE»-"MICROSOFT"VSTO Runtime Setup-v4-InstallerPath** или **HKEY_LOCAL_MACHINE-SOFTWARE-Wow6432Node-Microsoft-VSTO Runtime Setup-v4-InstallerPath** ключ реестра, чтобы найти путь к этому инструменту.

 Вы можете использовать следующие параметры с *VSTOinstaller.exe*.

| Параметр | Определение |
|------------------| - |
| /Install или /I | Установка решения. За данным параметром должен следовать путь к манифесту развертывания. Можно указать путь на локальном компьютере, в общей папке с именем по универсальным правилам именования (UNC). Вы можете указать локальный путь (*C:'FolderName-PublishFolder),* относительный путь *(Публикация),\\*или полностью квалифицированное местоположение*\\(«ServerName»FolderName* или http://<em>ServerName/FolderName</em>). |
| /Uninstall или /U | Удаление решения. За данным параметром должен следовать путь к манифесту развертывания. Можно указать путь на локальном компьютере к общей папке UNC. Вы можете указать локальный путь *(c:'FolderName-PublishFolder),* относительный путь *(Публикация),\\*или полностью квалифицированное местоположение*\\(«ServerName»FolderName* или http://<em>ServerName/FolderName).</em> |
| /Silent или /S | Установка или удаление без запроса ввода данных пользователем и без отображения сообщений. Если требуется подсказка доверия, настройка не устанавливается и не обновляется. |
| /Help или /? | Отображение справочных сведений. |

 При запуске *VSTOinstaller.exe*могут появиться следующие коды ошибок.

|Код ошибки|Определение|
|----------------|----------------|
|0|Решение было успешно установлено или удалено, или появилась справка VSTOInstaller.|
|–100|Один или несколько параметров командной строки недействительны или были установлены более одного раза. Для получения дополнительной информации введите "vstoinstaller /?" или посмотреть [Создать пользовательский установщик для решения ClickOnce Office](https://msdn.microsoft.com/3e5887ed-155f-485d-b8f6-3c02c074085e).|
|–101|Один или несколько вариантов командной строки недействительны. Для получения дополнительных сведений введите команду "vstoinstaller /?".|
|-200|Развертывание манифеста URI недействителен. Для получения дополнительных сведений введите команду "vstoinstaller /?".|
|-201|Решение не может быть установлено, поскольку манифест развертывания недействителен. Смотрите [манифесты развертывания для решений Office.](../vsto/deployment-manifests-for-office-solutions.md)|
|-202|Решение не может быть установлено, потому что Visual Studio Tools for Office раздел манифеста приложения не действителен. Смотрите [манифесты приложения для решений Office](../vsto/application-manifests-for-office-solutions.md).|
|-203|Решение не может быть установлено из-за ошибки загрузки. Проверьте URI-адрес манифеста развертывания или расположение файла в сети и повторите попытку.|
|-300|Решение не может быть установлено из-за исключения безопасности. Смотрите [решения Secure Office](../vsto/securing-office-solutions.md).|
|-400|Решение не может быть установлено.|
|-401|Решение не может быть неустановлено.|
|-500|Операция была отменена, поскольку решение не может быть установлено или удалено или не удалось загрузить манифест развертывания.|

## <a name="publish-an-update"></a><a name="Update"></a>Опубликовать обновление
 Чтобы обновить решение, вы публикуете его снова с помощью **конструктора проекта** или **опубликовать мастера**, а затем скопировать обновленное решение для расположения установки. При копировании файлов в папку установки убедитесь, что предыдущие файлы перезаписываются.

 В следующий раз, когда решение будет проверять обновление, оно найдет и загрузит новую версию автоматически.

## <a name="change-the-installation-location-of-a-solution"></a><a name="Location"></a>Изменение местоположения установки решения
 Путь установки можно добавлять и изменять после публикации решения. При необходимости можно изменить путь установки по одной из следующих причин:

- путь установки неизвестен на момент компиляции программы установки;

- файлы решения копируются в другое расположение;

- изменились имя или адрес сервера, на котором размещены файлы установки.

  Чтобы изменить путь установки решения, необходимо обновить программу установки, после чего пользователи должны запустить ее. Для настроек уровня документа пользователи должны также обновить свойство в своем документе, чтобы оно указывало на новое расположение.

> [!NOTE]
> Если вы не хотите просить пользователей обновлять свои свойства документов, вы можете попросить пользователей получить обновленный документ из места установки.

#### <a name="to-change-the-installation-path-in-the-setup-program"></a>Изменение пути установки в программе установки

1. Откройте окно **Командно-оперативную,** а затем измените каталоги в папку установки.

2. Запустите программу установки с параметром `/url`, который принимает новый путь установки в строковом формате.

    В следующем примере показано, как изменить путь к папке установки на расположение на веб-сайте компании Fabrikam, но вместо URL-адреса можно подставить любой путь:

   ```cmd
   setup.exe /url="http://www.fabrikam.com/newlocation"
   ```

   > [!NOTE]
   > Если появляется сообщение о том, что подпись исполняемого файла станет недействительной, это означает, что сертификат, с помощью которого было подписано решение, стал недействительным, а издатель неизвестен. В результате пользователям необходимо будет подтвердить, что они доверяют источнику решения, прежде чем они смогут установить его.

   > [!NOTE]
   > Чтобы просмотреть текущее значение URL-адреса, выполните команду `setup.exe /url`.

   Для настройки уровня документа пользователи должны открыть документ, а затем обновить его _AssemblyLocation свойством. Ниже описано, как пользователи могут выполнить эту задачу.

#### <a name="to-update-the-_assemblylocation-property-in-a-document"></a>Обновление свойства _AssemblyLocation в документе

1. На вкладке **Файл** выберите **Info**, который показывает следующую иллюстрацию.

     ![Вкладка сведений в Excel](../vsto/media/vsto-infotab.png "Вкладка сведений в Excel")

2. В списке **свойств** выберите **Advanced Properties**, который показывает следующая иллюстрация.

     ![Дополнительные свойства в Excel.](../vsto/media/vsto-advanceddocumentproperties.png "Дополнительные свойства в Excel.")

3. На вкладке **Custom** в списке **свойств** выберите _AssemblyLocation, как показано на следующем рисунке.

     ![Свойство AssemblyLocation.](../vsto/media/vsto-assemblylocationproperty.png "Свойство AssemblyLocation.")

     Коробка **значения** содержит идентификатор манифеста развертывания.

4. Перед идентификатором введите полностью квалифицированный путь документа, а затем бар, в формате *Путь*|*идентификатор* (например, *File://ServerName/FolderName/FileName|74744e4b-e4d6-41eb-84f7-ad20346fe2d9*.

     Для получения дополнительной информации о том, как отформатировать этот идентификатор, смотрите [обзор свойств пользовательских документов.](../vsto/custom-document-properties-overview.md)

5. Выберите кнопку **OK,** а затем сохраните и закройте документ.

6. Чтобы установить решение в указанном расположении, запустите программу установки без параметра "/url".

## <a name="roll-back-a-solution-to-an-earlier-version"></a><a name="Roll"></a>Откат решения к более ранней версии
 При откате решения пользователи возвращаются к более ранней версии этого решения.

#### <a name="to-roll-back-a-solution"></a>Откат решения

1. Откройте расположение установки решения.

2. В папке верхнего уровня публикации удалите манифест развертывания (файл *.vsto).*

3. Найдите вложенную папку версии, к которой требуется вернуться.

4. Скопируйте манифест развертывания из этой папки в папку публикации верхнего уровня.

     Например, чтобы откатить решение, называемое **OutlookAddIn1,** из версии 1.0.0.1 в версию 1.0.0.0, скопируйте файл **OutlookAddIn1.vsto** из **папки OutlookAddIn1_1_0_0_0.** Вставьте файл в папку верхнего уровня, перезаписа развертывания для версии для **OutlookAddIn1_1_0_0_1,** которая уже была.

     На следующем рисунке показана структура папок публикации для данного примера.

     ![Опубликовать структуру Фолдера](../vsto/media/publishfolderstructure.png "Структура папки публикации")

     Когда пользователь в следующий раз откроет приложение или настроенный документ, будет обнаружено изменение манифеста развертывания. Предыдущая версия решения Office будет запущена из кэша ClickOnce.

> [!NOTE]
> Локальные данные сохраняются только для одной предыдущей версии решения. При откате двух версий локальные данные не сохраняются. Для получения дополнительной информации о локальных данных смотрите [локальные и удаленные данные Access в приложениях ClickOnce.](../deployment/accessing-local-and-remote-data-in-clickonce-applications.md)

## <a name="see-also"></a>См. также раздел

- [Развертывание решения Office](../vsto/deploying-an-office-solution.md)
- [Опубликовать решения Office](../vsto/deploying-an-office-solution-by-using-clickonce.md)
- [Как: Опубликовать решение Office с помощью ClickOnce](https://msdn.microsoft.com/2b6c247e-bc04-4ce4-bb64-c4e79bb3d5b8)
- [Как: Установка решения ClickOnce Office](https://msdn.microsoft.com/14702f48-9161-4190-994c-78211fe18065)
- [Как: Опубликовать решение Office уровня документа для сервера SharePoint с помощью ClickOnce](https://msdn.microsoft.com/2408e809-fb78-42a1-9152-00afa1522e58)
- [Создайте пользовательский установщик для офисного решения ClickOnce](https://msdn.microsoft.com/3e5887ed-155f-485d-b8f6-3c02c074085e)