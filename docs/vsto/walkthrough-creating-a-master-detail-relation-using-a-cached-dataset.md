---
title: Создание главного иерархического отношения с помощью кэшированного набора данных
ms.date: 02/02/2017
ms.topic: conceptual
dev_langs:
- VB
- CSharp
helpviewer_keywords:
- master-detail tables [Office development in Visual Studio], walkthroughs
- data caching [Office development in Visual Studio], Master/Detail Relation
author: John-Hart
ms.author: johnhart
manager: jillfra
ms.workload:
- office
ms.openlocfilehash: 0acf84dd983a8c10f2af526ae0bb904eaa90a360
ms.sourcegitcommit: 7eb2fb21805d92f085126f3a820ac274f2216b4e
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 06/22/2019
ms.locfileid: "67328355"
---
# <a name="walkthrough-create-a-master-detail-relation-using-a-cached-dataset"></a>Пошаговое руководство. Создайте отношение основной/подробности, с помощью кэшированного набора данных
  В этом пошаговом руководстве демонстрируется создание иерархического отношения на листе и кэширование данных, решения можно использовать в автономном режиме.

 [!INCLUDE[appliesto_xlalldoc](../vsto/includes/appliesto-xlalldoc-md.md)]

 В этом пошаговом руководстве описаны следующие процедуры.

- Добавление элементов управления на лист.

- Настройка набора данных должен быть помещен в кэш на листе.

- Добавьте код, чтобы включить прокрутку записей.

- Тестирование проекта.

> [!NOTE]
> Отображаемые на компьютере имена или расположения некоторых элементов пользовательского интерфейса Visual Studio могут отличаться от указанных в следующих инструкциях. Это зависит от имеющегося выпуска Visual Studio и используемых параметров. Дополнительные сведения см. в разделе [Персонализация интегрированной среды разработки Visual Studio](../ide/personalizing-the-visual-studio-ide.md).

## <a name="prerequisites"></a>Предварительные требования
 Ниже приведены компоненты, необходимые для выполнения данного пошагового руководства.

- [!INCLUDE[vsto_vsprereq](../vsto/includes/vsto-vsprereq-md.md)]

- [!INCLUDE[Excel_15_short](../vsto/includes/excel-15-short-md.md)] или [!INCLUDE[Excel_14_short](../vsto/includes/excel-14-short-md.md)].

- Доступ к базе данных "Борей" SQL Server. База данных может быть на компьютере разработчика или на сервере.

- Разрешения на чтение и запись к базе данных SQL Server.

## <a name="create-a-new-project"></a>Создание нового проекта
 На этом шаге вы создадите проект книги Excel.

### <a name="to-create-a-new-project"></a>Создание нового проекта

1. Создайте проект книги Excel с именем **Мой основной / подробности**, с помощью Visual Basic или C#. Убедитесь, что **создания документа** выбран. Дополнительные сведения см. в разделе [Практическое руководство. Создание проектов Office в Visual Studio](../vsto/how-to-create-office-projects-in-visual-studio.md).

   Visual Studio открывает новую книгу Excel в конструкторе и добавляет **Мой основной / подробности** проект **обозревателе решений**.

## <a name="create-the-data-source"></a>Создание источника данных
 С помощью окна **Источники данных** добавьте типизированный набор данных в свой проект.

### <a name="to-create-the-data-source"></a>Создание источника данных

1. Если **источников данных** окно не отображается, откройте его в строке меню выберите **представление** > **Other Windows**  >   **Источники данных**.

2. Выберите команду **Добавить новый источник данных** , чтобы запустить **Мастер настройки источника данных**.

3. Выберите **базы данных** и нажмите кнопку **Далее**.

4. Выберите подключение данных к базе данных SQL Server Northwind или добавьте новое подключение с помощью **новое подключение** кнопки.

5. После выбора или создания подключения, нажмите кнопку **Далее**.

6. Очистить параметр, чтобы сохранить подключение, если он выбран, а затем нажмите кнопку **Далее**.

7. Разверните **таблиц** узел в **объектов базы данных** окна.

8. Выберите **заказы** таблицы и **Order Details** таблицы.

9. Нажмите кнопку **Готово**.

   Мастер добавляет две таблицы, чтобы **источников данных** окна. Он также добавляет типизированный набор данных в проект, который является видимым в **обозревателе решений**.

## <a name="add-controls-to-the-worksheet"></a>Добавление элементов управления на лист
 На этом шаге вы добавите именованного диапазона, объект списка и две кнопки для первого листа. Сначала добавьте именованный диапазон и объект списка из **источников данных** окна таким образом, чтобы они автоматически привязываются к источнику данных. Добавьте кнопки, из **элементов**.

### <a name="to-add-a-named-range-and-a-list-object"></a>Добавление именованного диапазона и объекта списка

1. Убедитесь, что **Мои Master-Detail.xlsx** книга открыта в конструкторе Visual Studio с **Sheet1** отображается.

2. Откройте **источников данных** окне и разверните **заказы** узла.

3. Выберите **OrderID** столбец, а затем щелкните стрелку раскрывающегося списка, который отображается.

4. Нажмите кнопку **NamedRange** в раскрывающемся списке, а затем перетащите **OrderID** столбца в ячейку **A2**.

     Объект <xref:Microsoft.Office.Tools.Excel.NamedRange> управления с именем `OrderIDNamedRange` создается в ячейке **A2**. В то же время <xref:System.Windows.Forms.BindingSource> с именем `OrdersBindingSource`, адаптер таблицы и <xref:System.Data.DataSet> экземпляр добавляются в проект. Элемент управления привязан к <xref:System.Windows.Forms.BindingSource>, который, в свою очередь, привязан к <xref:System.Data.DataSet> экземпляра.

5. Прокрутите вниз к столбцам, которые находятся под **заказы** таблицы. В нижней части списка находится **Order Details** таблицы; именно здесь, так как он является дочерним элементом **заказы** таблицы. Выберите этот параметр, **Order Details** таблицы, не тот, который находится на том же уровне, что **заказы** таблицы, а затем щелкните стрелку раскрывающегося списка, который отображается.

6. Нажмите кнопку **ListObject** в раскрывающемся списке, а затем перетащите **OrderDetails** таблице к ячейке **A6**.

7. Объект <xref:Microsoft.Office.Tools.Excel.ListObject> управления с именем **Order_DetailsListObject** создается в ячейке **A6**и привязывается к <xref:System.Windows.Forms.BindingSource>.

### <a name="to-add-two-buttons"></a>Добавление двух кнопок

1. Из **стандартные элементы управления** вкладке **элементов**, добавьте <xref:System.Windows.Forms.Button> управления ячейку **A3** листа.

    Эта кнопка называется `Button1`.

2. Добавьте еще один <xref:System.Windows.Forms.Button> управления ячейку **B3** листа.

    Эта кнопка называется `Button2`.

   Далее следует пометьте набор данных должен быть помещен в кэш в документе.

## <a name="cache-the-dataset"></a>Кэширование набора данных
 Пометить набор данных должен кэшироваться в документе, сделав набора данных, открытый, так и задание **CacheInDocument** свойство.

### <a name="to-cache-the-dataset"></a>Для кэширования набора данных

1. Выберите **NorthwindDataSet** в области компонентов.

2. В **свойства** измените **модификаторы** свойства **открытый**.

    Наборы данных должны быть открытыми, прежде чем включено кэширование.

3. Изменение **CacheInDocument** свойства **True**.

   Следующий шаг — добавить текст для кнопок и в C# добавьте код для привязки обработчиков событий.

## <a name="initialize-the-controls"></a>Инициализация элементов управления
 Задать текст кнопки и добавьте обработчики событий <xref:Microsoft.Office.Tools.Excel.Workbook.Startup> событий.

### <a name="to-initialize-the-data-and-the-controls"></a>Чтобы инициализировать данные и элементы управления

1. В **обозревателе решений**, щелкните правой кнопкой мыши **Sheet1.vb** или **Sheet1.cs**, а затем нажмите кнопку **просмотреть код** в контекстном меню.

2. Добавьте следующий код, чтобы `Sheet1_Startup` метод, чтобы задать текст для кнопок.

     [!code-vb[Trin_VstcoreDataExcel#15](../vsto/codesnippet/VisualBasic/Trin_VstcoreDataExcelVB/Sheet2.vb#15)]
     [!code-csharp[Trin_VstcoreDataExcel#15](../vsto/codesnippet/CSharp/Trin_VstcoreDataExcelCS/Sheet2.cs#15)]

3. Только в C# добавьте обработчики событий для кнопки события щелчка `Sheet1_Startup` метод.

     [!code-csharp[Trin_VstcoreDataExcel#16](../vsto/codesnippet/CSharp/Trin_VstcoreDataExcelCS/Sheet2.cs#16)]

## <a name="add-code-to-enable-scrolling-through-the-records"></a>Добавьте код, чтобы включить прокрутку записей
 Добавьте код для <xref:System.Windows.Forms.Control.Click> обработчик событий для каждой кнопки для перемещения по записям.

### <a name="to-scroll-through-the-records"></a>Прокрутка записей

1. Добавьте обработчик событий для <xref:System.Windows.Forms.Control.Click> событие `Button1`и добавьте следующий код для перемещения по записям в обратном направлении:

     [!code-vb[Trin_VstcoreDataExcel#17](../vsto/codesnippet/VisualBasic/Trin_VstcoreDataExcelVB/Sheet2.vb#17)]
     [!code-csharp[Trin_VstcoreDataExcel#17](../vsto/codesnippet/CSharp/Trin_VstcoreDataExcelCS/Sheet2.cs#17)]

2. Добавьте обработчик событий для <xref:System.Windows.Forms.Control.Click> событие `Button2`и добавьте следующий код, чтобы перемещаться по записи:

     [!code-vb[Trin_VstcoreDataExcel#18](../vsto/codesnippet/VisualBasic/Trin_VstcoreDataExcelVB/Sheet2.vb#18)]
     [!code-csharp[Trin_VstcoreDataExcel#18](../vsto/codesnippet/CSharp/Trin_VstcoreDataExcelCS/Sheet2.cs#18)]

## <a name="test-the-application"></a>Тестирование приложения
 Теперь можно протестировать книгу, чтобы убедиться в том, что данные отображаются должным образом и что решение можно использовать автономный режим.

### <a name="to-test-the-data-caching"></a>Чтобы проверить кэширование данных

1. Нажмите клавишу **F5**.

2. Убедитесь, что именованный диапазон и объект списка заполняются данными из источника данных.

3. Выполните прокрутку записей с помощью кнопок.

4. Сохраните книгу, а затем закройте книгу и Visual Studio.

5. Отключите подключение к базе данных. Отключите сетевой кабель с компьютера, если база данных расположена на сервере, или остановите службу SQL Server, если база данных находится на компьютере разработчика.

6. Откройте Excel, а затем откройте **Мои Master-Detail.xlsx** из *\bin* каталога ( *\My Master-Detail\bin* в Visual Basic или *\My Master-Detail\bin\ Отладка* в C#).

7. Выполните прокрутку записей, чтобы увидеть, что лист будет нормально работать без подключения к сети.

8. Повторно подключиться к базе данных. Снова подключения компьютера к сети, если база данных расположена на сервере, или запустите службу SQL Server, если база данных находится на компьютере разработчика.

## <a name="next-steps"></a>Следующие шаги
 В этом пошаговом руководстве описываются основные принципы создания отношения данных «основной/подробности» на листе и кэширование набора данных. Ниже приводятся некоторые из возможных последующих задач.

- Развертывание решения. Дополнительные сведения см. в разделе [развертывание решения Office](../vsto/deploying-an-office-solution.md)

## <a name="see-also"></a>См. также
- [Привязка данных к элементам управления в решениях Office](../vsto/binding-data-to-controls-in-office-solutions.md)
- [Данные в решениях Office](../vsto/data-in-office-solutions.md)
- [Кэширование данных](../vsto/caching-data.md)
- [Ведущие элементы и элементы управления](../vsto/host-items-and-host-controls-overview.md)
