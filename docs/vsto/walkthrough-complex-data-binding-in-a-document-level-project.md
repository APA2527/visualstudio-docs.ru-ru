---
title: Пошаговое руководство. Сложная привязка данных в проекте уровня документа
ms.date: 02/02/2017
ms.topic: conceptual
dev_langs:
- VB
- CSharp
helpviewer_keywords:
- data [Office development in Visual Studio], binding data
- complex data [Office development in Visual Studio]
- multiple column data binding [Office development in Visual Studio]
- data binding [Office development in Visual Studio], multiple columns
author: John-Hart
ms.author: johnhart
manager: jillfra
ms.workload:
- office
ms.openlocfilehash: aabd45871e55fd22b9b9e35597555fd13b15d6eb
ms.sourcegitcommit: 94b3a052fb1229c7e7f8804b09c1d403385c7630
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/23/2019
ms.locfileid: "62981680"
---
# <a name="walkthrough-complex-data-binding-in-a-document-level-project"></a>Пошаговое руководство. Сложная привязка данных в проекте уровня документа
  В этом пошаговом руководстве демонстрируются основные принципы сложная привязка данных в проекте уровня документа. Можно привязать несколько ячеек на листе Microsoft Office Excel к полям в базе данных "Борей" SQL Server.

 [!INCLUDE[appliesto_xlalldoc](../vsto/includes/appliesto-xlalldoc-md.md)]

 В данном пошаговом руководстве рассмотрены следующие задачи:

- Добавление источника данных к проекту книги.

- Добавление элементов управления с привязкой данных в лист.

- Сохранение изменений данных в базе данных.

  [!INCLUDE[note_settings_general](../sharepoint/includes/note-settings-general-md.md)]

## <a name="prerequisites"></a>Предварительные требования
 Ниже приведены компоненты, необходимые для выполнения данного пошагового руководства.

- [!INCLUDE[vsto_vsprereq](../vsto/includes/vsto-vsprereq-md.md)]

- [!INCLUDE[Excel_15_short](../vsto/includes/excel-15-short-md.md)] или [!INCLUDE[Excel_14_short](../vsto/includes/excel-14-short-md.md)].

- Доступ к серверу с образцом базы данных "Борей" SQL Server.

- Разрешения на чтение и запись к базе данных SQL Server.

## <a name="create-a-new-project"></a>Создание нового проекта
 Первым шагом является создание проекта книги Excel.

### <a name="to-create-a-new-project"></a>Создание нового проекта

1. Создайте проект книги Excel с именем **сложная привязка данных**. В мастере выберите **создания документа**.

     Дополнительные сведения см. в разделе [Как Создание проектов Office в Visual Studio](../vsto/how-to-create-office-projects-in-visual-studio.md).

     Visual Studio открывает новую книгу Excel в конструкторе и добавляет **сложная привязка данных** проект **обозревателе решений**.

## <a name="create-the-data-source"></a>Создание источника данных
 С помощью окна **Источники данных** добавьте типизированный набор данных в свой проект.

### <a name="to-create-the-data-source"></a>Создание источника данных

1. Если **источников данных** окно не отображается, откройте его в строке меню выберите **представление** > **Other Windows**  >   **Источники данных**.

2. Выберите команду **Добавить новый источник данных** , чтобы запустить **Мастер настройки источника данных**.

3. Выберите **базы данных** и нажмите кнопку **Далее**.

4. Выберите подключение данных к базе данных SQL Server Northwind или добавьте новое подключение с помощью **новое подключение** кнопки.

5. После выбора или создания подключения нажмите кнопку **Далее**.

6. Очистить параметр, чтобы сохранить подключение, если он выбран, а затем нажмите кнопку **Далее**.

7. Разверните **таблиц** узел в **объектов базы данных** окна.

8. Установите флажок рядом с полем **сотрудников** таблицы.

9. Нажмите кнопку **Готово**.

   Мастер добавляет **сотрудников** таблицы **источников данных** окна. Он также добавляет типизированный набор данных в проект, который является видимым в **обозревателе решений**.

## <a name="add-controls-to-the-worksheet"></a>Добавление элементов управления на лист
 На листе отобразится **сотрудников** таблицы при открытии книги. Пользователи смогут вносить изменения в данные и сохранить эти изменения в базе данных нажатием кнопки.

 Чтобы автоматически привязать лист в таблицу, можно добавить <xref:Microsoft.Office.Tools.Excel.ListObject> управления на лист из **источников данных** окна. Чтобы дать пользователю возможность сохранить изменения, добавьте <xref:System.Windows.Forms.Button> управления из **элементов**.

#### <a name="to-add-a-list-object"></a>Чтобы добавить объект списка

1. Убедитесь, что **Мои сложных данных Binding.xlsx** книга открыта в конструкторе Visual Studio с **Sheet1** отображается.

2. Откройте **источников данных** и выберите **сотрудников** узла.

3. Щелкните стрелку раскрывающегося списка, который отображается.

4. Выберите **ListObject** в раскрывающемся списке.

5. Перетащите **сотрудников** таблице к ячейке **A6**.

     Объект <xref:Microsoft.Office.Tools.Excel.ListObject> управления с именем `EmployeesListObject` создается в ячейке **A6**. В то же время <xref:System.Windows.Forms.BindingSource> с именем `EmployeesBindingSource`, адаптер таблицы и <xref:System.Data.DataSet> экземпляр добавляются в проект. Элемент управления привязан к <xref:System.Windows.Forms.BindingSource>, который, в свою очередь, привязан к <xref:System.Data.DataSet> экземпляра.

### <a name="to-add-a-button"></a>Чтобы добавить кнопку

1. Из **стандартные элементы управления** вкладке **элементов**, добавьте <xref:System.Windows.Forms.Button> управления ячейку **A4** листа.

   Следующий шаг — добавить текст к кнопке, при открытии листа.

## <a name="initialize-the-control"></a>Инициализация элемента управления
 Добавление текста кнопки в <xref:Microsoft.Office.Tools.Excel.Worksheet.Startup> обработчик событий.

### <a name="to-initialize-the-control"></a>Инициализация элемента управления

1. В **обозревателе решений**, щелкните правой кнопкой мыши **Sheet1.vb** или **Sheet1.cs**, а затем нажмите кнопку **просмотреть код** в контекстном меню.

2. Добавьте следующий код, чтобы `Sheet1_Startup` метод, чтобы задать текст для кнопки b`utton`.

    [!code-csharp[Trin_VstcoreDataExcel#8](../vsto/codesnippet/CSharp/Trin_VstcoreDataExcelCS/Sheet3.cs#8)]
    [!code-vb[Trin_VstcoreDataExcel#8](../vsto/codesnippet/VisualBasic/Trin_VstcoreDataExcelVB/Sheet3.vb#8)]

3. Только в C# добавьте обработчик событий для <xref:System.Windows.Forms.Control.Click> события `Sheet1_Startup` метод.

    [!code-csharp[Trin_VstcoreDataExcel#9](../vsto/codesnippet/CSharp/Trin_VstcoreDataExcelCS/Sheet3.cs#9)]

   Теперь добавьте код для обработки <xref:System.Windows.Forms.Control.Click> события кнопки.

## <a name="save-changes-to-the-database"></a>Сохранить изменения в базе данных
 Изменения, внесенные в данные существуют только в локальном наборе данных, пока они явно будут сохранены в базе данных.

### <a name="to-save-changes-to-the-database"></a>Чтобы сохранить изменения в базу данных

1. Добавьте обработчик событий для <xref:System.Windows.Forms.Control.Click> событие `button`и добавьте следующий код, чтобы зафиксировать все изменения, внесенные в наборе данных в базе данных.

     [!code-csharp[Trin_VstcoreDataExcel#10](../vsto/codesnippet/CSharp/Trin_VstcoreDataExcelCS/Sheet3.cs#10)]
     [!code-vb[Trin_VstcoreDataExcel#10](../vsto/codesnippet/VisualBasic/Trin_VstcoreDataExcelVB/Sheet3.vb#10)]

## <a name="test-the-application"></a>Тестирование приложения
 Теперь можно протестировать книгу, чтобы убедиться, что данные отображаются должным образом и что можно управлять данными в объекте списка.

### <a name="to-test-the-data-binding"></a>Для проверки привязки данных

- Нажмите клавишу **F5**.

     Убедитесь, что при открытии книги, то объект списка заполняется данными из **сотрудников** таблицы.

### <a name="to-modify-data"></a>Для изменения данных

1. Щелкните ячейку **B7**, который должен содержать имя **Davolio**.

2. Введите имя **Андерсон**, а затем нажмите клавишу **ввод**.

### <a name="to-modify-a-column-header"></a>Чтобы изменить заголовок столбца

1. Щелкните ячейку, содержащую заголовок столбца **LastName**.

2. Тип **Фамилия**, с пробелом между словами и нажмите клавишу **ввод**.

### <a name="to-save-data"></a>Для сохранения данных

1. Нажмите кнопку **Сохранить** на рабочем листе.

2. Выйдите из Excel. Нажмите кнопку **нет** когда будет предложено сохранить изменения.

3. Нажмите клавишу **F5** для повторного запуска проекта.

     Объект-список заполняется данными из **сотрудников** таблицы.

4. Обратите внимание, что имя в ячейке **B7** по-прежнему **Андерсон**, являющийся данные изменения внесены и сохранены в базе данных. Заголовок столбца **LastName** был изменен обратно в их исходной форме, без пробелов, так как заголовок столбца не привязан к базе данных, и вы не сохранили изменения, внесенные в журнал.

### <a name="to-add-new-rows"></a>Чтобы добавить новые строки

1. Выберите ячейку в объекте списка.

    Появится новая строка в нижней части списка, символ звездочки (**\\***) в первую ячейку новой строки.

2. Добавьте следующие сведения в пустой строке.

   |EmployeeID|LastName|FirstName|Заголовок|
   |----------------|--------------|---------------|-----------|
   |10|Климов|Сергей|Менеджер по продажам|

### <a name="to-delete-rows"></a>Для удаления строк

- Щелкните правой кнопкой мыши номер 16 (строку 16) на левой стороне листа, а затем нажмите кнопку **удалить**.

### <a name="to-sort-the-rows-in-the-list"></a>Для сортировки строк в списке

1. Выберите ячейку в списке.

     В заголовке каждого столбца отображаются кнопки со стрелками.

2. Нажмите кнопку со стрелкой в **Фамилия** заголовок столбца.

3. Нажмите кнопку **Сортировка по возрастанию**.

     Строки сортируются в алфавитном порядке по фамилии.

### <a name="to-filter-information"></a>Чтобы отфильтровать сведения

1. Выберите ячейку в списке.

2. Нажмите кнопку со стрелкой в **Title** заголовок столбца.

3. Нажмите кнопку **Торговый представитель**.

     В списке отображаются только те строки, которые имеют **Торговый представитель** в **Title** столбца.

4. Нажмите кнопку со стрелкой в **Title** заголовок столбца еще раз.

5. Нажмите кнопку **(все)**.

     Фильтр удаляется, и все строки будут включены.

## <a name="next-steps"></a>Следующие шаги
 В этом пошаговом руководстве описываются основные принципы привязки таблицы в базе данных в объект списка. Ниже приводятся некоторые из возможных последующих задач.

- Кэширование данных использования в автономном режиме. Дополнительные сведения см. в разделе [Как Кэшировать данные для использования в автономном режиме или на сервере](../vsto/how-to-cache-data-for-use-offline-or-on-a-server.md).

- Развертывание решения. Дополнительные сведения см. в разделе [развертывание решения Office](../vsto/deploying-an-office-solution.md).

- Создайте отношение «основной/подробности» между полем и таблицей. Дополнительные сведения см. в разделе [Пошаговое руководство: Создайте отношение основной/подробности, с помощью кэшированного набора данных](../vsto/walkthrough-creating-a-master-detail-relation-using-a-cached-dataset.md).

## <a name="see-also"></a>См. также
- [Привязка данных к элементам управления в решениях Office](../vsto/binding-data-to-controls-in-office-solutions.md)
- [Данные в решениях Office](../vsto/data-in-office-solutions.md)
- [Пошаговое руководство: Простая привязка данных в проекте уровня документа](../vsto/walkthrough-simple-data-binding-in-a-document-level-project.md)
