---
title: Рекомендации по разработке для COM, VSTO и VBA надстройки в Office
ms.date: 07/25/2017
ms.topic: conceptual
dev_langs:
- ''
helpviewer_keywords:
- ''
author: John-Hart
ms.author: johnhart
manager: jillfra
ms.workload:
- office
ms.openlocfilehash: 2fcc2fe575bd6b526f5f66d936625c87e91b0b39
ms.sourcegitcommit: 94b3a052fb1229c7e7f8804b09c1d403385c7630
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/23/2019
ms.locfileid: "62999787"
---
# <a name="development-best-practices-for-com-vsto-and-vba-add-ins-in-office"></a>Рекомендации по разработке для COM, VSTO и VBA надстройки в Office
  Если вы разрабатываете надстройки COM, VSTO и VBA для Office, выполните рекомендации по разработке, описанные в этой статье.   Это поможет обеспечить:

- Совместимость надстройки для различных версий и развертывание пакета Office.
- Меньший уровень сложности развертывания надстройки для пользователей и администраторов ИТ.
- Непредвиденные сбои время установки или из надстройки не возникают.

>Примечание. С помощью [моста для классических](/windows/uwp/porting/desktop-to-uwp-root) для подготовки вашей COM, VSTO и VBA надстройка для Windows Store не поддерживается. Надстройки COM, VSTO и VBA не может распространяться в Windows Store или Office Store.

## <a name="do-not-check-for-office-during-installation"></a>Не проверять во время установки Office
 Мы не рекомендуем использовать надстройки обнаружения установки во время установки надстройки Office. Если Microsoft Office не установлен, можно установить надстройки и пользователь сможет получить доступ к после установки Office.

## <a name="use-embedded-interop-types-nopia"></a>Использовать внедренные типы взаимодействия (NoPIA)
Если решение использует .NET 4.0 или более поздней версии, используйте типы внедренных сборок взаимодействия (NoPIA) вместо в зависимости от Office основного взаимодействия сборки (распространяемую сборку PIA). С помощью внедрения типа уменьшает размер установки решения и гарантирует совместимость с будущими версиями. Office 2010 была последней версией Office, которая поставлялась распространяемую сборку PIA. Дополнительные сведения см. в разделе [Пошаговое руководство: Внедрение данных о типе из сборок Microsoft Office](https://msdn.microsoft.com/library/ee317478.aspx) и [эквивалентность типов и внедренные типы взаимодействия](/windows/uwp/porting/desktop-to-uwp-root).

Если решение использует более раннюю версию .NET, рекомендуется обновить решение для использования .NET 4.0 или более поздней версии. Использование .NET 4.0 или более поздней версии сокращает необходимых компонентов среды выполнения на более новых версиях Windows.

## <a name="avoid-depending-on-specific-office-versions"></a>Избежать зависимости от конкретных версий Office
Если решение использует функциональные возможности, которая доступна только в более новых версиях Office, проверьте возможность (если это возможно, на уровне функций;) во время выполнения (например, с помощью исключения, обработка или по версии). Проверка минимальные версии, а не конкретные версии, с помощью поддерживаемых интерфейсов API в объектной модели, такие как [Application.Version свойство](<xref:Microsoft.Office.Interop.Excel._Application.Version%2A>). Мы не рекомендуем зависят Office двоичных метаданных пути установки и разделов реестра, так как они могут меняться от установок, сред и версий.

## <a name="enable-both-32-bit-and-64-bit-office-usage"></a>Разрешить 32-разрядных и 64-разрядных использования Office
Целевой сборки по умолчанию должен поддерживать 32-(x86) и 64-разрядных (x64), если решение зависит от библиотек, доступных только для определенной разрядности. 64-разрядной версии Office постоянно расширяется внедрения, особенно в средах с большими данными. Поддержка 32-разрядных и 64-разрядных упрощает для пользователей для перехода между 32-разрядных и 64-разрядных версий Office.

При написании кода VBA, используйте 64-разрядных safe инструкции declare и преобразовать переменные соответствующим образом. Кроме того убедитесь, что документы могут совместно использоваться пользователями под управлением 32-разрядной или 64-разрядных версиях Office, предоставляя код для каждого разрядность. Дополнительные сведения см. в разделе [64-разрядных Visual Basic для приложений Обзор](/office/vba/Language/Concepts/Getting-Started/64-bit-visual-basic-for-applications-overview).

## <a name="support-restricted-environments"></a>Поддержка сред
Решение не требует прав администратора или повышения прав учетной записи пользователя. Кроме того решение не должно влиять на задание или изменение:

- Текущий рабочий каталог.
- Каталоги загрузки библиотеки DLL.
- В переменную PATH.

## <a name="change-the-save-location-of-shared-data-and-settings"></a>Изменить сохранения расположение общих данных и параметры
Если решение состоит из надстройки и процесс, который является внешним по отношению к Office, не используйте папки данных приложения или реестру для обмена данными или параметров между надстройкой и внешний процесс. Вместо этого рекомендуется с помощью временной папки, папки документов или каталог установки решения.

## <a name="increment-the-version-number-with-each-update"></a>Увеличение номера версии при каждом обновлении
Настройка номера версии двоичных файлов в решении и увеличить его при каждом обновлении. Это упростит пользователям выявлять изменения между версиями и оценка совместимости.

## <a name="provide-support-statements-for-the-latest-versions-of-office"></a>Укажите положения о поддержке для последних версий Office
Заказчики спрашивают вас независимых поставщиков программного обеспечения для предоставления положения о поддержке для их COM, VSTO и VBA надстроек, которые работают в Office. Листинг помогает клиентам явной поддержки инструкций с помощью Office 365 профессиональный плюс средства оценки готовности понять технической поддержки.

Чтобы предоставить положения о поддержке для клиентских приложений Office (например, Word или Excel), сначала убедитесь, что надстройки выполнения в текущем выпуске Office и затем зафиксировать для предоставления обновлений, если надстройке нарушает работу в будущем выпуске. У вас нет для тестирования надстройки, когда корпорация Майкрософт выпускает новую сборку или обновление для Office. Microsoft редко изменяется платформой расширяемости COM, VSTO и VBA в Office, и эти изменения будут хорошо документирован.

>Внимание! Майкрософт ведет список поддерживаемых надстройки для отчетов о готовности и контактную информацию для независимых поставщиков программного обеспечения. Чтобы получить надстройку в списке, см. в разделе [ https://aka.ms/readyforwindows ](https://aka.ms/readyforwindows).

## <a name="use-process-monitor-to-help-debug-installation-or-loading-issues"></a>Использование монитора процессов для отладки установки или загрузки проблемы
Если надстройка имеет проблемы совместимости, во время установки или нагрузки, они могут быть связаны с проблемы доступа файловую систему и реестр. Используйте [Process Monitor](/sysinternals/downloads/procmon) или аналогичное средство отладки для входа и сравните поведение для рабочей среды, чтобы помочь определить причину проблемы.
