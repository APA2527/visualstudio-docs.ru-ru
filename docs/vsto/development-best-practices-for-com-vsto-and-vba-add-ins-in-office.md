---
title: 'Рекомендации по разработке: COM, VSTO, & надстроек VBA в Office'
description: Ознакомьтесь с рекомендуемыми рекомендациями при разработке надстроек COM, VSTO и VBA для Microsoft Office.
ms.custom: SEO-VS-2020
titleSuffix: ''
ms.date: 07/25/2017
ms.topic: conceptual
dev_langs:
- ''
helpviewer_keywords:
- ''
author: John-Hart
ms.author: johnhart
manager: jillfra
ms.workload:
- office
ms.openlocfilehash: e7387b58bae486588687fe018453fafb5d6571f7
ms.sourcegitcommit: ce85cff795df29e2bd773b4346cd718dccda5337
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 12/08/2020
ms.locfileid: "96846900"
---
# <a name="development-best-practices-for-com-vsto-and-vba-add-ins-in-office"></a>Рекомендации по разработке для надстроек COM, VSTO и VBA в Office
  При разработке надстроек COM, VSTO или VBA для Office следуйте рекомендациям по разработке, описанным в этой статье.   На этом этапе вы можете:

- Совместимость надстроек в разных версиях и развертываниях Office.
- Сокращение сложности развертывания надстроек для пользователей и ИТ-администраторов.
- Незапланированная установка или сбои во время выполнения надстройки не выполняются.

>Примечание. Использование [моста для настольных компьютеров](/windows/uwp/porting/desktop-to-uwp-root) для подготовки надстройки COM, VSTO или VBA для Магазина Windows не поддерживается. Надстройки COM, VSTO и VBA не могут распространяться в магазине Windows или магазине Office.

## <a name="do-not-check-for-office-during-installation"></a>Не проверять Office во время установки
 Мы не рекомендуем, чтобы надстройка определяла, установлен ли Office в процессе установки надстройки. Если Office не установлен, можно установить надстройку, и пользователь сможет получить к ней доступ после установки Office.

## <a name="use-embedded-interop-types-nopia"></a>Использование внедренных типов взаимодействия (Нопиа)
Если в решении используется .NET 4,0 или более поздней версии, используйте внедренные типы взаимодействия (Нопиа), а не в зависимости от распространяемого пакета сборок взаимодействия (PIA) для Office. Использование внедрения типов сокращает размер установки вашего решения и обеспечивает совместимость в будущем. Office 2010 был последней версией Office, которая поставляла распространяемый пакет PIA. Дополнительные сведения см. в разделе [Пошаговое руководство. внедрение сведений о типах из сборок Microsoft Office](/previous-versions/ee317478(v=vs.140)) и типов [эквивалентности и внедренных типов взаимодействия](/windows/uwp/porting/desktop-to-uwp-root).

Если в решении используется более ранняя версия .NET, рекомендуется обновить решение для использования .NET 4,0 или более поздней версии. Использование .NET 4,0 или более поздней версии сокращает предварительные требования среды выполнения в более новых версиях Windows.

## <a name="avoid-depending-on-specific-office-versions"></a>Избегайте в зависимости от конкретных версий Office
Если в решении используются функции, доступные только в более новых версиях Office, убедитесь, что такая возможность существует (если возможно, на уровне функции) во время выполнения (например, с помощью обработки исключений или путем проверки версии). Проверка минимальных версий, а не конкретных версий с помощью поддерживаемых API в объектной модели, например [свойства приложения. Version](<xref:Microsoft.Office.Interop.Excel._Application.Version%2A>). Не рекомендуется использовать двоичные метаданные Office, пути установки или разделы реестра, так как они могут изменяться между установками, средами и версиями.

## <a name="enable-both-32-bit-and-64-bit-office-usage"></a>Включить 32-разрядное и 64-разрядное использование Office
Целевой объект сборки по умолчанию должен поддерживать 32-bit (x86) и 64-bit (x64), если решение не зависит от библиотек, доступных только для определенной разрядности. 64-разрядная версия Office увеличивается при внедрении, особенно в средах больших данных. Поддержка как 32-разрядных, так и 64-бит упрощает для пользователей переход между 32-и 64-bit версиями Office.

При написании кода VBA используйте 64-разрядные надежные инструкции DECLARE и преобразуйте переменные соответствующим образом. Кроме того, убедитесь, что документы могут совместно использоваться пользователями, работающими под управлением 32-разрядных или 64-разрядных версий Office, путем предоставления кода для каждой разрядности. Дополнительные сведения см. в статье [64-bit Visual Basic for Applications](/office/vba/Language/Concepts/Getting-Started/64-bit-visual-basic-for-applications-overview).

## <a name="support-restricted-environments"></a>Поддержка ограниченных сред
Решение не должно требовать повышения прав учетной записи пользователя или администратора. Кроме того, решение не должно зависеть от настройки или изменения:

- текущий рабочий каталог.
- Каталоги загрузки библиотек DLL.
- Переменная PATH.

## <a name="change-the-save-location-of-shared-data-and-settings"></a>Изменение расположения сохранения общих данных и параметров
Если решение состоит из надстройки и процесса, который является внешним по отношению к Office, не используйте папку данных приложения пользователя или реестр для обмена данными или параметрами между надстройкой и внешним процессом. Вместо этого рассмотрите возможность использования временной папки пользователя, папки документов или каталога установки решения.

## <a name="increment-the-version-number-with-each-update"></a>Увеличение номера версии при каждом обновлении
Задайте номер версии двоичных файлов в решении и увеличьте его при каждом обновлении. Это упростит пользователям определять различия между версиями и оценивать совместимость.

## <a name="provide-support-statements-for-the-latest-versions-of-office"></a>Предоставление инструкций поддержки для последних версий Office
Клиенты запрашивают у поставщика программного обеспечения поддержку инструкций для надстроек COM, VSTO и VBA, работающих в Office. Список явных инструкций по поддержке помогает клиентам использовать Microsoft 365 приложения для средств обеспечения готовности к выпуску Enterprise.

Чтобы предоставить заявления о поддержке для клиентских приложений Office (например, Word или Excel), сначала убедитесь, что надстройки выполняются в текущем выпуске Office, а затем зафиксируйте, чтобы предоставить обновления, если надстройка будет приостановлена в будущем выпуске. Тестирование надстроек не требуется, когда корпорация Майкрософт выпускает новую сборку или обновляет Office. Корпорация Майкрософт редко изменяет платформу расширяемости COM, VSTO и VBA в Office, и эти изменения будут хорошо документированы.

>Важно. Корпорация Майкрософт поддерживает список поддерживаемых надстроек для отчетов о готовности и контактную информацию ISV. Чтобы получить список надстроек, см. раздел [/конфигмгр/десктоп-Аналитикс/РЕАДИ-фор-Виндовс](/configmgr/desktop-analytics/ready-for-windows).

## <a name="use-process-monitor-to-help-debug-installation-or-loading-issues"></a>Использование монитора процессов для отладки установки или загрузки проблем
Если во время установки или загрузки надстройки возникают проблемы совместимости, они могут быть связаны с проблемами доступа к файлу или реестру. Используйте [Монитор процессов](/sysinternals/downloads/procmon) или аналогичное средство отладки для ведения журнала и сравнения поведения в рабочей среде, чтобы помочь определить проблему.