---
title: Записи в реестре для адбов VSTO
ms.date: 08/14/2019
ms.topic: conceptual
dev_langs:
- VB
- CSharp
helpviewer_keywords:
- LoadBehavior entry
- add-ins [Office development in Visual Studio], registry entries
- registry keys [Office development in Visual Studio]
- application-level add-ins [Office development in Visual Studio], registry entries
- registry entries [Office development in Visual Studio]
author: John-Hart
ms.author: johnhart
manager: jillfra
ms.workload:
- office
ms.openlocfilehash: b02b50c42692ec2fd455358df5157e0b8481562b
ms.sourcegitcommit: b32fbbcbc43910b0ed7ce79aa9a22f2ed36ab57e
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/16/2020
ms.locfileid: "79416527"
---
# <a name="registry-entries-for-vsto-add-ins"></a>Записи в реестре для адбов VSTO
  При развертывании надстроек VSTO, созданных с помощью Visual Studio, необходимо создать определенный набор записей реестра. Эти записи реестра предоставляют сведения, позволяющие приложению Microsoft Office обнаружить и загрузить надстройку VSTO.

 [!INCLUDE[appliesto_allapp](../vsto/includes/appliesto-allapp-md.md)]

[!include[Add-ins note](includes/addinsnote.md)]

 При выполнении сборки проекта Visual Studio создает эти записи реестра на компьютере разработчика, упрощая запуск и отладку надстройки VSTO. Если вы используете ClickOnce для развертывания add-in VSTO, записи в реестре автоматически создаются на компьютере конечных пользователей. Если вы используете установку Windows для развертывания дополнения VSTO, необходимо настроить проект InstallShield Limited Edition для создания записей реестра на компьютере конечных пользователей.

 Дополнительные сведения об использовании записей реестра для надстроек VSTO во время процесса загрузки см. в разделе [Architecture of VSTO Add-ins](../vsto/architecture-of-vsto-add-ins.md).

> [!NOTE]
> В этом разделе текстовый *идентификатор надстройки* представляет собой уникальный идентификатор надстройки VSTO. По умолчанию идентификатором является имя сборки надстройки VSTO.

## <a name="register-vsto-add-ins-for-the-current-user-vs-all-users"></a>Регистрация вс-передов для текущего пользователя vsTO для всех пользователей
 После установки надстройку VSTO можно зарегистрировать одним из двух способов.

- Только для текущего пользователя (то есть он доступен только пользователю, который входит в систему на компьютер ею при установке add-in VSTO). В этом случае записи в реестре создаются под **HKEY_CURRENT_USER.**

- Для всех пользователей (т.е. любой пользователь, который входит в систему к компьютеру, может использовать add-in VSTO). В этом случае записи реестра создаются под **HKEY_LOCAL_MACHINE.**

  Все надстройки VSTO, созданные с помощью Visual Studio, могут быть зарегистрированы для текущего пользователя. Однако для всех пользователей надстройки VSTO можно зарегистрировать только в определенных сценариях. Эти сценарии зависят от версии Microsoft Office на компьютере и способа развертывания надстройки VSTO.

### <a name="deployment-type"></a>Тип развертывания
 Надстройки VSTO, развернутые с использованием ClickOnce, можно зарегистрировать только для текущего пользователя. Это потому, что ClickOnce поддерживает только создание ключей под **HKEY_CURRENT_USER**. Если вы хотите зарегистрировать надстройку VSTO для всех пользователей компьютера, разверните ее с использованием установщика Windows. Для получения дополнительной информации об этих типах развертывания [см. Развертывание решения Office с помощью](../vsto/deploying-an-office-solution-by-using-clickonce.md) решения ClickOnce и Deploy an Office с [помощью Windows Installer.](../vsto/deploying-a-vsto-solution-by-using-windows-installer.md)

## <a name="registry-entries"></a>Записи реестра
 Необходимые записи реестра VSTO расположены под следующими ключами реестра, где *Root* **HKEY_CURRENT_USER** или **HKEY_LOCAL_MACHINE** в зависимости от того, предназначена ли установка для текущего пользователя или всех пользователей.

|Офисное приложение|Путь конфигурации|
|------------------|------------------|
|Visio|\\*Идентификатор надстройки* *«Корень»*(Microsoft\\*Visio)*|
|Все остальные|*Корневое*«Программное\\обеспечение»Microsoft/Office*Office название приложения*\\ *«Идентификатор надстройки* Addins»|

> [!NOTE]
> Если установщик ориентирован на всех пользователей на 64-битной Windows, рекомендуется, чтобы он включает в себя две\\записи реестра, один под HKEY_LOCAL_MACHINE »Программное обеспечение»Microsoft и один под**HKEY_LOCAL_MACHINE'Software WOW6432Node**(Улей Microsoft). Это потому, что пользователи могут использовать либо 32-битные или 64-битные версии Office на компьютере.
>
>Если установщик ориентируется на текущего пользователя, ему не нужно устанавливаться на WOW6432Node, так как HKEY_CURRENT_USER-Software путь является общим.
>
>Для получения дополнительной информации, пожалуйста, смотрите [32-разрядные и 64-битные данные приложения в реестре](/windows/win32/sysinfo/32-bit-and-64-bit-application-data-in-the-registry)

 В следующей таблице перечислены записи в данном разделе реестра.

|Запись|Тип|Значение|
|-----------|----------|-----------|
|**Описание**|REG_SZ|Обязательный элемент. Краткое описание надстройки VSTO.<br /><br /> Это описание отображается, когда пользователь выбирает надстройку VSTO на панели **Надстройки** диалогового окна **Параметры** в приложении Microsoft Office.|
|**Friendlyname**|REG_SZ|Обязательный элемент. Описательное имя надстройки VSTO, которое отображается в диалоговом окне **Надстройки COM** в приложении Microsoft Office. Значением по умолчанию является идентификатор надстройки VSTO.|
|**LoadBehavior**|REG_DWORD|Обязательный элемент. Значение, указывающее, когда приложение пытается загрузить надстройку VSTO и текущее состояние надстройки VSTO («Загружена» или «Выгружена»).<br /><br /> По умолчанию эта запись имеет значение 3, которое означает, что надстройка VSTO загружается при запуске. Для получения дополнительной [информации](#LoadBehavior)см. **Примечание:**  Если пользователь отменяет добавление VSTO, это действие изменяет значение **LoadBehavior** в **HKEY_CURRENT_USER** улей реестра. Для каждого пользователя значение значения **LoadBehavior** в HKEY_CURRENT_USER улья переопределяет значение **LoadBehavior,** определенное в **HKEY_LOCAL_MACHINE** улье.|
|**Манифест**|REG_SZ|Обязательный элемент. Полный путь манифеста развертывания для надстройки VSTO. Путь может быть расположением на локальном компьютере, в сетевой папке (UNC) или на веб-сервере (HTTP).<br /><br /> Если для развертывания решения используется установщик Windows, необходимо добавить префикс **file:///** в путь **манифеста** . Вы также должны прибовать строку **&#124;vstolocal** (т.е. символ трубы **&#124;** следуют **vstolocal**) до конца этого пути. Это гарантирует загрузку решения из папки установки, а не из кэша ClickOnce. Для получения дополнительной информации [см. Развертывание решения Office с помощью установки Windows.](../vsto/deploying-a-vsto-solution-by-using-windows-installer.md) **Примечание:**  При создании дополнения VSTO на компьютере разработки Visual Studio автоматически прикрепляет **&#124;vstolocal** строку к этой записи реестра.|

### <a name="registry-entries-for-outlook-form-regions"></a><a name="OutlookEntries"></a>Записи реестра для регионов формы Outlook
 При создании настраиваемой области формы в надстройке VSTO для приложения Outlook для регистрации области формы в Outlook используются дополнительные записи реестра. Эти записи создаются в отдельном разделе реестра для каждого класса сообщений, поддерживаемого областью формы. Эти ключи реестра находятся в следующем месте, где *Root* **HKEY_CURRENT_USER** или **HKEY_LOCAL_MACHINE.**

 *Корень*(программное обеспечение)Microsoft/Офис-Outlook-FormRegions\\класса*сообщений*

 Подобно другим записям реестра, общим для всех надстроек VSTO, Visual Studio создает записи реестра области формы на компьютере разработчика при выполнении сборки проекта. Если вы используете ClickOnce для развертывания add-in VSTO, записи в реестре автоматически создаются на компьютере конечных пользователей. Если вы используете установку Windows для развертывания дополнения VSTO, необходимо настроить проект InstallShield Limited Edition для создания записей реестра на компьютере конечных пользователей.

 Для получения дополнительной информации о записях в реестре регионов формы [см.](/office/vba/outlook/Concepts/Creating-Form-Regions/specify-the-location-of-a-form-region-in-a-custom-form) Для получения дополнительной информации о регионах формы Outlook [см.](../vsto/creating-outlook-form-regions.md)

## <a name="loadbehavior-values"></a><a name="LoadBehavior"></a>Значения LoadBehavior
 Запись **LoadBehavior** под*корневым названием приложения*«Microsoft»Office\\ *Root*\\(Addins*add-in ID)* содержит бихразное сочетание значений, определяющих поведение времени выполнения надстройки VSTO. Младший бит (значения 0 и 1) указывает, загружена ли надстройка VSTO в данный момент. Остальные биты указывают, когда приложение пытается загрузить надстройку VSTO.

 Как правило, запись **LoadBehavior** должна быть установлена на 0, 3 или 16 (в десятичной), когда VSTO Add-in устанавливается на компьютерах конечных пользователей. По умолчанию при сборке или публикации надстройки VSTO Visual Studio устанавливает для записи **LoadBehavior** значение 3.

 В следующей таблице перечислены все возможные значения записи **LoadBehavior** . Некоторые описания в этой таблице относятся к загрузке надстройки VSTO вручную или программным путем. Чтобы загрузить надстройку VSTO вручную, установите флажок рядом с надстройкой VSTO в диалоговом окне **Надстройки COM** в приложении. Для загрузки надстройки VSTO программным способом укажите для свойства <xref:Microsoft.Office.Core.COMAddIn.Connect%2A> объекта <xref:Microsoft.Office.Core.COMAddIn> , представляющего надстройку VSTO, значение **true**.

|Значение (десятичное)|Состояние надстройки VSTO|Поведение при загрузке надстройки VSTO|Описание|
|--------------------------|-------------------------|--------------------------------|-----------------|
|0|Выгружен|Не загружать автоматически|Приложение никогда не пытается загрузить надстройку VSTO автоматически. Пользователь может попытаться загрузить надстройку VSTO вручную или сделать это программными средствами.<br /><br /> Если настройка VSTO успешно загружена, значение **LoadBehavior** остается равным 0, но состояние надстройки VSTO в диалоговом окне **Надстройки COM** обновляется, указывая, что надстройка VSTO загружена.|
|1|Загружен|Не загружать автоматически|Приложение никогда не пытается загрузить надстройку VSTO автоматически. Пользователь может попытаться загрузить надстройку VSTO вручную или сделать это программными средствами.<br /><br /> Хотя диалоговая коробка **COM Add-ins** указывает на то, что add-in VSTO загружается после запуска приложения, add-in VSTO не загружается до тех пор, пока не будет загружен вручную или программно.<br /><br /> Если приложение успешно загружает надстройку VSTO, значение **LoadBehavior** меняется на 0 и остается таким после закрытия приложения.|
|2|Выгружен|Загружать при запуске|Приложение не пытается загрузить надстройку VSTO автоматически. Пользователь может попытаться загрузить надстройку VSTO вручную или сделать это программными средствами.<br /><br /> Если приложение успешно загружает надстройку VSTO, значение **LoadBehavior** меняется на 3 и остается таким после закрытия приложения.|
|3|Загружен|Загружать при запуске|Приложение пытается загрузить надстройку VSTO при запуске приложения. Это значение используется по умолчанию при выполнении сборки или публикации надстройки в Visual Studio.<br /><br /> Если приложение успешно загружает надстройку VSTO, значение **LoadBehavior** остается равным 3. Если при загрузке надстройки VSTO возникает ошибка, значение **LoadBehavior** меняется на 2 и остается таким после закрытия приложения.|
|8|Выгружен|Загружать по запросу|Приложение не пытается загрузить надстройку VSTO автоматически. Пользователь может попытаться загрузить надстройку VSTO вручную или сделать это программными средствами.<br /><br /> Если приложение успешно загружает надстройку VSTO, значение **LoadBehavior** меняется на 9.|
|9|Загружен|Загружать по запросу|Надстройка VSTO будет загружаться только в том случае, если она требуется приложению, например, если пользователь щелкнет элемент пользовательского интерфейса, использующий функциональность этой надстройки VSTO (например, настраиваемую кнопку на ленте).<br /><br /> Если приложение загрузило надстройку VSTO, значение **LoadBehavior** остается равным 9, но состояние надстройки в диалоговом окне **Надстройки COM** обновляется, указывая, что надстройка VSTO загружена. Если при загрузке надстройки VSTO возникает ошибка, значение **LoadBehavior** меняется на 8.|
|16|Загружен|Загрузить в первый раз, в дальнейшем загружать по запросу|Установите это значение, если надстройку VSTO нужно загружать по запросу. Приложение загружает надстройку VSTO при первом запуске приложения пользователем. При следующем запуске приложения пользователем будут загружаться все элементы пользовательского интерфейса, определенные надстройкой VSTO, но сама надстройка VSTO не будет загружена, пока пользователь не щелкнет связанный с ней элемент пользовательского интерфейса.<br /><br /> Если приложение впервые успешно загружает надстройку VSTO, значение **LoadBehavior** остается равным 16 и надстройка загружается. После завершения работы приложения значение **LoadBehavior** меняется на 9.|

## <a name="see-also"></a>См. также раздел
- [Архитектура офисных решений в Visual Studio](../vsto/architecture-of-office-solutions-in-visual-studio.md)
- [Architecture of VSTO Add-ins](../vsto/architecture-of-vsto-add-ins.md)
- [Создавайте решения Office](../vsto/building-office-solutions.md)
- [Развертывание решения Office](../vsto/deploying-an-office-solution.md)
 