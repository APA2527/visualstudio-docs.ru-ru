---
title: Записи реестра для надстроек VSTO
ms.date: 02/02/2017
ms.topic: conceptual
dev_langs:
- VB
- CSharp
helpviewer_keywords:
- LoadBehavior entry
- add-ins [Office development in Visual Studio], registry entries
- registry keys [Office development in Visual Studio]
- application-level add-ins [Office development in Visual Studio], registry entries
- registry entries [Office development in Visual Studio]
author: John-Hart
ms.author: johnhart
manager: jillfra
ms.workload:
- office
ms.openlocfilehash: de101e33e94889a44fe9bc4e21db857763b1c9aa
ms.sourcegitcommit: 47eeeeadd84c879636e9d48747b615de69384356
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/23/2019
ms.locfileid: "63447027"
---
# <a name="registry-entries-for-vsto-add-ins"></a>Записи реестра для надстроек VSTO
  При развертывании надстроек VSTO, созданных с помощью Visual Studio, необходимо создать определенный набор записей реестра. Эти записи реестра предоставляют сведения, позволяющие приложению Microsoft Office обнаружить и загрузить надстройку VSTO.

 [!INCLUDE[appliesto_allapp](../vsto/includes/appliesto-allapp-md.md)]

 При выполнении сборки проекта Visual Studio создает эти записи реестра на компьютере разработчика, упрощая запуск и отладку надстройки VSTO. Если для развертывания надстройки VSTO используется ClickOnce, записи реестра автоматически создаются на компьютере конечного пользователя. При использовании установщика Windows для развертывания надстройки VSTO, необходимо настроить проект InstallShield Limited Edition для создания записей реестра на компьютере конечного пользователя.

 Дополнительные сведения об использовании записей реестра для надстроек VSTO во время процесса загрузки см. в разделе [Architecture of VSTO Add-ins](../vsto/architecture-of-vsto-add-ins.md).

> [!NOTE]
> В этом разделе текстовый *идентификатор надстройки* представляет собой уникальный идентификатор надстройки VSTO. По умолчанию идентификатором является имя сборки надстройки VSTO.

## <a name="register-vsto-add-ins-for-the-current-user-vs-all-users"></a>Регистрация надстроек VSTO для текущего пользователя и всех пользователей
 После установки надстройку VSTO можно зарегистрировать одним из двух способов.

- Для только для текущего пользователя (то есть она доступна только для пользователя, который вошел на компьютер при установке надстройки VSTO). В этом случае записи реестра создаются в разделе **HKEY_CURRENT_USER**.

- Для всех пользователей (то есть любой пользователь в систему на компьютере можно использовать надстройки VSTO). В этом случае записи реестра создаются в разделе **HKEY_LOCAL_MACHINE**.

  Все надстройки VSTO, созданные с помощью Visual Studio, могут быть зарегистрированы для текущего пользователя. Однако для всех пользователей надстройки VSTO можно зарегистрировать только в определенных сценариях. Эти сценарии зависят от версии Microsoft Office на компьютере и способа развертывания надстройки VSTO.

### <a name="microsoft-office-version"></a>Версия Microsoft Office
 Приложения Office можно загрузить VSTO Add-ins, зарегистрированные в разделе **HKEY_LOCAL_MACHINE** или **HKEY_CURRENT_USER**.

 Для загрузки надстроек VSTO, зарегистрированных в разделе **HKEY_LOCAL_MACHINE**, компьютеры должны иметь пакет обновления 976477. Дополнительные сведения см. на веб-сайте [http://go.microsoft.com/fwlink/?LinkId=184923](http://go.microsoft.com/fwlink/?LinkId=184923).

### <a name="deployment-type"></a>Тип развертывания
 Надстройки VSTO, развернутые с использованием ClickOnce, можно зарегистрировать только для текущего пользователя. Это обусловлено ClickOnce поддерживает создание ключей в группе только **HKEY_CURRENT_USER**. Если вы хотите зарегистрировать надстройку VSTO для всех пользователей компьютера, разверните ее с использованием установщика Windows. Дополнительные сведения об этих типах развертывания см. в разделе [развертывание решения Office с помощью ClickOnce](../vsto/deploying-an-office-solution-by-using-clickonce.md) и [развертывание решения Office с помощью установщика Windows](../vsto/deploying-an-office-solution-by-using-windows-installer.md).

## <a name="registry-entries"></a>Записи реестра
 Необходимые надстройки VSTO записи реестра, находятся в следующем разделе реестра для всех приложений, за исключением Visio, где *корневой* — **HKEY_CURRENT_USER** или **HKEY_LOCAL_MACHINE** .

 **Все приложения, за исключением Visio**

|Версия Office|Путь конфигурации|
|--------------------|------------------------|
|32-разрядная версия|*Корневой*\Software\Microsoft\Office\\*имя_приложения*\Addins\\*идентификатор надстройки*|
|64-разрядная версия|*Корневой*\Software\Wow6432Node\Microsoft\Office\\*имя_приложения*\Addins\\*идентификатор надстройки*|

 **Visio**

|Версия Office|Путь конфигурации|
|--------------------|------------------------|
|32-разрядная версия|*Корневой*\Software\Microsoft\Visio\Addins\\*идентификатор надстройки*|
|64-разрядная версия|*Корневой*\Software\Wow6432Node\Visio\Addins\\*идентификатор надстройки*|

 В следующей таблице перечислены записи в данном разделе реестра.

|Ввод|Тип|Значение|
|-----------|----------|-----------|
|**Описание**|REG_SZ|Обязательный. Краткое описание надстройки VSTO.<br /><br /> Это описание отображается, когда пользователь выбирает надстройку VSTO на панели **Надстройки** диалогового окна **Параметры** в приложении Microsoft Office.|
|**FriendlyName**|REG_SZ|Обязательный. Описательное имя надстройки VSTO, которое отображается в диалоговом окне **Надстройки COM** в приложении Microsoft Office. Значением по умолчанию является идентификатор надстройки VSTO.|
|**LoadBehavior**|REG_DWORD|Обязательный. Значение, указывающее, когда приложение пытается загрузить надстройку VSTO и текущее состояние надстройки VSTO («Загружена» или «Выгружена»).<br /><br /> По умолчанию эта запись имеет значение 3, которое означает, что надстройка VSTO загружается при запуске. Дополнительные сведения см. в разделе [значения LoadBehavior](#LoadBehavior). **Примечание.**  Если пользователь отключает надстройку, это действие изменяет **LoadBehavior** значение в **HKEY_CURRENT_USER** куст реестра. Для каждого пользователя, значение **LoadBehavior** в кусте HKEY_CURRENT_USER переопределяет значение по умолчанию **LoadBehavior** определенные в **HKEY_LOCAL_MACHINE** hive.|
|**Manifest**|REG_SZ|Обязательный. Полный путь манифеста развертывания для надстройки VSTO. Путь может быть расположением на локальном компьютере, в сетевой папке (UNC) или на веб-сервере (HTTP).<br /><br /> Если для развертывания решения используется установщик Windows, необходимо добавить префикс **file:///** в путь **манифеста** . Необходимо также добавить строку  **&#124;vstolocal** (то есть знак вертикальной черты **&#124;** следуют **vstolocal**) в конец этого пути. Это гарантирует загрузку решения из папки установки, а не из кэша ClickOnce. Дополнительные сведения см. в разделе [развертывание решения Office с помощью установщика Windows](../vsto/deploying-an-office-solution-by-using-windows-installer.md). **Примечание.**  При создании надстройки VSTO на компьютере разработки, Visual Studio автоматически добавляет  **&#124;vstolocal** строка для этой записи реестра.|

### <a name="OutlookEntries"></a> Записи реестра для областей формы Outlook
 При создании настраиваемой области формы в надстройке VSTO для приложения Outlook для регистрации области формы в Outlook используются дополнительные записи реестра. Эти записи создаются в отдельном разделе реестра для каждого класса сообщений, поддерживаемого областью формы. Эти разделы реестра находятся в следующем расположении, где *корневой* — **HKEY_CURRENT_USER** или **HKEY_LOCAL_MACHINE**.

 *Корневой*\Software\Microsoft\Office\Outlook\FormRegions\\*класс message*

 Подобно другим записям реестра, общим для всех надстроек VSTO, Visual Studio создает записи реестра области формы на компьютере разработчика при выполнении сборки проекта. Если для развертывания надстройки VSTO используется ClickOnce, записи реестра автоматически создаются на компьютере конечного пользователя. При использовании установщика Windows для развертывания надстройки VSTO, необходимо настроить проект InstallShield Limited Edition для создания записей реестра на компьютере конечного пользователя.

 Дополнительные сведения о записях реестра области формы, см. в разделе [укажите расположение области формы в настраиваемой формы](/office/vba/outlook/Concepts/Creating-Form-Regions/specify-the-location-of-a-form-region-in-a-custom-form). Дополнительные сведения об областях форм Outlook см. в разделе [областей форм Outlook создайте](../vsto/creating-outlook-form-regions.md).

## <a name="LoadBehavior"></a> Значения LoadBehavior
 **LoadBehavior** запись в разделе *корневой*\Software\Microsoft\Office\\*имя_приложения*\Addins\\*надстройки Идентификатор* ключ содержит битовую комбинацию значений, определяющих поведение во время выполнения надстройки VSTO. Младший бит (значения 0 и 1) указывает, загружена ли надстройка VSTO в данный момент. Остальные биты указывают, когда приложение пытается загрузить надстройку VSTO.

 Как правило **LoadBehavior** записи должен быть равным 0, 3 или 16 (в десятичном формате) Если надстройка VSTO устанавливается на компьютерах конечных пользователей. По умолчанию при сборке или публикации надстройки VSTO Visual Studio устанавливает для записи **LoadBehavior** значение 3.

 В следующей таблице перечислены все возможные значения записи **LoadBehavior** . Некоторые описания в этой таблице относятся к загрузке надстройки VSTO вручную или программным путем. Чтобы загрузить надстройку VSTO вручную, установите флажок рядом с надстройкой VSTO в диалоговом окне **Надстройки COM** в приложении. Для загрузки надстройки VSTO программным способом укажите для свойства <xref:Microsoft.Office.Core.COMAddIn.Connect%2A> объекта <xref:Microsoft.Office.Core.COMAddIn> , представляющего надстройку VSTO, значение **true**.

|Значение (десятичное)|Состояние надстройки VSTO|Поведение при загрузке надстройки VSTO|Описание|
|--------------------------|-------------------------|--------------------------------|-----------------|
|0|Выгружен|Не загружать автоматически|Приложение никогда не пытается загрузить надстройку VSTO автоматически. Пользователь может попытаться загрузить надстройку VSTO вручную или сделать это программными средствами.<br /><br /> Если настройка VSTO успешно загружена, значение **LoadBehavior** остается равным 0, но состояние надстройки VSTO в диалоговом окне **Надстройки COM** обновляется, указывая, что надстройка VSTO загружена.|
|1|Загружен|Не загружать автоматически|Приложение никогда не пытается загрузить надстройку VSTO автоматически. Пользователь может попытаться загрузить надстройку VSTO вручную или сделать это программными средствами.<br /><br /> Несмотря на то что **COM-надстройки** диалоговом окне указано, что надстройка VSTO загружается после запуска приложения, надстройка VSTO не загружается до загрузки вручную или программным способом.<br /><br /> Если приложение успешно загружает надстройку VSTO, значение **LoadBehavior** меняется на 0 и остается таким после закрытия приложения.|
|2|Выгружен|Загружать при запуске|Приложение не пытается загрузить надстройку VSTO автоматически. Пользователь может попытаться загрузить надстройку VSTO вручную или сделать это программными средствами.<br /><br /> Если приложение успешно загружает надстройку VSTO, значение **LoadBehavior** меняется на 3 и остается таким после закрытия приложения.|
|3|Загружен|Загружать при запуске|Приложение пытается загрузить надстройку VSTO при запуске приложения. Это значение используется по умолчанию при выполнении сборки или публикации надстройки в Visual Studio.<br /><br /> Если приложение успешно загружает надстройку VSTO, значение **LoadBehavior** остается равным 3. Если при загрузке надстройки VSTO возникает ошибка, значение **LoadBehavior** меняется на 2 и остается таким после закрытия приложения.|
|8|Выгружен|Загружать по запросу|Приложение не пытается загрузить надстройку VSTO автоматически. Пользователь может попытаться загрузить надстройку VSTO вручную или сделать это программными средствами.<br /><br /> Если приложение успешно загружает надстройку VSTO, значение **LoadBehavior** меняется на 9.|
|9|Загружен|Загружать по запросу|Надстройка VSTO будет загружаться только в том случае, если она требуется приложению, например, если пользователь щелкнет элемент пользовательского интерфейса, использующий функциональность этой надстройки VSTO (например, настраиваемую кнопку на ленте).<br /><br /> Если приложение загрузило надстройку VSTO, значение **LoadBehavior** остается равным 9, но состояние надстройки в диалоговом окне **Надстройки COM** обновляется, указывая, что надстройка VSTO загружена. Если при загрузке надстройки VSTO возникает ошибка, значение **LoadBehavior** меняется на 8.|
|16|Загружен|Загрузить в первый раз, в дальнейшем загружать по запросу|Установите это значение, если надстройку VSTO нужно загружать по запросу. Приложение загружает надстройку VSTO при первом запуске приложения пользователем. При следующем запуске приложения пользователем будут загружаться все элементы пользовательского интерфейса, определенные надстройкой VSTO, но сама надстройка VSTO не будет загружена, пока пользователь не щелкнет связанный с ней элемент пользовательского интерфейса.<br /><br /> Если приложение впервые успешно загружает надстройку VSTO, значение **LoadBehavior** остается равным 16 и надстройка загружается. После завершения работы приложения значение **LoadBehavior** меняется на 9.|

## <a name="see-also"></a>См. также
- [Архитектура решений Office в Visual Studio](../vsto/architecture-of-office-solutions-in-visual-studio.md)
- [Архитектура надстроек VSTO](../vsto/architecture-of-vsto-add-ins.md)
- [Создание решений Office](../vsto/building-office-solutions.md)
- [Развертывание решения Office](../vsto/deploying-an-office-solution.md)
