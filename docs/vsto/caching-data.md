---
title: Кэширование данных
ms.date: 02/02/2017
ms.topic: conceptual
dev_langs:
- VB
- CSharp
helpviewer_keywords:
- data caching [Office development in Visual Studio], about caching data
- data [Office development in Visual Studio], caching
- data caching [Office development in Visual Studio]
author: John-Hart
ms.author: johnhart
manager: jillfra
ms.workload:
- office
ms.openlocfilehash: c6e0f6d7fcf9920ddb8861712b7c5f8bf04506fc
ms.sourcegitcommit: 6cfffa72af599a9d667249caaaa411bb28ea69fd
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 09/02/2020
ms.locfileid: "62939419"
---
# <a name="cache-data"></a>Кэширование данных
  Вы можете кэшировать объекты данных в настройке на уровне документа, чтобы обеспечить доступ к данным в автономном режиме или без открытия Microsoft Office Word или Microsoft Office Excel. Для кэширования объекта объект должен иметь тип данных, соответствующий определенным требованиям. Многие распространенные типы данных в .NET Framework соответствуют этим требованиям, включая <xref:System.String> , <xref:System.Data.DataSet> и <xref:System.Data.DataTable> .

 [!INCLUDE[appliesto_alldoc](../vsto/includes/appliesto-alldoc-md.md)]

 Существует два способа добавления объекта в кэш данных.

- Чтобы добавить объект в кэш данных при построении решения, примените <xref:Microsoft.VisualStudio.Tools.Applications.Runtime.CachedAttribute> атрибут к объявлению объекта. Дополнительные сведения см. в разделе [как кэшировать данные для использования в автономном режиме или на сервере](../vsto/how-to-cache-data-for-use-offline-or-on-a-server.md).

- Чтобы программно добавить объект в кэш данных во время выполнения, используйте `StartCaching` метод ведущего элемента, например `ThisDocument` `ThisWorkbook` классы или. Дополнительные сведения см. в разделе [инструкции. программный кэш источника данных в документе Office](../vsto/how-to-programmatically-cache-a-data-source-in-an-office-document.md).

  После добавления объекта в кэш данных можно получить доступ к кэшированным данным и изменить его, не запуская Word или Excel. Дополнительные сведения см. [в разделе доступ к данным в документах на сервере](../vsto/accessing-data-in-documents-on-the-server.md).

## <a name="requirements-for-data-objects-to-be-cached"></a>Требования к объектам данных для кэширования
 Чтобы кэшировать объект данных в решении, объект должен удовлетворять этим требованиям:

- Быть открытым полем для чтения и записи или свойством ведущего элемента, например `ThisDocument` `ThisWorkbook` классами или.

- Не является индексатором или другим параметризованным свойством.

  Кроме того, объект данных должен быть сериализуемым <xref:System.Xml.Serialization.XmlSerializer> классом, что означает, что тип объекта должен иметь следующие характеристики:

- Быть общедоступным типом.

- Иметь открытый конструктор без параметров.

- Не выполнять код, требующий дополнительных прав доступа.

- Предоставить только открытые свойства для чтения и записи (другие свойства будут пропущены).

- Не предоставляйте многомерные массивы (допускаются вложенные массивы).

- Не возвращают интерфейсы из свойств и полей.

- Не реализовывать <xref:System.Collections.IDictionary> , если коллекция.

  При кэшировании объекта данных [!INCLUDE[vsto_runtime](../vsto/includes/vsto-runtime-md.md)] компонент сериализует объект в XML-строку, которая хранится в *пользовательской XML-части* документа. Дополнительные сведения см. в разделе [Общие сведения о пользовательских XML-частях](../vsto/custom-xml-parts-overview.md).

## <a name="cached-data-size-limits"></a>Ограничения на размер кэшированных данных
 Существует ряд ограничений на общий объем данных, которые можно добавить в кэш данных в документе, а также размер любого отдельного объекта в кэше данных. Если превысить эти ограничения, приложение может неожиданно закрыться при сохранении данных в кэше данных.

 Чтобы избежать этих ограничений, следуйте приведенным ниже рекомендациям.

- Не добавляйте в кэш данных объекты размером более 10 МБ.

- Не добавляйте в кэш данных более 100 МБ общего объема данных в одном документе.

  Это приблизительные значения. Конкретные ограничения зависят от нескольких факторов, включая объем доступной оперативной памяти и количество запущенных процессов.

## <a name="control-the-behavior-of-cached-objects"></a>Управление поведением кэшированных объектов
 Чтобы получить больший контроль над поведением кэшированного объекта, можно реализовать <xref:Microsoft.VisualStudio.Tools.Applications.Runtime.ICachedType> интерфейс для типа кэшированного объекта. Например, этот интерфейс можно реализовать, если требуется управлять способом уведомления пользователя об изменении объекта. Примеры кода, демонстрирующие, как реализовать <xref:Microsoft.VisualStudio.Tools.Applications.Runtime.ICachedType> , см. в разделе примеры `ControlCollection` динамических элементов управления Excel и примеры динамических элементов управления Word в примерах [и пошаговых руководствах по разработке приложений для Office](../vsto/office-development-samples-and-walkthroughs.md).

## <a name="persist-changes-to-cached-data-in-password-protected-documents"></a>Сохранение изменений в кэшированных данных в защищенных паролем документах
 При кэшировании объектов данных в документе, защищенном паролем, изменения в кэшированных данных не сохраняются. Вы можете сохранить изменения в кэшированные данные, переопределив два метода. Переопределите эти методы, чтобы временно удалить защиту при сохранении документа, а затем повторно примените защиту после завершения операции сохранения.

 Дополнительные сведения см. в разделе [как кэшировать данные в защищенном паролем документе](../vsto/how-to-cache-data-in-a-password-protected-document.md).

## <a name="prevent-data-loss-when-adding-null-values-to-the-data-cache"></a>Предотвращение потери данных при добавлении значений NULL в кэш данных
 При добавлении объектов в кэш данных все кэшированные объекты должны быть инициализированы значением, отличным от**null** , до сохранения и закрытия документа. Если при сохранении и закрытии документа какой-либо кэшированный объект имеет значение **null** , то [!INCLUDE[vsto_runtime](../vsto/includes/vsto-runtime-md.md)] автоматически удалит все кэшированные объекты из кэша данных.

 При добавлении объекта со значением **null** в кэш данных с помощью <xref:Microsoft.VisualStudio.Tools.Applications.Runtime.CachedAttribute> атрибута во время разработки можно использовать <xref:Microsoft.VisualStudio.Tools.Applications.ServerDocument> класс для инициализации кэшированных объектов данных перед открытием документа. Это полезно, если требуется инициализировать кэшированные данные на сервере без установленного приложения Word или Excel, прежде чем документ будет открыт конечным пользователем. Дополнительные сведения см. [в разделе доступ к данным в документах на сервере](../vsto/accessing-data-in-documents-on-the-server.md).

## <a name="see-also"></a>См. также раздел
- [Как кэшировать данные для использования в автономном режиме или на сервере](../vsto/how-to-cache-data-for-use-offline-or-on-a-server.md)
- [Руководство. программный кэш источника данных в документе Office](../vsto/how-to-programmatically-cache-a-data-source-in-an-office-document.md)
- [Пошаговое руководство. кэширование данных в документе, защищенном паролем](../vsto/how-to-cache-data-in-a-password-protected-document.md)
- [Пошаговое руководство. Создание связи "основной/подробности" с помощью кэшированного набора данных](../vsto/walkthrough-creating-a-master-detail-relation-using-a-cached-dataset.md)
