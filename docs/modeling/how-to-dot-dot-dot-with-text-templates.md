---
title: Практическое руководство по текстовым шаблонам
ms.date: 11/04/2016
ms.topic: conceptual
author: jillre
ms.author: jillfra
manager: jillfra
ms.workload:
- multiple
ms.openlocfilehash: 2fc29b7daa65a9aa0b0c45ae5bc90a4f845dedff
ms.sourcegitcommit: a8e8f4bd5d508da34bbe9f2d4d9fa94da0539de0
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 10/19/2019
ms.locfileid: "72605628"
---
# <a name="how-to--with-text-templates"></a>Практическое руководство по текстовым шаблонам
Текстовые шаблоны в Visual Studio предоставляют удобный способ создания текста любого типа. Текстовые шаблоны можно использовать для создания текста во время выполнения в рамках приложения и во время разработки для создания кода проекта. В этом разделе приводится краткое описание наиболее часто запрашиваемого «Разделы справки...?» вопросы.

 В этом разделе несколько ответов, которым предшествуют маркеры, являются альтернативными предложениями.

 Общие сведения о текстовых шаблонах см. в статье [Создание кода и текстовые шаблоны T4](../modeling/code-generation-and-t4-text-templates.md).

## <a name="how-to-"></a>Инструкции...

### <a name="generate-part-of-my-application-code"></a>Создать часть кода приложения
 У меня есть конфигурация или *модель* в файле или базе данных. Одна или несколько частей кода зависят от этой модели.

- Создайте некоторые файлы кода из текстовых шаблонов. Дополнительные сведения см. в статьях [Создание кода во время разработки с помощью текстовых шаблонов T4](../modeling/design-time-code-generation-by-using-t4-text-templates.md) и [что такое лучший способ начать писать шаблон?](#starting).

### <a name="generate-files-at-run-time-passing-data-into-the-template"></a>Создание файлов во время выполнения, передача данных в шаблон
 Во время выполнения приложение создает текстовые файлы, такие как отчеты, которые содержат сочетание стандартного текста и данных. Я хочу избежать написания сотен `write`ных инструкций.

- Добавьте в проект текстовый шаблон среды выполнения. Этот шаблон создает класс в коде, который можно создать и использовать для создания текста. В параметры конструктора можно передать данные. Дополнительные сведения см. [в разделе Создание текста во время выполнения с помощью текстовых шаблонов T4](../modeling/run-time-text-generation-with-t4-text-templates.md).

- Если необходимо создать из шаблонов, доступных только во время выполнения, можно использовать стандартные текстовые шаблоны. При написании расширения Visual Studio можно вызвать службу текстовых шаблонов. Дополнительные сведения см. [в разделе вызов преобразования текста в расширении VS](../modeling/invoking-text-transformation-in-a-vs-extension.md). В других контекстах можно использовать обработчик текстовых шаблонов. Для получения дополнительной информации см. <xref:Microsoft.VisualStudio.TextTemplating.Engine?displayProperty=fullName>.

     Используйте директиву \< # @parameter # > для передачи параметров в эти шаблоны. Дополнительные сведения см. в разделе [директива параметров T4](../modeling/t4-parameter-directive.md).

### <a name="read-another-project-file-from-a-template"></a>Чтение другого файла проекта из шаблона
 Чтобы считать файл из того же проекта Visual Studio, что и шаблон, выполните следующие действия.

- Вставьте строку `hostSpecific="true"` в директиву `<#@template#>`.

     В коде используйте `this.Host.ResolvePath(filename)`, чтобы получить полный путь к файлу.

### <a name="invoke-methods-from-a-template"></a>Вызов методов из шаблона

Если методы уже существуют, например, в классах .NET:

- Используйте директиву \< # @assembly # >, чтобы загрузить сборку, и используйте \< # @import # >, чтобы задать контекст пространства имен. Дополнительные сведения см. в разделе [Директива импорта T4](../modeling/t4-import-directive.md).

   Если часто используется один и тот же набор директив сборки и импорта, рекомендуется написать процессор директив. В каждом шаблоне можно вызвать обработчик директив, который может загружать сборки и файлы модели и задавать контекст пространства имен. Дополнительные сведения см. в разделе [Создание пользовательских обработчиков директив текстовых шаблонов T4](../modeling/creating-custom-t4-text-template-directive-processors.md).

Если вы пишете методы самостоятельно:

- При написании текстового шаблона среды выполнения напишите определение разделяемого класса, имя которого совпадает с именем текстового шаблона среды выполнения. Добавьте дополнительные методы в этот класс.

- Напишите блок управления функциями класса `<#+ ... #>`, в котором можно объявить методы, свойства и закрытые классы. При компиляции текстового шаблона он преобразуется в класс. Стандартные блоки управления `<#...#>` и text преобразуются в один метод, а блоки функций класса вставляются как отдельные члены. Дополнительные сведения см. в разделе [блоки управления текстовыми шаблонами](../modeling/text-template-control-blocks.md).

   Методы, определенные как функции класса, также могут включать в себя встроенные текстовые блоки.

   Рассмотрите возможность размещения функций класса в отдельном файле, который можно `<#@include#>` в один или несколько файлов шаблонов.

- Запишите методы в отдельную сборку (библиотеку классов) и вызывайте их из шаблона. Используйте директиву `<#@assembly#>` для загрузки сборки и `<#@import#>` для задания контекста пространства имен. Обратите внимание, что для перестроения сборки во время отладки может потребоваться перезапустить Visual Studio. Дополнительные сведения см. в разделе [директивы текстового шаблона T4](../modeling/t4-text-template-directives.md).

### <a name="generate-many-files-from-one-model-schema"></a>Создание нескольких файлов из одной схемы модели
 Если часто создаются файлы из моделей с одинаковой схемой XML или базы данных:

- Попробуйте написать процессор директив. Это позволяет заменить несколько инструкций сборки и импортировать инструкции в каждом шаблоне с помощью одной пользовательской директивы. Процессор директив также может загружать и анализировать файл модели. Дополнительные сведения см. в разделе [Создание пользовательских обработчиков директив текстовых шаблонов T4](../modeling/creating-custom-t4-text-template-directive-processors.md).

### <a name="generate-files-from-a-complex-model"></a>Создание файлов из сложной модели

- Рассмотрите возможность создания доменного языка (DSL) для представления модели. Это значительно упрощает написание шаблонов, поскольку вы используете типы и свойства, отражающие имена элементов в модели. Нет необходимости анализировать файл или переходить по XML-узлам. Пример:

     `foreach (Book book in this.Library) { ... }`

     Дополнительные сведения см. в статьях [Начало работы с доменными](../modeling/getting-started-with-domain-specific-languages.md) языками и [Создание кода на основе предметно-](../modeling/generating-code-from-a-domain-specific-language.md)ориентированного языка.

### <a name="get-data-from-visual-studio"></a>Получение данных из Visual Studio
 Для использования служб, предоставляемых в Visual Studio, задайте атрибут `hostSpecific` и загрузите `EnvDTE` сборку. Пример:

```csharp
<#@ template hostspecific="true" language="C#" #>
<#@ output extension=".txt" #>
<#@ assembly name="EnvDTE" #>
<#
  IServiceProvider serviceProvider = (IServiceProvider)this.Host;
  EnvDTE.DTE dte = (EnvDTE.DTE) serviceProvider.GetService(typeof(EnvDTE.DTE));
#>

Number of projects in this VS solution:  <#= dte.Solution.Projects.Count #>
```

### <a name="execute-text-templates-in-the-build-process"></a>Выполнение текстовых шаблонов в процессе сборки

- Дополнительные сведения см. [в разделе Создание кода в процессе сборки](../modeling/code-generation-in-a-build-process.md).

## <a name="more-general-questions"></a>Общие вопросы

### <a name="starting"></a>Как лучше всего начать писать текстовый шаблон?

1. Напишите конкретный пример созданного файла.

2. Превратите его в текстовый шаблон, вставив директиву `<#@template #>`, а также директивы и код, необходимые для загрузки входного файла или модели.

3. Постепенно заменяют части файла выражениями и блоками кода.

### <a name="what-is-a-model"></a>Что такое "модель"?

- Входные данные, считанные шаблоном. Он может находиться в файле или в базе данных. Это может быть XML, документ Visio или доменный язык (DSL) или модель UML либо обычный текст. Его можно распределить по нескольким файлам. Как правило, в одной модели считывается несколько шаблонов.

     Смысл термина "модель" заключается в том, что он представляет некоторый аспект деятельности компании непосредственно по сравнению с созданным программным кодом или другими файлами. Например, он может представлять план сети обмена данными, который будет защищен Вашим созданным программным обеспечением.

### <a name="what-is-the-benefit-of-using-text-templates"></a>Каково преимущество использования текстовых шаблонов?
 Как правило, в одной модели создается несколько кодов или других файлов. Модель представляет требования более прямо, чем созданный код. Он не пропускает сведения о реализации и записывается с точки зрения требований, а не кода. При изменении требований — как правило, вы можете более легко и надежно обновлять модель, чем различные части программного кода.

 Таким образом, создание кода является ценным инструментом с точки зрения гибких методов разработки.

### <a name="what-best-practices-are-there-for-text-templates"></a>Что такое "рекомендации" для текстовых шаблонов?

- Дополнительные сведения см. в разделе [рекомендации по написанию текстовых шаблонов T4](../modeling/guidelines-for-writing-t4-text-templates.md).

### <a name="what-is-t4"></a>Что такое "T4"?

- Еще одно имя для возможностей текстовых шаблонов Visual Studio, описываемых здесь. Предыдущая версия, которая не была опубликована, была сокращена на "преобразование текстового шаблона".
