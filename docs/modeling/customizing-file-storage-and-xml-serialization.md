---
title: Настройка хранилища файлов и XML-сериализации
ms.date: 11/04/2016
ms.topic: conceptual
f1_keywords:
- vs.dsltools.dsldesigner.xmlbehavior
helpviewer_keywords:
- Domain-Specific Language, serialization
author: gewarren
ms.author: gewarren
manager: jillfra
ms.workload:
- multiple
ms.openlocfilehash: 3956baeee617f82b142d1c1bfa54539d56446077
ms.sourcegitcommit: 94b3a052fb1229c7e7f8804b09c1d403385c7630
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/23/2019
ms.locfileid: "62994937"
---
# <a name="customize-file-storage-and-xml-serialization"></a>Настройка хранилища файлов и сериализации XML

Когда пользователь сохраняет экземпляр, или *модели*, доменного языка (DSL) в Visual Studio, в XML-файл создается или обновляется. Файл может быть перезагружен для повторного создания модели в Store.

Вы можете настроить схему сериализации, Настройка параметров в разделе **поведение сериализации Xml** в обозревателе DSL. Узел в разделе **поведение сериализации Xml** для каждого доменного класса, свойства и отношения. Связи находятся в своих классов источника. Кроме того, существуют также узлы, соответствующие фигуры, соединителя и схемы классов.

Кроме того, можно написать программный код для более широких возможностей настройки.

> [!NOTE]
> Если вы хотите сохранить модель в определенном формате, но не нужно повторно загрузить его из этой формы, рассмотрите возможность использования текстовых шаблонов для создания выходных данных из модели, а не пользовательскую схему сериализации. Дополнительные сведения см. в разделе [создание кода из доменного языка](../modeling/generating-code-from-a-domain-specific-language.md).

## <a name="model-and-diagram-files"></a>Модель и файлы схемы

Каждая модель обычно сохраняется в двух файлах:

- Файл модели имеет имя, например **Model1.mydsl**. Он сохраняет элементы модели и их свойств и связей. Расширение файла, например **.mydsl** определяется **FileExtension** свойство **редактор** узла в определении DSL.

- Файл схемы имеет имя, например **Model1.mydsl.diagram**. Он хранит фигуры, соединители и их положения, цвета, толщины линии и другие сведения внешний вид схемы. Если пользователь удаляет **.diagram** файл, важные сведения в модели не теряются. Только макет схемы будет потеряно. При открытии файла модели, по умолчанию набор фигур и соединителей будут создаваться.

### <a name="to-change-the-file-extension-of-a-dsl"></a>Чтобы изменить расширение доменного языка

1. Откройте Определение DSL. В обозревателе DSL щелкните узел "редактор".

2. В окне «Свойства» измените **FileExtension** свойство. Не включайте начальный «.» расширения имени файла.

3. В обозревателе решений, измените имя файлы шаблонов двух элементов в **DslPackage\ProjectItemTemplates**. Эти файлы имеют имена, которые имеют этот формат.

     `myDsl.diagram`

     `myDsl.myDsl`

## <a name="the-default-serialization-scheme"></a>Схема сериализации по умолчанию

Чтобы создать пример в этом разделе, использовался следующее определение DSL.

![Схема определения DSL &#45; модель семейного дерева](../modeling/media/familyt_person.png)

Этот DSL использовался для создания модели, который имеет следующий вид на экране.

![Обозреватель, панель элементов и схема семейного дерева](../modeling/media/familyt_instance.png)

Эта модель успешно сохранен и затем снова открыть в текстовом редакторе XML:

```xml
<?xml version="1.0" encoding="utf-8"?>
<familyTreeModel xmlns:dm0="http://schemas.microsoft.com/VisualStudio/2008/DslTools/Core" dslVersion="1.0.0.0" Id="f817b728-e920-458e-bb99-98edc469d78f" xmlns="http://schemas.microsoft.com/dsltools/FamilyTree">
  <people>
    <person name="Henry VIII" birthYear="1491" deathYear="1547" age="519">
      <children>
        <personMoniker name="/f817b728-e920-458e-bb99-98edc469d78f/Elizabeth I" />
        <personMoniker name="/f817b728-e920-458e-bb99-98edc469d78f/Mary" />
      </children>
    </person>
    <person name="Elizabeth I" birthYear="1533" deathYear="1603" age="477" />
    <person name="Mary" birthYear="1515" deathYear="1558" age="495" />
  </people>
</familyTreeModel>
```

Обратите внимание на следующие аспекты сериализованную модель:

- Каждый узел XML имеет имя, которое совпадает с именем класса домена, за исключением того, что начинается со строчной начальной буквой. Например, `familyTreeModel` и `person`.

- Свойства домена, такие как имя и Год_рождения сериализуются как атрибуты в XML-узлы. Опять же исходного символа имени свойства преобразуется в нижний регистр.

- Каждое отношение сериализуется как XML-узел, вложенный в исходном конце связи. Узел имеет то же имя, что свойству роли источника, но с начальный символ нижнего регистра.

     Например, в определении DSL, роли, которая называется **людей** созданного **FamilyTree** класса.  В XML, оно представлено узел с именем `people` вложен в `familyTreeModel` узла.

- Целевой конец каждого отношения внедрения сериализуется как узел вложен в узел связи. Например `people` узел содержит несколько `person` узлов.

- Целевой конец каждого ссылочного отношения сериализуется как *моникер*, которая кодирует ссылку на целевой элемент.

     Например, в разделе `person` узел, может существовать `children` связи. Этот узел содержит специальные имена, например:

    ```xml
    <personMoniker name="/f817b728-e920-458e-bb99-98edc469d78f/Elizabeth I" />
    ```

## <a name="understand-monikers"></a>Понять моникеры

Моникеры используются для представления перекрестные ссылки между разными частями файлы модели и схемы. Они также используются в `.diagram` файл для ссылки на узлы в файле модели. Существует два вида моникер.

- *Идентификатор моникеры* заключения в кавычки идентификатор GUID целевого элемента. Пример:

    ```xml
    <personShapeMoniker Id="f79734c0-3da1-4d72-9514-848fa9e75157" />
    ```

- *Указанием ключа моникеры* определить целевой элемент, значение свойства указанного домена, называется ключом моникера. Моникер элемента target, отмеченную символом специальное имя родительского элемента в дереве отношений внедрения.

     Следующие примеры, взяты из DSL в котором существует — это класс домена, с именем альбома, имеющая отношение внедрения к домену класса именованного Song (песня):

    ```xml
    <albumMoniker title="/My Favorites/Jazz after Teatime" />
    <songMoniker title="/My Favorites/Jazz after Teatime/Hot tea" />
    ```

     Полное моникерами ключа будет использоваться, если целевой класс имеет свойство домена, для которой параметр **является ключом моникера** присваивается `true` в **поведение сериализации Xml**. В примере этот параметр имеет значение для свойства домена с именем «Title» в доменных классов, «Альбом» и «Песни».

Полное ключа моникеры — более удобными для чтения, чем идентификатор моникеры. Если XML-файлами модели для чтения пользователями, рассмотрите возможность использования полного ключа моникеры. Тем не менее пользователь может задать более чем одного элемента имеют один и тот же ключ моникера. Повторяющиеся ключи может привести к не перезагрузки файла правильно. Таким образом Если определить класс домена, который указывается с помощью полного ключа моникеров, следует способа позволяют пользователю сохранить файл, содержащий повторяющиеся моникеры.

### <a name="to-set-a-domain-class-to-be-referenced-by-id-monikers"></a>Чтобы задать класс домена, на которые ссылается идентификатор моникеры

1. Убедитесь, что **является ключом моникера** является `false` для каждого свойства домена в классе и его базовых классов.

    1. В обозревателе DSL разверните **Behavior\Class сериализации XML-данных\\\<доменный класс > \Element данных**.

    2. Убедитесь, что **является ключом моникера** является `false` для каждого свойства домена.

    3. Если доменный класс, который имеет базовый класс, повторите процедуру, описанную в этом классе.

2. Задайте **идентификатор сериализации**  =  `true` для доменного класса.

     Это свойство можно найти в разделе **поведение сериализации Xml**.

### <a name="to-set-a-domain-class-to-be-referenced-by-qualified-key-monikers"></a>Чтобы задать класс домена, на которые ссылается полное моникерами ключа

- Задайте **является ключом моникера** для доменного свойства существующего класса домена. Тип свойства должен быть `string`.

    1. В обозревателе DSL разверните **Behavior\Class сериализации XML-данных\\\<доменный класс > \Element данных**, а затем выберите свойство домена.

    2. В окне «Свойства» задайте **является ключом моникера** для `true`.

- \- или -

     Создайте новый класс домена с помощью **именованный класс домена** средство.

     Это средство создает новый класс, имеющий свойство домена с именем Name. **Имя элемента** и **является ключом моникера** инициализируются значением свойства данного свойства домена `true`.

- \- или -

     Создание связи наследования от класса домена в другой класс, имеющий свойство ключа моникера.

### <a name="avoid-duplicate-monikers"></a>Избежать повторяющихся моникеры

Если вы используете полное моникерами ключа, возможно, что два элемента в модели пользователя может имеют одинаковое значение в свойстве ключа. Например если доменный язык имеет класс Person, имеющий свойство Name, пользователь может устанавливать имена двух элементов должны совпадать. Несмотря на то, что модель может быть сохранена в файл, он будет не перезагрузить правильно.

Существует несколько методов, которые помогут избежать такой ситуации:

- Задайте **имя элемента**  =  `true` для свойства ключа домена. Выберите свойство домена в схеме определения DSL и выберите значение в окне «Свойства».

     Когда пользователь создает новый экземпляр класса, это значение вынуждает свойство домена, чтобы автоматически назначить другое значение. Поведение по умолчанию добавляет номер в конец имени класса. Это не позволяет пользователю изменять имя к дубликатом, но полезно в случае, когда пользователь устанавливает значение перед сохранением модели.

- Включите проверку для DSL. В обозревателе DSL выберите Editor\Validation и задайте **использует...**  свойства `true`.

     Имеется автоматически созданный проверки метод проверки для неоднозначности. Данный метод `Load` категории проверки. Это гарантирует, что пользователь будет предупреждение о том, что может быть невозможно повторно открыть файл.

     Дополнительные сведения см. в разделе [проверка в доменных языках](../modeling/validation-in-a-domain-specific-language.md).

### <a name="moniker-paths-and-qualifiers"></a>Моникер пути и квалификаторы

Полное ключа моникер заканчивается на ключ моникера и префиксом со специальным родительским элементом в дереве внедрения. Например, если моникер альбома является:

```xml
<albumMoniker title="/My Favorites/Jazz after Teatime" />
```

Затем может быть одной из песен в этом альбоме.

```xml
<songMoniker title="/My Favorites/Jazz after Teatime/Hot tea" />
```

Тем не менее альбомы вместо ссылки по Идентификатору, затем моникеры будет выглядеть следующим образом:

```xml
<albumMoniker Id="77472c3a-9bf9-4085-976a-d97a4745237c" />
<songMoniker title="/77472c3a-9bf9-4085-976a-d97a4745237c/Hot tea" />
```

Обратите внимание на то, что так как идентификатор GUID является уникальным, оно никогда не предшествует специальное имя родительского.

Если вы знаете, что определенного свойства домена всегда будет иметь уникальное значение внутри модели, можно задать **квалификатор моникера является** для `true` для этого свойства. В результате его можно использовать в качестве квалификатора, без использования специального имени родительского элемента. Например, если установить оба **квалификатор моникера является** и **является ключом моникера** для свойства домена Title альбома класса, имя или идентификатор модели не используется в моникеры для альбома и его embedded дочерние элементы:

```xml
<albumMoniker name="Jazz after Teatime" />
<songMoniker title="/Jazz after Teatime/Hot tea" />
```

## <a name="customize-the-structure-of-the-xml"></a>Для настройки структуры XML

Чтобы выполнить следующие настройки, разверните **поведение сериализации Xml** узел в обозревателе DSL. Класс домена последовательно разверните узел элемента данных, чтобы просмотреть список свойств и связей, которые получают данные в этот класс. Выберите связь и изменить его параметры в окне «Свойства».

- Задайте **опустить элемент** в значение true, чтобы исключить узел исходной роли, оставляя только в списке целевых элементов. Не следует устанавливать этот параметр, если имеется более одной связи между исходной и целевой классы.

    ```xml
    <familyTreeModel ...>
      <!-- The following node is omitted by using Omit Element: -->
      <!-- <people> -->
        <person name="Henry VIII" .../>
        <person name="Elizabeth I" .../>
      <!-- </people> -->
    </familyTreeModel>
    ```

- Задайте **использовать полную форму** для внедрения в узлов, представляющих экземпляры отношений целевым узлам. Этот параметр задается автоматически при добавлении свойства домена в доменной связи.

    ```xml
    <familyTreeModel ...>
      <people>
        <!-- The following node is inserted by using Use Full Form: -->
        <familyTreeModelHasPeople myRelationshipProperty="x1">
          <person name="Henry VIII" .../>
        </familyTreeModelHasPeople>
        <familyTreeModelHasPeople myRelationshipProperty="x2">
          <person name="Elizabeth I" .../>
        </familyTreeModelHasPeople>
      </people>
    </familyTreeModel>
    ```

- Задайте **представление** = **элемент** должен иметь свойство домена, сохраняется как элемента а не в качестве значения атрибута.

    ```xml
    <person name="Elizabeth I" birthYear="1533">
      <deathYear>1603</deathYear>
    </person>
    ```

- Чтобы изменить порядок, в котором атрибуты и связи сериализуются, щелкните правой кнопкой мыши элемент в элемент данных и воспользуйтесь **вверх** или **вниз** команды меню.

## <a name="major-customization-using-program-code"></a>Основные настройки, с помощью программного кода

Вы можете заменить часть или все алгоритмы сериализации.

Мы рекомендуем изучить код в **Dsl\Generated Code\Serializer.cs** и **SerializationHelper.cs**.

### <a name="to-customize-the-serialization-of-a-particular-class"></a>Для настройки сериализации определенного класса

1. Задайте **является настраиваемым** в узле для этого класса в группе **поведение сериализации Xml**.

2. Преобразовать все шаблоны, выполните сборку решения и исследовать возникающие ошибки компиляции. Комментарии рядом с каждой ошибки содержат какой код, вы должны предоставить.

### <a name="to-provide-your-own-serialization-for-the-whole-model"></a>Чтобы предоставить собственную сериализацию для всей модели

1. Переопределите методы в Dsl\GeneratedCode\SerializationHelper.cs

## <a name="options-in-xml-serialization-behavior"></a>Параметры в поведение сериализации Xml

В обозревателе DSL щелкните узел поведение сериализации Xml содержит дочерний узел для каждого класса домена, отношения, фигуры, соединителя и классом схемы. Под каждым из этих узлов, приведен список свойств и связей, которые предоставляются на этот элемент. Связи представлены как в сами по себе, так и в разделе своих классов источника.

В следующей таблице перечислены параметры, которые можно задать в этом разделе определения DSL. В каждом случае выберите элемент в обозревателе DSL и задание параметров в окне «Свойства».

### <a name="xml-class-data"></a>Данные класса XML

Эти элементы находятся в обозревателе DSL под узлом **Behavior\Class сериализации XML-данных**.

|||
|-|-|
|Свойство|Описание|
|Содержит схему с настраиваемыми элементами|Если значение равно True, указывает, что доменный класс настраиваемую схему элемента|
|Пользовательское|Задайте значение **True** Если вы хотите написать собственный код сериализации и десериализации для данного доменного класса.<br /><br /> Выполните сборку решения и ошибках для обнаружения подробные инструкции.|
|Доменный класс|Доменный класс, к которому применяется этот узел класса данных. Только для чтения.|
|Имя элемента|Имя узла XML для элементов этого класса. Значение по умолчанию — строчные версию имя доменного класса.|
|Имя атрибута моникера|Имя атрибута, используемого в элементах моникера, чтобы содержать ссылку. Если не указано, используется имя или идентификатор свойства ключа.<br /><br /> В этом примере это «name»:  `<personMoniker name="/Mike Nash"/>`|
|Имя элемента моникера|Имя элемента xml, используемого для моникеров, ссылающимися на элементы этого класса.<br /><br /> Значение по умолчанию является строчной версией имя класса, суффикс «Moniker». Например, `personMoniker`.|
|Имя типа моникера|Имя типа xsd, созданного для моникеров для элементов этого класса. XSD-СХЕМЫ находится в **кода Dsl\Generated\\\*Schema.xsd**|
|Сериализовать идентификатор|Если значение равно True, идентификатора GUID элемента включается в файл. Это должно быть значение true, если отсутствует свойство, помеченный **является ключом моникера** и DSL определяет ссылочные отношения к этому классу.|
|Имя типа|Имя типа xml, созданного в xsd из обозначенного доменного класса.|
|Примечания|Неформальные примечания, связанные с этим элементом|

### <a name="xml-property-data"></a>Свойство XML-данных

Свойство XML-узлов находятся в узлах класса.

|||
|-|-|
|Свойство|Описание|
|Свойства домена|Свойство, к которому применяются данные конфигурации сериализации xml. Только для чтения.|
|— Ключ моникера|Если значение равно True, свойство используется как ключ для создания моникеров, которые ссылаются на экземпляры этого класса домена.|
|Имеет квалификатор моникера|Если значение равно True, свойство используется для создания квалификатора в моникерах. Если значение равно false, и свойство SerializeId не имеет значение true, если для данного доменного класса, моникеры уточняются именем специальное имя родительского элемента в дереве внедрения.|
|Представление|Если атрибут, свойство сериализуется как атрибут xml; Если элемент, он будет сериализовано как элемент; Если Ignore, оно не сериализовано.|
|Имя XML|Имя, используемое для XML-атрибута или элемента, представляющего свойство. По умолчанию это версия нижнего регистра в имени свойства домена.|
|Примечания|Неформальные примечания, связанные с этим элементом|

### <a name="xml-role-data"></a>Роли XML-данных

Узлы данных роли будут расположены в исходных узлов класса.

|Свойство|Описание|
|-|-|
|У пользовательского моникера|Задайте значение true, если вы хотите предоставить свой собственный код для создания и разрешении специальные имена, которые проходят через эту связь.<br /><br /> Подробные инструкции выполните сборку решения, а затем дважды щелкните сообщения об ошибках.|
|Доменная связь|Задает связь, к которому применяются эти параметры. Только для чтения.|
|Опустить элемент|Значение true, если узел XML, соответствующий роли источника, опускается из схемы.<br /><br /> Если имеется более одной связи между исходной и целевой классы, этот узел роли позволяет различать ссылки, который входит в две связи. Поэтому мы рекомендуем не задавать этот параметр в этом случае.|
|Имя элемента роли|Задает имя элемента XML, который является производным от роли источника. Значение по умолчанию — имя свойства роли.|
|Использовать полную форму|Значение true, если каждый целевой элемент или моникер заключено в XML-узел, представляющий отношение. Это должно быть присвоено значение true, если связь имеет собственные свойства домена.|

## <a name="see-also"></a>См. также

- [Перемещение по модели и обновление модели в коде программы](../modeling/navigating-and-updating-a-model-in-program-code.md)
- [Создание кода из доменного языка](../modeling/generating-code-from-a-domain-specific-language.md)