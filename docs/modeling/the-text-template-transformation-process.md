---
title: Процесс преобразования текстового шаблона
ms.date: 11/04/2016
ms.topic: conceptual
helpviewer_keywords:
- text templates, transformation process
author: jillre
ms.author: jillfra
manager: jillfra
ms.workload:
- multiple
ms.openlocfilehash: 518c06f8630ad9fa7742f7b3e85ac27263cd0a86
ms.sourcegitcommit: a8e8f4bd5d508da34bbe9f2d4d9fa94da0539de0
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 10/19/2019
ms.locfileid: "72605808"
---
# <a name="the-text-template-transformation-process"></a>Процесс преобразования текстового шаблона
Процесс преобразования текстовых шаблонов принимает текстовый файл шаблона в качестве входных данных и создает новый текстовый файл в качестве выходных данных. Например, можно использовать текстовые шаблоны для создания Visual Basic или C# кода или создать HTML-отчет.

 В этом процессе участвуют три компонента: механизм, узел и процессоры директив. Обработчик управляет процессом. он взаимодействует с хостом и процессором директив для создания выходного файла. Узел обеспечивает любое взаимодействие с средой, например поиск файлов и сборок. Обработчик директив добавляет такие функции, как чтение данных из XML-файла или базы данных.

 Процесс преобразования текстовых шаблонов выполняется в два этапа. Во-первых, подсистема создает временный класс, известный как созданный класс преобразования. Этот класс содержит код, созданный директивами и блоками управления. После этого обработчик компилирует и выполняет созданный класс преобразования для создания выходного файла.

## <a name="components"></a>Компоненты

|Компонент|Описание|Настраиваемое (да/нет)|
|-|-|-|
|Ядре|Компонент обработчика управляет процессом преобразования текстовых шаблонов|Номер|
|Узел|Узел — это интерфейс между ядром и средой пользователя. Visual Studio — это узел процесса преобразования текста.|Да. Можно написать пользовательский узел.|
|Обработчики директив|Обработчики директив — это классы, обрабатывающие директивы в текстовых шаблонах. Директивы можно использовать для предоставления данных текстовому шаблону из входного источника.|Да. Можно написать пользовательские обработчики директив|

## <a name="the-engine"></a>Подсистема
 Подсистема получает шаблон в виде строки из узла, который обрабатывает все файлы, используемые в процессе преобразования. Затем ядро запрашивает у узла поиск любых обработчиков пользовательских директив и других аспектов среды. Затем ядро компилирует и запускает созданный класс преобразования. Обработчик возвращает созданный текст для узла, который обычно сохраняет текст в файл.

## <a name="the-host"></a>Узел
 Узел отвечает за все, что относится к среде за пределами процесса преобразования, включая следующие:

- Поиск текстовых и двоичных файлов, запрошенных ядром или процессором директив. Узел может искать сборки в каталогах и в глобальном кэше сборок. Узел может искать код обработчика пользовательской директивы для подсистемы. Узел может также размещать и считывать текстовые файлы и возвращать их содержимое в виде строк.

- Предоставление списка стандартных сборок и пространств имен, используемых ядром для создания создаваемого класса преобразования.

- Предоставление домена приложения, используемого, когда модуль компилирует и выполняет созданный класс преобразования. Для защиты ведущего приложения от ошибок в коде шаблона используется отдельный домен приложения.

- Запись созданного выходного файла.

- Задание расширения по умолчанию для созданного выходного файла.

- Обработка ошибок преобразования текстовых шаблонов. Например, узел может отображать ошибки в пользовательском интерфейсе или записывать их в файл. (В Visual Studio ошибки отображаются в окне сообщения об ошибке.)

- Предоставление обязательного значения параметра, если пользователь вызвал директиву без указания значения. Процессор директив может указать имя директивы и параметр, а также попросить узел предоставить значение по умолчанию, если оно имеется.

## <a name="directives-and-directive-processors"></a>Директивы и обработчики директив
 Директива — это команда в текстовом шаблоне. Он предоставляет параметры для процесса создания. Обычно директивы определяют источник и тип модели, а также другие входные данные и расширение имени выходного файла.

 Обработчик директив может обрабатывать одну или несколько директив. При преобразовании шаблона необходимо установить обработчик директив, который может работать с директивами в шаблоне.

 Директивы работают путем добавления кода в создаваемый класс преобразования. Вы вызываете директивы из текстового шаблона, и подсистема обрабатывает все вызовы директив при создании созданного класса преобразования. После успешного вызова директивы остальной код, который вы пишете в текстовом шаблоне, может полагаться на функциональные возможности, предоставляемые этой директивой. Например, можно выполнить следующий вызов директивы `import` в шаблоне:

 `<#@ import namespace="System.Text" #>`

 Стандартный обработчик директив преобразует его в инструкцию `using` в созданном классе преобразования. Затем можно использовать класс `StringBuilder` в остальной части кода шаблона, не указывая его как `System.Text.StringBuilder`.