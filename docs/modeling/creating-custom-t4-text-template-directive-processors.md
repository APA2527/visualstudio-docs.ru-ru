---
title: Создание пользовательских обработчиков директив для текстовых шаблонов T4
ms.date: 11/04/2016
ms.topic: conceptual
helpviewer_keywords:
- text templates, custom directive processors
author: gewarren
ms.author: gewarren
manager: jillfra
ms.workload:
- multiple
ms.openlocfilehash: 6c159cd6fbd4f2fbfff414688e2ec865bcc8ddb4
ms.sourcegitcommit: 94b3a052fb1229c7e7f8804b09c1d403385c7630
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/23/2019
ms.locfileid: "63002706"
---
# <a name="creating-custom-t4-text-template-directive-processors"></a>Создание пользовательских обработчиков директив для текстовых шаблонов T4

*Процесс преобразования текстового шаблона* принимает *текстового шаблона* файл на входе и создает текстовый файл на выходе. *Модуль преобразования текстового шаблона* элементов управления, процесс, а также модуль взаимодействует с узлом преобразования текстового шаблона и один или несколько текстового шаблона *процессоры директив* для завершения процесс. Дополнительные сведения см. в разделе [процесс преобразования текстового шаблона](../modeling/the-text-template-transformation-process.md).

Для создания пользовательского процессора директив создается класс, наследующий <xref:Microsoft.VisualStudio.TextTemplating.DirectiveProcessor> либо <xref:Microsoft.VisualStudio.TextTemplating.RequiresProvidesDirectiveProcessor>.

Это различие между этими двумя <xref:Microsoft.VisualStudio.TextTemplating.DirectiveProcessor> реализует минимальный интерфейс, необходимы для получения параметров от пользователя, а также для создания кода, который создает выходной файл шаблона. <xref:Microsoft.VisualStudio.TextTemplating.RequiresProvidesDirectiveProcessor> реализует требует или предоставляет шаблон проектирования. <xref:Microsoft.VisualStudio.TextTemplating.RequiresProvidesDirectiveProcessor> обрабатывает два особых параметров `requires` и `provides`.  К примеру, пользовательского процессора директив может принять имя файла от пользователя, открыть и прочитать файл и сохраните текстового файла в переменной, которая называется `fileText`. Подкласс <xref:Microsoft.VisualStudio.TextTemplating.RequiresProvidesDirectiveProcessor> может принимать имя файла от пользователя в качестве значения `requires` и имя переменной для хранения текста для параметра `provides` параметр. Этот обработчик будет открыть и прочитать файл и сохраните текстового файла в указанной переменной.

Перед вызовом пользовательского процессора директив из текстового шаблона в Visual Studio, необходимо зарегистрировать его.

Дополнительные сведения о том, как добавить раздел реестра, см. в разделе [развертывание пользовательского процессора директив](../modeling/deploying-a-custom-directive-processor.md).

## <a name="custom-directives"></a>Пользовательские директивы

Пользовательской директивы выглядит следующим образом:

`<#@ MyDirective Processor="MyDirectiveProcessor" parameter1="value1" ... #>`

Пользовательский процессор директив можно использовать для доступа к внешним данным или ресурсам из текстового шаблона.

Различные текстовые шаблоны могут совместно использовать функции, предоставляемые один процессор директив, поэтому процессоры директив предоставляют способ идентификации кода для повторного использования. Встроенная `include` директива аналогичен предыдущему, так как его можно использовать выносить код и обмениваться ими в разных текстовых шаблонах. Разница является то, что функциональные возможности, `include` директива предоставляет является фиксированным и не принимает параметры. Если вы хотите получать общие функциональные возможности в текстовый шаблон и шаблон для передачи параметров, необходимо создать пользовательский процессор директив.

Некоторые примеры процессоры пользовательской директивы может быть:

- Процессор директив, чтобы вернуть данные из базы данных, который принимает в качестве параметров имя пользователя и пароль.

- Процессор директив, чтобы открыть и прочитать файл, который принимает имя файла в качестве параметра.

### <a name="principal-parts-of-a-custom-directive-processor"></a>Обязательные части пользовательского процессора директив

Для создания пользовательского процессора директив, необходимо создать класс, наследующий <xref:Microsoft.VisualStudio.TextTemplating.DirectiveProcessor> или <xref:Microsoft.VisualStudio.TextTemplating.RequiresProvidesDirectiveProcessor>.

Наиболее важным `DirectiveProcessor` используются следующие методы, которые необходимо реализовать.

- `bool IsDirectiveSupported(string directiveName)` – Возвращает `true` Если процессор директив может обрабатывать именованную директиву.

- `void ProcessDirective (string directiveName, IDictionary<string, string> arguments)` -Модуль шаблонов вызывает этот метод для каждого вхождения директивы в шаблоне. Ваш процессор должен сохранять результаты.

После всех вызовов ProcessDirective() будет вызывать эти методы:

- `string[] GetReferencesForProcessingRun()` – Возвращает имена сборок, которые требуется код шаблона.

- `string[] GetImportsForProcessingRun()` – Возвращает пространства имен, который может использоваться в коде шаблона.

- `string GetClassCodeForProcessingRun()` – Возвращает код методы, свойства и другие объявления, которые могут использовать код шаблона. Для этого проще всего создать строку, содержащую код C# или Visual Basic. Чтобы сделать процессор директив можно было вызывать из шаблона, который использует любой язык среды CLR, можно составлять операторы в виде дерева CodeDom и затем возвращают результат сериализации дерева на языке, используемом в шаблоне.

- Дополнительные сведения см. в разделе [Пошаговое руководство: Создание пользовательского процессора директив](../modeling/walkthrough-creating-a-custom-directive-processor.md).

## <a name="see-also"></a>См. также

- [Развертывание пользовательского процессора директив](../modeling/deploying-a-custom-directive-processor.md) объясняет регистрацию пользовательского процессора директив.
- [Пошаговое руководство: Создание пользовательского процессора директив](../modeling/walkthrough-creating-a-custom-directive-processor.md) описывает способы создания пользовательского процессора директив, как зарегистрировать и проверить процессора директив и способ форматирования выходной файл в виде HTML.