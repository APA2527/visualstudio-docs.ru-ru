---
title: Использование шаблонов CookieCutter с Python
description: Благодаря поддержке графического расширения Cookiecutter в Visual Studio можно искать шаблоны кода Python и на их основе создавать проекты.
ms.date: 01/28/2019
ms.topic: how-to
author: JoshuaPartlow
ms.author: joshuapa
manager: jillfra
ms.custom: seodec18
ms.workload:
- python
- data-science
ms.openlocfilehash: 2d58462b90039e14ae98fe450812ca4cfdb6cbbd
ms.sourcegitcommit: a801ca3269274ce1de4f6b2c3f40b58bbaa3f460
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/25/2020
ms.locfileid: "88801585"
---
# <a name="use-the-cookiecutter-extension"></a>Использование расширения Cookiecutter

[Cookiecutter](https://cookiecutter.readthedocs.io/en/latest/) предоставляет графический пользовательский интерфейс для поиска шаблонов, ввода их параметров и создания проектов и файлов. В Visual Studio 2017 и более поздних версий этот компонент уже встроен. В более ранних версиях Visual Studio его нужно устанавливать отдельно.

Для Cookiecutter требуется Python 3.3 или более поздней версии (32- или 64-разрядная), Anaconda 3 4.2 или более поздней версии (32- или 64-разрядная). Если подходящий интерпретатор Python недоступен, в Visual Studio отображается предупреждение. Если вы устанавливаете интерпретатор Python в процессе выполнения Visual Studio, нажмите на панели инструментов Cookiecutter кнопку **Home** (Домой), чтобы обнаружить установленный интерпретатор. (Дополнительные общие сведения о средах см. в разделе [Среды Python](managing-python-environments-in-visual-studio.md).)

После завершения установки выберите **Просмотр** > **Обозреватель Cookiecutter**, чтобы отрыть окно обозревателя.

![Главное окно Cookiecutter](media/cookiecutter-overview.png)

## <a name="cookiecutter-workflow"></a>Рабочий процесс Cookiecutter

Работа с Cookiecutter включает просмотр и выбор шаблона, клонирование его на локальный компьютер, установку параметров, а затем создание кода из клонированного шаблона. Весь этот процесс описан в разделах ниже.

### <a name="browse-templates"></a>Обзор шаблонов

На домашней странице Cookiecutter отображается список шаблонов, упорядоченных в представленные ниже группы.

| Группа | Description |
| --- | --- |
| **Установлено** | Шаблоны, установленные на локальный компьютер. Когда используется шаблон в Интернете, его репозиторий автоматически клонируется в подпапку *~/.cookiecutters*. Вы можете удалить установленный шаблон, выбрав его и нажав клавишу **DELETE**. |
| **Рекомендованные** | Шаблоны, загруженные из рекомендуемого веб-канала. Веб-канал по умолчанию курируется корпорацией Майкрософт. Дополнительные сведения о настройке веб-канала см. в разделе [Параметры Cookiecutter](#cookiecutter-options), приведенном ниже. |
| **GitHub** | Результаты поиска по ключевому слову cookiecutter на сайте GitHub. Они возвращаются с разбиением на страницы. Если доступно больше результатов, в конце списка содержится ссылка **Загрузить еще**. |
| **Custom** | Если в поле поиска введено пользовательское расположение, оно также отобразится в этой группе. Вы можете ввести либо полный путь к репозиторию GitHub, либо полный путь к папке на локальном диске. |

### <a name="cloning"></a>клонирования

Когда вы выбираете шаблон и нажимаете кнопку **Далее**, Cookiecutter создает локальную копию, из которой будет работать.

Если вы выбираете шаблон из групп **Рекомендуется** или **GitHub** или вводите настраиваемый URL-адрес в поле поиска и выбираете соответствующий шаблон, он клонируется и устанавливается на ваш локальный компьютер. Если же этот шаблон был установлен в предыдущем сеансе Visual Studio, он автоматически удаляется и клонируется последняя версия.

Если вы выбираете шаблон из группы **Установленные** или вводите в поле поиска настраиваемый путь к папке и выбираете соответствующий шаблон, Visual Studio загружает этот шаблон без клонирования.

> [!Important]
> Шаблоны Cookiecutter всегда клонируются в одной папке *~/.cookiecutters*. Каждой подпапке присваивается имя репозитория Git без указания имени пользователя GitHub. При клонировании различных шаблонов с одинаковым именем, принадлежащих разным пользователям, могут возникнуть конфликты. В таком случае вы не сможете перезаписать существующий шаблон на другой с таким же именем. Чтобы установить другой шаблон, сначала нужно удалить существующий.

### <a name="set-template-options"></a>Настройка параметров шаблона

После локальной установки шаблона Cookiecutter отображает страницу параметров, на которой вы можете указать, где именно Cookiecutter создать файлы, а также ряд других параметров.

![Страница параметров Cookiecutter](media/cookiecutter-template-options.png)

Для каждого шаблона Cookiecutter определяется свой набор параметров и устанавливается значение по умолчанию (предложенный текст в каждом поле ввода). Значением по умолчанию может быть фрагмент кода, особенно если это динамическое значение, использующее другие параметры.

Для определенных параметров можно настроить значения по умолчанию с помощью файла конфигурации пользователя. Когда расширение Cookiecutter обнаруживает файл конфигурации пользователя, значения по умолчанию для шаблона заменяются на значения по умолчанию в этом файле. Дополнительные сведения см. в разделе документации Cookiecutter о [пользовательской конфигурации](https://cookiecutter.readthedocs.io/en/latest/advanced/user_config.html).

Если в шаблоне заданы определенные задачи Visual Studio, которые необходимо выполнить после создания кода, появится дополнительный параметр **Run additional tasks on completion** (Выполнить дополнительные задачи по завершении), который позволит явно отказаться от этих задач. Самые распространенные задачи — открытие веб-браузера, открытие файлов в редакторе, установка зависимостей и другие.

### <a name="create"></a>Создание

После настройки параметров выберите **Создать**, чтобы создать код (если выходная папка не пуста, отображается предупреждение). Если вы уже сталкивались с выходными данными шаблона и не против перезаписи файлов, вы можете проигнорировать предупреждение. В противном случае щелкните **Отмена**, укажите пустую папку, а затем вручную скопируйте созданные файлы в папку выходных данных с определенным содержимым.

После успешного создания файлов Cookiecutter предоставит возможность открывать файлы в **обозревателе решений**.

![Отображение команды обозревателя решений в Cookiecutter](media/cookiecutter-files-created.png)

## <a name="cookiecutter-options"></a>Параметры Cookiecutter

Выберите **Инструменты** > **Параметры** > **Cookiecutter**, чтобы увидеть доступные параметры Cookiecutter.

![Параметры Cookiecutter](media/cookiecutter-tools-options.png)

| Параметр | Description |
| --- | --- |
| **Рекомендуемый URL-адрес веб-канала** | Расположение веб-канала рекомендуемых шаблонов. Это может быть URL-адрес или путь к локальному файлу. Если не указывать значение в этом поле, будет использоваться веб-канал по умолчанию, который курирует корпорация Майкрософт. Веб-канал предоставляет простой список расположений шаблона, разделенных новыми строками. Чтобы запросить изменения для курируемого веб-канала, необходимо запросить [источник на GitHub](https://github.com/Microsoft/PTVS/blob/master/Python/Product/Cookiecutter/CookiecutterFeed.txt). |
| **Показать справку** | Данный параметр управляет видимостью панели со справкой в верхней области окна Cookiecutter. |

## <a name="optimize-cookiecutter-templates-for-visual-studio"></a>Оптимизация шаблонов Cookiecutter для Visual Studio

Чтобы ознакомиться с основами разработки шаблона Cookiecutter, обратитесь к [документации Cookiecutter](https://cookiecutter.readthedocs.io/en/latest/first_steps.html). Расширение Cookiecutter для Visual Studio поддерживает шаблоны, созданные для Cookiecutter версии 1.4.

Отрисовка по умолчанию переменных шаблона зависит от типа данных (строковый тип данных или список).

- Строковый тип данных: метка для имени переменной, текстовое поле для ввода значения и филигрань для отображения значения по умолчанию. Всплывающая подсказка в текстовом поле отображает значение по умолчанию.
- Список: метка для имени переменной, поле со списком для выбора значения. Всплывающая подсказка в поле со списком отображает значение по умолчанию.

Эти возможности можно расширить, указав дополнительные метаданные в файле *cookiecutter.json* именно для Visual Studio (они игнорируются интерфейсом командной строки Cookiecutter). Эти свойства необязательны.

| Свойство | Description |
| --- | --- |
| Метка | Содержимое, которое отображается над редактором для переменной вместо ее имени. |
| Description | Описание, которое отображается в качестве подсказки в элементе управления "Поле ввода" вместо значения по умолчанию для этой переменной. |
| URL-адрес | Изменяет метку на гиперссылку. Появляется всплывающая подсказка, отображающая URL-адрес. Если вы щелкните гиперссылку, откроется пользовательский браузер по умолчанию с этим URL-адресом. |
| Выбор | Позволяет настроить редактор для переменной. В настоящее время поддерживаются следующие селекторы:<ul><li>`string`: стандартное текстовое поле, заданное по умолчанию для строк;</li><li>`list`: стандартное поле со списком, заданное по умолчанию для списков;</li><li>`yesno`: поле со списком, чтобы выбрать между `y` и `n` для строк;</li><li>`odbcConnection`: текстовое поле с кнопкой **...** для вывода диалогового окна подключения к базе данных.</li></ul> |

Пример

```json
{
    "site_name": "web-app",
    "python_version": ["3.5.2", "2.7.12"],
    "use_azure": "y",

    "_visual_studio": {
        "site_name": {
            "label": "Site name",
            "description": "E.g. <site-name>.azurewebsites.net (can only contain alphanumeric characters and `-`)"
        },
        "python_version": {
            "label": "Python version",
            "description": "The version of Python to run the site on"
        },
        "use_azure" : {
            "label": "Use Azure",
            "description": "Include Azure deployment files",
            "selector": "yesno",
            "url": "https://azure.microsoft.com"
        }
    }
}
```

### <a name="run-visual-studio-tasks"></a>Выполнение задач Visual Studio

Функция Cookiecutter с именем *Post-Generate Hooks* (Обработчики после создания) позволяет после создания файлов выполнять произвольный код на языке Python. Несмотря на гибкость этой функции, получить доступ к Visual Studio не так просто.

К примеру, вы хотите открыть файл в редакторе Visual Studio или его веб-браузере либо активировать пользовательский интерфейс Visual Studio, который предлагает пользователю создать виртуальную среду и установить требования к пакету.

Чтобы поддерживать эти сценарии, Visual Studio выполняет поиск расширенных метаданных в файле *cookiecutter.json*, в котором описываются команды для выполнения, после того как пользователь открыл созданные файлы в **обозревателе решений** или добавил файлы в существующий проект. Пользователь опять может отменить выполнение этих задач, используя параметр **Выполнить дополнительные задачи по завершении**, доступный в параметрах шаблона.

Пример

```json
"_visual_studio_post_cmds": [
    {
        "name": "File.OpenFile",
        "args": "{{cookiecutter._output_folder_path}}\\readme.txt"
    },
    {
        "name": "Cookiecutter.ExternalWebBrowser",
        "args": "https://docs.microsoft.com"
    },
    {
        "name": "Python.InstallProjectRequirements",
        "args": "{{cookiecutter._output_folder_path}}\\dev-requirements.txt"
    }
]
```

Команды указываются по имени. Должно использоваться нелокализованное имя (на английском языке) для работы с локализованными установками Visual Studio. Используйте **командное окно** Visual Studio для проверки и обнаружения имен команд.

Если вы хотите передать один аргумент, укажите его в качестве строки, как показано в примере выше.

Если же необходимости передавать аргумент нет, оставьте строку в JSON-файле пустой.

```json
"_visual_studio_post_cmds": [
    {
        "name": "View.WebBrowser"
    }
]
```

Используйте массив для нескольких аргументов. Что касается параметров, разделите параметр и его значение на отдельные аргументы, используя соответствующее заключение в кавычки. Пример:

```json
"_visual_studio_post_cmds": [
    {
        "name": "File.OpenFile",
        "args": [
            "{{cookiecutter._output_folder_path}}\\read me.txt",
            "/e:",
            "Source Code (text) Editor"
        ]
    }
]
```

Аргументы могут содержать ссылки на другие переменные Cookiecutter. В примерах, приведенных выше, внутренняя переменная `_output_folder_path` используется для формирования абсолютного пути к созданным файлам.

Обратите внимание, что команда `Python.InstallProjectRequirements` работает только при добавлении файлов в существующий проект. Это ограничение связано с тем, что эта команда обрабатывается проектом Python в **обозревателе решений**, а в **обозревателе решений** - **в представлении папок** отсутствует проект для получения сообщения. Мы планируем устранить это ограничение в последующих выпусках (а также в целом улучшить поддержку **представления папок**).

## <a name="troubleshooting"></a>Устранение неполадок

### <a name="error-loading-template"></a>Ошибка при загрузке шаблона

Некоторые шаблоны могут использовать недопустимые типы данных, например логические значения, в файлах *cookiecutter.json*. Сообщите о таких экземплярах автору шаблона, выбрав ссылку **Проблемы** на информационной панели шаблона.

### <a name="hook-script-failed"></a>Не удалось выполнить сценарий обработчика

Некоторые шаблоны могут использовать сценарии задач после создания, несовместимые с пользовательским интерфейсом Cookiecutter. Например, скрипты на запрос ввода данных пользователем завершаются сбоем из-за отсутствия консоли терминала.

### <a name="hook-script-not-supported-on-windows"></a>Сценарий перехватчика не поддерживается в Windows

Если пост-установочный скрипт содержится в файле с расширением *.sh*, его невозможно связать с приложением на компьютере под управлением Windows. Может появиться диалоговое окно с предложением найти совместимое приложение в Магазине Windows.

### <a name="templates-with-known-issues"></a>Шаблоны с распространенными проблемами

Сбои при клонировании:

- **wildfish/cookiecutter-django-crud** (недопустимый знак `|` в имени подпапки);
- **cookiecutter-pyvanguard** (недопустимый знак `|` в имени подпапки).

Сбои при загрузке:

- **chrisdev/wagtail-cookiecutter-foundation** (использует логический тип в файле *cookiecutter.json*);
- **quintoandar/cookiecutter-android** (отсутствует папка шаблона).

Сбои при запуске:

- **iknite/cookiecutter-ansible-role** (постсценарий обработки требует ввода в консоли);
- **benregn/cookiecutter-django-ansible** (ошибка Jinja)

Используется bash (не является критической ошибкой):

- **openstack-dev/cookiecutter**.
