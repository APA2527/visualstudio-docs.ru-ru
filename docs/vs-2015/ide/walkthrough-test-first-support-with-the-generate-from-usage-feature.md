---
title: Пошаговое руководство. Основанная на тестировании поддержка с помощью возможности "Создание в результате использования" | Документы Майкрософт
ms.date: 11/15/2016
ms.prod: visual-studio-dev14
ms.technology: vs-ide-general
ms.topic: conceptual
helpviewer_keywords:
- Generate From Usage
- Test-First Development
ms.assetid: 764c17a4-cd95-4c23-bf63-d92d9c5adfb2
caps.latest.revision: 68
author: jillre
ms.author: jillfra
manager: jillfra
ms.openlocfilehash: f40ed5f3070f177d1c914495f78a223364d64ae4
ms.sourcegitcommit: a8e8f4bd5d508da34bbe9f2d4d9fa94da0539de0
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 10/19/2019
ms.locfileid: "72662677"
---
# <a name="walkthrough-test-first-support-with-the-generate-from-usage-feature"></a>Пошаговое руководство. Основанная на тестировании поддержка с помощью возможности "Создание в результате использования"
[!INCLUDE[vs2017banner](../includes/vs2017banner.md)]

В этом разделе демонстрируется использование функции [Создание в результате использования](../misc/generate-from-usage.md), которая поддерживает разработку на основе тестирования.

 *Разработка на основе тестирования* является подходом к созданию программного обеспечения, в рамках которого на основе спецификаций продукта создаются модульные тесты, а затем создается исходный код, который приводит к успешному выполнению тестов. [!INCLUDE[vsprvs](../includes/vsprvs-md.md)] поддерживает разработку на основе тестирования путем создания новых типов и членов в исходном коде при их первом упоминании в тестовых случаях до их определения.

 [!INCLUDE[vsprvs](../includes/vsprvs-md.md)] создает новые типы и члены, практически не изменяя рабочий процесс. Разработчик может создавать заглушки для типов, методов, свойств, полей или конструкторов прямо из текущего места в коде. После закрытия диалогового окна создания типа фокус сразу же возвращается в файл, открытый в настоящий момент.

 Функция "Создание в результате использования" может использоваться вместе с платформами тестирования, интегрированными с [!INCLUDE[vsprvs](../includes/vsprvs-md.md)]. В этом разделе показана платформа модульного тестирования корпорации Майкрософт.

 [!INCLUDE[note_settings_general](../includes/note-settings-general-md.md)]

### <a name="to-create-a-windows-class-library-project-and-a-test-project"></a>Создание проекта библиотеки классов Windows и проекта тестирования

1. Создайте проект библиотеки классов Windows в [!INCLUDE[csprcs](../includes/csprcs-md.md)] или [!INCLUDE[vbprvb](../includes/vbprvb-md.md)]. Назовите его `GFUDemo_VB` или `GFUDemo_CS`в зависимости от используемого языка.

2. В **обозревателе решений**щелкните правой кнопкой мыши значок решения в верхней части окна, выберите команду **Добавить**, а затем — **Новый проект**. В диалоговом окне **Создание проекта** в левой области **Типы проектов** выберите элемент **Тестирование**.

3. В области **Шаблоны** выберите элемент **Проект модульного теста** и примите имя по умолчанию UnitTestProject1. На рисунке ниже показано диалоговое окно, отображаемое в [!INCLUDE[csprcs](../includes/csprcs-md.md)]. Диалоговое окно в [!INCLUDE[vbprvb](../includes/vbprvb-md.md)] выглядит похоже.

     ![Диалоговое окно создания тестового проекта](../ide/media/newproject-test.png "NewProject_Test") Диалоговое окно «Создание проекта»

4. Нажмите кнопку **ОК** , чтобы закрыть диалоговое окно **Создание проекта** .

5. В **обозревателе решений** для проекта класса щелкните правой кнопкой мыши узел **Ссылки** и выберите действие **Добавить ссылку**.

6. В диалоговом окне **Диспетчер ссылок** выберите **Проекты**, а затем выберите нужный проект модульного теста.

7. Щелкните **ОК**, чтобы закрыть диалоговое окно **Диспетчер ссылок**.

8. В файле **Class1** сразу после последней из инструкций **using** добавьте новую инструкцию **using** для тестового проекта:

    * В Visual Basic она имеет вид `Using UnitTestProject1`.

    * Для C# используйте `using UnitTestProject1;`.

9. Сохраните решение. Теперь все готово для создания тестов.

### <a name="to-generate-a-new-class-from-a-unit-test"></a>Создание класса на основе модульного теста

1. Тестовый проект содержит файл с именем UnitTest1. Дважды щелкните этот файл в **обозревателе решений** , чтобы открыть его в редакторе кода. Будет создан тестовый класс и метод теста.

2. Найдите объявление класса `UnitTest1` и переименуйте его в `AutomobileTest`. Если в C# есть конструктор `UnitTest1()` , переименуйте его в `AutomobileTest()`.

    > [!NOTE]
    > Теперь функция IntelliSense поддерживает два режима завершения инструкций: *режим завершения* и *режим предложений*. Режим предложений следует применять в тех случаях, когда классы и члены используются до их определения. Когда открыто окно IntelliSense, для переключения между режимом завершения и режимом предложений можно нажать клавиши CTRL+ALT+ПРОБЕЛ. Дополнительные сведения см. в разделе [Using IntelliSense](../ide/using-intellisense.md) . Режим предложений поможет вам при вводе `Automobile` в следующем шаге.

3. Найдите метод `TestMethod1()` и переименуйте его в `DefaultAutomobileIsInitializedCorrectly()`. Внутри этого метода создайте экземпляр класса с именем `Automobile`, как показано в приведенных ниже примерах. Отобразится волнистая линия подчеркивания, свидетельствующая об ошибке компиляции, а под именем типа отобразится смарт-тег. Расположение смарт-тега зависит от того, используется ли [!INCLUDE[vbprvb](../includes/vbprvb-md.md)] или [!INCLUDE[csprcs](../includes/csprcs-md.md)].

     ![Подчеркивание смарт-тега в Visual Basic](../ide/media/genclass-underlinevb.png "GenClass_UnderlineVB") Visual Basic

     ![Подчеркивание смарт-тега&#35; в C](../ide/media/genclass-underline.png "GenClass_Underline") ВнешнегоC#

4. Наведите указатель мыши на смарт-тег, чтобы просмотреть сообщение об ошибке, в котором сообщается о том, что тип `Automobile` еще не определен. Щелкните смарт-тег или нажмите клавиши CTRL+. (CTRL+точка), чтобы открыть контекстное меню "Создание в результате использования", как показано на рисунке ниже.

     ![Контекстное меню смарт-тега в Visual Basic](../ide/media/genclass-smartvb.png "GenClass_SmartVB") Visual Basic

     ![Контекстное меню смарт-тега на&#35; языке C](../ide/media/genclass-smartcs.png "GenClass_SmartCS") ВнешнегоC#

5. Теперь возможны два варианта. Вы можете щелкнуть команду **Создать класс для Automobile** , чтобы создать файл в тестовом проекте и заполнить его пустым классом с именем `Automobile`. Это быстрый способ создания класса в новом файле текущего проекта с модификаторами доступа по умолчанию. Вы также можете выбрать команду **Сформировать новый тип** , чтобы открыть диалоговое окно **Формирование нового типа** . Это обеспечивает размещение класса в существующем файле или добавление файла в другой проект.

     Выберите команду **Сформировать новый тип** , чтобы открыть диалоговое окно **Формирование нового типа** , которое показано на рисунке ниже. В списке **Проект** выберите элемент **GFUDemo_VB** или элемент **GFUDemo_CS** , чтобы среда [!INCLUDE[vsprvs](../includes/vsprvs-md.md)] добавила файл в проект исходного кода, а не в тестовый проект.

     ![Диалоговое окно «Создание нового типа»](../ide/media/genotherdialog.png "женосердиалог") Диалоговое окно «Создание нового типа»

6. Нажмите кнопку **ОК** , чтобы закрыть диалоговое окно и создать файл.

7. В **обозревателе решений**обратитесь к узлам проекта GFUDemo_VB или GFUDemo_CS, чтобы убедиться в том, что новый файл Automobile.vb или Automobile.cs содержится в проекте. В редакторе кода фокус остается на элементе `AutomobileTest.DefaultAutomobileIsInitializedCorrectly`. Написание теста можно свободно продолжить.

### <a name="to-generate-a-property-stub"></a>Создание заглушки свойства

1. Предположим, что в спецификации продукта класс `Automobile` имеет два открытых свойства с именами `Model` и `TopSpeed`. Эти свойства необходимо инициализировать значениями по умолчанию `"Not specified"` и `-1` с помощью конструктора по умолчанию. Следующий модульный тест позволит убедиться в том, что конструктор по умолчанию устанавливает свойства в соответствующие значения.

     Добавьте приведенную ниже строку кода в элемент `DefaultAutomobileIsInitializedCorrectly`.

     [!code-csharp[VbTDDWalkthrough#1](../snippets/csharp/VS_Snippets_VBCSharp/vbtddwalkthrough/cs/unittest1.cs#1)]
     [!code-vb[VbTDDWalkthrough#1](../snippets/visualbasic/VS_Snippets_VBCSharp/vbtddwalkthrough/vb/unittest1.vb#1)]

     Так как код ссылается на два неопределенных свойства `Automobile`, отображается смарт-тег. Щелкните смарт-тег для `Model` , а затем выберите пункт **Создание прототипа свойства**. Создайте заглушку свойства и для свойства `TopSpeed` .

     В классе `Automobile` типы новых свойств корректным образом выводятся из контекста.

     На рисунке ниже показано контекстное меню смарт-тега.

     ![Создание контекстного меню свойств в Visual Basic](../ide/media/genpropertysmarttagvb.png "женпропертисмарттагвб") Visual Basic

     ![Контекстное меню создания свойства в C&#35; ](../ide/media/genpropertysmarttagcs.png "женпропертисмарттагкс") ВнешнегоC#

### <a name="to-locate-the-source-code"></a>Поиск исходного кода

1. Используйте функцию **Перейти** для перехода к файлу исходного кода Automobile.cs или Automobile.vb, чтобы убедиться в том, что были созданы новые свойства.

     Функция **Перейти** позволяет быстро ввести текстовую строку (например, имя типа или часть имени) и перейти в необходимое место, щелкнув элемент в списке результатов.

     Откройте диалоговое окно **Перейти** , щелкнув в окне редактора кода и нажав клавиши CTRL+, (CTRL+запятая). В текстовом поле введите `automobile`. Выберите в списке класс **Automobile** и нажмите кнопку **ОК**.

     Окно **Перейти** показано на рисунке ниже.

     ![Диалоговое окно "переход к](../ide/media/navigate-2.png "Navigate_2") " Переход к окну

### <a name="to-generate-a-stub-for-a-new-constructor"></a>Создание заглушки для нового конструктора

1. В этом тестовом методе будет создана заглушка конструктора, которая инициализирует свойства `Model` и `TopSpeed` указанными значениями. После этого будет добавлен код, завершающий тест. Добавьте приведенный ниже дополнительный тестовый метод в класс `AutomobileTest` .

     [!code-csharp[VbTDDWalkthrough#2](../snippets/csharp/VS_Snippets_VBCSharp/vbtddwalkthrough/cs/intermediate.cs#2)]
     [!code-vb[VbTDDWalkthrough#2](../snippets/visualbasic/VS_Snippets_VBCSharp/vbtddwalkthrough/vb/intermediate.vb#2)]

2. Щелкните смарт-тег в новом конструкторе класса и выберите команду **Сформировать заглушку конструктора**. В файле класса `Automobile` обратите внимание на то, что новый конструктор проверил имена локальных переменных, используемых в вызове конструктора, обнаружил свойства с одинаковыми именами в классе `Automobile` и создал в теле конструктора код для хранения значений аргументов в свойствах `Model` и `TopSpeed` . (В [!INCLUDE[vbprvb](../includes/vbprvb-md.md)]поля `_model` и `_topSpeed` нового конструктора являются неявно определенными резервными полями свойств `Model` и `TopSpeed` .)

3. После создания нового конструктора под вызовом конструктора по умолчанию в `DefaultAutomobileIsInitializedCorrectly`отображается волнистая линия. Сообщение об ошибке указывает на то, что класс `Automobile` не имеет конструктора, который не принимает ни одного аргумента. Чтобы создать явный конструктор по умолчанию без параметров, щелкните смарт-тег и выберите команду **Сформировать заглушку конструктора**.

### <a name="to-generate-a-stub-for-a-method"></a>Создание заглушки метода

1. Предположим, что согласно спецификации новый объект `Automobile` может быть переведен в состояние Running, если его свойства `Model` и `TopSpeed` содержат значения, отличные от значений по умолчанию. Добавьте приведенные ниже строки в метод `AutomobileWithModelNameCanStart` .

     [!code-csharp[VbTDDWalkthrough#3](../snippets/csharp/VS_Snippets_VBCSharp/vbtddwalkthrough/cs/unittest1.cs#3)]
     [!code-vb[VbTDDWalkthrough#3](../snippets/visualbasic/VS_Snippets_VBCSharp/vbtddwalkthrough/vb/unittest1.vb#3)]

2. Щелкните смарт-тег для вызова метода `myAuto.Start` , а затем выберите команду **Сформировать заглушку метода**.

3. Щелкните смарт-тег для свойства `IsRunning` , а затем выберите команду **Создание прототипа свойства**. Класс `Automobile` теперь содержит следующий код:

     [!code-csharp[VbTDDWalkthrough#4](../snippets/csharp/VS_Snippets_VBCSharp/vbtddwalkthrough/cs/intermediate.cs#4)]
     [!code-vb[VbTDDWalkthrough#4](../snippets/visualbasic/VS_Snippets_VBCSharp/vbtddwalkthrough/vb/intermediate.vb#4)]

### <a name="to-run-the-tests"></a>Запуск тестов

1. В меню **Модульный тест** наведите указатель на пункт **Выполнить модульные тесты**и выберите пункт **Все тесты**. Эта команда выполняет все тесты всех платформ тестирования, которые созданы для текущего решения.

     В этом случае существует два теста, которые ожидаемым образом завершаются с ошибкой. Тест `DefaultAutomobileIsInitializedCorrectly` завершается с ошибкой, так как условие `Assert.IsTrue` возвращает значение `False`. Тест `AutomobileWithModelNameCanStart` завершается с ошибкой, так как метод `Start` в классе `Automobile` создает исключение.

     Окно **Результаты теста** показано на рисунке ниже.

     ![Невыполненные результаты теста](../ide/media/testsfailed.png "тестсфаилед") Окно результаты теста

2. В окне **Результаты теста** дважды щелкните каждую строку результата теста для перехода к месту сбоя в ходе каждого тестирования.

### <a name="to-implement-the-source-code"></a>Реализация исходного кода

1. Добавьте приведенный ниже код в конструктор по умолчанию, чтобы свойства `Model`, `TopSpeed` и `IsRunning` были инициализированы правильными значениями по умолчанию `"Not specified"`, `-1`и `True` (`true`).

     [!code-csharp[VbTDDWalkthrough#5](../snippets/csharp/VS_Snippets_VBCSharp/vbtddwalkthrough/cs/automobile.cs#5)]
     [!code-vb[VbTDDWalkthrough#5](../snippets/visualbasic/VS_Snippets_VBCSharp/vbtddwalkthrough/vb/automobile.vb#5)]

2. При вызове метода `Start` он должен устанавливать флажок `IsRunning` в значение true только в том случае, если свойство `Model` или `TopSpeed` имеет значение, отличное от значения по умолчанию. Удалите `NotImplementedException` из тела метода и добавьте приведенный ниже код.

     [!code-csharp[VbTDDWalkthrough#6](../snippets/csharp/VS_Snippets_VBCSharp/vbtddwalkthrough/cs/automobile.cs#6)]
     [!code-vb[VbTDDWalkthrough#6](../snippets/visualbasic/VS_Snippets_VBCSharp/vbtddwalkthrough/vb/automobile.vb#6)]

### <a name="to-run-the-tests-again"></a>Повторный запуск тестов

1. В меню **Тест** наведите указатель на пункт **Выполнить**, а затем выберите пункт **Все тесты в решении**. Результат на этот раз положительный. Окно **Результаты теста** показано на рисунке ниже.

     ![Результаты теста, пройденные](../ide/media/testspassed.png "тестспассед") Окно результаты теста

## <a name="see-also"></a>См. также раздел
 [Создание кода на основе](../misc/generate-from-usage.md) [записи](../ide/writing-code-in-the-code-and-text-editor.md) использования [с помощью](../ide/using-intellisense.md) [модульного тестирования IntelliSense в коде](../test/unit-test-your-code.md)
