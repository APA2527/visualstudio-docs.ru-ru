---
title: Управление параметрами приложения (.NET) | Документы Майкрософт
ms.date: 11/15/2016
ms.prod: visual-studio-dev14
ms.technology: vs-ide-general
ms.topic: conceptual
f1_keywords:
- msvse_settingsdesigner.err.nameblank
helpviewer_keywords:
- application settings [Visual Studio]
ms.assetid: 35254321-ad14-47d9-b8c6-39ab3203c5d9
caps.latest.revision: 27
author: jillre
ms.author: jillfra
manager: jillfra
ms.openlocfilehash: 85cc90170b2dc665bcdd5acd97860c47ef5a14c4
ms.sourcegitcommit: bad28e99214cf62cfbd1222e8cb5ded1997d7ff0
ms.translationtype: MTE95
ms.contentlocale: ru-RU
ms.lasthandoff: 11/21/2019
ms.locfileid: "74293862"
---
# <a name="managing-application-settings-net"></a>Управление параметрами приложения (.NET)

[!INCLUDE[vs2017banner](../includes/vs2017banner.md)]

Параметры приложений позволяют динамически хранить данные приложения. Параметры позволяют хранить на клиентском компьютере информацию, которая не должна быть включена в код приложения (например, строку подключения), настройки пользователя и другие сведения, необходимые во время выполнения.

Параметры приложения заменяют динамические свойства, используемые в более ранних версиях Visual Studio.

Каждый параметр приложения должен иметь уникальное имя. Именем может быть любая комбинация букв, цифр или символов подчеркивания, которая не начинается с цифры и не содержит пробелов. Имя может быть изменено с помощью свойства `Name` .

Параметры приложения могут храниться в виде любого типа данных, который может быть сериализован в формат XML или имеет метод `TypeConverter` , реализующий `ToString`/`FromString`. Наиболее распространенными типами являются `String`, `Integer`и `Boolean`, но можно также хранить значения как <xref:System.Drawing.Color>, <xref:System.Object>или в виде строки подключения.

Параметры приложений также содержат значение. Значение задается с помощью свойства **Value** и должно соответствовать типу данных параметра.

Кроме того, параметры приложений могут быть связаны со свойством формы или элемента управления во время разработки.

Существуют два типа параметров приложений в зависимости от области действия:

- Параметры, область действия которых ограничивается приложением, могут использоваться для хранения такой информации, как URL-адрес для веб-службы или строка подключения к базе данных. Эти значения связаны с приложением. Следовательно, пользователи не могут изменять их во время выполнения.

- Параметры, область действия которых ограничивается пользователем, можно использовать для хранения такой информации, как сохранение последнего положения формы или предпочитаемых настроек шрифта. Пользователи могут изменять эти значения во время выполнения.

  Можно изменить тип параметра с помощью свойства **Scope** .

  Система работы с проектами хранит параметры приложений в двух файлах XML: файле app.config, который создается во время разработки при создании первого параметра приложения; и файле user.config, который создается во время выполнения, когда работающий с приложением пользователь изменяет значение любого параметра пользователя. Обратите внимание, что изменения параметров пользователей не записываются на диск, если только приложение специально не вызовет для этого метод.

## <a name="creating-application-settings-at-design-time"></a>Создание параметров приложения во время разработки

В режиме разработки можно создавать параметры приложения двумя способами: с помощью страницы **Параметры** **Конструктора проектов**либо с помощью окна **Свойства** формы или элемента управления, которое позволяет привязать параметр к свойству.

При создании параметра, область действия которого ограничивается приложением (например строки подключения к базе данных или ссылки на ресурсы сервера), [!INCLUDE[vsprvs](../includes/vsprvs-md.md)] сохраняет его в файл app.config с тегом `<applicationSettings>` . (Строки подключения сохраняются под тегом `<connectionStrings>` .)

При создании параметра, область действия которого ограничивается пользователем (например шрифта по умолчанию, домашней страницы или размера окна), [!INCLUDE[vsprvs](../includes/vsprvs-md.md)] сохраняет ее в файл app.config с тегом `<userSettings>` .

> [!IMPORTANT]
> При хранении строк подключения в файле в app.config необходимо предпринимать меры предосторожности, чтобы избегать раскрытия секретной информации, такой как пароли или пути сервера, содержащейся в строке подключения.
>
> Если информация для строки подключения берется из внешнего источника (например пользователь задает идентификатор пользователя и пароль), то необходимо следить за тем, чтобы значения, которые используются для составления строки подключения, не содержали дополнительных параметров строки подключения, изменяющих действие подключения.
>
> Рассмотрите возможность использования функции защищенной конфигурации для шифрования секретной информации в файле конфигурации. Дополнительные сведения см. в статье [Защита сведений о соединении](https://msdn.microsoft.com/library/1471f580-bcd4-4046-bdaf-d2541ecda2f4).

> [!NOTE]
> Из-за отсутствия модели файла конфигурации для библиотек классов, параметры приложений не применяются для проектов библиотек классов. Исключением является Visual Studio Tools для проекта Office DLL, который может иметь файл конфигурации.

## <a name="using-customized-settings-files"></a>Использование индивидуальных файлов параметров

Для удобства управления группами параметров в проект можно добавить индивидуальные файлы настроек. Содержащиеся в одном файле параметры загружаются и сохраняются как единое целое. Следовательно возможность хранения параметров в отдельных файлах для часто и редко используемых групп позволяет сэкономить время на загрузке и сохранении параметров.

Например, можно добавить в проект такой файл, как SpecialSettings.Settings. Хотя класс `SpecialSettings` и не открыт для доступа через пространство имен `My` , но функция **Просмотр кода** позволяет прочесть индивидуальный файл параметров, содержащий `Partial Class SpecialSettings`.

Конструктор параметров сначала ищет файл Settings.settings, который создает система работы с проектами; это файл, отображаемый Конструктором проектов по умолчанию на вкладке **Параметры** . Файл Settings.Settings находится в папке "Мои проекты", предназначенной для проектов [!INCLUDE[vbprvb](../includes/vbprvb-md.md)] , и в папке "Свойства", предназначенной для проектов [!INCLUDE[csprcs](../includes/csprcs-md.md)] . Затем Конструктор проектов ищет другие файлы параметров в корневой папке проекта. Таким образом, индивидуальный файл параметров следует помещать туда же. Если добавить файл с расширением SETTINGS в другое место проекта, Конструктор проекта не сможет его найти.

## <a name="accessing-or-changing-application-settings-at-run-time-in-visual-basic"></a>Доступ или изменение параметров приложения во время выполнения в Visual Basic

В проектах [!INCLUDE[vbprvb](../includes/vbprvb-md.md)] во время выполнения доступ к параметрам приложения можно получить с помощью объекта `My.Settings` . На странице **Параметры** нажмите кнопку **Просмотреть код** , чтобы просмотреть файл Settings.vb. Файл Settings.vb определяет класс `Settings` , который позволяет обрабатывать эти события в классе параметров: <xref:System.Configuration.ApplicationSettingsBase.SettingChanging>, <xref:System.Configuration.ApplicationSettingsBase.PropertyChanged>, <xref:System.Configuration.ApplicationSettingsBase.SettingsLoaded>и <xref:System.Configuration.ApplicationSettingsBase.SettingsSaving>. Обратите внимание, что класс `Settings` в файле Settings.vb является частичным классом, который отображает только принадлежащий пользователю код, а не весь сгенерированный класс. Более подробную информацию о доступе к параметрам приложения с помощью объекта `My.Settings` см. в разделе [Accessing Application Settings](https://msdn.microsoft.com/library/e38d0cc7-247a-46ca-ba04-f2913f0adb2e).

Значения любого изменяемого пользователем во время выполнения приложения параметра, область действия которого ограничивается пользователем (например положение формы), хранятся в файле User.config. Обратите внимание, что значения по умолчанию по-прежнему сохраняются в файл app.config.

В случае изменения во время выполнения приложения каких-либо параметров, область действия которых ограничивается пользователем, например при тестировании приложения, и требуется восстановить их значения по умолчанию, нажмите кнопку **Синхронизировать** .

Настоятельно рекомендуется использовать для доступа к параметрам объект `My.Settings` и используемый по умолчанию файл с расширением SETTINGS. Это связано с тем, что можно использовать Конструктор параметров для задания свойств параметрам и, кроме того, настройки пользователей автоматически сохраняются перед завершением работы приложения. Однако приложение [!INCLUDE[vbprvb](../includes/vbprvb-md.md)] может получить доступ к настройкам напрямую. В этом случае необходим доступ к классу `MySettings` и использование индивидуального файла с расширением SETTINGS в корневой папке проекта. Необходимо также сохранить пользовательские настройки до завершения работы приложения, как бы это было сделано для приложения C#. Это описывается в следующем разделе.

<!-- markdownlint-disable MD003 MD020 -->
## <a name="accessing-or-changing-application-settings-at-run-time-in-visual-c"></a>Доступ или изменение параметров приложения во время выполнения в Visual C#
<!-- markdownlint-enable MD003 MD020 -->

В языках, отличных от [!INCLUDE[vbprvb](../includes/vbprvb-md.md)], например [!INCLUDE[csprcs](../includes/csprcs-md.md)], доступ к классу `Settings` необходимо осуществлять напрямую, как показано в следующем примере [!INCLUDE[csprcs](../includes/csprcs-md.md)] .

```csharp
Properties.Settings.Default.FirstUserSetting = "abc";
```

Также необходимо явным образом вызывать метод `Save` этого оберточного класса, чтобы сохранить настройки пользователя. Обычно это выполняется в обработчике событий `Closing` главной формы. В следующем примере [!INCLUDE[csprcs](../includes/csprcs-md.md)] показан вызов метода `Save` .

```csharp
Properties.Settings.Default.Save();
```

Общие сведения о доступе к параметрам приложений с помощью класса `Settings` см. в разделе [Общие сведения о параметрах приложений](https://msdn.microsoft.com/library/0dd8bca5-a6bf-4ac4-8eec-5725d08b38dc). Информацию об итерации параметров см. в этой [записи форума](https://social.msdn.microsoft.com/Forums/en-US/40fbb470-f1e8-4a02-a4a0-9f62b54d0fc4/is-this-possible-propertiessettingsdefault?forum=csharpgeneral).

## <a name="see-also"></a>См. также

- [Доступ к параметрам приложения](https://msdn.microsoft.com/library/e38d0cc7-247a-46ca-ba04-f2913f0adb2e)
