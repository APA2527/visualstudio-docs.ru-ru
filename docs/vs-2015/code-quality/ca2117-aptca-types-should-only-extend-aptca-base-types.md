---
title: 'CA2117: APTCA-типы должны расширять только базовые APTCA-типы | Документация Майкрософт'
ms.date: 11/15/2016
ms.prod: visual-studio-dev14
ms.technology: vs-ide-code-analysis
ms.topic: reference
f1_keywords:
- CA2117
- AptcaTypesShouldOnlyExtendAptcaBaseTypes
helpviewer_keywords:
- AptcaTypesShouldOnlyExtendAptcaBaseTypes
- CA2117
ms.assetid: c505b586-2f1e-47cb-98ee-a5afcbeda70f
caps.latest.revision: 18
author: jillre
ms.author: jillfra
manager: wpickett
ms.openlocfilehash: 90c1f66f36fc689ee077ec66f154487d65ee13a1
ms.sourcegitcommit: 6cfffa72af599a9d667249caaaa411bb28ea69fd
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 09/02/2020
ms.locfileid: "85543615"
---
# <a name="ca2117-aptca-types-should-only-extend-aptca-base-types"></a>CA2117. APTCA-типы должны расширять только базовые APTCA-типы
[!INCLUDE[vs2017banner](../includes/vs2017banner.md)]

|Элемент|Значение|
|-|-|
|TypeName|AptcaTypesShouldOnlyExtendAptcaBaseTypes|
|CheckId|CA2117|
|Категория|Microsoft.Security|
|Критическое изменение|Критическое|

## <a name="cause"></a>Причина
 Открытый или защищенный тип в сборке с <xref:System.Security.AllowPartiallyTrustedCallersAttribute?displayProperty=fullName> атрибутом наследуется от типа, объявленного в сборке, не имеющей атрибута.

## <a name="rule-description"></a>Описание правила
 По умолчанию открытые или защищенные типы в сборках со строгими именами неявно защищаются по [требованиям наследования](https://msdn.microsoft.com/28b9adbb-8f08-4f10-b856-dbf59eb932d9) для полного доверия. Сборки со строгими именами, помеченные <xref:System.Security.AllowPartiallyTrustedCallersAttribute> атрибутом (APTCA), не имеют такой защиты. Атрибут отключает требование наследования. Это делает видимые типы, объявленные в сборке, наследуемой типами, которые не имеют полного доверия.

 Если атрибут APTCA существует в полностью доверенной сборке, а тип в сборке наследуется от типа, который не допускает частично доверенных вызывающих объектов, то может использоваться уязвимость безопасности. Если два типа `T1` и `T2` отвечают приведенным ниже условиям, то вредоносные вызывающие объекты могут использовать этот тип `T1` для обхода неявного требования наследования с полным доверием, защищающего `T2` :

- `T1` — Это открытый тип, объявленный в полностью доверенной сборке, имеющей атрибут APTCA.

- `T1` наследуется от типа `T2` вне его сборки.

- `T2`не имеет атрибута APTCA и, следовательно, не должны наследоваться типами в частично доверенных сборках.

  Частично доверенный тип `X` может наследовать от класса `T1` , который предоставляет ему доступ к унаследованным членам, объявленным в `T2` . Поскольку не `T2` имеет атрибута APTCA, его непосредственный производный тип ( `T1` ) должен удовлетворять требованию наследования для полного доверия; `T1` имеет полное доверие и, следовательно, удовлетворяет этой проверке. Угроза безопасности заключается в том, что не `X` участвует в выполнении требования наследования, которое защищает `T2` от недоверенного подкласса. По этой причине типы с атрибутом APTCA не должны расширять типы, которые не имеют атрибута.

  Другой проблемой безопасности, и, возможно, более распространенной, является то, что производный тип ( `T1` ) может с помощью ошибки программиста предоставлять защищенные члены из типа, которому требуется полное доверие ( `T2` ). В этом случае ненадежные вызывающие объекты получают доступ к информации, которая должна быть доступна только для полностью доверенных типов.

## <a name="how-to-fix-violations"></a>Устранение нарушений
 Если тип, сообщаемый нарушением, находится в сборке, для которой не требуется атрибут APTCA, удалите его.

 Если атрибут APTCA является обязательным, добавьте требование наследования для полного доверия к типу. Это защищает от наследования недоверенными типами.

 Можно устранить нарушение, добавив атрибут APTCA в сборки базовых типов, о которых сообщает нарушение. Не выполняя проверку безопасности всего кода в сборках и всего кода, который зависит от сборок.

## <a name="when-to-suppress-warnings"></a>Отключение предупреждений
 Чтобы безопасно отключить предупреждение из этого правила, необходимо убедиться, что защищенные члены, предоставляемые вашим типом, не прямо или косвенно разрешают ненадежным вызывающим объектам доступ к конфиденциальной информации, операциям или ресурсам, которые могут использоваться необратимым образом.

## <a name="example"></a>Пример
 В следующем примере используются две сборки и тестовое приложение для демонстрации уязвимости системы безопасности, обнаруженной этим правилом. Первая сборка не имеет атрибута APTCA и не должна наследоваться частично доверенными типами (представленными `T2` в предыдущем обсуждении).

 [!code-csharp[FxCop.Security.NoAptcaInherit#1](../snippets/csharp/VS_Snippets_CodeAnalysis/FxCop.Security.NoAptcaInherit/cs/FxCop.Security.NoAptcaInherit.cs#1)]

## <a name="example"></a>Пример
 Вторая сборка, представленная `T1` в предыдущем обсуждении, является полностью доверенной и позволяет частично доверенным вызывающим объектам.

 [!code-csharp[FxCop.Security.YesAptcaInherit#1](../snippets/csharp/VS_Snippets_CodeAnalysis/FxCop.Security.YesAptcaInherit/cs/FxCop.Security.YesAptcaInherit.cs#1)]

## <a name="example"></a>Пример
 Тип теста, представленный `X` в предыдущем обсуждении, находится в сборке с частичным доверием.

 [!code-csharp[FxCop.Security.TestAptcaInherit#1](../snippets/csharp/VS_Snippets_CodeAnalysis/FxCop.Security.TestAptcaInherit/cs/FxCop.Security.TestAptcaInherit.cs#1)]

 В этом примере формируются следующие данные:

 **Соблюдайте на Глен с тенью 2/22/2003 12:00:00 AM!** 
 **Из теста: Sunny луг** 
 **Соблюдайте на Sunny луг 2/22/2003 12:00:00 AM!**
## <a name="related-rules"></a>Связанные правила
 [CA2116. APTCA-методы должны вызывать только APTCA-методы](../code-quality/ca2116-aptca-methods-should-only-call-aptca-methods.md)

## <a name="see-also"></a>См. также:
 [Рекомендации по безопасному кодированию](https://msdn.microsoft.com/library/4f882d94-262b-4494-b0a6-ba9ba1f5f177) [.NET Framework сборки, вызываемые частично доверенным кодом,](https://msdn.microsoft.com/a417fcd4-d3ca-4884-a308-3a1a080eac8d) [с использованием библиотек из](https://msdn.microsoft.com/library/dd66cd4c-b087-415f-9c3e-94e3a1835f74) [требований наследования](https://msdn.microsoft.com/28b9adbb-8f08-4f10-b856-dbf59eb932d9) частично доверенного кода
