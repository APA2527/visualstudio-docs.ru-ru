---
title: 'CA2116: APTCA должны вызывать только методы APTCA | Документация Майкрософт'
ms.date: 11/15/2016
ms.prod: visual-studio-dev14
ms.technology: vs-ide-code-analysis
ms.topic: reference
f1_keywords:
- AptcaMethodsShouldOnlyCallAptcaMethods
- CA2116
helpviewer_keywords:
- AptcaMethodsShouldOnlyCallAptcaMethods
- CA2116
ms.assetid: 8b91637e-891f-4dde-857b-bf8012270ec4
caps.latest.revision: 20
author: jillre
ms.author: jillfra
manager: wpickett
ms.openlocfilehash: c9de5178b585275ef410ad3179ba320b663536bf
ms.sourcegitcommit: a8e8f4bd5d508da34bbe9f2d4d9fa94da0539de0
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 10/19/2019
ms.locfileid: "72658681"
---
# <a name="ca2116-aptca-methods-should-only-call-aptca-methods"></a>CA2116: методы APTCA должны вызывать только методы APTCA
[!INCLUDE[vs2017banner](../includes/vs2017banner.md)]

|||
|-|-|
|TypeName|AptcaMethodsShouldOnlyCallAptcaMethods|
|CheckId|CA2116|
|Категория|Microsoft.Security|
|Критическое изменение|Критическое|

## <a name="cause"></a>Причина
 Метод в сборке с атрибутом <xref:System.Security.AllowPartiallyTrustedCallersAttribute?displayProperty=fullName> вызывает метод в сборке, не имеющей атрибута.

## <a name="rule-description"></a>Описание правила
 По умолчанию открытые или защищенные методы в сборках со строгими именами неявно защищаются с помощью [ссылки на запросы](https://msdn.microsoft.com/library/a33fd5f9-2de9-4653-a4f0-d9df25082c4d) полного доверия. только полностью доверенные вызывающие объекты могут обращаться к сборке со строгим именем. Сборки со строгими именами, помеченные атрибутом <xref:System.Security.AllowPartiallyTrustedCallersAttribute> (APTCA), не имеют этой защиты. Атрибут отключает запрос компоновки, делая сборку доступным для вызывающих объектов, которые не имеют полного доверия, например кода, выполняемого из интрасети или Интернета.

 Если атрибут APTCA имеется в полностью доверенной сборке, а сборка выполняет код в другой сборке, которая не допускает частично доверенных вызывающих объектов, возможно, используется уязвимость безопасности. Если два метода `M1` и `M2` отвечают следующим условиям, то вредоносные вызывающие объекты могут использовать метод `M1` для обхода неявного запроса ссылки с полным доверием, защищающего `M2`:

- `M1` — это открытый метод, объявленный в полностью доверенной сборке, имеющей атрибут APTCA.

- `M1` вызывает метод `M2` извне сборки `M1`.

- Сборка `M2` не имеет атрибута APTCA и, следовательно, не должна выполняться или от имени вызывающих объектов с частичным доверием.

  Частично доверенный вызывающий объект `X` может вызывать метод `M1`, что приводит к `M1` вызову `M2`. Поскольку `M2` не имеет атрибута APTCA, его непосредственный вызывающий объект (`M1`) должен соответствовать запросу компоновки для полного доверия.  `M1` имеет полное доверие и, следовательно, удовлетворяет этой проверке. Угроза безопасности заключается в том, что `X` не участвует в выполнении запроса компоновки, защищающего `M2` от ненадежных вызывающих объектов. Поэтому методы с атрибутом APTCA не должны вызывать методы, не имеющие атрибута.

## <a name="how-to-fix-violations"></a>Устранение нарушений
 Если требуется атрибут АПКТА, используйте требование для защиты метода, который вызывает сборку с полным доверием. Точные требуемые разрешения зависят от функциональных возможностей, предоставляемых вашим методом. Если возможно, защитите метод с помощью запроса полного доверия, чтобы обеспечить недоступность базовой функциональности вызывающим объектам с частичным доверием. Если это невозможно, выберите набор разрешений, которые эффективно защищают предоставляемую функциональность. Дополнительные сведения о требованиях см. в разделе [требования](https://msdn.microsoft.com/e5283e28-2366-4519-b27d-ef5c1ddc1f48).

## <a name="when-to-suppress-warnings"></a>Отключение предупреждений
 Чтобы безопасно отключить предупреждение из этого правила, необходимо убедиться, что функциональные возможности, предоставляемые методом, напрямую или косвенно разрешают вызывающим объектам доступ к конфиденциальным сведениям, операциям или ресурсам, которые могут быть использованы необратимым образом.

## <a name="example"></a>Пример
 В следующем примере используются две сборки и тестовое приложение для демонстрации уязвимости системы безопасности, обнаруженной этим правилом. Первая сборка не имеет атрибута APTCA и не должна быть доступна для частично доверенных вызывающих объектов (представленных `M2` в предыдущем обсуждении).

 [!code-csharp[FxCop.Security.NoAptca#1](../snippets/csharp/VS_Snippets_CodeAnalysis/FxCop.Security.NoAptca/cs/FxCop.Security.NoAptca.cs#1)]

## <a name="example"></a>Пример
 Вторая сборка является полностью доверенной и позволяет частично доверенным вызывающим объектам (представленным `M1` в предыдущем обсуждении).

 [!code-csharp[FxCop.Security.YesAptca#1](../snippets/csharp/VS_Snippets_CodeAnalysis/FxCop.Security.YesAptca/cs/FxCop.Security.YesAptca.cs#1)]

## <a name="example"></a>Пример
 Тестовое приложение (представленное `X` в предыдущем обсуждении) является частично доверенным.

 [!code-csharp[FxCop.Security.TestAptcaMethods#1](../snippets/csharp/VS_Snippets_CodeAnalysis/FxCop.Security.TestAptcaMethods/cs/FxCop.Security.TestAptcaMethods.cs#1)]

 В этом примере формируются следующие данные:

 **Требование полного доверия: сбой запроса.** **был вызван 
 классрекуирингфуллтруст. DoWork.**
## <a name="related-rules"></a>Связанные правила
 [CA2117: APTCA-типы должны расширять только базовые APTCA-типы](../code-quality/ca2117-aptca-types-should-only-extend-aptca-base-types.md)

## <a name="see-also"></a>См. также раздел
 [Рекомендации по безопасному написанию кода](https://msdn.microsoft.com/library/4f882d94-262b-4494-b0a6-ba9ba1f5f177) [.NET Framework сборки, вызываемые частично доверенным кодом,](https://msdn.microsoft.com/a417fcd4-d3ca-4884-a308-3a1a080eac8d) [с использованием библиотек из частично доверенного кода](https://msdn.microsoft.com/library/dd66cd4c-b087-415f-9c3e-94e3a1835f74) [требования](https://msdn.microsoft.com/e5283e28-2366-4519-b27d-ef5c1ddc1f48) к [каналам](https://msdn.microsoft.com/library/a33fd5f9-2de9-4653-a4f0-d9df25082c4d) [данные и моделирование](https://msdn.microsoft.com/library/8c37635d-e2c1-4b64-a258-61d9e87405e6)
