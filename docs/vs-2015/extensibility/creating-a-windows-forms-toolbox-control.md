---
title: Создание Windows Forms элемента управления панели элементов | Документация Майкрософт
ms.date: 11/15/2016
ms.prod: visual-studio-dev14
ms.technology: vs-ide-sdk
ms.topic: conceptual
helpviewer_keywords:
- winforms
- toolbox
- windows forms
ms.assetid: 0be6ffc1-8afd-4d02-9a5d-e27dde05fde6
caps.latest.revision: 20
ms.author: gregvanl
manager: jillfra
ms.openlocfilehash: 03fcc73c58baa1482c53e104a9946ffaa354f1a0
ms.sourcegitcommit: 08fc78516f1107b83f46e2401888df4868bb1e40
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 05/15/2019
ms.locfileid: "65698965"
---
# <a name="creating-a-windows-forms-toolbox-control"></a>Создание элемента управления на панели инструментов Windows Forms
[!INCLUDE[vs2017banner](../includes/vs2017banner.md)]

Шаблон элемента управления панели элементов Windows Forms, включенный в средства расширения Visual Studio (VS SDK) позволяет создать элемент управления, который автоматически добавляется **элементов** при установке расширения. В этом разделе показано, как использовать шаблон для создания элемента управления с простой счетчик, который можно передавать другим пользователям.  
  
## <a name="prerequisites"></a>Предварительные требования  
 Начиная с Visual Studio 2015, не следует устанавливать пакет SDK для Visual Studio из центра загрузки. Она будет включена в качестве дополнительного компонента в программе установки Visual Studio. VS SDK также можно установить позже. Дополнительные сведения см. в разделе [установка Visual Studio SDK](../extensibility/installing-the-visual-studio-sdk.md).  
  
## <a name="creating-a-windows-forms-toolbox-control"></a>Создание элемента управления на панели инструментов Windows Forms  
 Шаблон элемента управления панели элементов Windows Forms создает неопределенный пользовательский элемент управления и предоставляет все функциональные возможности, необходимые для добавления элемента управления в **элементов**.  
  
#### <a name="create-an-extension-with-a-windows-forms-toolbox-control"></a>Создание расширения с помощью элемента управления панели элементов Windows Forms  
  
1. Создайте проект VSIX с именем `MyWinFormsControl`. Вы найдете шаблон проекта VSIX в **новый проект** диалоговое окно, в разделе **Visual C# / Extensibility**.  
  
2. При открытии проекта добавьте **элемента управления панели элементов Windows Forms** шаблон элемента с именем `Counter`. В **обозревателе решений**, щелкните правой кнопкой мыши узел проекта и выберите **добавить / новый элемент**. В **Добавление нового элемента** диалоговое окно, перейдите к **Visual C# / Extensibility** и выберите **элемента управления панели элементов Windows Forms**  
  
3. Это добавляет пользовательский элемент управления, `ProvideToolboxControlAttribute` <xref:Microsoft.VisualStudio.Shell.RegistrationAttribute> необходимо вставить элемент управления в **элементов**и **Microsoft.VisualStudio.ToolboxControl** запись ресурса в манифест VSIX для развертывания.  
  
### <a name="building-a-user-interface-for-the-control"></a>Создание пользовательского интерфейса для элемента управления  
 `Counter` Элемент управления требует двух дочерних элементов управления: <xref:System.Windows.Forms.Label> для отображения текущего счетчика и <xref:System.Windows.Forms.Button> для сброса счетчика в 0. Нет других дочерних элементов управления требуются, так как вызывающие объекты будут увеличения значения счетчика программным способом.  
  
##### <a name="to-build-the-user-interface"></a>Создание пользовательского интерфейса  
  
1. В **обозревателе решений**, дважды щелкните Counter.cs, чтобы открыть его в конструкторе.  
  
2. Удалите «щелкните здесь!» **Кнопка** включается по умолчанию при добавлении шаблона элемента управления панели элементов Windows Forms.  
  
3. Из **элементов**, перетащите `Label` управления и затем `Button` управления под его в область конструктора.  
  
4. Измените общий элемент управления на 150, 50 пикселей, а также изменить размер кнопки элемента управления до 50, номер 20 пикселей.  
  
5. В **свойства** окна, задайте следующие значения для элементов управления в рабочей области конструирования.  
  
    |Элемент управления|Свойство|Значение|  
    |-------------|--------------|-----------|  
    |`Label1`|**Text**|""|  
    |`Button1`|**Name**|btnReset|  
    |`Button1`|**Text**|Сбросить|  
  
### <a name="coding-the-user-control"></a>Написание кода пользовательского элемента управления  
 Элемент управления `Counter` будет предоставлять метод для увеличения значения счетчика, событие, которое будет наступать всякий раз, когда значение счетчика увеличивается, кнопку `Reset` и три свойства для хранения текущего значения счетчика, отображаемого текста и значения, определяющего, должна ли кнопка `Reset` отображаться или скрываться. Атрибут `ProvideToolboxControl` определяет место на **панели элементов** , в котором будет отображаться элемент управления `Counter` .  
  
##### <a name="to-code-the-user-control"></a>К коду пользовательского элемента управления  
  
1. Дважды щелкните форму, чтобы открыть ее обработчик события загрузки в окне кода.  
  
2. Выше метод обработчика событий в класс элемента управления создайте целое число для хранения значения счетчика и строки для хранения текста, отображаемого, как показано в следующем примере.  
  
    ```csharp  
    int currentValue;  
    string displayText;  
    ```  
  
3. Создайте следующие объявления открытого свойства.  
  
    ```csharp  
    public int Value {  
        get { return currentValue; }   
    }  
  
    public string Message {  
        get { return displayText; }  
        set { displayText = value; }  
    }  
  
    public bool ShowReset {  
        get { return btnReset.Visible; }  
        set { btnReset.Visible = value; }  
    }  
  
    ```  
  
     Вызывающие объекты получить доступ к свойствам get и set счетчика отображаемый текст для отображения или скрытия `Reset` кнопки. Вызывающие объекты можно получить текущее значение только для чтения `Value` свойство, но их невозможно задать значение напрямую.  
  
4. Поместите следующий код `Load` событие элемента управления.  
  
    ```csharp  
    private void Counter_Load(object sender, EventArgs e)  
    {  
        currentValue = 0;  
        label1.Text = Message + Value;  
    }  
  
    ```  
  
     Установка **метка** текста в <xref:System.Windows.Forms.UserControl.Load> событие позволяет загрузить перед применением их значения свойства целевого объекта. Установка **метка** текст в конструкторе приведет пустой **метка**.  
  
5. Создайте приведенный ниже открытый метод для увеличения значения счетчика.  
  
    ```csharp  
    public void Increment()  
    {  
        currentValue++;  
        label1.Text = displayText + Value;  
        Incremented(this, EventArgs.Empty);  
    }  
  
    ```  
  
6. Добавьте объявление для `Incremented` событий в класс элемента управления.  
  
    ```csharp  
    public event EventHandler Incremented;  
    ```  
  
     Вызывающие объекты можно добавить обработчики к этому событию реагировать на изменения в значении счетчика.  
  
7. Вернуться в режим конструктора и дважды щелкните `Reset` кнопку, чтобы создать `btnReset_Click` обработчик событий, а затем введите в, как показано в следующем примере.  
  
    ```csharp  
    private void btnReset_Click(object sender, EventArgs e)  
    {  
        currentValue = 0;  
        label1.Text = displayText + Value;  
    }  
  
    ```  
  
8. Непосредственно над определением класса в объявлении атрибута `ProvideToolboxControl` измените значение первого параметра с `"MyWinFormsControl.Counter"` на `"General"`. Таким образом задается имя группы элементов, в которой будет размещаться элемент управления на **панели элементов**.  
  
     В приведенном ниже примере показаны атрибут `ProvideToolboxControl` и скорректированное определение класса.  
  
    ```csharp  
    [ProvideToolboxControl("General", false)]  
    public partial class Counter : UserControl  
    ```  
  
### <a name="testing-the-control"></a>Тестирование элемента управления  
 Для тестирования **элементов** управления, сначала протестируйте его в среде разработки и затем протестировать ее в скомпилированном приложении.  
  
##### <a name="to-test-the-control"></a>Тестирование элемента управления  
  
1. Нажмите клавишу F5.  
  
     Это создает проект и открывается второй экспериментальный экземпляр Visual Studio с элементом управления, установленным.  
  
2. В экспериментальном экземпляре Visual Studio, создайте **приложение Windows Forms** проекта.  
  
3. В **обозревателе решений**, дважды щелкните файл Form1.cs, чтобы открыть его в конструкторе, если он еще не открыт.  
  
4. В **элементов**, `Counter` элемент должен отображаться в **Общие** раздел.  
  
5. Перетащите `Counter` в форму элемент управления, а затем выберите его. `Value`, `Message`, И `ShowReset` свойства будут отображены в **свойства** окне вместе со свойствами, которые наследуются от <xref:System.Windows.Forms.UserControl>.  
  
6. Задайте для свойства `Message` значение `Count:`.  
  
7. Перетащите <xref:System.Windows.Forms.Button> управления в форму и задайте свойства name и текст кнопки `Test`.  
  
8. Дважды щелкните кнопку, чтобы открыть файл Form1.cs в представлении кода и создать обработчик щелчка.  
  
9. В обработчик щелчка, вызовите `counter1.Increment()`.  
  
10. В функции конструктора после вызова `InitializeComponent`, тип `counter1``.``Incremented +=` и нажмите клавишу TAB дважды.  
  
     Visual Studio создает обработчик уровне форм для `counter1.Incremented` событий.  
  
11. Выделите `Throw` инструкции в обработчике событий, тип `mbox`, и нажмите клавишу TAB дважды, чтобы создать окно сообщения из фрагмента кода почтовый ящик.  
  
12. На следующей строке, добавьте следующий `if` / `else` блок, чтобы задать видимость `Reset` кнопки.  
  
    ```csharp  
    if (counter1.Value < 5) counter1.ShowReset = false;  
    else counter1.ShowReset = true;  
    ```  
  
13. Нажмите клавишу F5.  
  
     Форма откроется. `Counter` Элемент управления отображает следующий текст.  
  
     **Число: 0**  
  
14. Нажмите кнопку **Test**.  
  
     Увеличения значения счетчика и Visual Studio отображает окно сообщения.  
  
15. Закрывайте окно сообщения.  
  
     **Сброс** кнопка будет скрыта.  
  
16. Нажмите кнопку **теста** пока не достигнет счетчика **5** Закрытие сообщения поля каждый раз.  
  
     **Сброс** кнопку появится повторно.  
  
17. Нажмите кнопку **Reset**.  
  
     Сбрасывает счетчик **0**.  
  
## <a name="next-steps"></a>Следующие шаги  
 При создании элемента управления **панели элементов** Visual Studio создает файл с именем *Имя_проекта*.vsix в папке \bin\debug\ проекта. Чтобы развернуть элемент управления, можно отправить VSIX-файл в сеть или на веб-сайт. Когда пользователь открывает VSIX-файл, элемент управления устанавливается и добавляется к Visual Studio **элементов** на компьютере пользователя. Кроме того, можно отправить VSIX-файл на [Visual Studio Marketplace](https://marketplace.visualstudio.com/) веб-сайт, чтобы пользователи могли его найти, перейдя в **средства / расширения и обновления** диалоговое окно.  
  
## <a name="see-also"></a>См. также  
 [Расширение панели элементов](../misc/extending-the-toolbox.md)   
 [Создание элемента управления панели элементов WPF](../extensibility/creating-a-wpf-toolbox-control.md)   
 [Расширение других частей Visual Studio](../extensibility/extending-other-parts-of-visual-studio.md)   
 [Основы разработки элементов управления форм Windows Forms](https://msdn.microsoft.com/library/6277bb81-90f7-4c5b-9f4b-b02bb42dd316)
