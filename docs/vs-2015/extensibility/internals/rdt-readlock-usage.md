---
title: Использование RDT_ReadLock | Документация Майкрософт
ms.date: 11/15/2016
ms.prod: visual-studio-dev14
ms.technology: vs-ide-sdk
ms.topic: conceptual
helpviewer_keywords:
- RDT_ReadLock
- visible
- RDT_EditLock
- invisible
ms.assetid: b935fc82-9d6b-4a8d-9b70-e9a5c5ad4a55
caps.latest.revision: 9
ms.author: gregvanl
manager: jillfra
ms.openlocfilehash: a9a6b5f86f0cfbb71f6264bdc74df72ad9209c9d
ms.sourcegitcommit: 6cfffa72af599a9d667249caaaa411bb28ea69fd
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 09/02/2020
ms.locfileid: "68154130"
---
# <a name="rdt_readlock-usage"></a>Использование RDT_ReadLock
[!INCLUDE[vs2017banner](../../includes/vs2017banner.md)]

<xref:Microsoft.VisualStudio.Shell.Interop._VSRDTFLAGS> флаг, предоставляющий логику блокировки документа в выполняемой таблице документов (РДТ), которая представляет собой список всех документов, открытых в интегрированной среде разработки Visual Studio. Этот флаг определяет, когда документы открываются, и является ли документ видимым в пользовательском интерфейсе или может оставаться невидимым в памяти.  
  
 Как правило, используется, <xref:Microsoft.VisualStudio.Shell.Interop._VSRDTFLAGS> Если выполняется одно из следующих условий:  
  
- Если вы хотите открыть документ в невидимом виде и только для чтения, но еще не установили <xref:Microsoft.VisualStudio.Shell.Interop.IVsHierarchy> его.  
  
- Если требуется, чтобы пользователю было предложено сохранить документ, который был открыт до того, как пользователь выводит его в пользовательском интерфейсе, а затем попытался закрыть его.  
  
## <a name="how-to-manage-visible-and-invisible-documents"></a>Управление видимыми и невидимыми документами  
 Когда пользователь открывает документ в пользовательском интерфейсе, <xref:Microsoft.VisualStudio.Shell.Interop.IVsHierarchy> должен быть установлен владелец документа, и <xref:Microsoft.VisualStudio.Shell.Interop._VSRDTFLAGS> должен быть установлен флаг. Если <xref:Microsoft.VisualStudio.Shell.Interop.IVsHierarchy> владелец не может быть установлен, документ не будет сохранен, когда пользователь нажмет кнопку **сохранить все** или закроет интегрированную среду разработки. Это означает, что если документ открыт незаметно для изменения в памяти, и пользователю предлагается сохранить документ при завершении работы или сохранить, если выбран параметр **сохранить все** , то `RDT_ReadLock` использовать нельзя. Вместо этого необходимо использовать `RDT_EditLock` и регистрировать, <xref:Microsoft.VisualStudio.Shell.Interop.IVsDocumentLockHolder> Если <xref:Microsoft.VisualStudio.Shell.Interop.__VSREGDOCLOCKHOLDER> флаг.  
  
## <a name="rdt_editlock-and-document-modification"></a>RDT_EditLock и изменение документа  
 Приведенный выше флаг указывает на то, что невидимый открывающий документ будет давать его `RDT_EditLock` при открытии документа пользователем в видимом **документвиндов**. Когда это происходит, пользователю предоставляется запрос **Save** , когда видимый **документвиндов** закрывается. Реализации Microsoft. VisualStudio. Package. Automation. Оапрожект. CodeModel, которые используют <xref:Microsoft.VisualStudio.Shell.Interop.IVsInvisibleEditorManager> службу, изначально работают, только если `RDT_ReadLock` используется только объект (т. е. когда документ открывается незаметно для анализа данных). Позже, если документ необходимо изменить, блокировка будет обновлена до слабого **RDT_EditLock**. Если пользователь открывает документ в видимой **документвиндов**, `CodeModel` слабый `RDT_EditLock` выпуск освобождается.  
  
 Если пользователь закроет **документвиндов** и **не** выберет запрос на сохранение открытого документа, то `CodeModel` Реализация уничтожает всю информацию в документе и повторно откроет документ с диска, когда в следующий раз для документа потребуются дополнительные сведения. Тонкостью этого поведения является экземпляр, в котором пользователь открывает **документвиндов** невидимого открытого документа, изменяет его, закрывает его, а затем выбирает **нет** при появлении запроса на сохранение документа. В этом случае, если документ содержит `RDT_ReadLock` , документ не будет закрыт, а измененный документ останется открытым невидимым в памяти, даже если пользователь отказался от сохранения документа.  
  
 Если невидимый открывающий документ использует слабый объект `RDT_EditLock` , он получает блокировку, когда пользователь открывает документ, и никакие другие блокировки не удерживаются. Когда пользователь закрывает **документвиндов** и выбирает **No (нет** ) при запросе на сохранение документа, документ должен быть закрыт из памяти. Это означает, что невидимый клиент должен прослушивать события РДТ для отслеживания этого вхождения. При следующем необходимости документ должен быть открыт повторно.
