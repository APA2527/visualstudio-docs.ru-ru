---
title: Сценарии установки VSPackage | Документация Майкрософт
ms.date: 11/15/2016
ms.prod: visual-studio-dev14
ms.technology: vs-ide-sdk
ms.topic: conceptual
helpviewer_keywords:
- VSPackages, deployment considerations
ms.assetid: d2928498-f27c-46b4-a9cd-cba41fd85a10
caps.latest.revision: 22
ms.author: gregvanl
manager: jillfra
ms.openlocfilehash: a09b794a6cd81966df45a1b30182040d7ab9335e
ms.sourcegitcommit: 6cfffa72af599a9d667249caaaa411bb28ea69fd
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 09/02/2020
ms.locfileid: "65696745"
---
# <a name="vspackage-setup-scenarios"></a>Сценарии установки VSPackage
[!INCLUDE[vs2017banner](../../includes/vs2017banner.md)]

Важно спроектировать установщик VSPackage для обеспечения гибкости. Например, может потребоваться выпустить исправление для системы безопасности в будущем или изменить бизнес-стратегию, для которой требуется тщательная поддержка параллельного управления версиями.  
  
 В [поддержку нескольких версий Visual Studio](../../extensibility/supporting-multiple-versions-of-visual-studio.md)можно ознакомиться с преимуществами и проблемами поддержки параллельных установок [!INCLUDE[vsprvs](../../includes/vsprvs-md.md)] с помощью общих или параллельных установок пакета VSPackage. В сокращенных версиях пакеты VSPackage позволяют наиболее гибко поддерживать новые возможности [!INCLUDE[vsprvs](../../includes/vsprvs-md.md)] .  
  
 Сценарии, описанные в этом разделе, не являются единственными вариантами, но они представлены как Рекомендуемые рекомендации.  
  
## <a name="components-privacy-and-sharing"></a>Компоненты, конфиденциальность и общий доступ  
  
##### <a name="make-your-components-independent"></a>Сделайте компоненты независимыми  
 После определения и заполнения компонента, назначения `GUID` и развертывания компонента нельзя изменить его композицию. Если вы изменяете композицию компонента, полученный компонент должен быть новым компонентом с новым `GUID` . Учитывая эти факты, можно обеспечить максимальную гибкость управления версиями, делая каждый компонент независимым, самостоятельным. Дополнительные сведения о правилах, управляющих компонентами, см. в разделе [изменение кода компонента](https://msdn.microsoft.com/library/aa367849\(VS.85\).aspx) и [что происходит, если правила компонентов повреждены?](https://msdn.microsoft.com/library/aa372795\(VS.85\).aspx)  
  
##### <a name="do-not-mix-shared-and-private-resources-in-a-component"></a>Не смешивать общие и частные ресурсы в компоненте  
 Подсчет ссылок выполняется на уровне компонента. Следовательно, смешивание общих и частных ресурсов в одном компоненте делает невозможным обновление закрытых ресурсов, таких как исполняемый файл, без перезаписи общих ресурсов. Этот сценарий позволяет создавать проблемы обратной совместимости и ограничивать создание параллельных возможностей.  
  
 Например, значения реестра, используемые для регистрации пакета VSPackage, [!INCLUDE[vsipsdk](../../includes/vsipsdk-md.md)] должны храниться в компоненте, отдельном от того, который используется для регистрации пакета VSPackage с [!INCLUDE[vsprvs](../../includes/vsprvs-md.md)] . Общие файлы или значения реестра переходят в еще один компонент.  
  
## <a name="scenario-1-shared-vspackage"></a>Сценарий 1. общий пакет VSPackage  
 В этом сценарии общий пакет VSPackage (один двоичный файл, поддерживающий несколько версий [!INCLUDE[vsprvs](../../includes/vsprvs-md.md)] ) поставляется в установщик Windows пакете. Регистрация в каждой версии [!INCLUDE[vsprvs](../../includes/vsprvs-md.md)] осуществляется с помощью выбираемых пользователем функций. Это также означает, что при назначении отдельным функциям каждый компонент можно выбрать отдельно для установки или удаления, поместив пользователя в контроль над интеграцией пакета VSPackage в разные версии [!INCLUDE[vsprvs](../../includes/vsprvs-md.md)] . (Дополнительные сведения об использовании функций в пакетах установщик Windows см. в разделе [установщик Windows функции](https://msdn.microsoft.com/library/aa372840\(VS.85\).aspx) .)  
  
 ![График VS Shared VSPackage](../../extensibility/internals/media/vs-sharedpackage.gif "VS_SharedPackage")  
Общий установщик VSPackage  
  
 Как показано на рисунке, общие компоненты входят в состав Feat_Common компонента, который всегда устанавливается. После того как функции Feat_VS2002 и Feat_VS2003 видны, пользователи могут выбирать версии, которые [!INCLUDE[vsprvs](../../includes/vsprvs-md.md)] должны интегрироваться VSPackage, во время установки. Пользователи также могут использовать режим обслуживания установщик Windows для добавления и удаления компонентов, которые в этом случае добавляют или удаляют сведения о регистрации VSPackage из разных версий [!INCLUDE[vsprvs](../../includes/vsprvs-md.md)] .  
  
> [!NOTE]
> Установка в столбце "Отображение" функции значения 0 скрывает его. Значение столбца низкого уровня, например 1, гарантирует, что оно будет установлено всегда. Дополнительные сведения см. в разделе [свойство инсталллевел](https://msdn.microsoft.com/library/aa369536\(VS.85\).aspx) и [Таблица функций](https://msdn.microsoft.com/library/aa368585.aspx).  
  
## <a name="scenario-2-shared-vspackage-update"></a>Сценарий 2. Общее обновление VSPackage  
 В этом сценарии поставляется обновленная версия установщика VSPackage в сценарии 1. В целях обсуждения обновление добавляет поддержку [!INCLUDE[vsprvs](../../includes/vsprvs-md.md)] , но оно также может быть более простым исправлением безопасности или исправлением ошибок. Правила установщик Windows для установки новых компонентов требуют, чтобы неизмененные компоненты, уже имеющиеся в системе, не копировались повторно. В этом случае система с уже установленной версией 1,0 перезапишет обновленный компонент Comp_MyVSPackage.dll и предложит пользователям добавить новый компонент Feat_VS2005 с его компонентом Comp_VS2005_Reg.  
  
> [!CAUTION]
> Каждый раз, когда пакет VSPackage совместно используется несколькими версиями [!INCLUDE[vsprvs](../../includes/vsprvs-md.md)] , важно, чтобы последующие выпуски VSPackage поддерживали обратную совместимость с предыдущими версиями [!INCLUDE[vsprvs](../../includes/vsprvs-md.md)] . Если вы не можете поддерживать обратную совместимость, следует использовать параллельные и частные пакеты VSPackage. Дополнительные сведения см. в разделе [Поддержка нескольких версий Visual Studio](../../extensibility/supporting-multiple-versions-of-visual-studio.md).  
  
 ![Изображение обновление пакета VS Shared VS](../../extensibility/internals/media/vs-sharedpackageupdate.gif "VS_SharedPackageUpdate")  
Установщик общих обновлений VSPackage  
  
 В этом сценарии представлен новый установщик VSPackage, использующий установщик Windows поддержку незначительных обновлений. Пользователи просто устанавливают версию 1,1 и ИТ обновляет версию 1,0. Однако в системе не обязательно наличие версии 1,0. Один и тот же установщик установит версию 1,1 в системе без версии 1,0. Преимущество предоставления незначительных обновлений таким образом заключается в том, что нет необходимости проходить разработку установщика обновления и полнофункционального установщика. Один установщик выполняет оба задания. Вместо исправления безопасности или пакета обновления могут воспользоваться преимуществами установщик Windows исправлений. Дополнительные сведения см. в разделе [Установка исправлений и обновления](https://msdn.microsoft.com/library/aa370579\(VS.85\).aspx).  
  
## <a name="scenario-3-side-by-side-vspackage"></a>Сценарий 3. параллельный пакет VSPackage  
 В этом сценарии представлены два установщика VSPackage — по одному для каждой версии Visual Studio .NET 2003 и [!INCLUDE[vsprvs](../../includes/vsprvs-md.md)] . Каждый установщик устанавливает параллельный или частный пакет VSPackage (один, который специально создан и установлен для конкретной версии [!INCLUDE[vsprvs](../../includes/vsprvs-md.md)] ). Каждый пакет VSPackage находится в отдельном компоненте. Следовательно, каждое из них можно обслуживать по отдельности с помощью исправлений или выпусков обслуживания. Так как библиотека DLL VSPackage теперь зависит от версии, она может быть защищена от регистрации в том же компоненте, что и библиотека DLL.  
  
 ![VS Side&#45;по&#45;стороне графика пакета VS](../../extensibility/internals/media/vs-sbys-package.gif "VS_SbyS_Package")  
Параллельный установщик VSPackage  
  
 Каждый установщик также содержит код, который совместно используется двумя установщиками. Если общий код установлен в общем расположении, установка обоих MSI-файлов установит общий код только один раз. Второй установщик просто увеличивает счетчик ссылок на компонент. Счетчик ссылок гарантирует, что если один из пакетов VSPackage удаляется, общий код будет оставаться для другого пакета VSPackage. Если второй пакет VSPackage также удаляется, то общий код будет удален.  
  
## <a name="scenario-4-side-by-side-vspackage-update"></a>Сценарий 4. параллельное обновление VSPackage  
 В этом сценарии пакет VSPackage для [!INCLUDE[vsprvslong](../../includes/vsprvslong-md.md)] обнаруженной уязвимости системы безопасности и необходимо выполнить обновление. Как и в сценарии 2, можно создать новый MSI-файл, который обновляет существующую установку, чтобы включить исправление безопасности, а также развернуть новые установки с уже установленным исправлением безопасности.  
  
 В этом случае VSPackage — это управляемый пакет VSPackage, установленный в глобальном кэше сборок (GAC). При перестроении для включения исправления безопасности необходимо изменить часть номера версии сборки. Сведения о регистрации нового номера версии сборки перезаписывают предыдущую версию, что приводит [!INCLUDE[vsprvs](../../includes/vsprvs-md.md)] к загрузке фиксированной сборки.  
  
 ![VS Side&#45;по&#45;ному графику обновления пакета VS](../../extensibility/internals/media/vs-sbys-packageupdate.gif "VS_SbyS_PackageUpdate")  
Установщик обновлений пакета VSPackage параллельно  
  
 **Примечание** . Дополнительные сведения о развертывании параллельных сборок см. [в разделе Упрощение развертывания и решения Hell библиотек DLL с помощью .NET Framework](https://msdn.microsoft.com/library/ms973843.aspx).  
  
## <a name="see-also"></a>См. также:  
 [установщик Windows](https://msdn.microsoft.com/library/cc185688\(VS.85\).aspx)   
 [Поддержка нескольких версий Visual Studio](../../extensibility/supporting-multiple-versions-of-visual-studio.md)
