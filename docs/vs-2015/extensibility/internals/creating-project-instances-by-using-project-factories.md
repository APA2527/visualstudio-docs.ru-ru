---
title: Создание экземпляров проекта с помощью фабрик проекта | Документация Майкрософт
ms.date: 11/15/2016
ms.prod: visual-studio-dev14
ms.technology: vs-ide-sdk
ms.topic: conceptual
helpviewer_keywords:
- project factories
- projects [Visual Studio SDK], project factories
ms.assetid: 94c90012-8669-459c-af8e-307ac242c8c4
caps.latest.revision: 14
ms.author: gregvanl
manager: jillfra
ms.openlocfilehash: f26b11aaf74b73535c82ebcd6422f3be0bba3f22
ms.sourcegitcommit: 6cfffa72af599a9d667249caaaa411bb28ea69fd
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 09/02/2020
ms.locfileid: "65697207"
---
# <a name="creating-project-instances-by-using-project-factories"></a>Создание экземпляров проекта с помощью фабрик проектов
[!INCLUDE[vs2017banner](../../includes/vs2017banner.md)]

Типы проектов в [!INCLUDE[vsprvs](../../includes/vsprvs-md.md)] используют *фабрику проектов* для создания экземпляров объектов Project. Фабрика проектов аналогична фабрике класса Standard для создаваемых COM-объектов. Однако объекты проекта не могут быть созданы одновременно. их можно создать только с помощью фабрики проектов.  
  
 [!INCLUDE[vsprvs](../../includes/vsprvs-md.md)]Интегрированная среда разработки вызывает фабрику проекта, реализованную в VSPackage, когда пользователь загружает существующий проект или создает новый проект в среде [!INCLUDE[vsprvs](../../includes/vsprvs-md.md)] . Новый объект Project предоставляет интегрированной среде разработки достаточно сведений для заполнения обозреватель решений. Новый объект Project также предоставляет необходимые интерфейсы для поддержки всех соответствующих действий пользовательского интерфейса, инициированных интегрированной средой разработки.  
  
 Интерфейс можно реализовать <xref:Microsoft.VisualStudio.Shell.Interop.IVsProjectFactory> в классе в проекте. Как правило, он находится в отдельном модуле.  
  
 Пример реализации `IVsProjectFactory` интерфейса см. в разделе пржфак. cpp, который содержится в каталоге [Basic Project](https://msdn.microsoft.com/385fd2a3-d9f1-4808-87c2-a3f05a91fc36) Sample.  
  
 Проекты, которые поддерживают агрегирование с помощью владельца, должны сохранять ключ владельца в файле проекта. При <xref:Microsoft.VisualStudio.Shell.Interop.IVsProjectFactory.CreateProject%2A> вызове метода для проекта с ключом владельца, принадлежащий проект преобразует свой ключ владельца в GUID фабрики проекта, а затем вызывает `CreateProject` метод в этой фабрике проектов, чтобы выполнить фактическое создание.  
  
## <a name="creating-an-owned-project"></a>Создание собственного проекта  
 Владелец создает принадлежащий проект в два этапа:  
  
1. Путем вызова <xref:Microsoft.VisualStudio.Shell.Interop.IVsOwnedProjectFactory.PreCreateForOwner%2A> метода. Это дает возможность владельцем проекта создать агрегированный объект проекта на основе входных данных, управляющих данными `IUnknown` . Владелец проекта передает внутренний `IUnknown` и объединенный объект обратно в проект владельца. Это дает принадлежащему проекту возможность хранить внутренние `IUnknown` .  
  
2. Путем вызова <xref:Microsoft.VisualStudio.Shell.Interop.IVsOwnedProjectFactory.InitializeForOwner%2A> метода. Собственный проект выполняет все свои экземпляры при вызове этого метода вместо вызова AS, так `IVsProjectFactory::CreateProject` как для проектов, которые не принадлежат. Входным `VSOWNEDPROJECTOBJECT` перечислением обычно является объединенный проект, принадлежащий. Принадлежащий проект может использовать эту переменную для определения того, был ли уже создан объект проекта (файл cookie не равен NULL) или должен быть создан (файл cookie равен NULL).  
  
   Типы проектов определяются уникальным идентификатором GUID проекта, аналогично идентификатору CLSID создаваемого COM-объекта. Как правило, одна фабрика проектов обрабатывает создание экземпляров одного типа проекта, хотя одна фабрика проекта может обрабатывать несколько идентификаторов GUID для одного типа проекта.  
  
   Типы проектов связаны с определенным расширением имени файла. Когда пользователь пытается открыть существующий файл проекта или пытается создать новый проект путем клонирования шаблона, интегрированная среда разработки использует расширение файла для определения соответствующего идентификатора GUID проекта.  
  
   Как только интегрированная среда разработки определит, нужно ли создать новый проект или открыть существующий проект определенного типа, интегрированная среда разработки использует сведения из системного реестра в разделе [HKEY_LOCAL_MACHINE \Software\Microsoft\VisualStudio\8.0\Projects], чтобы определить, какой пакет VSPackage реализует требуемую фабрику проектов. Интегрированная среда разработки загружает этот пакет VSPackage. В <xref:Microsoft.VisualStudio.Shell.Interop.IVsPackage.SetSite%2A> методе пакет VSPackage должен зарегистрировать свою фабрику проекта в интегрированной среде разработки, вызвав <xref:Microsoft.VisualStudio.Shell.Interop.IVsRegisterProjectTypes.RegisterProjectType%2A> метод.  
  
   Основной метод `IVsProjectFactory` интерфейса, <xref:Microsoft.VisualStudio.Shell.Interop.IVsProjectFactory.CreateProject%2A> который должен выполнять два сценария: Открытие существующего проекта и создание нового проекта. Большинство проектов сохраняют свое состояние проекта в файле проекта. Как правило, новые проекты создаются путем создания копии файла шаблона, переданного в `CreateProject` метод, и открытия копии. Экземпляры существующих проектов создаются путем непосредственного открытия файла проекта, переданного в `CreateProject` метод. `CreateProject`При необходимости метод может отображать дополнительные пользовательские функции пользовательского интерфейса.  
  
   Проект также может использовать файлы без файлов и, вместо этого, хранить свое состояние проекта в механизме хранения, отличном от файловой системы, такой как база данных или веб-сервер. В этом случае параметр имени файла, передаваемый в `CreateProject` метод, фактически не является путем файловой системы, а уникальной строкой — URL-адресом для обнаружения данных проекта. Вам не нужно копировать файлы шаблонов, которые передаются в, `CreateProject` чтобы запустить соответствующую последовательность построения для выполнения.  
  
## <a name="see-also"></a>См. также:  
 <xref:Microsoft.VisualStudio.Shell.Interop.IVsOwnedProjectFactory>   
 <xref:Microsoft.VisualStudio.Shell.Interop.IVsProjectFactory>   
 <xref:Microsoft.VisualStudio.Shell.Interop.IVsRegisterProjectTypes>   
 [Контрольный список. Создание новых типов проектов](../../extensibility/internals/checklist-creating-new-project-types.md)
