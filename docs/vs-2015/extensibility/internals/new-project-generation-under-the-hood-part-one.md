---
title: 'Создание проекта: За кулисами, часть 1 | Документация Майкрософт'
ms.date: 11/15/2016
ms.prod: visual-studio-dev14
ms.technology: vs-ide-sdk
ms.topic: conceptual
helpviewer_keywords:
- projects [Visual Studio], new project dialog
- projects [Visual Studio], new project generation
ms.assetid: 66778698-0258-467d-8b8b-c351744510eb
caps.latest.revision: 30
ms.author: gregvanl
manager: jillfra
ms.openlocfilehash: 6f26c093f09cd5b7b99f00ee69a81be99c769e2e
ms.sourcegitcommit: 94b3a052fb1229c7e7f8804b09c1d403385c7630
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/23/2019
ms.locfileid: "68184160"
---
# <a name="new-project-generation-under-the-hood-part-one"></a>Создание проекта: как это работает, часть 1
[!INCLUDE[vs2017banner](../../includes/vs2017banner.md)]

Когда-нибудь думали о том, как создать собственный тип проекта? Интересно, что произойдет при создании нового проекта? Давайте взглянуть изнутри и что происходит в действительности.  
  
 Существует несколько задач, которые координирует Visual Studio для вас:  
  
- Он отображает дерево из всех доступных типов проектов.  
  
- Он отображает список шаблонов приложений для каждого типа проекта и позволяет выбрать одну.  
  
- Он собирает сведения о проекте для приложения, например имя и путь проекта.  
  
- Эти сведения передаются на фабрику проектов.  
  
- Он создает элементы проекта и папки в текущем решении.  
  
## <a name="the-new-project-dialog-box"></a>Диалоговое окно нового проекта  
 Все начинается с выбора типа проекта для нового проекта. Давайте начнем, щелкнув **новый проект** на **файл** меню. **Новый проект** откроется диалоговое окно, которым нужен примерно так:  
  
 ![Диалоговое окно "новый проект"](../../extensibility/internals/media/newproject.gif "NewProject")  
  
 Давайте рассмотрим более подробно. **Типы проектов** дерева перечислены различные типы проектов, можно создать. При выборе типа проекта, например **Visual C# Windows**, вы увидите список шаблонов приложений, чтобы приступить к работе. **Установленные шаблоны Visual Studio** устанавливаются с Visual Studio и доступны всем пользователям компьютера. Можно добавить новые шаблоны, которые вы создаете или собирать **Мои шаблоны** и доступны только текущему пользователю.  
  
 Если выбран шаблон, похожий на **приложения Windows**, описание типа приложения отображается в диалоговом окне; в данном случае **проект по созданию приложения с пользовательским интерфейсом Windows**.  
  
 В нижней части **новый проект** диалоговом окне вы увидите несколько элементов управления, сбора дополнительной информации. Элементы управления, вы увидите зависят от типа проекта, но обычно они включают проект **имя** текстовое поле, **расположение** текстовое поле и связанных **Обзор** кнопку и **Имя решения** текстовое поле и связанных **создать каталог для решения** "флажок".  
  
## <a name="populating-the-new-project-dialog-box"></a>Заполнение диалоговом окне нового проекта  
 Где does **новый проект** диалоговое окно Получение информации о из? Существует два механизма на работе, один из них рекомендуется использовать. **Новый проект** объединяет и отображает сведения, полученные с обоими механизмами.  
  
 Старый метод (не рекомендуется) использует записи системного реестра и файлов VSDir. Этот механизм выполняется при открытии Visual Studio. Метод новой использует VSTEMPLATE-файлах. Этот механизм работает при инициализации Visual Studio, например, путем запуска  
  
```  
devenv /setup  
```  
  
 или диспетчер конфигурации служб  
  
```  
devenv /installvstemplates  
```  
  
### <a name="project-types"></a>Типы проектов  
 Положение и имена **типы проектов** корневые узлы, такие как **Visual C#** и **другие языки**, определяется путем записи системного реестра. Организация дочерних узлов, таких как **базы данных** и **смарт-устройств**, отражает иерархию папок, которые содержат соответствующие VSTEMPLATE-файлов. Давайте сначала посмотрим на корневые узлы.  
  
#### <a name="project-type-root-nodes"></a>Корневые узлы типа проекта  
 Когда [!INCLUDE[vsprvs](../../includes/vsprvs-md.md)] будет инициализирован, он проходит через подразделов для раздела реестра системы HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\VisualStudio\14.0\NewProjectTemplates\TemplateDirs для построения и назовите корневые узлы **типыпроектов** дерева. Эта информация кэшируется для последующего использования. Рассмотрим TemplateDirs\\{FAE04EC1-301F-11D3-BF4B-00C04F79EFBC} \\ /1 ключ. Каждая запись представляет собой идентификатор GUID пакета VSPackage. Имя подраздела (/ 1) учитывается, но его наличие означает, что это **типы проектов** корневого узла. Корневой узел, в свою очередь, может иметь несколько подразделов, определяющие его внешний вид в **типы проектов** дерева. Давайте рассмотрим некоторые из них.  
  
##### <a name="default"></a>(Значение по умолчанию)  
 Это идентификатор ресурса для локализованной строки с именем корневого узла. Строковый ресурс находится в вспомогательной библиотеке DLL, выбранных с GUID пакета VSPackage.  
  
 В примере является идентификатор GUID VSPackage  
  
 {FAE04EC1-301F-11D3-BF4B-00C04F79EFBC}  
  
 и идентификатор ресурса (значение по умолчанию) корневой узел (/ 1) является #2345  
  
 Если найти GUID в соседнем ключ пакетов и проверить подраздел SatelliteDll, можно найти путь к сборке, которая содержит строковый ресурс:  
  
 \<Путь установки Visual Studio > \VC#\VCSPackages\1033\csprojui.dll  
  
 Чтобы проверить это, откройте файл в проводнике и перетащите csprojui.dll в каталоге Visual Studio... В строке таблице показано, что resource #2345 заголовок **Visual C#** .  
  
##### <a name="sortpriority"></a>SortPriority  
 Этот параметр определяет положение корневого узла в **типы проектов** дерева.  
  
 REG_DWORD SortPriority 0x00000014 (20)  
  
 Чем меньше номер приоритета, тем выше позицию в дереве.  
  
##### <a name="developeractivity"></a>DeveloperActivity  
 При наличии этого подраздела положение корневого узла управляется диалоговом окне параметров разработчика. Например, примененная к объекту директива  
  
 DeveloperActivity REG_SZVC#  
  
 Показывает, что Visual C# корневой узел Если Visual Studio для [!INCLUDE[vcprvc](../../includes/vcprvc-md.md)] разработки. В противном случае он будет дочерним для узла **другие языки**.  
  
##### <a name="folder"></a>Папка  
 При наличии этого подраздела корневой узел становится дочерним для узла указанной папке. Появится список возможных папки в разделе  
  
 HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\VisualStudio\11.0\NewProjectTemplates\PseudoFolders  
  
 Например запись проекты базы данных имеет папку ключ, соответствующий записи другие типы проектов в PseudoFolders. Таким образом, в **типы проектов** дереве **проектов баз данных** будет дочерним для узла **другие типы проектов**.  
  
#### <a name="project-type-child-nodes-and-vstdir-files"></a>Дочерние узлы типа проекта и файлы .vstdir  
 Положение дочерних узлов в **типы проектов** дерева соответствует иерархии папок в папках Шаблоны_проекта. Для шаблонов машин (**установленные шаблоны Visual Studio**), местонахождение является \Program Files\Microsoft 14.0\Common7\IDE\ProjectTemplates\ Visual Studio и пользовательских шаблонов (**Мои шаблоны**), расположение — Мои \My Documents\Visual Studio 14.0\Templates\ProjectTemplates\\. Иерархии папок в обоих случаях объединяются для создания **типы проектов** дерева.  
  
 Для Visual Studio с C# параметров разработчика **типы проектов** дерева выглядит примерно следующим образом:  
  
 ![Типы проектов](../../extensibility/internals/media/projecttypes.png "ProjectTypes")  
  
 В соответствующую папку Шаблоны_проекта выглядит следующим образом:  
  
 ![Шаблоны проектов](../../extensibility/internals/media/projecttemplates.png "Шаблоны_проекта")  
  
 Когда **новый проект** откроется диалоговое окно [!INCLUDE[vsprvs](../../includes/vsprvs-md.md)] проходит через папку Шаблоны_проекта и воссоздает его структуру в **типы проектов** дерева с определенными изменениями:  
  
- Корневой узел в **типы проектов** дерева определяется данный шаблон приложения.  
  
- Имя узла можно локализовать и может содержать специальные символы.  
  
- Можно изменить порядок сортировки.  
  
##### <a name="finding-the-root-node-for-a-project-type"></a>Поиск корневой узел для типа проекта  
 Когда Visual Studio проходит через Шаблоны_проекта папок, открывает все ZIP-файлов и извлекает любые VSTEMPLATE-файлах. VSTEMPLATE-файл использует XML для описания шаблон приложения. Дополнительные сведения см. в разделе [Создание нового проекта: За кулисами, часть вторая](../../extensibility/internals/new-project-generation-under-the-hood-part-two.md).  
  
 \<ProjectType > тег определяет тип проекта для приложения. Например файл \CSharp\SmartDevice\WindowsCE\1033\WindowsCE-EmptyProject.zip содержит файл EmptyProject.vstemplate с этим тегом:  
  
```  
<ProjectType>CSharp</ProjectType>  
```  
  
 \<ProjectType > тег, а не во вложенную папку в папке Шаблоны_проекта определяет корневой узел приложения в **типы проектов** дерева. В примере приложения для Windows CE будут отображены в **Visual C#** корневой узел, и даже если пришлось переместить папку WindowsCE в папке VisualBasic, чтобы Windows CE приложений по-прежнему будут отображены в  **Visual C#** корневого узла.  
  
##### <a name="localizing-the-node-name"></a>Локализация имя узла  
 Когда Visual Studio проходит через Шаблоны_проекта папки, он проверяет все .vstdir файлы, которые она находит. Файл .vstdir является XML-файл, который определяет отображение типа проекта в **новый проект** диалоговое окно. В файле .vstdir, используйте \<LocalizedName > тег имени **типы проектов** узла.  
  
 Например файл \CSharp\Database\TemplateIndex.vstdir содержит этот тег:  
  
```  
<LocalizedName Package="{462b036f-7349-4835-9e21-bec60e989b9c}" ID="4598"/>  
```  
  
 Этот параметр определяет вспомогательной библиотеки DLL и ресурсов идентификатор локализованную строку с именем корневого узла в этом случае **базы данных**. Локализованное имя может содержать специальные символы, которые не доступны в именах папок, таких как **.NET**.  
  
 Если не \<LocalizedName > присутствует тег, именем типа проекта саму папку **SmartPhone2003**.  
  
##### <a name="finding-the-sort-order-for-a-project-type"></a>Поиск порядок сортировки для типа проекта  
 Чтобы определить порядок сортировки для этого типа проекта, используйте файлы .vstdir \<SortOrder > тег.  
  
 Например файл \CSharp\Windows\Windows.vstdir содержит этот тег:  
  
```  
<SortOrder>5</SortOrder>  
```  
  
 Файл \CSharp\Database\TemplateIndex.vstdir содержит тег с большим значением:  
  
```  
<SortOrder>5000</SortOrder>  
```  
  
 Чем меньше число в \<SortOrder > тег, тем выше позицию в дереве, поэтому **Windows** узел отображается выше, чем **базы данных** узел в **типы проектов**  дерева.  
  
 Если не \<SortOrder > тег указан для типа проекта, он отображается в алфавитном порядке следующие типы проектов, которые содержат \<SortOrder > спецификации.  
  
 Обратите внимание, что файлы не .vstdir в «Мои документы» (**Мои шаблоны**) папки. Имена типов проекта для приложения пользователя не локализуются и отображаются в алфавитном порядке.  
  
#### <a name="a-quick-review"></a>Краткий обзор  
 Давайте изменим **новый проект** диалоговое окно и создать новый шаблон проекта пользователя.  
  
1. Добавьте вложенную папку MyProjectNode папку 14.0\Common7\IDE\ProjectTemplates\CSharp \Program Files\Microsoft Visual Studio.  
  
2. Создайте файл MyProject.vstdir в папке MyProjectNode, используя любой текстовый редактор.  
  
3. Добавьте следующие строки в файл .vstdir:  
  
   ```  
   <TemplateDir Version="1.0.0">  
       <SortOrder>6</SortOrder>  
   </TemplateDir>  
   ```  
  
4. Сохраните и закройте файл .vstdir.  
  
5. Создайте файл MyProject.vstemplate в папке MyProjectNode, используя любой текстовый редактор.  
  
6. Добавьте следующие строки в VSTEMPLATE-файле:  
  
   ```  
   <VSTemplate Version="2.0.0" Type="Project" xmlns="http://schemas.microsoft.com/developer/vstemplate/2005">  
       <TemplateData>  
           <ProjectType>CSharp</ProjectType>  
       </TemplateData>  
   </VSTemplate>  
   ```  
  
7. Сохраните файл the.vstemplate и закройте редактор.  
  
8. Отправьте новые сжатую папку MyProjectNode\MyProject.zip VSTEMPLATE-файл.  
  
9. Командное окно Visual Studio введите:  
  
    ```  
    devenv /installvstemplates  
    ```  
  
   Запустите Visual Studio.  
  
10. Откройте **новый проект** диалогового окна поле, а затем разверните **Visual C#** узел проекта.  
  
    ![MyProjectNode](../../extensibility/internals/media/myprojectnode.png "MyProjectNode")  
  
    **MyProjectNode** отображается как дочерний узел Visual C# просто узле Windows.  
  
## <a name="see-also"></a>См. также  
 [Создание проекта: как это работает, часть 2](../../extensibility/internals/new-project-generation-under-the-hood-part-two.md)
