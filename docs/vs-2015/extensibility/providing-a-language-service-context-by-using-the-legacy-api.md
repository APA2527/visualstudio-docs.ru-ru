---
title: Предоставление контекста языковой службы с помощью API прежних версий | Документация Майкрософт
ms.date: 11/15/2016
ms.prod: visual-studio-dev14
ms.technology: vs-ide-sdk
ms.topic: conceptual
helpviewer_keywords:
- editors [Visual Studio SDK], legacy - language service context
ms.assetid: daa2df22-9181-4bad-b007-a7d40302bce1
caps.latest.revision: 15
ms.author: gregvanl
manager: jillfra
ms.openlocfilehash: 4471b71b612008ba7d0733c92286415cd3c3f6b3
ms.sourcegitcommit: 6cfffa72af599a9d667249caaaa411bb28ea69fd
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 09/02/2020
ms.locfileid: "68193866"
---
# <a name="providing-a-language-service-context-by-using-the-legacy-api"></a>Предоставление контекста языковой службы с помощью API прежних версий
[!INCLUDE[vs2017banner](../includes/vs2017banner.md)]

Существует два способа предоставления языковой службы контексту пользователя с помощью [!INCLUDE[vsprvs](../includes/vsprvs-md.md)] редактора ядра: укажите контекст текстового маркера или укажите весь контекст пользователя. Различия между ними описаны здесь.  
  
 Дополнительные сведения о предоставлении контекста для языковой службы, подключенной к собственному редактору, см. [в разделе инструкции. Предоставление контекста для редакторов](../extensibility/how-to-provide-context-for-editors.md).  
  
## <a name="provide-text-marker-context-to-the-editor"></a>Укажите контекст текстового маркера для редактора  
 Чтобы предоставить контекст для ошибок компилятора, обозначенных текстовыми маркерами в [!INCLUDE[vsprvs](../includes/vsprvs-md.md)] основном редакторе, реализуйте <xref:Microsoft.VisualStudio.TextManager.Interop.IVsTextMarkerContextProvider> интерфейс. В этом сценарии языковая служба предоставляет контекст только в том случае, если курсор находится на текстовом маркере. Это позволяет редактору предоставлять ключевое слово в курсоре в окне **динамической справки** без атрибутов.  
  
## <a name="provide-all-user-context-to-the-editor"></a>Предоставить редактору весь контекст пользователя  
 Если вы создаете языковую службу и используете [!INCLUDE[vsprvs](../includes/vsprvs-md.md)] основной редактор, то можете реализовать <xref:Microsoft.VisualStudio.TextManager.Interop.IVsLanguageContextProvider> интерфейс для предоставления контекста для языковой службы.  
  
 Для реализации `IVsLanguageContextProvider` контейнер контекста (коллекция) прикрепляется к редактору, который отвечает за обновление контейнера контекста. Когда окно **динамической справки** вызывает <xref:Microsoft.VisualStudio.Shell.Interop.IVsUserContext.Update%2A> интерфейс в этом контейнере контекста во время простоя, контейнер контекста запрашивает у редактора обновление. Затем редактор уведомляет языковую службу о том, что необходимо обновить редактор, и передает указатель на контейнер контекста. Это делается путем вызова <xref:Microsoft.VisualStudio.TextManager.Interop.IVsLanguageContextProvider.UpdateLanguageContext%2A> метода из редактора в языковую службу. Используя указатель на контейнер контекста, языковая служба теперь может добавлять и удалять атрибуты и ключевые слова. Для получения дополнительной информации см. <xref:Microsoft.VisualStudio.TextManager.Interop.IVsLanguageContextProvider>.  
  
 Существует два разных способа реализации `IVsLanguageContextProvider` :  
  
- Предоставление ключевого слова для контейнера контекста  
  
   При вызове редактора для обновления контейнера контекста передайте соответствующие ключевые слова и атрибуты, а затем возвратите `S_OK` . Это возвращаемое значение предписывает редактору хранить ключевое слово и контекст атрибута вместо предоставления ключевого слова в курсоре контейнеру контекста.  
  
- Получить ключевое слово из ключевого слова в курсоре  
  
   При вызове редактора для обновления контейнера контекста передайте соответствующие атрибуты, а затем возвратите `E_FAIL` . Это возвращаемое значение предписывает редактору хранить атрибуты в контейнере контекста, но обновляет контейнер контекста ключевым словом в курсоре.  
  
  На следующей схеме показано, как предоставляется контекст для языковой службы, реализующей интерфейс `IVsLanguageContextProvider` .  
  
  ![График LangServiceImplementation2](../extensibility/media/vslanguageservice2.gif "vsLanguageService2")  
  Контекст для языковой службы  
  
  Как видно на диаграмме, к [!INCLUDE[vsprvs](../includes/vsprvs-md.md)] основному текстовому редактору прикрепляется контейнер контекста. Этот контейнер контекста указывает на три отдельных контейнера подконтекста: языковая служба, редактор по умолчанию и текстовый маркер. Контейнеры языковой службы и текстового маркера содержат атрибуты и ключевые слова для языковой службы <xref:Microsoft.VisualStudio.TextManager.Interop.IVsLanguageContextProvider> , если интерфейс реализован, и текстовые маркеры, если <xref:Microsoft.VisualStudio.TextManager.Interop.IVsTextMarkerContextProvider> интерфейс реализован. Если ни один из этих интерфейсов не реализован, редактор предоставляет контекст для ключевого слова в курсоре в контейнере подконтекста редактора по умолчанию.  
  
## <a name="context-guidelines-for-editors-and-designers"></a>Рекомендации по контексту для редакторов и конструкторов  
 Конструкторы и редакторы должны предоставлять общее ключевое слово для редактора или окна конструктора. Это делается так, что для конструктора или редактора, когда пользователь нажимает клавишу F1, отображается универсальный, но соответствующий раздел справки. В дополнение к этому редактору необходимо указать ключевое слово Current в курсоре или указать ключевой термин на основе текущего выбора. Это делается для того, чтобы раздел справки для текста или элемента пользовательского интерфейса, на который указывает или выбран, отображался, когда пользователь нажимает клавишу F1. Конструктор предоставляет контекст для элемента, выбранного в конструкторе, например кнопки в форме. Редакторы и конструкторы также должны подключаться к языковой службе, как описано в [предыдущих версиях языковой службы](../extensibility/internals/legacy-language-service-essentials.md).
