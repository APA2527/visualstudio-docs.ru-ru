---
title: Практическое руководство. Присоединение Profiler к веб-приложению ASP.NET для сбора данных о параллелизме при помощи командной строки | Документация Майкрософт
ms.date: 11/15/2016
ms.prod: visual-studio-dev14
ms.technology: vs-ide-debug
ms.topic: conceptual
ms.assetid: 0e215fdd-55f8-43ef-9534-06542eefe223
caps.latest.revision: 34
author: MikeJo5000
ms.author: mikejo
manager: jillfra
ms.openlocfilehash: d720779019ab4106fa6c4b727e9994f168a2d8f2
ms.sourcegitcommit: 94b3a052fb1229c7e7f8804b09c1d403385c7630
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/23/2019
ms.locfileid: "68179280"
---
# <a name="how-to-attach-the-profiler-to-an-aspnet-web-application-to-collect-concurrency-data-by-using-the-command-line"></a>Практическое руководство. Присоединение Profiler к веб-приложению ASP.NET для сбора данных параллелизма с помощью командной строки
[!INCLUDE[vs2017banner](../includes/vs2017banner.md)]

В этом разделе описывается использование программ командной строки средств профилирования [!INCLUDE[vsprvs](../includes/vsprvs-md.md)] для подключения профилировщика к приложению ASP.NET и сбора данных о параллелизме потоков и процессов.  

 Программы командной строки средств профилирования расположены в подкаталоге \Team Tools\Performance Tools каталога установки Visual Studio. На 64-разрядных компьютерах доступны 64- и 32-разрядные версии этих программ. Для использования командной строки профилировщика необходимо добавить путь к программам в переменную среды PATH окна **командной строки** или в саму команду. Дополнительные сведения см. в статье [Указание пути к средствам командной строки](../profiling/specifying-the-path-to-profiling-tools-command-line-tools.md).  

 Для сбора данных о параллелизме подключите профилировщик к рабочему процессу ASP.NET, в котором размещается веб-сайт. Когда профилировщик будет подключен к приложению, можно будет приостанавливать и возобновлять сбор данных. Для завершения сеанса профилирования профилировщик следует отключить от приложения и явным образом завершить его работу. В большинстве случаев рекомендуется сбрасывать переменные среды профилирования в конце сеанса.  

## <a name="attaching-the-profiler"></a>Подключение профилировщика  

#### <a name="to-attach-the-profiler-to-a-aspnet-application"></a>Присоединение профилировщика к приложению ASP.NET  

1. Запустите профилировщик. Для этого введите следующую команду:  

    [VSPerfCmd](../profiling/vsperfcmd.md) **/start:concurrency /output:** `OutputFile` [`Options`]  

   - Параметр [/start](../profiling/start.md) инициализирует профилировщик для сбора данных о конфликтах ресурсов.  

   - Параметр [/output](../profiling/output.md) **:** `OutputFile` является обязательным для параметра **/start**. `OutputFile` указывает имя и расположение файла данных профилирования (VSP-файла).  

     С параметром **/start** можно использовать любой из параметров, приведенных в следующей таблице.  

   |                               Параметр                               |                                                                     Описание                                                                      |
   |--------------------------------------------------------------------|------------------------------------------------------------------------------------------------------------------------------------------------------|
   | [/user](../profiling/user-vsperfcmd.md) **:** [`Domain\`]`UserName` |                           Задает необязательные домен и имя пользователя учетной записи, которой будет предоставлен доступ к профилировщику.                           |
   |           [/crosssession](../profiling/crosssession.md)            |                                               Включает профилирование процессов в других сеансах входа.                                                |
   |  [/wincounter](../profiling/wincounter.md) **:** `WinCounterPath`  |                                      Задает счетчик производительности Windows, данные которого будут собираться во время профилирования.                                       |
   |       [/automark](../profiling/automark.md) **:** `Interval`       | Используется с только с параметром **/wincounter**. Указывает время (в миллисекундах) между событиями сбора счетчика производительности Windows. Значение по умолчанию — 500. |
   |     [/events](../profiling/events-vsperfcmd.md) **:** `Config`     |       Задает события трассировки событий для Windows (ETW), собираемые во время профилирования. События трассировки событий Windows собираются в отдельный ETL-файл.       |

2. Запустите приложение ASP.NET обычным образом.  

3. Подключите профилировщик к рабочему процессу ASP.NET. Для этого введите следующую команду: **VSPerfCmd /attach:** `PID` [ **/targetclr:** `Version`].  

   - `PID` задает идентификатор или имя рабочего процесса ASP.NET. Идентификаторы всех запущенных процессов можно просмотреть в диспетчере задач Windows.  

   - [/targetclr](../profiling/targetclr.md) **:** `Version` указывает версию профилируемой среды CLR, если в приложении загружено несколько версий среды выполнения. Этот параметр является необязательным.  

## <a name="controlling-data-collection"></a>Управление сбором данных  
 Пока приложение выполняется, вы можете управлять сбором данных путем запуска и остановки записи данных в файл, используя параметры VSPerfCmd.exe. Управляя сбором данных, вы можете собирать данные на конкретных этапах выполнения программы, например при запуске или завершении работы приложения.  

#### <a name="to-start-and-stop-data-collection"></a>Запуск и остановка сбора данных  

- Пары параметров VSPerfCmd в следующей таблице запускают и останавливают сбор данных. Каждый параметр необходимо указывать в отдельной командной строке. Сбор данных можно включать и отключать несколько раз.  

    |Параметр|Описание|  
    |------------|-----------------|  
    |[/globalon /globaloff](../profiling/globalon-and-globaloff.md)|Запускает ( **/globalon**) или останавливает ( **/globaloff**) сбор данных для всех процессов.|  
    |[/processon](../profiling/processon-and-processoff.md) **:** `PID`  [processoff](../profiling/processon-and-processoff.md) **:** `PID`|Запускает ( **/processon**) или останавливает ( **/processoff**) сбор данных для процесса с указанным идентификатором процесса (`PID`).|  
    |[/attach](../profiling/attach.md) **:** {`PID`&#124;`ProcName`} [/detach](../profiling/detach.md)[ **:** {`PID`&#124;`ProcName`}]|**/attach** запускает сбор данных для процесса с указанным идентификатором (`PID`) или именем (*ProcName*) процесса. **/detach** останавливает сбор данных для указанного процесса или для всех процессов, если конкретный процесс не задан.|  

## <a name="ending-the-profiling-session"></a>Завершение сеанса профилирования  
 Для завершения сеанса профилирования профилировщик не должен выполнять сбор данных. Вы можете остановить сбор данных из приложения, профилируемого с помощью метода параллелизма, перезапустив рабочий процесс ASP.NET или вызвав параметр **VSPerfCmd /detach**. Затем можно вызвать параметр **VSPerfCmd /shutdown**, чтобы завершить работу профилировщика и закрыть файл данных профилирования. Команда **VSPerfClrEnv/globaloff** очищает переменные среды профилирования, однако конфигурация системы не сбрасывается до перезагрузки компьютера.  

#### <a name="to-end-a-profiling-session"></a>Завершение сеанса профилирования  

1. Отключите профилировщик от целевого приложения. Для этого закройте приложение или введите следующую команду в командной строке:  

     **VSPerfCmd /detach**  

2. Завершите работу профилировщика. Для этого введите следующую команду в командной строке:  

     **VSPerfCmd**  [/shutdown](../profiling/shutdown.md)  

## <a name="see-also"></a>См. также  
 [Профилирование веб-приложений ASP.NET](../profiling/command-line-profiling-of-aspnet-web-applications.md)   
 [Быстрое профилирование веб-сайтов с помощью средства VSPerfASPNETCmd](../profiling/rapid-web-site-profiling-with-vsperfaspnetcmd.md)
