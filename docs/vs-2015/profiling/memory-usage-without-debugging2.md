---
title: Использование памяти без отладки 2 | Документы Майкрософт
ms.date: 11/15/2016
ms.prod: visual-studio-dev14
ms.technology: vs-ide-debug
ms.topic: conceptual
dev_langs:
- FSharp
- VB
- CSharp
- C++
ms.assetid: 24238fc0-40b8-4079-8579-698211db9a26
caps.latest.revision: 18
author: MikeJo5000
ms.author: mikejo
manager: jillfra
ms.openlocfilehash: 0ab8aaff0ddf793fe64dd3695adc58c281290f98
ms.sourcegitcommit: bad28e99214cf62cfbd1222e8cb5ded1997d7ff0
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 11/21/2019
ms.locfileid: "74295695"
---
# <a name="memory-usage-without-debugging"></a>Использование памяти без отладки
[!INCLUDE[vs2017banner](../includes/vs2017banner.md)]

Средство **Использование памяти** без отладки можно использовать для выполнения перечисленных далее задач.  
  
- Мониторинг использования памяти приложением прямо в Visual Studio во время разработки сценария.  
  
- Создание подробных моментальных снимков состояния памяти вашего приложения одним щелчком.  
  
- Сравнение моментальных снимков для поиска первопричины возникновения проблем с памятью.  
  
  В этом разделе описывается применение инструмента "Использование памяти" для анализа универсального приложения Windows на XAML. Если вы хотите проанализировать использование памяти в универсальных приложениях Windows на базе JavaScript и HTML, см. статью [Analyze memory usage (JavaScript)](https://msdn.microsoft.com/library/windows/apps/jj819176.aspx) (Анализ использования памяти [JavaScript]).  
  
## <a name="BKMK_Start_a_Memory_Usage_diagnostic_session"></a> Запуск диагностического сеанса по использованию памяти  
  
1. Откройте универсальный проект Windows на C# в Visual Studio.  
  
2. В строке меню выберите **Отладка, Профилировщик производительности...** .  
  
3. Выберите **Использование памяти** и нажмите кнопку **Запуск** в нижней части страницы.  
  
     ![Запуск сеанса диагностики использования памяти](../profiling/media/memuse-start-diagnosticssession.png "MEMUSE_Start_DiagnosticsSession")  
  
## <a name="BKMK_Monitor_memory_use"></a> Мониторинг использования памяти  
 Хотя вы можете применять инструмент **Использование памяти**, чтобы создавать подробные отчеты для поиска и устранения проблем, этот же инструмент можно использовать для изучения воздействия разрабатываемого сценария на память в режиме реального времени.  
  
 При запуске сеанса диагностики запускается ваше приложение, а в окне **Средства диагностики** отображается график использования памяти приложением.  
  
 ![Страница обзора использования памяти](../profiling/media/memuse-reportoverview.png "MEMUSE__ReportOverview")  
  
 График временной шкалы показывает колебания объема памяти, используемого выполняемым приложением. Пики на графике обычно указывают на то, что некоторый код собирает или создает данные, а после обработки удаляет их. Крупные пики обозначают области, которые вы, вероятно, сможете оптимизировать. Особое внимание следует уделять использованию памяти без ее возвращения, так как это может указывать на неэффективное использование памяти и даже на ее утечку.  
  
### <a name="BKMK_Close_a_monitoring_session"></a> Закрытие сеанса мониторинга  
 ![Останавливает сбор](../profiling/media/memuse-stopcollection.png "MEMUSE__StopCollection")  
  
 Чтобы остановить сеанс мониторинга без создания отчета, просто закройте окно диагностики. Чтобы создать отчет по полученным снимкам памяти, нажмите кнопку **Остановить**.  
  
## <a name="BKMK_Take_snapshots_to_analyze_the_memory_state_of_your_app"></a> Получение моментальных снимков состояния памяти приложения  
 Если вы обнаружили проблему с памятью и хотите разобраться с ней подробнее, можно создать моментальные снимки во время сеанса диагностики, зафиксировав состояние объектов в памяти на определенный момент времени. Поскольку приложение использует большое количество разных типов объектов, вам может потребоваться сосредоточить анализ на одном сценарии. Кроме того, рекомендуется получить базовый снимок приложения до возникновения проблем с памятью, другой снимок — при первом возникновении проблемы, а также еще один или несколько снимков, если вы в состоянии повторить этот сценарий.  
  
 Для сбора моментальных снимков запустите новый сеанс диагностики. Когда вы захотите зафиксировать данные о памяти, выберите **Сделать снимок**. Для создания отчета выберите **Остановить**.  
  
## <a name="BKMK_Memory_Usage_overview_page"></a> Страница обзора инструмента "Использование памяти"  
 После остановки сбора данных инструмент "Использование памяти" останавливает приложение и отображает обзорный отчет.  
  
 ![Страница обзора использования памяти](../profiling/media/memuse-reportoverview.png "MEMUSE__ReportOverview")  
  
### <a name="BKMK_Memory_Usage_snapshot_views"></a> Представления снимков инструмента "Использование памяти"  
 Представления снимков позволяют открывать подробные отчеты в новых окнах Visual Studio. Существует два вида представлений снимков:  
  
- [Подробный отчет о снимках](../profiling/memory-usage-without-debugging2.md#BKMK_Snapshot_details_reports) отображает типы и экземпляры в одном моментальном снимке.  
  
- [Разностный отчет по снимкам (diff)](../profiling/memory-usage-without-debugging2.md#BKMK_Snapshot_difference__diff__reports) показывает сравнение типов и экземпляров на двух моментальных снимках.  
  
  ![Ссылки для просмотра снимков](../profiling/media/memuse-snapshotview-numbered.png "MEMUSE__SnapshotView_Numbered")  
  
  Нумерованные элементы на изображении представления снимков являются ссылками, открывающими представления отчетов инструмента "Использование памяти".  
  
|||  
|-|-|  
|![Шаг 1](../profiling/media/procguid-1.png "ProcGuid_1")|Текст этой ссылки указывает общее число байт в памяти на момент получения снимка.<br /><br /> Выберите данную ссылку, чтобы отобразить подробный отчет о снимках с сортировкой по общему размеру экземпляров типов.|  
|![Шаг 2](../profiling/media/procguid-2.png "ProcGuid_2")|Текст этой ссылки указывает общее число объектов в памяти на момент получения снимка.<br /><br /> Выберите данную ссылку, чтобы отобразить подробный отчет о снимках с сортировкой по числу экземпляров типов.|  
|![Шаг 3](../profiling/media/procguid-3.png "ProcGuid_3")|Текст этой ссылки указывает разницу между общим размером объектов в памяти, зафиксированным на момент получения данного снимка, и общим размером из предыдущего снимка.<br /><br /> В тексте этой ссылки указано положительно число, когда размер памяти этого снимка больше размера памяти предыдущего снимка, если же первый размер меньше второго, отображается отрицательное число. Текст ссылки **Baseline** (Базовый) указывает на то, что данный снимок является первым в сеансе диагностики; текст **No Difference** (Без различий) указывает на равенство значений.<br /><br /> Выберите данную ссылку, чтобы отобразить разностный отчет о снимках с сортировкой по разности между общими размерами экземпляров типов.|  
|![Шаг 4](../profiling/media/procguid-4.png "ProcGuid_4")|Текст этой ссылки указывает разницу между общим числом объектов в памяти для данного снимка и числом объектов из предыдущего снимка.<br /><br /> Выберите данную ссылку, чтобы отобразить разностный отчет о снимках (diff) с сортировкой по разности между общими количествами экземпляров типов.|  
  
## <a name="BKMK_Snapshot_reports"></a> Отчеты по снимкам  
 ![Моментальный отчет "Использование памяти"](../profiling/media/memuse-snapshotreport-all.png "MEMUSE_SnapshotReport_All")  
  
### <a name="BKMK_Snapshot_report_trees"></a> Деревья отчетов по снимкам  
  
#### <a name="BKMK_Managed_Heap"></a> Управляемая куча  
 Деревья ["Управляемая куча" (сведения о снимке)](../profiling/memory-usage-without-debugging2.md#BKMK_Managed_Heap_tree__Snapshot_details_) и ["Управляемая куча" (разница между снимками)](../profiling/memory-usage-without-debugging2.md#BKMK_Managed_Heap_tree__Snapshot_diff_) показывают типы и экземпляры в отчете. При выборе типа или экземпляра отображаются деревья **Пути к корню** и **Объекты, на которые указывает ссылка** для выбранного элемента.  
  
#### <a name="BKMK_Paths_to_Root"></a> Пути к корню  
 [Дерево "Пути к корню" (сведения о снимке)](../profiling/memory-usage-without-debugging2.md#BKMK_Paths_to_Root_tree__Snapshot_details_) и [Дерево "Пути к корню" (разница между снимками)](../profiling/memory-usage-without-debugging2.md#BKMK_Paths_to_Root_tree__Snapshot_diff_) показывают цепочку объектов, ссылающихся на тип или экземпляр. Сборщик мусора .NET Framework очищает память для объекта только после освобождения всех ссылок на него.  
  
#### <a name="BKMK_Referenced_Objects"></a> Объекты, на которые указывает ссылка  
 [Дерево "Объекты, на которые указывает ссылка" (сведения о снимке)](../profiling/memory-usage-without-debugging2.md#BKMK_Referenced_Objects_tree__Snapshot_details_) и [Дерево "Объекты, на которые указывает ссылка" (разница между снимками)](../profiling/memory-usage-without-debugging2.md#BKMK_Referenced_Objects_tree__Snapshot_diff_) показывают объекты, на которые ссылается выбранный тип или экземпляр.  
  
### <a name="BKMK_Object_Type_and_Instance_fields"></a> Поля "Тип объекта" и "Экземпляр"  
 Когда запись **Тип объекта** имеет вложенные записи, вы можете отобразить их, выбрав значок со стрелкой. Если текст **Тип объекта** выделен голубым цветом, его можно выбрать для перехода к соответствующему объекту в файле исходного кода. Исходный файл открывается в отдельном окне.  
  
 В качестве имен экземпляров используются уникальные идентификаторы, создаваемые инструментом "Использование памяти".  
  
 Если вы нашли тип, которые не можете быстро идентифицировать, или не знаете, как он связан с вашим кодом, не стоит беспокоиться. Вероятно, это объект из .NET Framework, операционной системы или компилятора, отображаемый инструментом "Использование памяти" в связи с тем, что он входит в состав цепочек владения ваших объектов.  
  
### <a name="BKMK_Report_tree_filters_"></a> Фильтры деревьев отчетов  
 Основная часть приложений содержит неожиданно большое число типов, большинство из которых не представляют интереса для разработчика приложений. Инструмент **Использование памяти** определяет два фильтра, которые вы можете использовать для скрытия большинства таких типов в деревьях **Управляемая куча** и **Пути к корню**. Можно также осуществлять фильтрацию дерева по имени типа.  
  
 ![Параметры сортировки и фильтрации](../profiling/media/memuse-sortandfilter.png "MEMUSE_SortAndFilter")  
  
#### <a name="BKMK_Filter"></a> Фильтр  
 Введите строку в поле **Фильтр**, чтобы отобразить только те типы из дерева, которые содержат указанный текст. Этот фильтр не учитывает регистр и распознает введенную строку в любой части имени типа.  
  
#### <a name="BKMK_Collapse_Small_Objects"></a> Свернуть маленькие объекты  
 При применении данного фильтра типы, у которых значение **Размер (байт)** меньше 0,5 процента от общего размера памяти снимка, в списке **Управляемая куча** не отображаются.  
  
#### <a name="BKMK_Just_My_Code"></a> Только мой код  
 Фильтр **Только мой код** скрывает большинство экземпляров, созданных внешним кодом. Внешние типы принадлежат операционной системе или компонентам инфраструктуры либо создаются компилятором.  
  
## <a name="BKMK_Snapshot_details_reports"></a> Подробные отчеты о снимках  
 Подробный отчет о снимках позволяет вам сосредоточиться на одном снимке из сеанса диагностики. Чтобы открыть подробный отчет, выберите одну из ссылок в представлении снимков, как показано на следующем изображении. Обе ссылки открывают один и тот же отчет, единственное различие заключается в начальном порядке сортировки дерева **Управляемая куча** в этом отчете. В обоих случаях вы можете изменить порядок сортировки после открытия отчета.  
  
 ![Ссылки на моментальный снимок отчета в представлении моментальных снимков](../profiling/media/memuse-snapshotview-snapshotdetailslinks.png "MEMUSE_SnapshotView_SnapshotDetailsLinks")  
  
- Ссылка **МБ** сортирует отчет по столбцу **Инклюзивный размер (байт)** .  
  
- Ссылка **Объектов** сортирует отчет по столбцу **Количество**.  
  
### <a name="BKMK_Managed_Heap_tree__Snapshot_details_"></a> Дерево "Управляемая куча" (сведения о снимке)  
 Дерево **Управляемая куча** перечисляет типы объектов, которые хранятся в памяти. Вы можете развернуть имя типа, чтобы просмотреть десять самых крупных экземпляров этого типа, отсортированных по размеру. При выборе типа или экземпляра отображаются деревья **Пути к корню** и **Объекты, на которые указывает ссылка** для выбранного элемента.  
  
 ![Дерево "Управляемая куча"](../profiling/media/memuse-snapshotdetails-managedheaptree.png "MEMUSE__SnapshotDetails_ManagedHeapTree")  
  
|||  
|-|-|  
|**Тип объекта**|Имя типа или экземпляра объекта.|  
|**Количество**|Число экземпляров объекта типа. Для экземпляра это число всегда равно 1.|  
|**Размер (байт)**|Для типа — это размер всех экземпляров типа в снимке памяти без учета размера объектов, содержащихся в этих экземплярах.<br /><br /> Для экземпляра, типа — это размер объекта без учета размера объектов, содержащихся в экземпляре. экземплярах.|  
|**Инклюзивный размер (байт)**|Размер экземпляров типа или размер отдельного экземпляра, включая размер содержащихся внутри объектов.|  
  
### <a name="BKMK_Paths_to_Root_tree__Snapshot_details_"></a> Дерево "Пути к корню" (сведения о снимке)  
 Дерево **Пути к корню** показывает цепочку объектов, ссылающихся на тип или экземпляр. Сборщик мусора .NET Framework очищает память для объекта только после освобождения всех ссылок на него.  
  
 ![Пути к корневому дереву для типов](../profiling/media/memuse-snapshotdetails-type-pathstoroottree.png "MEMUSE_SnapshotDetails_Type_PathsToRootTree")  
  
 При просмотре типа в дереве **Пути к корню** число объектов тех типов, которые содержат ссылки на этот тип, отображается в столбце **Количество ссылок**. Этот столбец не отображается, когда вы анализируете экземпляр.  
  
### <a name="BKMK_Referenced_Objects_tree__Snapshot_details_"></a> Дерево "Объекты, на которые указывает ссылка" (сведения о снимке)  
 Дерево **Объекты, на которые указывает ссылка** показывает объекты, на которые ссылается выбранный тип или экземпляр.  
  
 ![Обжжектс дерево ссылок для экземпляров](../profiling/media/memuse-snapshotdetails-referencedobjects-instance.png "MEMUSE_SnapshotDetails_ReferencedObjects_Instance")  
  
|||  
|-|-|  
|**Тип объекта/экземпляр**|Имя типа или экземпляра объекта.|  
|**Размер (байт)**|Для типа — это размер всех экземпляров типа без учета размера объектов, содержащихся в этом типе.<br /><br /> Для экземпляра — это размер объекта без учета размера объектов, содержащихся в объекте.|  
|**Инклюзивный размер (байт)**|Размер экземпляров типа или размер экземпляра, включая размер содержащихся внутри объектов.|  
  
## <a name="BKMK_Snapshot_difference__diff__reports"></a> Разностные отчеты по снимкам (diff)  
 Разностный отчет по снимкам (diff) показывает изменения между основным снимком и снимком, полученным непосредственно перед ним. Чтобы открыть разностный отчет (diff), выберите одну из ссылок в представлении снимков, как показано на следующем изображении. Обе ссылки открывают один и тот же отчет, единственное различие заключается в начальном порядке сортировки дерева **Управляемая куча** в этом отчете. Вы можете изменить порядок сортировки после открытия отчета.  
  
 ![Ссылки на отчет о различиях в представлении моментальных снимков](../profiling/media/memuse-snapshotview-snapshotdifflinks.png "MEMUSE_SnapshotView_SnapshotDiffLinks")  
  
- Ссылка **МБ** сортирует отчет по столбцу **Инклюзивный размер (байт)** .  
  
- Ссылка **Объектов** сортирует отчет по столбцу **Количество**.  
  
### <a name="BKMK_Managed_Heap_tree__Snapshot_diff_"></a> Дерево "Управляемая куча" (разница между снимками)  
 Дерево **Управляемая куча** перечисляет типы объектов, которые хранятся в памяти. Вы можете развернуть имя типа, чтобы просмотреть десять самых крупных экземпляров этого типа, отсортированных по размеру. При выборе типа или экземпляра отображаются деревья **Пути к корню** и **Объекты, на которые указывает ссылка** для выбранного элемента.  
  
 ![Дерево "Управляемая куча" для типа в отчете о различиях](../profiling/media/memuse-snapshotdiff-type-heap.png "MEMUSE_SnapshotDiff_Type_Heap")  
  
 Обратите внимание, что столбцы **Количество**, **Размер (байт)** и **Инклюзивный размер (байт)** на изображении свернуты.  
  
|||  
|-|-|  
|**Тип объекта**|Имя типа или экземпляра объекта.|  
|**Количество**|Число экземпляров типа в основном снимке. Для экземпляра **Количество** всегда равно 1.|  
|**Разница количества**|Для типа разница в количестве экземпляров типа между основным и предыдущим снимками. Для экземпляра это поле отображается пустым.|  
|**Размер (байт)**|Размер объектов в основном снимке без учета размера объектов, содержащихся в этих объектах. Для типа **Размер (байт)** и **Инклюзивный размер (байт)**  — это общие размеры экземпляров типа.|  
|**Разница общего размера (байт)**|Для типа — это разница в общем размере экземпляров типа между основным снимком и предыдущим снимком без учета размера объектов, содержащихся в этих экземплярах. Для экземпляра это поле отображается пустым.|  
|**Инклюзивный размер (байт)**|Размер объектов в основном снимке с учетом размера объектов, содержащихся в этих объектах.|  
|**Разница инклюзивного размера (байт)**|Для типа — это разница в размере всех экземпляров типа между основным снимком и предыдущим снимком с учетом размера объектов, содержащихся в этих объектах. Для экземпляра это поле отображается пустым.|  
  
### <a name="BKMK_Paths_to_Root_tree__Snapshot_diff_"></a> Дерево "Пути к корню" (разница между снимками)  
 Дерево **Пути к корню** показывает цепочку объектов, ссылающихся на тип или экземпляр. Сборщик мусора .NET Framework очищает память для объекта только после освобождения всех ссылок на него.  
  
 ![Пути к корневому дереву для экземпляров в представлении diff](../profiling/media/memuse-snapshotdiff-pathstoroot-instance-all.png "MEMUSE_SnapshotDiff_PathsToRoot_Instance_All")  
  
### <a name="BKMK_Referenced_Objects_tree__Snapshot_diff_"></a> Дерево "Объекты, на которые указывает ссылка" (разница между снимками)  
 Дерево **Объекты, на которые указывает ссылка** показывает объекты, на которые ссылается основной тип или экземпляр.  
  
 ![Обжжектс дерево ссылок для экземпляров](../profiling/media/memuse-snapshotdetails-referencedobjects-instance.png "MEMUSE_SnapshotDetails_ReferencedObjects_Instance")  
  
|||  
|-|-|  
|**Тип объекта/экземпляр**|Имя типа или экземпляра объекта.|  
|**Размер (байт)**|Для экземпляра — это размер объекта в основном снимке без учета размера объектов, содержащихся в этом экземпляре.<br /><br /> Для типа — это общий размер экземпляров типа в основном снимке без учета размера объектов, содержащихся в этом экземпляре.|  
|**Инклюзивный размер (байт)**|Размер объектов в основном снимке с учетом размера объектов, содержащихся в этих объектах.|  
  
## <a name="see-also"></a>См. также  
 [Память JavaScript](../profiling/javascript-memory.md)   
 [Анализ производительности приложений](https://msdn.microsoft.com/library/58acb30b-8428-41a6-b195-b0fdedb89575)   
 [Запуск средств анализа производительности](https://msdn.microsoft.com/library/788279d8-f56b-40a0-9bef-facc3dfba471)   
 [Рекомендации по повышению производительности приложений Магазина Windows на C++, C# и Visual Basic](https://msdn.microsoft.com/library/windows/apps/hh750313.aspx)   
 [Diagnosing memory issues with the new Memory Usage Tool in Visual Studio](https://go.microsoft.com/fwlink/p/?LinkId=394706) (Диагностика проблем, связанных с памятью, с помощью нового средства "Использование памяти" в Visual Studio)
