---
title: Использование GPU | Документы Майкрософт
ms.date: 11/15/2016
ms.prod: visual-studio-dev14
ms.technology: vs-ide-debug
ms.topic: conceptual
ms.assetid: 957fed3c-4ded-4e05-87c6-ccc33de65349
caps.latest.revision: 7
author: MikeJo5000
ms.author: mikejo
manager: jillfra
ms.openlocfilehash: b2e827b180ae218f3dd42b124500e01260e72d82
ms.sourcegitcommit: bad28e99214cf62cfbd1222e8cb5ded1997d7ff0
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 11/21/2019
ms.locfileid: "74297393"
---
# <a name="gpu-usage"></a>Использование GPU
[!INCLUDE[vs2017banner](../includes/vs2017banner.md)]

Используйте инструмент учета использования GPU в концентраторе производительности и диагностики Visual Studio, чтобы получить более полное представление о высокоуровневом использовании оборудования в вашем приложении Direct3D. С его помощью можно определить, привязана ли производительность приложения к ЦП или GPU, и понять, как более эффективно использовать оборудование платформы. Инструмент учета использования GPU поддерживает приложения, использующие Direct3D 12, Direct3D 11 и Direct3D 10 и не поддерживает другие графические API, например Direct2D или OpenGL.  
  
 Это окно **GPU Usage Report** (Отчет об использовании GPU):  
  
 ![The GPU Usage report, with CPU and GPU timelines](../debugger/media/gfx-diag-gpu-usage-report.png "gfx_diag_gpu_usage_report")  
  
## <a name="requirements"></a>Требования  
 Ниже приведены требования по использованию инструмента учета использования GPU, дополняющие требования по диагностике графики.  
  
- GPU и драйвер, поддерживающие необходимое инструментирование синхронизации.  
  
  > [!NOTE]
  > Дополнительные сведения о поддерживаемых драйверах и оборудовании см. в разделе [Поддерживаемые драйвера и оборудование](#hwsupport) в конце этого документа.  
  
  Дополнительные сведения о требованиях по диагностике графики см. в разделе [Приступая к работе](../debugger/getting-started-with-visual-studio-graphics-diagnostics.md).  
  
## <a name="using-the-gpu-usage-tool"></a>Работа с инструментом учета использования GPU  
 При запуске приложения под управлением инструмента учета использования GPU система Visual Studio создает сеанс диагностики, выводящий высокоуровневую информацию о производительности отрисовки приложения и использовании GPU в режиме реального времени.  
  
#### <a name="to-start-the-gpu-usage-tool"></a>Запуск инструментом учета использования GPU:  
  
1. В главном меню выберите **Отладка**, затем **Производительность и диагностика** (сочетание клавиш на клавиатуре: ALT+F2).  
  
2. В концентраторе "Производительность и диагностика" установите флажок **Использование GPU**. При необходимости установите флажки для других интересующих вас инструментов. Можно одновременно запустить несколько инструментов производительности и диагностики, чтобы получить более полное представление о производительности приложения.  
  
    ![Choose the diagnostic tools you want to use.](../debugger/media/gfx-diag-diagsession-tools.png "gfx_diag_diagsession_tools")  
  
   > [!NOTE]
   > Не все инструменты производительности и диагностики можно использовать одновременно.  
  
3. Нажмите синюю кнопку **Пуск** в нижней части концентратора "Производительность и диагностика", чтобы запустить приложение под управлением выбранных инструментов.  
  
   Высокоуровневые сведения, отображаемые в режиме реального времени, включает в себя синхронизацию кадров, частоту кадров и уровень использования GPU. Все эти элементы информации отображаются независимо друг от друга, однако используется общая шкала времени, чтобы можно было легко найти связь между ними.  
  
   Графики **Frame time (ms)** (Время кадра (мс)) и **Frames per second (FPS)** (Кадров в секунду (кадров/с)) содержат две красные горизонтальные линии, представляющие целевые показатели производительности для 60 и 30 кадров в секунду. На графике **Время кадра** приложение превышает целевой показатель производительности, когда график проходит под линией, и не достигает его, когда график проходит над линией. На графике числа кадров в секунду действует обратный принцип — приложение превышает целевой показатель производительности, когда график проходит над линией, и не достигает его, когда график проходит под линией. В основном эти графики используются для получения общего представления о производительности приложения и выявления замедлений в работе, которые может потребоваться проверить, например, неожиданного падения частоты кадров или пика загрузки GPU.  
  
   Во время выполнения приложения под управлением инструмента учета использования GPU сеанс диагностики также собирает подробные сведения о событиях графики, которые были обработаны GPU. Эта информация используется для создания более детального отчета об использовании оборудования приложением. Поскольку создание этого отчета занимает некоторое время, его можно просмотреть только после завершения сбора информации в рамках сеанса диагностики.  
  
   Если вы хотите подробнее рассмотреть проблему производительности или использования, остановите сбор сведений о производительности, чтобы дать системе возможность создать требуемый отчет.  
  
#### <a name="to-generate-and-view-the-gpu-usage-report"></a>Создание и просмотр отчета об использовании GPU:  
  
1. В нижней части окна сеанса диагностики выберите ссылку **Остановка сбора** или нажмите кнопку **Остановить** в верхнем левом углу.  
  
    ![Collect GPU and CPU timing information.](../debugger/media/gfx-diag-gpu-usage-collect.png "gfx_diag_gpu_usage_collect")  
  
2. В верхней части отчета выберите часть одного из графиков, где изображена соответствующая проблема. Выбранный фрагмент может иметь длину до 3 секунд, более длинные фрагменты усекаются с конца.  
  
    ![Post&#45;collection, select a range to view details](../debugger/media/gfx-diag-gpu-usage-select1.png "gfx_diag_gpu_usage_select1")  
  
3. В нижней части отчета выберите ссылку **view details** (Просмотр сведений) в сообщении **…click here to view details of GPU usage for that range** (Щелкните для просмотра сведений об использовании GPU для этого диапазона) для просмотра подробной временной шкалы выделенного фрагмента.  
  
    ![Post&#45;collection, with range selected](../debugger/media/gfx-diag-gpu-usage-select2.png "gfx_diag_gpu_usage_select2")  
  
   Открывается новый документ с вкладками, содержащий отчет. Отчет об использовании GPU помогает определить, когда событие графики было запущено на ЦП, когда оно достигло GPU и сколько времени потребовалось GPU для его выполнения. Эти сведения помогают выявить узкие места и возможности для повышения уровня параллелизма в коде.  
  
## <a name="using-the-gpu-usage-report"></a>Работа с отчетом об использовании GPU  
 В верхней части отчета об использовании GPU отображаются временные шкалы для операций обработки ЦП, операций отрисовки GPU и операций копирования ЦП. Эти временные шкалы разделены светло-серыми вертикальными полосами, представляющими вертикальную синхронизацию дисплея; частота полос соответствует частоте обновления одного из дисплеев (выбранного в раскрывающемся списке **Дисплей**), для которого были собраны данные об использовании GPU. Поскольку частота обновления дисплея может превышать целевой показатель производительности, прямая зависимость вертикальной синхронизации и частоты кадров, которой должно достичь приложение, может отсутствовать. Чтобы достичь целевого показателя производительности, приложение должно завершить всю обработку, осуществить отрисовку и выполнить вызов Present() с целевой частотой кадров, однако отрисованный кадр не будет отображаться до выполнения следующей после Present() вертикальной синхронизации.  
  
 В нижней части отображается список событий графики, возникших за охваченный в отчете период времени.  
  
 Это окно **отчета об использовании GPU**:  
  
 ![The GPU Usage report, with CPU and GPU timelines](../debugger/media/gfx-diag-gpu-usage-report.png "gfx_diag_gpu_usage_report")  
  
 При выборе одного из событий в нижней части отчета маркер помещается на связанные события соответствующих временных шкал, обычно это одно событие в потоке ЦП, которые представляет вызов API, и другое событие на одной из временных шкал GPU, представляющее выполнение задачи GPU. Аналогичным образом, при выборе одного из событий на временной шкале выделяется соответствующее событие в нижней части отчета. При уменьшении масштаба временных шкал в верхней части отчета остаются видимыми только наиболее продолжительные события. Чтобы просмотреть более кратковременные события, увеличьте масштаб временных шкал, нажав клавишу CTRL и вращая колесико указывающего устройства либо воспользовавшись элементом управления масштабирования в левом нижнем углу верхней панели. Можно также перетаскивать содержимое панели временных шкал для перемещения по записанным событиям.  
  
 Чтобы упростить поиск нужных данных, можно отфильтровать отчет об использовании GPU по именам процессов, идентификаторам потоков и именам событий. Кроме того, можно указать, частота обновления какого дисплея определяет линии вертикальной синхронизации, и отсортировать события по уровням иерархии, если ваше приложение использует интерфейс ID3DUserDefinedAnnotation для группировки команд отрисовки.  
  
 Ниже приведены дополнительные сведения:  
  
|Элемент управления фильтра|Описание|  
|--------------------|-----------------|  
|**Process**|Имя процесса, который вас интересует. В этот раскрывающийся список включаются все процессы, использовавшие GPU во время сеанса диагностики. Цвет, связанный с процессом в этом раскрывающемся списке, является цветом операций потока на приведенных ниже временных шкалах.|  
|**Поток**|Идентификатор потока, который вас интересует. В многопоточном приложении это может помочь изолировать определенные потоки, относящиеся к интересующему вас процессу. События, связанные с выбранным потоком, выделяются на каждой временной шкале.|  
|**Дисплей**|Номер дисплея, для которого отображается частота обновления. **Примечание**. Некоторые драйверы можно настроить для представления нескольких физических дисплеев в качестве одного большого виртуального дисплея. Может отображаться только один дисплей, даже если к компьютеру подключено несколько дисплеев.|  
|**Фильтр**|Ключевые слова, которые вас интересуют. В нижней части отчета будут отображаться только те события, которые полностью или частично соответствуют ключевому слову. Можно указать несколько ключевых слов, разделяя их точкой с запятой (;).|  
|**Иерархическая сортировка**|Флажок, указывающий, сохраняются или игнорируются иерархии событий, определенные с помощью пользовательских маркеров.|  
  
 Список событий в нижней части отчета об использовании GPU содержит сведения о каждом событии.  
  
|Столбец|Описание|  
|------------|-----------------|  
|**Имя события**|Имя события графики. Событие обычно соответствует одному событию на временной шкале потоков ЦП и одному событию на временной шкале GPU.<br /><br /> Имена событий могут быть неопределенными, если инструменту учета использования GPU не удалось определить имя события. Дополнительные сведения см. в примечаниях под этой таблицей.|  
|**Начало ЦП (нс)**|Время инициирования события на ЦП путем вызова API Direct3D. Время измеряется в наносекундах и отсчитывается относительно момента запуска приложения.|  
|**Начало GPU (нс)**|Время инициирования события в GPU. Время измеряется в наносекундах и отсчитывается относительно момента запуска приложения.|  
|**Длительность GPU (нс)**|Время в наносекундах, которое потребовалось для завершения события в GPU.|  
|**Имя процесса**|Имя приложения, из которого пришло событие.|  
|**Идентификатор потока**|Идентификатор потока, из которого пришло событие.|  
  
> [!IMPORTANT]
> Для определения событий требуется операционная система Windows 8.1. Кроме того, если GPU или драйвер не поддерживают необходимые функции инструментирования, все события будут отображаться как неопределенные. В случае возникновения этой проблемы обязательно обновите драйвер GPU и повторите попытку. Дополнительные сведения см. в разделе [Поддержка оборудования и драйверов](#hwsupport) ниже.  
  
## <a name="gpu-usage-settings"></a>Параметры инструмента учета использования GPU  
 В инструменте учета использования GPU можно настроить отложенный сбор данных профилирования, чтобы не начинать сбор сведений о сразу после запуска приложения. Поскольку данные профилирования могут иметь значительный объем, бывает полезно знать, что снижения производительности приложения регистрируются лишь с недавнего времени.  
  
#### <a name="to-postpone-profiling-from-the-start-of-the-app"></a>Чтобы отложить профилирование относительно запуска приложения, выполните следующие действия:  
  
1. В главном меню выберите **Отладка**, затем **Производительность и диагностика** (сочетание клавиш на клавиатуре: ALT+F2).  
  
2. В концентраторе "Производительность и диагностика" выберите ссылку **параметры** рядом с элементом **Использование GPU**.  
  
3. В области **GPU Profiling Configuration** (Конфигурация профилирования GPU) страницы свойств **Общие** снимите флажок **Begin profiling at app start** (Начать профилирование с момента запуска приложения), чтобы отложить профилирование.  
  
     ![Configure when GPU Usage collection starts](../debugger/media/gfx-diag-gpu-usage-config.png "gfx_diag_gpu_usage_config")  
  
> [!IMPORTANT]
> В настоящее время откладывание профилирования не поддерживается для приложений Direct3D 12.  
  
 Когда вы используете данный параметр, чтобы отложить сбор данных профилирования, в нижней части окна инструмента учета использования GPU становится доступной дополнительная ссылка при запуске приложения под управлением этого инструмента. Чтобы начать сбор данных профилирования, выберите ссылку **Start** (Запуск) в сообщении **Start collecting additional detailed GPU Usage Data** (Запуск сбора дополнительных подробных данных об использовании GPU).  
  
## <a name="hwsupport"></a> Поддержка оборудования и драйверов  
 Поддерживаются следующие драйверы и оборудование GPU:  
  
|Vendor|Описание GPU|Требуемая версия драйвера|  
|------------|---------------------|-----------------------------|  
|Intel®|Процессоры Intel® четвертого поколения («Haswell»)<br /><br /> - Intel® HD Graphics (GT1)<br />- Intel® HD Graphics 4200 (GT2)<br />- Intel® HD Graphics 4400 (GT2)<br />- Intel® HD Graphics 4600 (GT2)<br />- Intel® HD Graphics P4600 (GT2)<br />- Intel® HD Graphics P4700 (GT2)<br />- Intel® HD Graphics 5000 (GT3)<br />- Intel® Iris™ Graphics 5100 (GT3)<br />- Intel® Iris™ Pro Graphics 5200 (GT3e)|-- (используйте самые последние версии драйверов)|  
|AMD®|Большинство продуктов, выпущенных после серии AMD Radeon™ HD 7000-series (кроме AMD Radeon™ HD 7350-7670)<br /><br /> AMD Radeon™ GPU, AMD FirePro™ GPU и акселераторы AMD FirePro GPU на базе архитектуры Graphics Core Next (GCN).<br /><br /> Гибридные процессоры (Accelerated Processing Unit — APU) AMD® E-Series и AMD A-series на базе архитектуры Graphics Core Next (GCN) («Kaveri», «Kabini», «Temash», «Beema», «Mullins»)|14.7 RC3 или выше|  
|NVIDIA®|Большинство продуктов, выпущенных после серии NVIDIA® GeForce® 400-series.<br /><br /> NVIDIA® GeForce® GPU, NVIDIA Quadro® GPU и акселераторы NVIDIA® Tesla™ GPU на базе архитектуры Fermi™, Kepler™ или Maxwell™.|343.37 или выше|  
  
 В настоящее время не поддерживаются конфигурации с несколькими GPU, такие как NVIDIA® SLI™ и AMD Crossfire™. Средства настройка гибридной графики, например NVIDIA® Optimus™ и AMD Enduro™, поддерживаются.  
  
## <a name="see-also"></a>См. также  
  
- [Решения сложных проблем с графикой в игре с помощью инструментов DirectX (видео)](https://channel9.msdn.com/Events/GDC/GDC-2015/Solve-the-Tough-Graphics-Problems-with-your-Game-Using-DirectX-Tools)  
  
- [Средство использования GPU в Visual Studio (видео)](https://channel9.msdn.com/Events/Visual-Studio/Connect-event-2014/715)  
  
- [Средство использования GPU в Visual Studio 2013 с обновлением 4, CTP-версия 1 (блог)](https://devblogs.microsoft.com/cppblog/gpu-usage-tool-in-visual-studio-2013-update-4-ctp1/)  
  
- [Использование GPU для DirectX в Visual Studio (блог)](https://blogs.msdn.microsoft.com/ianhu/2014/12/16/gpu-usage-for-directx-in-visual-studio/)
