---
title: Пошаговое руководство. Отладка многопоточных приложений | Документация Майкрософт
ms.date: 11/15/2016
ms.prod: visual-studio-dev14
ms.technology: vs-ide-debug
ms.topic: conceptual
dev_langs:
- FSharp
- VB
- CSharp
- C++
helpviewer_keywords:
- multithreaded debugging, walkthrough
- walkthroughs, multithreaded debugging
ms.assetid: 590ffd57-0556-43d8-8962-ee27e5b2b7d7
caps.latest.revision: 42
author: MikeJo5000
ms.author: mikejo
manager: jillfra
ms.openlocfilehash: 33ce391523a256bcb195deccf0c14868b5eae707
ms.sourcegitcommit: 08fc78516f1107b83f46e2401888df4868bb1e40
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 05/15/2019
ms.locfileid: "65683085"
---
# <a name="walkthrough-debugging-a-multithreaded-application"></a>Пошаговое руководство. Отладка многопоточных приложений
[!INCLUDE[vs2017banner](../includes/vs2017banner.md)]

[!INCLUDE[vs_dev11_long](../includes/vs-dev11-long-md.md)] предоставляет улучшенное **потоков** окна и других пользовательского интерфейса усовершенствования для упрощения отладки многопоточных приложений. Выполнение данного пошагового руководства занимает лишь несколько минут, но оно позволит ознакомиться с новыми возможностями интерфейса для отладки многопоточных приложений.  
  
 Чтобы начать работу с данным пошаговым руководством, необходим проект многопоточного приложения. Выполните следующие действия для создания этого проекта.  
  
#### <a name="to-create-the-walkthrough-project"></a>Чтобы создать проект для пошагового руководства  
  
1. На **файл** меню, выберите **New** и нажмите кнопку **проекта**.  
  
     Откроется диалоговое окно **Новый проект** .  
  
2. В **тип проекта**s см. в удобном для вас языке: **Visual Basic**, **Visual C#** , или **Visual C++**.  
  
3. В **шаблоны** выберите **консольное приложение** или **консольное приложение CLR**.  
  
4. В **имя** введите имя MyThreadWalkthroughApp поле.  
  
5. Нажмите кнопку **ОК**.  
  
     Появится новый проект консольного приложения. Когда проект будет создан, откроется файл исходного кода. В зависимости от выбранного языка файл исходного кода может называться Module1.vb, Program.cs или MyThreadWalkthroughApp.cpp  
  
6. Удалите код, который отображается в исходном файле и замените его кодом примера, который отображается в разделе «Создание потока» раздела [создание потоков и передача данных во время запуска](https://msdn.microsoft.com/library/52b32222-e185-4f42-91a7-eaca65c0ab6d).  
  
7. В меню **Файл** выберите команду **Сохранить все**.  
  
#### <a name="to-begin-the-walkthrough"></a>Чтобы начать работу над пошаговым руководством  
  
- В окне исходного кода найдите следующий код:  
  
    ```vb  
    Thread.Sleep(3000)   
    Console.WriteLine(  
    ```  
  
```csharp  
Thread.Sleep(3000);  
Console.WriteLine();  
```  
  
```cpp  
Thread::Sleep(3000);  
Console.WriteLine();  
```  
  
#### <a name="to-start-debugging"></a>Начало отладки  
  
1. Щелкните правой кнопкой мыши `Console.WriteLine` инструкции, пункты **точки останова** и нажмите кнопку **вставить точку останова**.  
  
     В левом переплете окна исходного кода появится красный шар. Это означает, что точка останова установлена в этом месте.  
  
2. В меню **Отладка** щелкните **Начать отладку**.  
  
     Начнется отладка, консольное приложение запустится и прервется на точке останова.  
  
3. Если в этот момент фокус находится на окне консольного приложения, щелкните окно [!INCLUDE[vsprvs](../includes/vsprvs-md.md)] для возвращения фокуса в [!INCLUDE[vsprvs](../includes/vsprvs-md.md)].  
  
4. В окне исходного кода найдите строку, содержащую следующий код:  
  
    ```vb  
    Thread.Sleep(5000)   
    ```  
  
```csharp  
Thread.Sleep(3000);  
```  
  
```cpp  
Thread::Sleep(3000);  
```  
  
1. 
  
#### <a name="to-discover-the-thread-marker"></a>Чтобы обнаружить маркер потока  
  
1. Щелкните правой кнопкой мыши в **потоков** окно, нажмите кнопку **Показать потоки в исходном коде**.  
  
2. Посмотрите на переплет в левой части окна. На этой строке появится значок, похожий на 2 тряпичных нити. Одна нить красного цвета, другая — синего. маркер потока указывает, что некий поток остановлен в этом месте. Возможно, в данном месте остановлен наш поток.  
  
3. Наведите указатель мыши на маркер потока. Появится всплывающая подсказка. Подсказка сообщает имя и идентификационный номер каждого остановившегося тут потока. В нашем случае существует только один поток, имя которого, вероятно, `<noname>`.  
  
4. Щелкните правой кнопкой мыши маркер потока. Обратите внимание на варианты выбора в контекстном меню.  
  
   Этот значок — *маркер потока*:  
  
   ![Маркер потока](../debugger/media/threadmarker.gif "ThreadMarker")  
  
## <a name="flagging-and-unflagging-threads"></a>Пометка потоков и ее снятие  
 В [!INCLUDE[vs_orcas_long](../includes/vs-orcas-long-md.md)] можно пометить поток, которому следует уделить особое внимание. Пометка потоков — хороший способ отслеживать более важные потоки и игнорировать менее важные.  
  
#### <a name="to-flag-threads"></a>Чтобы пометить потоки  
  
1. На **представление** последовательно выберите пункты **панелей инструментов**.  
  
     Убедитесь, что **место отладки** выбранных инструментов.  
  
2. Перейдите к **место отладки** панели инструментов и щелкните **потоков** списка.  
  
    > [!NOTE]
    > Эта панель инструментов можно узнать по трем заметным спискам: **Процесс**, **потоков**, и **кадра стека**.  
  
3. Обратите внимание, сколько потоков отображается в списке.  
  
4. Вернитесь к окно исходного кода и щелкните правой кнопкой мыши **потоков** маркера еще раз.  
  
5. В контекстном меню пункты **флаг**и затем щелкните имя потока и Идентификационный номер.  
  
6. Вернитесь к **место отладки** панели инструментов и щелкните **потоков** еще раз список.  
  
     Теперь в списке отображаются только отмеченные потоки. Кнопка флага находится справа от **потоков** списка. Значок флага на кнопке ранее был тусклым. Теперь у него ярко–красная окраска.  
  
7. Наведите указатель мыши на значок флага.  
  
     Появится всплывающее окно. Это всплывающее окно сообщает, какой режим **потоков** список отсортирован по: **Показывать только отмеченные потоки**.  
  
8. Нажмите кнопку флага для переключения обратно в **Показывать все потоки** режим.  
  
9. Нажмите кнопку **потоков** еще раз список и убедитесь, что теперь снова отображаются все потоки.  
  
10. Нажмите кнопку флага для переключения обратно в **Показывать только отмеченные потоки**.  
  
11. В меню **Отладка** выберите пункт **Окна** и затем щелкните **Потоки**.  
  
     **Потоков** появится окно. К одному потоку прикреплен заметный значок флага.  
  
12. В окне исходного кода щелкните правой кнопкой мыши маркер потока еще раз.  
  
     Обратите внимание, какие варианты сейчас доступны в контекстном меню. Вместо **флаг**, после этого появится **снять отметку**. Не нажимайте кнопку **снять отметку**.  
  
13. Перейдите к следующему шагу — как снять отметку с потока.  
  
#### <a name="to-unflag-threads"></a>Чтобы снять отметку с потока  
  
1. На **потоков** окно, щелкните правой кнопкой мыши строку, соответствующую отмеченному потоку.  
  
     Появится контекстное меню. Она имеет параметры для **снять отметку** и **снять все отметки**.  
  
2. Чтобы снять отметку с потока, нажмите кнопку **снять отметку**.  
  
3. Щелкните значок красного флажка.  
  
4. Рассмотрим **место отладки** инструментов еще раз. Кнопка флага снова стала тусклой. Вы сняли отметку с только что отмеченного потока. Поскольку отсутствуют отмеченные потоки, панель инструментов вернулась в **Показывать все потоки** режим. Нажмите кнопку **потоков** список и убедитесь, что отображаются все потоки.  
  
5. Вернитесь к **потоков** окна и просмотрите колонки сведений.  
  
     В верхней части каждой колонки большая часть кнопок имеет заголовки, которые идентифицируют колонку. Однако первый столбец слева не имеет заголовка. Вместо этого он имеет значок, являющийся контуром флага. Можно заметить тот же контур в каждой строке списка потоков. Контур означает, что поток не отмечен.  
  
6. Щелкните контуры флагов у двух потоков, второго и третьего снизу в списке.  
  
     Вместо контуров будут отображаться значки красных флагов.  
  
7. Нажмите кнопку в заголовке колонки флагов.  
  
     Порядок в списке потоков изменился, когда была нажата кнопка. Список потоков теперь отсортирован так, что отмеченные потоки располагаются в верху списка.  
  
8. Снова нажмите кнопку в заголовке колонки флагов.  
  
     Порядок сортировки изменился еще раз.  
  
## <a name="more-about-the-threads-window"></a>Дополнительные сведения об окне "Потоки"  
  
#### <a name="to-learn-more-about-the-threads-window"></a>Чтобы получить дополнительные сведения об окне "Потоки"  
  
1. В **потоков** окне просмотрите третий столбец слева. Кнопка в верхней части этого столбца называется **идентификатор**.  
  
2. Нажмите кнопку **идентификатор**.  
  
     Теперь список потоков отсортирован по идентификатору потока.  
  
3. Щелкните правой кнопкой мыши любой поток в списке. В контекстном меню, щелкните **Шестнадцатеричный вывод**.  
  
     Формат идентификаторов потоков изменился.  
  
4. Наведите указатель мыши на любой поток в списке.  
  
     После небольшой задержки появится Подсказка Данных. Она отображает частичный стек вызова для этого потока.  
  
5. Просмотрите четвертый столбец слева, который обозначается **категории**. Потоки делятся на категории.  
  
     Первый поток, созданный в процессе, называется "основной поток". Найдите его в списке потоков.  
  
6. Щелкните правой кнопкой мыши основной поток, а затем нажмите кнопку **переключиться на поток**.  
  
     Появится диалоговое окно с предупреждением. Оно сообщает, что [!INCLUDE[vsprvs](../includes/vsprvs-md.md)] не может отобразить исходный код для основного потока.  
  
     Нажмите кнопку **ОК**.  
  
7. Рассмотрим **стек вызовов** окна и **место отладки** панели инструментов.  
  
     Содержание **стек вызовов** окна были изменены.  
  
## <a name="switching-the-active-thread"></a>Переключение активного потока  
  
#### <a name="to-switch-threads"></a>Чтобы переключаться между потоками  
  
1. В **потоков** окне просмотрите второй столбец слева. Кнопка в верхней части этого столбца не содержит текста или значка. Этот столбец содержит **активный поток** столбца.  
  
2. Рассмотрим **активного потока** столбца и обратите внимание, что у одного потока есть желтая стрелка. Это *индикатор активного потока*.  
  
3. Запишите идентификатор потока, на котором установлен индикатор активного потока. Индикатор активного потока будет перемещен на другой поток, но после завершения его необходимо будет вернуть.  
  
4. Щелкните правой кнопкой мыши другой поток, а затем нажмите кнопку **переключиться на поток**.  
  
5. Рассмотрим **стек вызовов** окна в окне исходного кода. Его содержимое изменилось.  
  
6. Рассмотрим **место отладки** панели инструментов. Здесь активный поток тоже был изменен.  
  
7. Перейдите к **место отладки** панели инструментов. Нажмите кнопку **поток** поле и выберите другой поток из раскрывающегося списка.  
  
8. Рассмотрим **потоков** окна. Здесь изменился индикатор активного потока.  
  
9. В окне исходного кода щелкните правой кнопкой мыши маркер потока. В контекстном меню пункты **переключиться в режим** и щелкните имя/идентификатор потока.  
  
     Было рассмотрено три способа изменения активного потока: с помощью **потоков** окне **поток** поле **место отладки** панели инструментов, а также индикатора потока в окне исходного кода.  
  
     С помощью индикатора потока можно переключаться только на потоки, остановленные в этом конкретном расположении. С помощью окна **Потоки** и панели инструментов **Место отладки** можно переключиться на любой поток.  
  
## <a name="freezing-and-thawing-thread-execution"></a>Замораживание и размораживание потоков  
  
#### <a name="to-freeze-and-unfreeze-threads"></a>Чтобы заморозить и разморозить потоки  
  
1. В **потоков** , щелкните правой кнопкой мыши любой поток и выберите пункт **закрепить**.  
  
2. Посмотрите на столбец "Активный поток". В нем появилась пара вертикальных полос. Эти две синие полосы указывают, что поток заморожен.  
  
3. Рассмотрим **Suspend** столбца. Счетчик приостановки для потока теперь имеет значение 1.  
  
4. Щелкните правой кнопкой мыши замороженный поток, а затем нажмите кнопку **Разморозить**.  
  
     Столбец активных потоков и **Suspend** изменение столбца.  
  
## <a name="see-also"></a>См. также  
 [Отладка многопоточных приложений](../debugger/debug-multithreaded-applications-in-visual-studio.md)   
 [Практическое руководство. Переключение на другой поток при отладке](../debugger/how-to-switch-to-another-thread-while-debugging.md)
