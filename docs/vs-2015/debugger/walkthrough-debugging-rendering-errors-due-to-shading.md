---
title: Пошаговое руководство. Отладка ошибок из-за заливки отрисовки | Документация Майкрософт
ms.date: 11/15/2016
ms.prod: visual-studio-dev14
ms.technology: vs-ide-debug
ms.topic: conceptual
ms.assetid: 01875b05-cc7b-4add-afba-f2b776f86974
caps.latest.revision: 17
author: MikeJo5000
ms.author: mikejo
manager: jillfra
ms.openlocfilehash: b4c158c4ce6762b69f73a55915cc459f84cd7fff
ms.sourcegitcommit: 94b3a052fb1229c7e7f8804b09c1d403385c7630
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/23/2019
ms.locfileid: "68183596"
---
# <a name="walkthrough-debugging-rendering-errors-due-to-shading"></a>Пошаговое руководство. Отладка ошибок отрисовки, возникающих из-за заливки
[!INCLUDE[vs2017banner](../includes/vs2017banner.md)]

В данном пошаговом руководстве показано, как с помощью средств диагностики графики [!INCLUDE[vsprvs](../includes/vsprvs-md.md)] исследовать объект, который имеет неверный цвет из-за ошибки шейдера.  
  
 В этом пошаговом руководстве показывается:  
  
- Проанализируйте документ журнала графики, чтобы определить пиксели, которые указывают на проблему.  
  
- Использование окна **Журнал пикселей графики** для более подробного изучения состояния пикселей.  
  
- Использование **отладчика HLSL** для изучения построителей текстур и шейдеров вершин.  
  
## <a name="scenario"></a>Сценарий  
 Неверное окрашивание объектов часто возникает, когда шейдер вершин передает неверные или неполные данные в построитель текстуры.  
  
 В этом случае объект недавно добавлен в приложение вместе с новыми шейдером вершин и построителем текстур для преобразования объекта и придания ему уникального внешнего вида. При запуске приложения во время теста объект окрашивается сплошным черным цветом. С помощью диагностики графики можно записать данные о проблеме в журнал графики, чтобы можно было выполнить отладку приложения. Проблема в приложении выглядит следующим образом:  
  
 ![Объект выводится с неправильными цветами. ](../debugger/media/gfx-diag-demo-render-error-shader-problem.png "gfx_diag_demo_render_error_shader_problem")  
  
## <a name="investigation"></a>Исследование  
 С помощью средств диагностики графики можно загрузить документ журнала графики для проверки кадров, захваченных в ходе теста.  
  
#### <a name="to-examine-a-frame-in-a-graphics-log"></a>Анализ кадра в журнале графики  
  
1. В [!INCLUDE[vsprvs](../includes/vsprvs-md.md)]загрузите журнал графики, содержащий кадр, на котором видно, что модель отсутствует. В [!INCLUDE[vsprvs](../includes/vsprvs-md.md)]откроется новое окно документа журнала графики. В верхней части этого окна находится вывод целевого объекта отрисовки для выбранного кадра. В нижней части находится **Список кадров**, в котором каждый захваченный кадр отображается как эскиз.  
  
2. В **списке кадров**выберите кадр, на котором объект имеет неправильный внешний вид. Однобуферная прорисовка обновляется, и в ней отображается выбранный кадр. В этом сценарии окно документа журнала графики выглядит следующим образом:  
  
    ![Документ журнала графики в Visual Studio. ](../debugger/media/gfx-diag-demo-render-error-shader-step-1.png "gfx_diag_demo_render_error_shader_step_1")  
  
   После выбора кадра, который демонстрирует проблему, можно воспользоваться окном **Журнал пикселей графики** для ее диагностики. Окно **Журнал пикселей графики** в хронологическом порядке показывает примитивы, которые могут влиять на определенный пиксель, шейдеры примитивов и влияние, которые примитивы могут оказывать на целевой объект отрисовки.  
  
#### <a name="to-examine-a-pixel"></a>Проверка пикселя  
  
1. Откройте окно **Журнал пикселей графики** . На панели инструментов **Диагностика графики** выберите **Журнал пикселей**.  
  
2. Выберите пиксель для изучения. В окне документа журнала графики выберите один из пикселей на неправильно окрашенном объекте:  
  
    ![При выборе пикселя отображается его журнал. ](../debugger/media/gfx-diag-demo-render-error-shader-step-2.png "gfx_diag_demo_render_error_shader_step_2")  
  
    Окно **журнала пикселей графики** будет обновлено, чтобы отразить выбранный пиксель. В этом случае окно **журнала пикселей графики** выглядит следующим образом.  
  
    ![В журнале пикселя показано одно событие DrawIndexed. ](../debugger/media/gfx-diag-demo-render-error-shader-step-3.png "gfx_diag_demo_render_error_shader_step_3")  
  
    Обратите внимание, что результат работы построителя текстуры — полностью непрозрачный черный цвет (0, 0, 0, 1) и что **средство слияния вывода** объединило его с **предыдущим** цветом пикселя таким образом, что итоговый **результат** — тоже полностью непрозрачный черный цвет.  
  
   После того как будет проверен неправильно окрашенный пиксель и обнаружено, что выходной цвет построителя текстуры не является ожидаемым, можно использовать отладчик HLSL, чтобы проверить построитель текстуры и узнать, что случилось с цветом объекта. Отладчик HLSL можно использовать для проверки состояния переменных HLSL при выполнении, пошагового выполнения кода HLSL и указания точек останова для помощи в диагностике проблемы.  
  
#### <a name="to-examine-the-pixel-shader"></a>Изучение построителя текстуры  
  
1. Начните отладку построителя текстуры. В окне **Журнал пикселей графики** в разделе примитива объекта рядом с **построителем текстуры**нажмите кнопку **Начать отладку** .  
  
2. В этом сценарии несложно заметить, что построитель текстуры не является источником проблемы, так как он просто передает цвет из шейдера вершин.  
  
3. Наведите указатель на `input.color`. Обратите внимание, что его значение — полностью непрозрачный черный (0, 0, 0, 1).  
  
    ![Член «color» объекта «input» черным. ](../debugger/media/gfx-diag-demo-render-error-shader-step-5.png "gfx_diag_demo_render_error_shader_step_5")  
  
    В этом сценарии анализ показывает, что неверный цвет, вероятно, является результатом работы шейдера вершин, который не предоставляет правильные сведения о цвете шейдеру пикселей, с которыми тот мог бы работать.  
  
   После того как вы определили, что шейдер вершин, вероятно, не предоставляет правильных сведений шейдеру пикселей, следующий шаг — проверить шейдер вершин.  
  
#### <a name="to-examine-the-vertex-shader"></a>Проверка шейдера вершин  
  
1. Запустите отладку шейдера вершин. В окне **Журнала пикселей графики** в разделе примитива объекта рядом с **шейдером вершин**нажмите кнопку **Начать отладку** .  
  
2. Найдите структуру выходных данных шейдера вершин — это входные данные для построителя текстуры. В этом сценарии эта структура называется `output`. Просмотрите код шейдера вершин и обратите внимание, что член `color` структуры `output` явно установлен в полностью непрозрачный черный, — возможно, в результате каких-либо действий по отладке.  
  
3. Убедитесь, что член цвета никогда не копируется из входной структуры. Поскольку значение `output.color` устанавливается в полностью непрозрачный черный непосредственно перед возвратом структуры `output` , имеет смысл убедиться, что значение `output` не было правильно инициализировано на предыдущей строке. Выполняйте пошагово код шейдера вершин, пока не достигнете строки, на которой `output.color` устанавливается в черный, и наблюдайте за значением `output.color`. Обратите внимание, что значение `output.color` не инициализируется до его установки в черный. Это подтверждает, что строка кода, которая устанавливает `output.color` в черный, должна быть изменена, а не удалена.  
  
    ![Значение «output.color» черным. ](../debugger/media/gfx-diag-demo-render-error-shader-step-7.png "gfx_diag_demo_render_error_shader_step_7")  
  
   После того как вы определили, что причиной проблемы отрисовки является то, что шейдер вершин не предоставляет правильное значение цвета шейдеру пикселей, можно переходить к устранению проблемы. В этом сценарии для этого необходимо изменить следующий код в шейдере вершин:  
  
```  
output.color = float3(0.0f, 0.0f, 0.0f);  
```  
  
 в  
  
```hlsl  
output.color = input.color;  
```  
  
 Этот код просто передает цвет вершины из вершин объекта без изменений, более сложные шейдеры вершин могут изменять цвет до его передачи. Исправленный код шейдера вершин должен выглядеть примерно так:  
  
 ![Исправленный код шейдера вершин. ](../debugger/media/gfx-diag-demo-render-error-shader-step-8.png "gfx_diag_demo_render_error_shader_step_8")  
  
 Внеся исправления в код, можно заново собрать его и еще раз запустить приложение, чтобы убедиться, что проблема с отрисовкой решена.  
  
 ![Объект выводится с правильными цветами. ](../debugger/media/gfx-diag-demo-render-error-shader-resolution.png "gfx_diag_demo_render_error_shader_resolution")
