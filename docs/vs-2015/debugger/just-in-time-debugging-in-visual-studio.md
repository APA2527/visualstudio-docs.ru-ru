---
title: JIT-отладка
ms.date: 11/15/2016
ms.prod: visual-studio-dev14
ms.technology: vs-ide-debug
ms.topic: conceptual
dev_langs:
- C++
- CSharp
- VB
helpviewer_keywords:
- debugging [Visual Studio], Just-In-Time
- Just-In-Time debugging
ms.assetid: 14972d5f-69bc-479b-9529-03b8787b118f
caps.latest.revision: 51
author: MikeJo5000
ms.author: mikejo
manager: jillfra
ms.openlocfilehash: ad2814dffa75809a318dc7cebe7831b5ecec7d29
ms.sourcegitcommit: 6cfffa72af599a9d667249caaaa411bb28ea69fd
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 09/02/2020
ms.locfileid: "65690597"
---
# <a name="just-in-time-debugging-in-visual-studio"></a>JIT-отладка в Visual Studio
[!INCLUDE[vs2017banner](../includes/vs2017banner.md)]

JIT-отладка запускает Visual Studio автоматически при возникновении исключения или сбоя в приложении, работающем за пределами Visual Studio. Это позволяет протестировать приложение, когда Visual Studio не выполняется, и начать отладку с помощью Visual Studio при возникновении проблемы.

JIT-отладка работает для классических приложений Windows. Он не работает для универсальных приложений Windows и не работает для управляемого кода, размещенного в собственном приложении, например в визуализаторах.

## <a name="did-the-just-in-time-debugger-dialog-box-appear-when-trying-to-run-an-app"></a><a name="BKMK_Scenario"></a> Появляется ли диалоговое окно JIT-отладчик при попытке запустить приложение?

Действия, которые необходимо выполнить при появлении диалогового окна JIT-отладчик Visual Studio, зависят от того, что вы пытаетесь сделать.

#### <a name="if-you-want-to-get-rid-of-the-dialog-box-and-just-run-the-app-normally"></a>Если вы хотите избавиться от диалогового окна и просто запустить приложение обычным образом

1. (Опытные пользователи) Если у вас установлен Visual Studio (или он был установлен ранее и удалил его), [Отключите JIT-отладку](#BKMK_Enabling) и попробуйте запустить приложение еще раз.

2. Если веб-приложение выполняется в Internet Explorer, отключите отладку скриптов.

    Отключить отладку скриптов в диалоговом окне "Свойства обозревателя". Доступ к этому средству можно получить из окна свойств сети и Интернета на **панели управления**  /  **Network and Internet**  /  **Internet Options** (конкретные действия зависят от используемой версии Windows и Internet Explorer).

    ![житинтернетоптионс](../debugger/media/jitinternetoptions.png "житинтернетоптионс")

3. Повторно откройте веб-страницу, где была обнаружена ошибка. Если проблема не устранена, обратитесь к владельцу веб-приложения, чтобы устранить проблему.

4. Если вы используете другой тип приложения Windows, необходимо обратиться к владельцу приложения, чтобы исправить ошибку, а затем переустановить исправленную версию приложения.

#### <a name="if-you-want-to-fix-or-debug-the-error-advanced-users"></a>Если вы хотите исправить или отладить ошибку (опытных пользователей)

- Необходимо [установить Visual Studio](https://visualstudio.microsoft.com/vs/older-downloads/) , чтобы просмотреть подробные сведения об ошибке и попытаться отладить ее. Подробные инструкции см. [в разделе Использование JIT](#BKMK_Using_JIT) . Если вы не можете устранить ошибку и исправить приложение, обратитесь к владельцу приложения, чтобы устранить ошибку.

## <a name="enable-or-disable-just-in-time-debugging"></a><a name="BKMK_Enabling"></a> Включение или отключение JIT-отладки
 Вы можете включить или отключить JIT-отладку в диалоговом окне " **Сервис/параметры** " Visual Studio.

#### <a name="to-enable-or-disable-just-in-time-debugging"></a>Включение или отключение JIT–отладки

1. Запустите Visual Studio. В меню **Сервис** выберите команду **Параметры**.

2. В диалоговом окне **Параметры** выберите папку **Отладка** .

3. В папке **Отладка** выберите страницу **JIT** .

4. В поле **включить JIT-отладку этих типов кода** выберите или отмените выбор соответствующих типов программ: **управляемый**, **машинный**или **Скрипт**.

    Чтобы отключить JIT–отладку, если она была включена, необходимы права администратора. Включение JIT–отладки устанавливает раздел реестра. Для его изменения требуются права администратора.

5. Нажмите кнопку **ОК**.

   JIT-отладка может оставаться включенной даже после удаления Visual Studio с компьютера. Если Visual Studio не установлена, вы не сможете отключить JIT-отладку из диалогового окна **Параметры** Visual Studio. В таком случае JIT-отладку можно отключить, отредактировав реестр Windows.

#### <a name="to-disable-just-in-time-debugging-by-editing-the-registry"></a>Отключение JIT-отладки путем редактирования реестра

1. В меню **Пуск** выполните поиск и выполните команду `regedit.exe`

2. В окне **редактора реестра** перейдите к разделу реестра и удалите следующие записи:

    - HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Windows NT\CurrentVersion\AeDebug\Debugger

    - HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\\.NETFramework\DbgManagedDebugger

3. Если компьютер работает под управлением 64-разрядной операционной системы, удалите также следующие записи реестра:

    - HKEY_LOCAL_MACHINE\SOFTWARE\Wow6432Node\Microsoft\Windows NT\CurrentVersion\AeDebug\Debugger

    - HKEY_LOCAL_MACHINE\SOFTWARE\Wow6432Node\Microsoft\\.NETFramework\DbgManagedDebugger

4. Будьте внимательны, чтобы случайно не удалить или не изменить какие-либо другие разделы реестра.

5. Закройте окно **Редактор реестра**.

> [!NOTE]
> Если вы пытаетесь отключить JIT-отладку для серверного приложения и эти действия не помогли устранить проблему, отключите отладку на стороне сервера в параметрах приложения IIS и повторите попытку.

#### <a name="to-enable-just-in-time-debugging-of-a-windows-form"></a>Включение JIT-отладки для приложений Windows Forms

1. По умолчанию для приложений Windows Forms имеется обработчик исключений верхнего уровня, позволяющий программе продолжать работу, если возможно восстановление после ошибки. Например, если приложение Windows Forms создает необработанное исключение, вы увидите диалоговое окно следующего вида:

     ![виндовсформсунхандледексцептион](../debugger/media/windowsformsunhandledexception.png "виндовсформсунхандледексцептион")

     Чтобы включить JIT-отладку Windows Forms приложения, необходимо выполнить следующие дополнительные действия:

2. Задайте `jitDebugging` значение `true` в `system.windows.form` разделе файла machine.config или *\<application name>*.exe.config:

    ```
    <configuration>
        <system.windows.forms jitDebugging="true" />
    </configuration>
    ```

3. Для приложений Windows Form, написанных на языке C++, в файле CONFIG или в коде должен быть задан атрибут `DebuggableAttribute`. Если компиляция выполняется с атрибутом [/Zi](https://msdn.microsoft.com/library/ce9fa7e1-0c9b-47e3-98ea-26d1a16257c8), но без [/Og](https://msdn.microsoft.com/library/d10630cc-b9cf-4e97-bde3-8d7ee79e9435), компилятор автоматически задаст этот атрибут. Однако если требуется отладка неоптимизированного построения выпуска, этот атрибут необходимо задать самостоятельно. Для этого добавьте следующую строку в файл AssemblyInfo.cpp своего приложения:

    ```
    [assembly:System::Diagnostics::DebuggableAttribute(true, true)];
    ```

     Для получения дополнительной информации см. <xref:System.Diagnostics.DebuggableAttribute>.

## <a name="a-namebkmk_using_jituse-just-in-time-debugging"></a><a name="BKMK_Using_JIT">Использовать JIT-отладку
 В этом разделе показано, что происходит, когда исполняемый объект создает исключение.

 Для выполнения инструкций необходимо установить Visual Studio. Если у вас нет Visual Studio, вы можете скачать бесплатный [выпуск Visual studio 2015 Community Edition](https://visualstudio.microsoft.com/vs/older-downloads/).

 При установке Visual Studio JIT-отладка включается по умолчанию.

 В этом разделе мы создадим консольное приложение C# в Visual Studio, которое создает исключение <xref:System.NullReferenceException> .

 В Visual Studio создайте консольное приложение C# (**файл/создать, проект, Visual C# или консольное приложение**) с именем **сровснуллексцептион**. Дополнительные сведения о создании проектов в Visual Studio см. в разделе [Пошаговое руководство. Создание простого приложения](../ide/walkthrough-create-a-simple-application-with-visual-csharp-or-visual-basic.md).

 Когда проект откроется в Visual Studio, откройте файл Program.cs. Замените метод Main() следующим кодом, который выводит строку на консоль, а затем создает исключение NullReferenceException:

```csharp
static void Main(string[] args)
{
    Console.WriteLine("we will now throw a NullReferenceException");
    throw new NullReferenceException("this is the exception thrown by the console app");
}
```

> [!IMPORTANT]
> Чтобы эта процедура работала в [конфигурации выпуска](../debugger/how-to-set-debug-and-release-configurations.md), необходимо отключить [только мой код](../debugger/just-my-code.md). В Visual Studio щелкните **Сервис/параметры**. В диалоговом окне **Параметры** выберите **Отладка**. Снимите флажок **включить только мой код**.

 Выполните сборку решения (в Visual Studio выберите **Сборка/Перестроение решения**). Можно выбрать конфигурацию отладки или выпуска. Дополнительные сведения о конфигурациях сборки см. в разделе [Основные сведения о конфигурациях сборки](../ide/understanding-build-configurations.md).

 Процесс сборки создает исполняемый ThrowsNullException.exe. Его можно найти в папке, в которой был создан проект C#: **. ..\сровснуллексцептион\сровснуллексцептион\бин\дебуг** или **. ..\сровснуллексцептион\сровснуллексцептион\бин\релеасе**.

 Дважды щелкните ThrowsNullException.exe. Вы увидите командное окно следующего вида:

 ![ThrowsNullExceptionConsole](../debugger/media/throwsnullexceptionconsole.png "ThrowsNullExceptionConsole")

 Через несколько секунд появится окно ошибки:

 ![сровснуллексцептионеррор](../debugger/media/throwsnullexceptionerror.png "сровснуллексцептионеррор")

 Не нажимайте кнопку **Отмена**! Через несколько секунд вы увидите две кнопки: **Отладка** и **закрыть программу**. Нажмите кнопку **Отладка**.

> [!CAUTION]
> Если приложение содержит ненадежный код, появится диалоговое окно с предупреждением системы безопасности. Это диалоговое окно позволяет выбрать, следует ли продолжать отладку или нет. Перед продолжением отладки решите, доверяете ли вы данному коду. Этот код написан вами самостоятельно? Доверяете ли вы автору кода? Если приложение выполняется на удаленном компьютере, узнаете ли вы имя процесса? Даже если приложение выполняется на локальном компьютере, это не обязательно означает, что ему можно доверять. Рассмотрите возможность запуска вредоносного кода на компьютере. Если вы решили, что код, который вы собираетесь отладить, заслуживает доверия, щелкните **Отладка**. В противном случае щелкните **не выполнять отладку**.

 Откроется окно **отладчика JIT Visual Studio** :

 ![JustInTimeDialog](../debugger/media/justintimedialog.png "JustInTimeDialog")

 В разделе **возможных отладчиков**вы увидите, что выбран **новый экземпляр Microsoft Visual Studio 2015** . Выберите сейчас, если он еще не выбран.

 В нижней части окна в разделе **выполните отладку с помощью выбранного отладчика?** нажмите кнопку **Да**.

 Проект Сровснуллексцептион открывается в новом экземпляре Visual Studio с выполнением остановки в строке, вызывающей исключение:

 ![NullReferenceSecondInstance](../debugger/media/nullreferencesecondinstance.png "NullReferenceSecondInstance")

 Теперь можно начать отладку. Если бы это было реальное приложение, необходимо выяснить, почему код создает исключение.

## <a name="just-in-time-debugging-errors"></a>Ошибки JIT-отладки
 Если диалоговое окно не отображается при аварийном завершении программы, это может быть вызвано отчеты об ошибках Windows параметрами на компьютере. Дополнительные сведения см. в разделе [. Параметры WER](https://msdn.microsoft.com/library/windows/desktop/bb513638\(v=vs.85\).aspx).

 Могут отображаться следующие сообщения об ошибках, связанные с JIT–отладкой.

- **Не удалось подключиться к аварийному процессу. Указанная программа не является программой Windows или MS–DOS.**

     Эта ошибка возникает при попытке подключиться к процессу, выполняемому от имени другого пользователя.

     Чтобы обойти эту проблему, запустите Visual Studio, откройте диалоговое окно **Присоединение к процессу** из меню **Отладка** и найдите процесс, который необходимо отладить, в списке **Доступные процессы** . Если вы не знакомы с именем процесса, просмотрите диалоговое окно **отладчика Visual Studio** и запишите идентификатор процесса. Выберите процесс в списке **Доступные процессы** и нажмите кнопку **присоединить**. В диалоговом окне **JIT-отладчика Visual Studio** нажмите кнопку **нет** , чтобы закрыть диалоговое окно.

- **Не удалось запустить отладчик, так как пользователь не вошел в систему.**

     Данная ошибка возникает, когда JIT–отладка пытается запустить Visual Studio на компьютере, на котором нет пользователей, вошедших в консоль. Так как пользователи, выполнившие вход, отсутствуют, также отсутствует сеанс пользователя, в котором следовало бы отображать диалоговое окно JIT–отладки.

     Для решения этой проблемы необходимо войти в компьютер.

- **Класс не зарегистрирован.**

     Эта ошибка указывает, что отладчик пытался создать класс COM, который не зарегистрирован, вероятно, из–за проблем с установкой.

     Чтобы решить эту проблему, используйте установочный диск для переустановки или восстановления установки Visual Studio.

## <a name="see-also"></a>См. также:
 [Основы отладчика](../debugger/debugger-basics.md) [безопасности отладчика](../debugger/debugger-security.md) [: JIT, отладка, диалоговое окно "Параметры"](../debugger/just-in-time-debugging-options-dialog-box.md) [предупреждение безопасности. присоединение к процессу, владельцем которого является недоверенный пользователь, может быть опасно. Если следующая информация выглядит подозрительно или вы не уверены, не присоединитесь к этому процессу](/visualstudio/debugger/security-warning-attaching-to-a-process-owned-by-an-untrusted-user?view=vs-2015) .
