---
title: Устранение неполадок с покрытием кода | Документация Майкрософт
ms.date: 11/15/2016
ms.prod: visual-studio-dev14
ms.technology: vs-ide-test
ms.topic: troubleshooting
ms.assetid: 26de91b8-45e3-4976-a20e-a3bd1942ddcb
caps.latest.revision: 13
ms.author: jillfra
manager: jillfra
ms.openlocfilehash: c2bf21286143b2b9543c834f00ed31ddaa4cef63
ms.sourcegitcommit: 6cfffa72af599a9d667249caaaa411bb28ea69fd
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 09/02/2020
ms.locfileid: "72660378"
---
# <a name="troubleshooting-code-coverage"></a>Устранение неполадок с покрытием кода
[!INCLUDE[vs2017banner](../includes/vs2017banner.md)]

Средство анализа покрытия кода в Visual Studio выполняет сбор данных для машинных и управляемых сборок (DLL- или EXE-файлы). Однако в некоторых случаях в окне Результаты покрытия кода отображается сообщение об ошибке, похожее на "пустые результаты созданы:...". Это может произойти по нескольким причинам. Сведения в этом разделе помогут устранить эту проблему.

## <a name="what-you-should-see"></a>Отображаемые сведения
 При выборе команды **Анализ покрытия кода** в меню Тест (при условии успешной сборки и тестирования) в окне Покрытие кода должен отобразиться список результатов. Разверните элементы, чтобы просмотреть сведения о них.

 ![Результаты покрытия кода с цветами](../test/media/codecoverage1.png "CodeCoverage1")

 Дополнительные сведения см. в разделе [Использование покрытия кода для определения объема протестированного кода](../test/using-code-coverage-to-determine-how-much-code-is-being-tested.md).

## <a name="possible-reasons-for-seeing-no-results-or-old-results"></a>Возможные причины отсутствия результатов или отображения старых результатов

### <a name="do-you-have-the-right-edition-of-visual-studio"></a>Вы используете правильный выпуск Visual Studio?
 Вам требуется Visual Studio Enterprise.

### <a name="no-tests-were-executed"></a>Тесты не выполнены
 Анализ проверьте окно вывода. В раскрывающемся списке **Показать выходные данные из:** выберите **Тесты**. Проверьте, были ли зарегистрированы какие-либо предупреждения или ошибки.

 Объяснение анализ покрытия кода выполняется во время выполнения тестов. Он включает только сборки, загруженные в память во время выполнения тестов. Если ни один из тестов не выполняется, это значит, что нет данных для включения в отчет о покрытии кода.

 Решение в обозревателе тестов выберите **запустить все** , чтобы убедиться, что тесты выполнены успешно. Исправьте все ошибки перед выполнением команды **Анализ покрытия кода**.

### <a name="youre-looking-at-a-previous-result"></a>Отображается предыдущий результат
 При изменении и повторном выполнении тестов может по-прежнему отображаться предыдущий результат анализа покрытия кода, включая цветовую разметку предыдущего запуска.

1. Выполните команду "Анализ покрытия кода".

2. Убедитесь, что выбран последний набор результатов в окне "Результаты покрытия кода".

### <a name="pdb-symbol-files-are-unavailable"></a>Недоступны PDB-файлы (файлы символов)
 Анализ откройте целевую папку компиляции (обычно bin\debug) и убедитесь, что для каждой сборки существует PDB-файл в том же каталоге, что и файл. dll или. exe.

 Объяснение обработчик покрытия кода требует, чтобы в каждой сборке был связанный PDB-файл, доступный во время тестового запуска. Если PDB-файл не существует для определенной сборки, она не будет проанализирована.

 PDB-файл должен быть создан из той же сборки, что и DLL-файл или EXE-файл.

 Разрешение убедитесь, что в параметрах сборки создается PDB-файл. Если PDB-файлы не обновляются при построении проекта, откройте свойства проекта, выберите страницу **Сборка** , щелкните **Дополнительно** и проверьте **сведения об отладке**.

 Если PDB-файл и DLL-файл или EXE-файл находятся в разных местах, скопируйте PDB-файл в тот же каталог. Также можно настроить анализатор покрытия кода для поиска PDB-файлов в другом расположении. См. дополнительные сведения по [настройке анализа покрытия кода](../test/customizing-code-coverage-analysis.md).

### <a name="using-an-instrumented-or-optimized-binary"></a>Использование инструментированного или оптимизированного двоичного файла
 Анализ определяет, находится ли двоичный файл в любой форме расширенной оптимизации, например профильной оптимизации, или инструментирован с помощью средства профилирования, такого как vsinstr.exe или vsperfmon.exe.

 Объяснение если сборка уже инструментирована или оптимизирована другим средством профилирования, сборка пропускается из анализа покрытия кода.

 Для таких сборок невозможно выполнить анализ покрытия кода.

 Отключите оптимизацию и используйте новую сборку.

### <a name="code-is-not-managed-net-or-native-c-code"></a>Неуправляемый код (.NET) или машинный код (C++)
 Анализ убедитесь, что выполняются некоторые тесты управляемого кода или C++.

 Объяснение анализ покрытия кода в Visual Studio доступен только в управляемом и машинном коде (C++). При работе со средствами сторонних разработчиков часть кода или весь код может выполняться на другой платформе.

 Разрешение нет доступных.

### <a name="assembly-has-been-installed-by-ngen"></a>Сборка установлена с помощью NGen
 Анализ убедитесь, что сборка не загружена из кэша образов в машинном код.

 Объяснение из соображений производительности сборки машинных образов не анализируются. См. дополнительные сведения о [файле Ngen.exe (генераторе образов в машинном коде)](https://msdn.microsoft.com/library/44bf97aa-a9a4-4eba-9a0d-cfaa6fc53a66).

 Разрешение используйте версию MSIL сборки. Не обрабатывайте ее с помощью NGen.

### <a name="custom-runsettings-file-with-bad-syntax"></a>Пользовательский RUNSETTINGS-файл с неверным синтаксисом
 Анализ при использовании пользовательского файла. runsettings может содержать синтаксическую ошибку.

 Это приводит к тому, что анализ покрытия кода не выполняется вовсе. Окно покрытия кода не открывается по завершении тестового запуска, или в нем отображаются старые результаты.

 Объяснение для настройки параметров покрытия кода можно выполнить модульные тесты с пользовательским файлом runsettings. С помощью параметров можно включать или исключать файлы. См. дополнительные сведения по [настройке анализа покрытия кода](../test/customizing-code-coverage-analysis.md).

 Решение. Существует два возможных типа ошибок:

- **Ошибка XML**

     Откройте RUNSETTINGS-файл в редакторе XML Visual Studio. Найдите ошибки.

- **Ошибка в регулярном выражении**

  Каждая строка в файле представляет собой регулярное выражение. Проверьте каждую строку на наличие ошибок, в частности, следующих:

  - Несоответствующие круглые скобки (...) или круглые скобки без escape-последовательности \\(...\\). Для сопоставления с круглыми скобками в строке поиска необходимо установить для них escape-последовательность. Например, для сопоставления с функцией используйте выражение `.*MyFunction\(double\)`

  - Звездочка или плюс в начале выражения. Для сопоставления с любой строкой символов используйте точку со следующей за ней звездочкой: `.*`

### <a name="custom-runsettings-file-with-incorrect-exclusions"></a>Пользовательский RUNSETTINGS-файл с неверными исключениями
 Анализ если вы используете пользовательский файл. runsettings, убедитесь, что он включает сборку.

 Объяснение для настройки параметров покрытия кода можно выполнить модульные тесты с пользовательским файлом runsettings. С помощью параметров можно включать или исключать файлы. См. дополнительные сведения по [настройке анализа покрытия кода](../test/customizing-code-coverage-analysis.md).

 Решение удалите все `Include` узлы из файла RunSettings, а затем удалите все `Exclude` узлы. Если это не решит проблему, последовательно верните их обратно.

 Убедитесь, что узел DataCollectors определяет покрытие кода. Сравните его с примером в разделе [Customizing Code Coverage Analysis](../test/customizing-code-coverage-analysis.md) (Настройка анализа покрытия кода).

## <a name="some-code-is-always-shown-as-not-covered"></a>Часть кода всегда отображается как непокрытая

### <a name="initialization-code-in-native-dlls-is-executed-before-instrumentation"></a>Код инициализации в машинных библиотеках DLL выполняется до инструментирования
 Анализ в статическом связанном машинном коде, часть функции инициализации **DllMain** и код, который она вызывает, иногда отображается как неохваченный, даже если код был выполнен.

 Объяснение средство покрытия кода работает путем вставки инструментирования в сборку непосредственно перед запуском приложения. В любой сборке, загруженной до этого времени, код инициализации в **DllMain** выполняется сразу после загрузки сборки и до выполнения приложения. Этот код будет отображаться как непокрытый.

 Обычно это применяется к статически загружаемым сборкам.

 Разрешение нет.

## <a name="see-also"></a>См. также:
 [Using Code Coverage to Determine How Much Code is being Tested](../test/using-code-coverage-to-determine-how-much-code-is-being-tested.md) (Использование покрытия кода для определения объема тестируемого кода)
