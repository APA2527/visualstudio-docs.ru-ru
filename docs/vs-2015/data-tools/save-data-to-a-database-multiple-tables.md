---
title: Сохранение данных в базе данных (несколько таблиц) | Документация Майкрософт
ms.date: 11/15/2016
ms.prod: visual-studio-dev14
ms.technology: vs-data-tools
ms.topic: conceptual
dev_langs:
- VB
- CSharp
- C++
- aspx
helpviewer_keywords:
- updating datasets, walkthroughs
- data [Visual Studio], saving
- saving data, walkthroughs
- data [Visual Studio], updating
ms.assetid: 7ebe03da-ce8c-4cbc-bac0-a2fde4ae4d07
caps.latest.revision: 27
author: jillre
ms.author: jillfra
manager: jillfra
ms.openlocfilehash: c5c4d5fc73660c97bcb69957a93d2ff08f64e31c
ms.sourcegitcommit: a8e8f4bd5d508da34bbe9f2d4d9fa94da0539de0
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 10/19/2019
ms.locfileid: "72655463"
---
# <a name="save-data-to-a-database-multiple-tables"></a>Сохранение данных в базе данных (несколько таблиц)
[!INCLUDE[vs2017banner](../includes/vs2017banner.md)]

Одним из наиболее распространенных сценариев в разработке приложений является отображение данных на форме в приложении Windows, изменение этих данных и отправка обновленных данных обратно в базу данных. Это пошаговое руководство описывает создание формы, отображающей данные из двух связанных таблиц, правку записей и сохранение изменений в базе данных. В данном примере используются таблицы `Customers` и `Orders` из учебной базы данных "Борей".

 Вы можете сохранить данные из приложения в базе данных, вызвав метод `Update` адаптера таблицы. При перетаскивании таблиц из окна **Источники данных** на форму автоматически добавляется код, необходимый для сохранения данных. Для всех дополнительных таблиц, добавляемых в форму, требуется добавление этого кода вручную. Это пошаговое руководство описывает добавление кода для сохранения обновлений из нескольких таблиц.

> [!NOTE]
> Отображаемые диалоговые окна и команды меню могут отличаться от описанных в справке в зависимости от текущих параметров или используемого выпуска. Чтобы изменить параметры, выберите в меню **Сервис** пункт **Импорт и экспорт параметров** . Дополнительные сведения см. в статье [Настройка параметров разработки в Visual Studio](https://msdn.microsoft.com/22c4debb-4e31-47a8-8f19-16f328d7dcd3).

 В данном пошаговом руководстве представлены следующие задачи.

- Создание нового проекта **приложения Windows** .

- Создание и Настройка источника данных в приложении с помощью [мастера настройки источника данных](https://msdn.microsoft.com/library/c4df7de5-5da0-4064-940c-761dd6d9e28f).

- Установка элементов управления для элементов в [окне Источники данных](https://msdn.microsoft.com/library/0d20f699-cc95-45b3-8ecb-c7edf1f67992). Дополнительные сведения см. в разделе [Установка элемента управления, создаваемого при перетаскивании из окна Источники данных](../data-tools/set-the-control-to-be-created-when-dragging-from-the-data-sources-window.md).

- Создание элементов управления с привязкой к данным с помощью перетаскивания элементов из окна **Источники данных** на форму.

- Изменение нескольких записей в каждой таблице в наборе данных.

- Изменение кода для отправки обновленных данных в наборе данных обратно в базу данных.

## <a name="prerequisites"></a>Необходимые компоненты
 Для выполнения данного пошагового руководства требуется:

- Доступ к примеру базы данных "Борей".

## <a name="create-the-windows-application"></a>Создание приложения Windows
 Первым шагом является создание **приложения Windows**. Во время этого шага назначение имени проекту не является обязательным, но мы придаем ему имя, так как мы планируем сохранить его позже.

#### <a name="to-create-the-new-windows-application-project"></a>Создание нового проекта приложения Windows

1. В меню **файл** создайте новый проект.

2. Задайте для проекта имя `UpdateMultipleTablesWalkthrough`.

3. Выберите **приложение Windows**и нажмите кнопку **ОК**. Дополнительные сведения см. в разделе [Client Applications](https://msdn.microsoft.com/library/2dfb50b7-5af2-4e12-9bbb-c5ade0e39a68).

     Создается проект **UpdateMultipleTablesWalkthroug**, который добавляется в **Обозреватель решений**.

## <a name="create-the-data-source"></a>Создание источника данных
 На этом шаге **Мастер настройки источника данных** используется для создания источника данных из базы данных Northwind. Для создания подключения необходимо иметь доступ к учебной базе данных "Борей".

#### <a name="to-create-the-data-source"></a>Создание источника данных

1. В меню **данные** выберите команду**отобразить источники данных**.

2. В окне **Источники данных** выберите**Добавить новый источник данных** , чтобы запустить **Мастер настройки источника данных**.

3. На экране **Выбор типа источника данных**выберите **база данных**, а затем нажмите кнопку **Далее**.

4. На экране **Выбор подключения к данным**выполните одно из следующих действий.

    - Если подключение к учебной базе данных Northwind доступно в раскрывающемся списке, то выберите его.

         \- или -

    - Выберите **Новое подключение** для открытия диалогового окна **Добавить/изменить подключение**.

5. Если базе данных требуется пароль, выберите параметр, чтобы включить конфиденциальные данные, а затем нажмите кнопку **Далее**.

6. В **строке сохранить подключение в файл конфигурации приложения**нажмите кнопку **Далее**.

7. На экране **Выбор объектов базы данных**разверните узел **таблицы** .

8. Выберите таблицы **Customers** и **Orders** , а затем нажмите кнопку **Готово**.

     Объект **NorthwindDataSet** добавляется в проект, и таблицы отображаются в окне **Источники данных**.

## <a name="set-the-controls-to-be-created"></a>Задание создаваемых элементов управления
 В этом пошаговом руководстве данные в таблице `Customers` находятся в макете **сведений** , где данные отображаются в отдельных элементах управления. Данные из таблицы `Orders` находятся в макете **сетки** , который отображается в элементе управления <xref:System.Windows.Forms.DataGridView>.

#### <a name="to-set-the-drop-type-for-the-items-in-the-data-sources-window"></a>Установка типа удаления для элементов в окне "Источники данных"

1. В окне **Источники данных** разверните узел **Клиенты** .

2. В узле **Клиенты** выберите **сведения** из списка управления, чтобы изменить элемент управления таблицы **Customers** на отдельные элементы управления. Дополнительные сведения см. в разделе [Установка элемента управления, создаваемого при перетаскивании из окна Источники данных](../data-tools/set-the-control-to-be-created-when-dragging-from-the-data-sources-window.md).

## <a name="create-the-data-bound-form"></a>Создание формы с привязкой к данным
 Вы можете создавать элементы управления с привязкой к данным с помощью перетаскивания элементов из окна **Источники данных** на форму.

#### <a name="to-create-data-bound-controls-on-the-form"></a>Создание элементов управления с привязкой к данным на форме

1. Перетащите главный узел **Customers** из окна **Источники данных** на форму **Form1**.

     Привязанные к данным элементы управления с метками описания отображаются на форме вместе с панелью инструментов (<xref:System.Windows.Forms.BindingNavigator>) для перемещения по записям. В области компонентов появляется [NorthwindDataSet](../data-tools/dataset-tools-in-visual-studio.md), CustomersTableAdapter, <xref:System.Windows.Forms.BindingSource> и <xref:System.Windows.Forms.BindingNavigator>.

2. Перетащите связанный узел **Заказы** из окна **Источники данных** на **Form1**.

    > [!NOTE]
    > Связанный узел **Заказы** расположен под столбцом **Факс** и является дочерним для узла **Клиенты**.

     На форме появляется элемент <xref:System.Windows.Forms.DataGridView> и панель инструментов (<xref:System.Windows.Forms.BindingNavigator>) для перемещения по записям. В области компонентов отображаются OrdersTableAdapter и <xref:System.Windows.Forms.BindingSource>.

## <a name="addcode-to-update-the-database"></a>Аддкоде обновить базу данных
 Вы можете обновить базу данных, вызвав методы `Update` адаптеров таблицы **Клиенты** и **Заказы**. По умолчанию обработчик событий для кнопки **сохранить** <xref:System.Windows.Forms.BindingNavigator> добавляется в код формы для отправки обновлений в базу данных. Эта процедура изменяет код для отправки обновлений в правильном порядке. Это устраняет возможность возникновения ошибок ссылочной целостности. Этот код также реализует обработку ошибок, упаковывая вызов обновления в блок try-catch. Вы можете изменить этот код в соответствии с потребностями своего приложения.

> [!NOTE]
> Для ясности в этом пошаговом руководстве не используется транзакция. Однако при обновлении двух или более связанных таблиц включите всю логику обновления в рамках транзакции. Транзакция — это процесс, который гарантирует, что все связанные изменения базы данных будут успешными до фиксации каких-либо изменений. Дополнительные сведения см. в разделе [Transactions and Concurrency](https://msdn.microsoft.com/library/f46570de-9e50-4fe6-8710-a8c31fa8569b).

#### <a name="to-add-update-logic-to-the-application"></a>Добавление логики обновления в приложение

1. Нажмите кнопку **сохранить** на <xref:System.Windows.Forms.BindingNavigator>. Откроется редактор кода для обработчика событий `bindingNavigatorSaveItem_Click`.

2. Замените код в обработчике событий на вызов методов `Update` связанных адаптеров таблицы. Следующий код сначала создает три временные таблицы данных для хранения обновленной информации для каждого <xref:System.Data.DataRowState> (<xref:System.Data.DataRowState>, <xref:System.Data.DataRowState> и <xref:System.Data.DataRowState>). Затем обновления выполняются в правильном порядке. Код должен выглядеть следующим образом:

     [!code-csharp[VbRaddataSaving#10](../snippets/csharp/VS_Snippets_VBCSharp/VbRaddataSaving/CS/Form4.cs#10)]
     [!code-vb[VbRaddataSaving#10](../snippets/visualbasic/VS_Snippets_VBCSharp/VbRaddataSaving/VB/Form4.vb#10)]

## <a name="test-the-application"></a>Тестирование приложения

#### <a name="to-test-the-application"></a>Тестирование приложения

1. Нажмите **клавишу F5**.

2. Внесите изменения в данные одной или нескольких записей в каждой таблице.

3. Нажмите кнопку **Сохранить**.

4. Проверьте значения в базе данных и убедитесь, что изменения были сохранены.

## <a name="next-steps"></a>Следующие шаги
 В зависимости от требований приложения существует несколько шагов, которые, возможно, потребуется выполнить после создания формы с привязкой к данным в приложении Windows. Ниже приводится перечень рекомендаций, позволяющих улучшить полученный результат.

- Добавление функциональности поиска в форму. Дополнительные сведения см. в разделе [инструкции. Добавление параметризованного запроса в приложение Windows Forms](https://msdn.microsoft.com/library/13db4ad3-56b9-4a0b-b3a5-6a4ff84d4416).

- Изменение источника данных для добавления или удаления объектов базы данных. Дополнительные сведения см. [в разделе инструкции. изменение набора данных](https://msdn.microsoft.com/library/f2dade5f-9c7a-4ddb-96a8-e0a39e50bfd3).

## <a name="see-also"></a>См. также раздел
 [Сохранение данных обратно в базу данных](../data-tools/save-data-back-to-the-database.md)
