---
title: Практическое руководство. Добавление проверки в классы сущностей | Документация Майкрософт
ms.date: 11/15/2016
ms.prod: visual-studio-dev14
ms.technology: vs-data-tools
ms.topic: conceptual
ms.assetid: 61107da9-7fa3-4dba-b101-ae46536f52c4
caps.latest.revision: 6
author: gewarren
ms.author: gewarren
manager: jillfra
ms.openlocfilehash: 5381c33790cbe9a7b5083f29d2602af39387bf61
ms.sourcegitcommit: 47eeeeadd84c879636e9d48747b615de69384356
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/23/2019
ms.locfileid: "63386758"
---
# <a name="how-to-add-validation-to-entity-classes"></a>Практическое руководство. Добавление проверки в классы сущностей
[!INCLUDE[vs2017banner](../includes/vs2017banner.md)]

*Проверка* классов сущностей представляет собой процесс подтверждения того, что значения, вводимые в объекты данных, соответствуют ограничениям в схеме объекта, а также правилам, установленным для приложения. Проверка данных перед отправкой обновлений в основную базы данных рекомендуется, это уменьшает количество ошибок. Это также уменьшает потенциальное количество циклов передачи между приложением и базой данных.  
  
 [Средства LINQ to SQL в Visual Studio](../data-tools/linq-to-sql-tools-in-visual-studio2.md) предоставляет разделяемые методы, которые позволяют пользователям расширять сгенерированный проектировщиком код, который выполняется во время операций вставки, обновления и удаления из завершенных сущностей, а также во время и после отдельного столбца изменения.  
  
> [!NOTE]
> В этом разделе описаны основные этапы добавления проверки в классы сущностей с помощью [!INCLUDE[vs_ordesigner_short](../includes/vs-ordesigner-short-md.md)]. Так как он может быть трудно следовать этим универсальным шагам, не обращаясь к определенному классу сущностей, было предоставлено пошаговое руководство, которое использует реальные данные.  
  
## <a name="adding-validation-for-changes-to-the-value-in-a-specific-column"></a>Добавление проверки для изменений данных в отдельном столбце  
 В этой процедуре показывается, как проверять данные при изменении значений в столбцах. Поскольку проверка выполняется в внутри определения класса (а не в интерфейсе пользователя), вызывается исключение, если значение не проходит проверку. Реализуйте обработку ошибок для кода в приложении, которое пытается изменять значения столбцов.  
  
 [!INCLUDE[note_settings_general](../includes/note-settings-general-md.md)]  
  
#### <a name="to-validate-data-during-a-columns-value-change"></a>Для проверки данных при изменении значений столбца  
  
1. Откройте или создайте новый файл LINQ to SQL Classes (**.dbml** файл) в [!INCLUDE[vs_ordesigner_short](../includes/vs-ordesigner-short-md.md)]. (Дважды щелкните по файлу **.dbml** в **Обозревателе решений**.)  
  
2. В конструкторе O/R, щелкните правой кнопкой мыши класс, для которого вы хотите добавить проверку, а затем нажмите кнопку **Просмотр кода**.  
  
    Открывается Редактор кода с разделяемым классом для выбранного класса сущностей.  
  
3. Поместите курсор в разделяемый класс.  
  
4. Для проектов Visual Basic:  
  
   1. Разверните список **Имя метода**.  
  
   2. Найдите **на**_COLUMNNAME_**Changing** метод для столбца, который вы хотите добавить проверку.  
  
   3. `On` *COLUMNNAME* `Changing` метод добавляется в разделяемый класс.  
  
   4. Добавьте следующий код, чтобы сначала убедиться, что значение было введено, и потом, чтобы гарантировать, что введенное значение для столбца приемлемо для приложения: Аргумент `value` содержит предложенное значение, так что добавьте логику, чтобы подтвердить, что это - допустимое значение:  
  
      ```vb  
      If value.HasValue Then  
          ' Add code to ensure that the value is acceptable.  
          ' If value < 1 Then  
          '    Throw New Exception("Invalid data!")  
          ' End If  
      End If  
      ```  
  
      Для проектов C#:  
  
   5. Поскольку проекты C# автоматически не генерируют обработчики событий, то можно использовать IntelliSense для создания изменяющие столбец разделяемые методы.  
  
       Введите `partial` и потом пространство для доступа к списку доступных разделяемых методов. Щелкните изменяющий метод для столбца, для которого вы хотите добавить проверку. Следующий код напоминает код, который генерируется, когда выбирается изменяющий столбец разделяемый метод:  
  
      ```csharp  
      partial void OnCOLUMNNAMEChanging(COLUMNDATATYPE value)  
          {  
             throw new System.NotImplementedException();  
          }  
  
      ```  
  
## <a name="adding-validation-for-updates-to-an-entity-class"></a>Добавление проверки для обновлений в класс сущностей.  
 В дополнение к проверке значений во время изменений можно проверить правильность данных, когда осуществляется попытка обновить завершенный класс сущностей. Проверка во время предпринятого обновления позволяет сравнить значения в нескольких столбцах, если бизнес- правила требуют этого. В следующей процедуре показано, как осуществлять проверку, когда осуществляется попытка обновить завершенный класс сущностей.  
  
> [!NOTE]
> Код проверки для обновлений в полных классах сущностей выполняется в разделяемом классе <xref:System.Data.Linq.DataContext>, а не в разделяемом классе заданного класса сущности.  
  
#### <a name="to-validate-data-during-an-update-to-an-entity-class"></a>Для добавления проверки во время обновления в классе сущностей  
  
1. Откройте или создайте новый файл LINQ to SQL Classes (**.dbml** файл) в [!INCLUDE[vs_ordesigner_short](../includes/vs-ordesigner-short-md.md)]. (Дважды щелкните по файлу **.dbml** в **Обозревателе решений**.)  
  
2. Щелкните правой кнопкой мыши пустую область в конструкторе O/R и нажмите кнопку **Просмотр кода**.  
  
    Открывается Редактор кода с разделяемым классом для `DataContext`.  
  
3. Поместите курсор в разделяемый класс для `DataContext`.  
  
4. Для проектов Visual Basic:  
  
   1. Разверните список **Имя метода**.  
  
   2. Нажмите кнопку **обновление**_ENTITYCLASSNAME_.  
  
   3. `Update` *ENTITYCLASSNAME* метод добавляется в разделяемый класс.  
  
   4. Обратитесь к отдельным значениям в столбце, используя аргумент `instance`, как показано в следующем коде:  
  
      ```vb  
      If (instance.COLUMNNAME = x) And (instance.COLUMNNAME = y) Then  
          Dim ErrorMessage As String = "Invalid data!"  
          Throw New Exception(ErrorMessage)  
      End If  
      ```  
  
      Для проектов C#:  
  
   5. Поскольку проекты C# автоматически не генерируют обработчики событий, можно использовать IntelliSense для создания разделяемого `Update` *CLASSNAME* метод.  
  
   6. Введите `partial` и потом пространство для доступа к списку доступных разделяемых методов. Щелкните метод обновления для класса, для которого вы хотите добавить проверку. Следующий код напоминает код, создаваемый при выборе `Update` *CLASSNAME* разделяемый метод:  
  
      ```csharp  
      partial void UpdateCLASSNAME(CLASSNAME instance)  
      {  
          if ((instance.COLUMNNAME == x) && (instance.COLUMNNAME = y))  
          {  
              string ErrorMessage = "Invalid data!";  
              throw new System.Exception(ErrorMessage);  
          }  
      }  
      ```  
  
## <a name="see-also"></a>См. также  
 [Средства LINQ to SQL в Visual Studio](../data-tools/linq-to-sql-tools-in-visual-studio2.md)   
 [LINQ to SQL](http://msdn.microsoft.com/library/73d13345-eece-471a-af40-4cc7a2f11655)   
 [Проверка данных](http://msdn.microsoft.com/library/b3a9ee4e-5d4d-4411-9c56-c811f2b4ee7e)
