---
title: Сохранить данные обратно в базу данных | Документация Майкрософт
ms.date: 11/15/2016
ms.prod: visual-studio-dev14
ms.technology: vs-data-tools
ms.topic: conceptual
dev_langs:
- VB
- CSharp
- C++
- aspx
helpviewer_keywords:
- datasets [Visual Basic], validating data
- data validation, datasets
- data [Visual Studio], saving
- row version
- updating datasets, constraints
- datasets [Visual Basic], about datasets
- datasets [Visual Basic], merging
- updates, constraints in datasets
- saving data, about saving data
- datasets [Visual Basic], constraints
- TableAdapters
ms.assetid: afe6cb8a-dc6a-428b-b07b-903ac02c890b
caps.latest.revision: 31
author: jillre
ms.author: jillfra
manager: jillfra
ms.openlocfilehash: e1b1a54d8be5ab4aa9703d318d0b537deff53b6f
ms.sourcegitcommit: a8e8f4bd5d508da34bbe9f2d4d9fa94da0539de0
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 10/19/2019
ms.locfileid: "72652871"
---
# <a name="save-data-back-to-the-database"></a>Сохранение данных обратно в базу данных
[!INCLUDE[vs2017banner](../includes/vs2017banner.md)]

Набор данных — это копия данных в памяти. Если изменить эти данные, рекомендуется сохранить эти изменения обратно в базу данных. Это можно сделать одним из трех способов:

- Путем вызова одного из методов `Update` TableAdapter

- Путем вызова одного из методов DBDirect адаптера таблицы

- Вызов метода UpdateAll на `TableAdapterManager`, создаваемом Visual Studio, если набор данных содержит таблицы, связанные с другими таблицами в наборе данных

  При связывании таблиц набора данных с элементами управления на странице Windows Forms или XAML архитектура привязки данных выполняет всю работу за вас.

  Если вы знакомы с TableAdapter, вы можете перейти непосредственно к одному из следующих разделов:

|Раздел|Описание|
|-----------|-----------------|
|[Вставка новых записей в базу данных](../data-tools/insert-new-records-into-a-database.md)|Выполнение операций обновления и вставки с помощью адаптеров таблиц или объектов команд|
|[Обновление данных с помощью адаптера таблицы](../data-tools/update-data-by-using-a-tableadapter.md)|Как выполнять обновления с помощью адаптеров таблиц|
|[Иерархическое обновление](../data-tools/hierarchical-update.md)|Выполнение обновлений из набора данных с двумя или более связанными таблицами|
|[Обработка исключения параллельности](../data-tools/handle-a-concurrency-exception.md)|Как управлять исключениями, когда два пользователя пытаются одновременно изменить одни и те же данные в базе данных|
|[Сохранение данных с помощью транзакции](../data-tools/save-data-by-using-a-transaction.md)|Сохранение данных в транзакции с помощью пространства имен System. Transactions и объекта TransactionScope|
|[Сохранение данных в транзакции](../data-tools/save-data-in-a-transaction.md)|Сохранение данных в транзакции с помощью пространства имен System. Transactions|
|[Сохранение данных в базе данных (несколько таблиц)](../data-tools/save-data-to-a-database-multiple-tables.md)|Изменение записей и сохранение изменений в нескольких таблицах обратно в базу данных|
|[Сохранение данных из объекта в базе данных](../data-tools/save-data-from-an-object-to-a-database.md)|Передача данных из объекта, который не находится в наборе данных, в базу данных с помощью метода DbDirect адаптера таблицы|
|[Сохранение данных с помощью методов DBDirect адаптера таблицы](../data-tools/save-data-with-the-tableadapter-dbdirect-methods.md)|Как использовать TableAdapter для отправки запросов SQL непосредственно в базу данных|
|[Сохранение набора данных в формате XML](../data-tools/save-a-dataset-as-xml.md)|Сохранение набора данных в XML-документе|

## <a name="two-stage-updates"></a>Два этапа обновления
 Обновление источника данных выполняется в два этапа. Первым шагом является обновление набора данных новыми записями, измененными записями или удаленными записями. Если приложение не отправляет эти изменения обратно в источник данных, то обновление будет завершено.

 Если изменения отправляются обратно в базу данных, требуется второй шаг. Если элементы управления с привязкой к данным не используются, необходимо вручную вызвать метод обновления того же адаптера таблицы TableAdapter (или адаптера данных), который использовался для заполнения набора данных. Однако можно также использовать различные адаптеры, например, для перемещения данных из одного источника данных в другой или для обновления нескольких источников данных. Если вы не используете привязку данных и сохраняете изменения для связанных таблиц, необходимо вручную создать экземпляр переменной автоматически созданного класса TableAdapterManager, а затем вызвать его метод UpdateAll.

 ![Обновления набора данных Visual Basic](../data-tools/media/vbdatasetupdates.gif "вбдатасетупдатес") Процесс с двумя этапами обновления и роль DataRowVersion в успешном обновлении

 Набор данных содержит коллекции таблиц, которые содержат коллекции строк. Если вы планируете обновить базовый источник данных позже, при добавлении или удалении строк необходимо использовать методы для свойства DataTable. Датаровколлектион. Эти методы выполняют отслеживание изменений, необходимое для обновления источника данных. При вызове коллекции RemoveAt для свойства Rows удаление не будет передаваться обратно в базу данных.

## <a name="merge-datasets"></a>Объединить наборы данных
 Содержимое набора данных можно обновить, *объединив* его с другим набором данных. Это включает копирование содержимого *исходного* набора данных в вызывающий набор данных (называемый *целевым* набором данных). При слиянии наборов данных новые записи из исходного набора добавляются в целевой набор данных. Кроме того, дополнительные столбцы в исходном наборе данных добавляются в целевой набор данных. Объединение наборов данных полезно, если у вас есть локальный DataSet и вы получаете второй набор данных из другого приложения. Это также полезно при получении второго набора данных из компонента, например веб-службы XML, или при необходимости интегрировать данные из нескольких наборов данных.

 При слиянии наборов данных можно передать логический аргумент (`preserveChanges`), который сообщает методу <xref:System.Data.DataSet.Merge%2A>, следует ли хранить существующие изменения в целевом наборе DataSet. Поскольку наборы данных поддерживают несколько версий записей, важно помнить, что объединяются более одной версии записей. В следующей таблице показано, как объединяются записи в двух наборах данных:

|Числен|Целевой набор данных|Исходный набор данных|
|--------------------|--------------------|--------------------|
|До преобразования|Джеймс Уилсон (|Джеймс C. Уилсон (|
|Текущие|Джим Уилсон (|Джеймс C. Уилсон (|

 Вызов метода <xref:System.Data.DataSet.Merge%2A> в предыдущей таблице с `preserveChanges=false targetDataset.Merge(sourceDataset)` приводит к следующим результатам:

|Числен|Целевой набор данных|Исходный набор данных|
|--------------------|--------------------|--------------------|
|До преобразования|Джеймс C. Уилсон (|Джеймс C. Уилсон (|
|Текущие|Джеймс C. Уилсон (|Джеймс C. Уилсон (|

 Вызов метода <xref:System.Data.DataSet.Merge%2A> с `preserveChanges = true targetDataset.Merge(sourceDataset, true)` приводит к следующим результатам:

|Числен|Целевой набор данных|Исходный набор данных|
|--------------------|--------------------|--------------------|
|До преобразования|Джеймс C. Уилсон (|Джеймс C. Уилсон (|
|Текущие|Джим Уилсон (|Джеймс C. Уилсон (|

> [!CAUTION]
> В сценарии `preserveChanges = true`, если метод <xref:System.Data.DataSet.RejectChanges%2A> вызывается для записи в целевом наборе данных, то возвращается к исходным данным из *исходного* набора данных. Это означает, что при попытке обновить исходный источник данных с помощью целевого набора данных может оказаться невозможным найти исходную строку для обновления. Можно предотвратить нарушение параллелизма, заполняя другой набор данных обновленными записями из источника данных, а затем выполнив слияние, чтобы предотвратить нарушение параллелизма. (Нарушение параллелизма происходит, когда другой пользователь изменяет запись в источнике данных после заполнения набора данных.)

## <a name="update-constraints"></a>Ограничения обновления
 Чтобы внести изменения в существующую строку данных, добавьте или обновите данные в отдельных столбцах. Если набор данных содержит ограничения (например, внешние ключи или ограничения, не допускающие значения NULL), то возможно, что запись может временно находиться в состоянии ошибки при ее обновлении. То есть он может находиться в состоянии ошибки после завершения обновления одного столбца, но до перехода к следующему.

 Чтобы предотвратить преждевременные нарушения ограничений, можно временно приостановить ограничения обновления. Это служит двум целям:

- Он предотвращает возникновение ошибки после того, как вы закончите обновление одного столбца, но не начали обновлять другой.

- Он предотвращает возникновение некоторых событий обновления (событий, которые часто используются для проверки).

  После завершения обновления можно повторно включить проверку ограничений, которая также активирует события обновления и вызывает их.

> [!NOTE]
> В Windows Forms архитектура привязки данных, встроенная в DataGrid, приостанавливает проверку ограничений до тех пор, пока фокус не будет перемещен из строки, и вам не нужно явно вызывать методы <xref:System.Data.DataRow.BeginEdit%2A>, <xref:System.Data.DataRow.EndEdit%2A> или <xref:System.Data.DataRow.CancelEdit%2A>.

 Ограничения автоматически отключаются при вызове метода <xref:System.Data.DataSet.Merge%2A> в наборе данных. Когда слияние завершено, при наличии ограничений на набор данных, который не может быть включен, создается <xref:System.Data.ConstraintException>. В этом случае свойство <xref:System.Data.DataSet.EnforceConstraints%2A> имеет значение `false,` и все нарушения ограничений должны быть разрешены перед сбросом свойства <xref:System.Data.DataSet.EnforceConstraints%2A> в `true`.

 После завершения обновления можно повторно включить проверку ограничений, которая также активирует события обновления и вызывает их.

 Дополнительные сведения о приостановке событий см. [в разделе Отключение ограничений при заполнении набора данных](../data-tools/turn-off-constraints-while-filling-a-dataset.md).

## <a name="dataset-update-errors"></a>Ошибки обновления набора данных
 При обновлении записи в наборе данных существует вероятность возникновения ошибки. Например, можно непреднамеренно записать данные неправильного типа в столбец или данные, которые имеют слишком большую длину, или данные с какой-либо другой проблемой целостности. Или могут возникнуть проверки, зависящие от приложения, которые могут вызывать пользовательские ошибки на любом этапе события обновления. Дополнительные сведения см. [в разделе Проверка данных в DataSets](../data-tools/validate-data-in-datasets.md).

## <a name="maintaining-information-about-changes"></a>Обслуживание информации об изменениях
 Сведения об изменениях в наборе данных сохраняются двумя способами: путем пометки строк, указывающих, что они были изменены (<xref:System.Data.DataRow.RowState%2A>), и хранения нескольких копий записи (<xref:System.Data.DataRowVersion>). С помощью этих сведений процессы могут определить, что изменилось в наборе данных и могут отправить соответствующие обновления в источник данных.

### <a name="rowstate-property"></a>Свойство RowState
 Свойство <xref:System.Data.DataRow.RowState%2A> объекта <xref:System.Data.DataRow> — это значение, которое предоставляет сведения о состоянии конкретной строки данных.

 В следующей таблице приведены возможные значения перечисления <xref:System.Data.DataRowState>.

|Значение Датаровстате|Описание|
|------------------------|-----------------|
|<xref:System.Data.DataRowState>|Строка была добавлена в качестве элемента в <xref:System.Data.DataRowCollection>. (Строка в этом состоянии не имеет соответствующей исходной версии, так как она не существовала при вызове последнего метода <xref:System.Data.DataRow.AcceptChanges%2A>).|
|<xref:System.Data.DataRowState>|Строка была удалена с помощью <xref:System.Data.DataRow.Delete%2A> объекта <xref:System.Data.DataRow>.|
|<xref:System.Data.DataRowState>|Строка была создана, но не является частью какой-либо <xref:System.Data.DataRowCollection>. Объект <xref:System.Data.DataRow> находится в этом состоянии сразу после его создания, перед добавлением в коллекцию и после его удаления из коллекции.|
|<xref:System.Data.DataRowState>|Значение столбца в строке изменилось каким-либо образом.|
|<xref:System.Data.DataRowState>|Строка не изменилась со времени последнего вызова <xref:System.Data.DataRow.AcceptChanges%2A>.|

### <a name="datarowversion-enumeration"></a>DataRowVersion - перечисление
 Наборы данных поддерживают несколько версий записей. Перечисление <xref:System.Data.DataRowVersion> объекта <xref:System.Data.DataRow> — это значение, которое можно использовать для возврата определенной версии объекта <xref:System.Data.DataRow>.

 В следующей таблице приведены возможные значения перечисления <xref:System.Data.DataRowVersion>.

|Значение DataRowVersion|Описание|
|--------------------------|-----------------|
|<xref:System.Data.DataRowVersion>|Текущая версия записи содержит все изменения, выполненные с записью с момента последнего вызова <xref:System.Data.DataRow.AcceptChanges%2A>. Если строка была удалена, текущая версия отсутствует.|
|<xref:System.Data.DataRowVersion>|Значение по умолчанию для записи, определяемое схемой набора данных или источником данных.|
|<xref:System.Data.DataRowVersion>|Исходная версия записи — это копия записи, так как она была в последний раз зафиксирована в наборе данных. На практике это, как правило, версия записи, считанная из источника данных.|
|<xref:System.Data.DataRowVersion>|Предлагаемая версия записи, которая временно доступна в середине обновления, то есть между моментом вызова метода <xref:System.Data.DataRow.BeginEdit%2A> и методом <xref:System.Data.DataRow.EndEdit%2A>. Как правило, доступ к предложенной версии записи осуществляется в обработчике для события, такого как <xref:System.Data.DataTable.RowChanging>. При вызове метода <xref:System.Data.DataRow.CancelEdit%2A> изменения отменяются и удаляется Предлагаемая версия строки данных.|

 Исходная и текущая версии полезны при передаче сведений об обновлении в источник данных. Как правило, при отправке обновления в источник данных новые сведения для базы данных находятся в текущей версии записи. Сведения из исходной версии используются для нахождение обновляемой записи.

 Например, в случае изменения первичного ключа записи необходим способ нахождение соответствующей записи в источнике данных для обновления изменений. Если исходная версия не существовала, запись, скорее всего, будет добавлена к источнику данных, что приведет не только к дополнительной нежелательной записи, но в одной записи, которая является неточной и устаревшей. Эти две версии также используются в управлении параллелизмом. Исходную версию можно сравнить с записью в источнике данных, чтобы определить, изменилась ли запись с момента ее загрузки в набор данных.

 Предлагаемая версия полезна, если необходимо выполнить проверку перед фактическим фиксацией изменений в наборе данных.

 Даже если записи были изменены, они не всегда являются исходными или текущими версиями этой строки. При вставке новой строки в таблицу нет исходной версии, а только текущей версии. Аналогичным образом, при удалении строки путем вызова метода `Delete` таблицы существует исходная версия, но отсутствует текущая версия.

 Можно проверить, существует ли определенная версия записи, выполнив запрос к методу <xref:System.Data.DataRow.HasVersion%2A> строки данных. Доступ к любой версии записи можно получить, передав значение перечисления <xref:System.Data.DataRowVersion> в качестве необязательного аргумента при запросе значения столбца.

## <a name="getting-changed-records"></a>Получение измененных записей
 Распространенной практикой является не обновление каждой записи в наборе данных. Например, пользователь может работать с элементом управления Windows Forms <xref:System.Windows.Forms.DataGridView>, который отображает много записей. Однако пользователь может обновить только несколько записей, удалить один из них и вставить новый. Наборы данных и таблицы с данными предоставляют метод (`GetChanges`) для возврата только измененных строк.

 Можно создавать подмножества измененных записей с помощью метода `GetChanges` таблицы данных (<xref:System.Data.DataTable.GetChanges%2A>) или самого набора данных (<xref:System.Data.DataSet.GetChanges%2A>). При вызове метода для таблицы данных возвращается копия таблицы только с измененными записями. Аналогично, при вызове метода для набора данных вы получаете новый набор данных, содержащий только измененные записи.

 `GetChanges` сам по себе возвращает все измененные записи. Напротив, передача требуемого <xref:System.Data.DataRowState> в качестве параметра в метод `GetChanges` позволяет указать подмножество измененных записей: добавленные записи, записи, помеченные для удаления, отсоединенные записи или измененные записи.

 Получение подмножества измененных записей полезно, если нужно отправить записи в другой компонент для обработки. Вместо отправки всего набора данных можно снизить издержки на взаимодействие с другим компонентом, получая только те записи, которые необходимы компоненту. Дополнительные сведения см. [в разделе инструкции. извлечение измененных строк](https://msdn.microsoft.com/library/6ff0cbd0-5253-48e7-888a-144d56c2e0a9).

## <a name="committing-changes-in-the-dataset"></a>Фиксация изменений в наборе данных
 По мере внесения изменений в набор данных задается свойство <xref:System.Data.DataRow.RowState%2A> измененных строк. Исходная и текущая версии записей устанавливаются, обслуживаются и становятся доступными для вас с помощью свойства <xref:System.Data.DataRowView.RowVersion%2A>. Метаданные, хранящиеся в свойствах этих измененных строк, необходимы для отправки правильных обновлений в источник данных.

 Если изменения соответствуют текущему состоянию источника данных, вам больше не нужно поддерживать эти сведения. Обычно существует два раза, когда набор данных и его источник синхронизируются:

- Сразу же после загрузки информации в набор данных, например при чтении данных из источника.

- После отправки изменений из набора данных в источник данных (но не ранее, так как при этом теряются сведения об изменениях, необходимые для отправки изменений в базу данных).

  Можно зафиксировать ожидающие изменения в наборе данных, вызвав метод <xref:System.Data.DataSet.AcceptChanges%2A>. Как правило, <xref:System.Data.DataSet.AcceptChanges%2A> вызывается в приложении в следующий раз.

- После загрузки набора данных. При загрузке набора данных путем вызова метода `Fill` TableAdapter адаптер автоматически фиксирует изменения. Однако при загрузке набора данных путем объединения другого набора данных в него необходимо зафиксировать изменения вручную.

  > [!NOTE]
  > Можно запретить адаптеру автоматически фиксировать изменения при вызове метода `Fill`, задав для свойства `AcceptChangesDuringFill` адаптера значение `false`. Если задано значение `false`, <xref:System.Data.DataRow.RowState%2A> каждой строки, вставленной во время заполнения, задается <xref:System.Data.DataRowState>.

- После отправки изменений набора данных в другой процесс, например в веб-службу XML.

  > [!CAUTION]
  > Применение изменений таким образом удаляет все сведения об изменениях. Не зафиксируйте изменения до тех пор, пока не завершите выполнение операций, требующих, чтобы приложение знало, какие изменения были сделаны в наборе данных.

  Этот метод выполняет следующие задачи:

- Записывает <xref:System.Data.DataRowVersion> версию записи в ее <xref:System.Data.DataRowVersion>ную версию и перезаписывает исходную версию.

- Удаляет все строки, в которых свойство <xref:System.Data.DataRow.RowState%2A> имеет значение <xref:System.Data.DataRowState>.

- Задает для свойства <xref:System.Data.DataRow.RowState%2A> записи значение <xref:System.Data.DataRowState>.

  Метод <xref:System.Data.DataSet.AcceptChanges%2A> доступен на трех уровнях. Его можно вызвать для объекта <xref:System.Data.DataRow> для фиксации изменений только для этой строки. Его также можно вызвать для объекта <xref:System.Data.DataTable>, чтобы зафиксировать все строки в таблице. Наконец, можно вызвать его для объекта <xref:System.Data.DataSet>, чтобы зафиксировать все ожидающие изменения во всех записях всех таблиц набора данных.

  В следующей таблице описано, какие изменения фиксируются в зависимости от того, на каком объекте вызывается метод.

|Метод|Результат|
|------------|------------|
|<xref:System.Data.DataRow.AcceptChanges%2A?displayProperty=fullName>|Изменения фиксируются только в указанной строке.|
|<xref:System.Data.DataTable.AcceptChanges%2A?displayProperty=fullName>|Изменения фиксируются во всех строках в указанной таблице.|
|<xref:System.Data.DataSet.AcceptChanges%2A?displayProperty=fullName>|Изменения фиксируются во всех строках во всех таблицах набора данных.|

> [!NOTE]
> При загрузке набора данных путем вызова метода `Fill` TableAdapter не нужно явно принимать изменения. По умолчанию метод `Fill` вызывает метод `AcceptChanges` после завершения заполнения таблицы данных.

 Связанный метод, `RejectChanges`, отменяет результаты изменений, копируя <xref:System.Data.DataRowVersion>ную версию обратно в <xref:System.Data.DataRowVersion>ную версию записей. Он также задает <xref:System.Data.DataRow.RowState%2A> каждой записи обратно в <xref:System.Data.DataRowState>.

## <a name="data-validation"></a>Проверка данных
 Чтобы убедиться, что данные в приложении соответствуют требованиям процессов, в которые оно передается, часто требуется добавить проверку. Это может потребовать проверки правильности записи пользователя в форме, проверки данных, отправляемых в приложение другим приложением, или даже проверки того, что данные, вычисляемые в компоненте, находятся в пределах ограничений источника данных. и требования к приложениям.

 Проверить данные можно несколькими способами.

- На бизнес-уровне путем добавления кода в приложение для проверки данных. Этот набор данных можно использовать в одном месте. Конструктор наборов данных предоставляет некоторые преимущества проверки серверной части, такие как возможность проверки изменений по мере изменения значений столбцов и строк. Дополнительные сведения см. [в разделе Проверка данных в DataSets](../data-tools/validate-data-in-datasets.md).

- На уровне представления, добавив проверку в формы. Дополнительные сведения см. [в разделе Проверка вводимых пользователем данных в Windows Forms](https://msdn.microsoft.com/library/4ec07681-1dee-4bf9-be5e-718f635a33a1).

- В серверной части данных, отправляя данные в источник данных, например базу данных, и позволяя ему принимать или отклонять данные. Если вы работаете с базой данных, которая обладает расширенными возможностями для проверки данных и предоставляет сведения об ошибках, это может быть практичным подходом, поскольку вы можете проверить данные независимо от того, откуда они приходят. Однако этот подход может не соответствовать требованиям к проверке для конкретного приложения. Кроме того, наличие проверки данных в источнике данных может привести к множеству циклических обращений к источнику данных в зависимости от того, как ваше приложение упрощает разрешение ошибок проверки, возникающих в серверной части.

  > [!IMPORTANT]
  > При использовании команд данных со свойством <xref:System.Data.SqlClient.SqlCommand.CommandType%2A>, для которого установлено значение <xref:System.Data.CommandType>, внимательно проверяйте сведения, отправляемые с клиента, перед их передачей в базу данных. Злоумышленники могут попытаться отправить (внедрить) модифицированные или добавочные инструкции SQL и получить незаконный доступ к базе данных или повредить ее. Прежде чем передавать данные, введенные пользователем, в базу данных, всегда проверяйте, являются ли сведения допустимыми. Рекомендуется всегда использовать параметризованные запросы или хранимые процедуры, если это возможно. Дополнительные сведения см. в разделе [Общие сведения об использовании сценариев](https://msdn.microsoft.com/library/772c7312-211a-4eb3-8d6e-eec0aa1dcc07).

  После внесения изменений в наборе данных можно передать изменения в источник данных. Чаще всего это делается путем вызова метода `Update` TableAdapter (или адаптера данных). Этот метод выполняет цикл по каждой записи в таблице данных, определяет, какой тип обновления требуется (для обновления, вставки или удаления), если таковой имеется, а затем запускает соответствующую команду.

## <a name="transmitting-updates-to-the-data-source"></a>Передача обновлений в источник данных
 В качестве иллюстрации того, как выполняются обновления, предположим, что приложение использует набор данных, содержащий одну таблицу данных. Приложение выбирает две строки из базы данных. После извлечения таблица данных в памяти выглядит следующим образом:

```
(RowState)     CustomerID   Name             Status
(Unchanged)    c200         Robert Lyon      Good
(Unchanged)    c400         Nancy Buchanan    Pending
```

 Приложение изменяет состояние Нэнси Батурин на "предпочтительно". В результате этого изменения значение свойства <xref:System.Data.DataRow.RowState%2A> для этой строки изменяется с <xref:System.Data.DataRowState> на <xref:System.Data.DataRowState>. Значение свойства <xref:System.Data.DataRow.RowState%2A> для первой строки остается <xref:System.Data.DataRowState>. Таблица данных теперь выглядит следующим образом:

```
(RowState)     CustomerID   Name             Status
(Unchanged)    c200         Robert Lyon      Good
(Modified)     c400         Nancy Buchanan    Preferred
```

 Теперь приложение вызывает метод `Update` для передачи набора данных в базу данных. Метод проверяет каждую строку, в свою очередь. В первой строке метод не передает инструкцию SQL в базу данных, так как эта строка не изменилась с момента первоначальной выборки из базы данных.

 Однако во второй строке метод `Update` автоматически вызывает правильную команду данных и передает ее в базу данных. Конкретный синтаксис инструкции SQL зависит от диалекта SQL, поддерживаемого базовым хранилищем данных. Но следующие общие признаки передаваемой инструкции SQL являются значимыми:

- Передаваемая инструкция SQL является инструкцией UPDATE. Адаптер знает, что используется инструкция UPDATE, так как значение свойства <xref:System.Data.DataRow.RowState%2A> <xref:System.Data.DataRowState>.

- Переданная инструкция SQL содержит предложение WHERE, указывающее, что целевым объектом инструкции UPDATE является строка, в которой `CustomerID = 'c400'`. Эта часть инструкции SELECT отличает целевую строку от остальных, поскольку `CustomerID` является первичным ключом целевой таблицы. Информация для предложения WHERE является производной от исходной версии записи (`DataRowVersion.Original`) в случае, если значения, необходимые для обнаружения строки, изменились.

- Переданная инструкция SQL содержит предложение SET для установки новых значений измененных столбцов.

    > [!NOTE]
    > Если свойству `UpdateCommand` TableAdapter присвоено имя хранимой процедуры, адаптер не формирует инструкцию SQL. Вместо этого он вызывает хранимую процедуру с соответствующими передаваемыми параметрами.

## <a name="passing-parameters"></a>Передача параметров
 Обычно параметры используются для передачи значений для записей, которые будут обновляться в базе данных.  Когда метод `Update` TableAdapter выполняет инструкцию UPDATE, ему необходимо заполнить значения параметров. Он получает эти значения из коллекции `Parameters` для соответствующей команды данных, в данном случае `UpdateCommand` объекта в TableAdapter.

 Если вы использовали инструменты Visual Studio для создания адаптера данных, то объект `UpdateCommand` содержит коллекцию параметров, соответствующих заполнительу параметра в инструкции.

 Свойство <xref:System.Data.SqlClient.SqlParameter.SourceColumn%2A?displayProperty=fullName> каждого параметра указывает на столбец в таблице данных. Например, свойству `SourceColumn` для параметров `au_id` и `Original_au_id` присваивается любой столбец в таблице данных, содержащий идентификатор автора. При запуске метода `Update` адаптера он считывает столбец идентификатора автора из обновляемой записи и заполняет значения инструкцией.

 В инструкции UPDATE необходимо указать оба новых значения (которые будут записаны в запись), а также старые значения (чтобы запись могла быть найдена в базе данных). Поэтому существуют два параметра для каждого значения: одно для предложения SET и другое для предложения WHERE. Оба параметра считывают данные из обновляемой записи, но получают разные версии значения столбца на основе [Свойства SqlParameter. SourceVersion](https://msdn.microsoft.com/library/system.data.sqlclient.sqlparameter.sourceversion.aspx)параметра. Параметр для предложения SET получает текущую версию, а параметр для предложения WHERE получает исходную версию.

> [!NOTE]
> Можно также вручную задать значения в коллекции `Parameters` в коде, который обычно выполняется в обработчике событий для события <xref:System.Data.DataTable.RowChanging> адаптера данных.

## <a name="see-also"></a>См. также раздел
 [Обновление данных с помощью TableAdapter](../data-tools/update-data-by-using-a-tableadapter.md) [Подготовка приложения к получению](https://msdn.microsoft.com/library/c17bdb7e-c234-4f2f-9582-5e55c27356ad) [элементов управления привязки данных в данных в Visual Studio](../data-tools/bind-controls-to-data-in-visual-studio.md) [Проверка данных](https://msdn.microsoft.com/library/b3a9ee4e-5d4d-4411-9c56-c811f2b4ee7e)
