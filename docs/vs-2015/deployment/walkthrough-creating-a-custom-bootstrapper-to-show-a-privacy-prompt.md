---
title: Пошаговое руководство. Создание настраиваемого начального загрузчика для отображения запроса о конфиденциальности | Документация Майкрософт
ms.date: 11/15/2016
ms.prod: visual-studio-dev14
ms.technology: vs-ide-deployment
ms.topic: conceptual
dev_langs:
- FSharp
- VB
- CSharp
- C++
helpviewer_keywords:
- ClickOnce deployment, prerequisites
- dependencies [.NET Framework], custom bootstrapper package
- deploying applications [Visual Studio], custom prerequisites
- Windows Installer deployment, prerequisites
- prerequisites [.NET Framework], custom bootstrapper package
ms.assetid: 2f3edd6a-84d1-4864-a1ae-6a13c5732aae
caps.latest.revision: 12
author: mikejo5000
ms.author: mikejo
manager: jillfra
ms.openlocfilehash: 6d93d9f771da9387661603f3eb71301e9d9aead7
ms.sourcegitcommit: 6cfffa72af599a9d667249caaaa411bb28ea69fd
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 09/02/2020
ms.locfileid: "90842680"
---
# <a name="walkthrough-creating-a-custom-bootstrapper-to-show-a-privacy-prompt"></a>Пошаговое руководство. Создание пользовательского загрузчика для вывода окна с предупреждением о конфиденциальности
[!INCLUDE[vs2017banner](../includes/vs2017banner.md)]

Можно настроить автоматическое обновление приложений ClickOnce при доступности сборок с более новыми версиями файлов и версий сборок. Чтобы обеспечить согласие клиентов на такое поведение, можно отобразить запрос о конфиденциальности. Затем они могут выбрать, предоставлять ли приложению разрешение на автоматическое обновление. Если приложение не может обновляться автоматически, оно не устанавливается.  
  
 [!INCLUDE[note_settings_general](../includes/note-settings-general-md.md)]  
  
## <a name="prerequisites"></a>Предварительные требования  
 Для выполнения этого пошагового руководства требуются следующие компоненты:  
  
- Visual Studio 2010.  
  
## <a name="creating-an-update-consent-dialog-box"></a>Создание диалогового окна "согласие на обновление"  
 Чтобы отобразить запрос о конфиденциальности, создайте приложение, запрашивающее у читателя разрешение на автоматическое обновление приложения.  
  
#### <a name="to-create-a-consent-dialog-box"></a>Создание диалогового окна «согласие»  
  
1. В меню **Файл** укажите **Создать**, затем нажмите **Проект**.  
  
2. В диалоговом окне **Новый проект** щелкните **Windows**, а затем — **виндовсформсаппликатион**.  
  
3. В поле **имя**введите **консентдиалог**и нажмите кнопку **ОК**.  
  
4. В конструкторе щелкните форму.  
  
5. В окне **Свойства** измените значение свойства **текст** на **обновить диалоговое окно согласия**.  
  
6. На **панели элементов**разверните **все Windows Forms**и перетащите элемент управления **Label** в форму.  
  
7. В конструкторе щелкните элемент управления метка.  
  
8. В окне **Свойства** измените значение свойства **текст** в разделе **внешний вид** на следующее:  
  
    Приложение, которое вы собираетесь установить, проверяет наличие последних обновлений в Интернете. Нажимая кнопку "принимаю", вы разрешаете приложению проверять наличие обновлений и устанавливать их автоматически через Интернет.  
  
9. Перетащите элемент управления **CheckBox** на **панели элементов**в середину формы.  
  
10. В окне **Свойства** измените значение свойства **текст** в разделе **Макет** на **я принимаю**.  
  
11. В **области элементов**перетащите элемент управления **Button** в нижнюю левую часть формы.  
  
12. В окне **Свойства** измените свойство **Text** в разделе **Макет** , чтобы **Перейти**к выполнению.  
  
13. В окне **Свойства** измените свойство **(Name)** в разделе **Структура** на **процеедбуттон**.  
  
14. На **панели элементов**перетащите элемент управления **Button** в нижнюю правую форму.  
  
15. В окне **Свойства** измените значение свойства **текст** в разделе **Макет** на **Отмена**.  
  
16. В окне **Свойства** измените свойство **(Name)** в разделе **Структура** на **CancelButton**.  
  
17. В конструкторе дважды щелкните флажок **я принимаю** , чтобы создать обработчик событий CheckedChanged.  
  
18. В файле кода Form1 добавьте следующий код для обработчика событий CheckedChanged.  
  
     [!code-csharp[ConsentDialog#1](../snippets/csharp/VS_Snippets_ProTools/consentdialog/cs/form1.cs#1)]
     [!code-vb[ConsentDialog#1](../snippets/visualbasic/VS_Snippets_ProTools/consentdialog/vb/form1.vb#1)]  
  
19. Обновите конструктор класса, чтобы отключить кнопку " **продолжать** " по умолчанию.  
  
     [!code-csharp[ConsentDialog#6](../snippets/csharp/VS_Snippets_ProTools/consentdialog/cs/form1.cs#6)]
     [!code-vb[ConsentDialog#6](../snippets/visualbasic/VS_Snippets_ProTools/consentdialog/vb/form1.vb#6)]  
  
20. В файле кода Form1 добавьте следующий код для логической переменной, чтобы определить, не отправлял ли конечный пользователь на обновления в сети.  
  
     [!code-csharp[ConsentDialog#3](../snippets/csharp/VS_Snippets_ProTools/consentdialog/cs/form1.cs#3)]
     [!code-vb[ConsentDialog#3](../snippets/visualbasic/VS_Snippets_ProTools/consentdialog/vb/form1.vb#3)]  
  
21. В конструкторе дважды щелкните кнопку " **Далее** ", чтобы создать обработчик событий щелчка.  
  
22. В файле кода Form1 добавьте следующий код в обработчик событий Click для кнопки **продолжения** .  
  
     [!code-csharp[ConsentDialog#2](../snippets/csharp/VS_Snippets_ProTools/consentdialog/cs/form1.cs#2)]
     [!code-vb[ConsentDialog#2](../snippets/visualbasic/VS_Snippets_ProTools/consentdialog/vb/form1.vb#2)]  
  
23. В конструкторе дважды щелкните кнопку **Отмена** , чтобы создать обработчик событий щелчка.  
  
24. В файле кода Form1 добавьте следующий код для обработчика событий Click для кнопки **Отмена** .  
  
     [!code-csharp[ConsentDialog#4](../snippets/csharp/VS_Snippets_ProTools/consentdialog/cs/form1.cs#4)]
     [!code-vb[ConsentDialog#4](../snippets/visualbasic/VS_Snippets_ProTools/consentdialog/vb/form1.vb#4)]  
  
25. Обновите приложение, чтобы оно возвращало ошибку, если конечный пользователь не имеет согласия на обновления в сети.  
  
     Только для Visual Basic разработчиков:  
  
    1. В **Обозреватель решений**щелкните **консентдиалог**.  
  
    2. В меню **проект** выберите команду **Добавить модуль**, а затем нажмите кнопку **добавить**.  
  
    3. Добавьте в файл кода Module1. vb следующий код.  
  
        [!code-vb[ConsentDialog#7](../snippets/visualbasic/VS_Snippets_ProTools/consentdialog/vb/module1.vb#7)]  
  
    4. В меню **проект** выберите пункт **Свойства консентдиалог**и перейдите на вкладку **приложение** .  
  
    5. Снимите флажок **Включить платформу приложений**.  
  
    6. В раскрывающемся меню **начальный объект** выберите **Module1**.  
  
       > [!NOTE]
       > Отключение платформы приложений отключает такие функции, как стили оформления Windows XP, события приложений, экран-заставка, приложение с одним экземпляром и многое другое. Дополнительные сведения см. в разделе [Application Page, Project Designer (Visual Basic)](../ide/reference/application-page-project-designer-visual-basic.md).  
  
       Только для разработчиков на Visual C#:  
  
       Откройте файл кода Program.cs и добавьте следующий код.  
  
       [!code-csharp[ConsentDialog#5](../snippets/csharp/VS_Snippets_ProTools/consentdialog/cs/program.cs#5)]  
  
26. В меню **Сборка** выберите **BuildSolution**.  
  
## <a name="creating-the-custom-bootstrapper-package"></a>Создание пользовательского пакета начального загрузчика  
 Чтобы отобразить запрос о конфиденциальности для конечных пользователей, можно создать пользовательский пакет начального загрузчика для диалогового окна согласия на обновление и включить его в качестве необходимого компонента во все приложения ClickOnce.  
  
 В этой процедуре показано, как создать пользовательский пакет начального загрузчика, создав следующие документы:  
  
- Файл манифеста product.xml для описания содержимого начального загрузчика.  
  
- Файл манифеста package.xml для перечисления аспектов пакета, зависящих от локализации, таких как строки и условия лицензии на программное обеспечение.  
  
- Документ с условиями лицензии на программное обеспечение.  
  
#### <a name="step-1-to-create-the-bootstrapper-directory"></a>Шаг 1. Создание каталога начального загрузчика  
  
1. Создайте каталог с именем **упдатеконсентдиалог** в%ProgramFiles%\Microsoft SDKs\Windows\v7.0A\Bootstrapper\Packages.  
  
    > [!NOTE]
    > Для создания этой папки могут потребоваться права администратора.  
  
2. В каталоге Упдатеконсентдиалог создайте подкаталог с именем en.  
  
    > [!NOTE]
    > Создайте новый каталог для каждого языкового стандарта. Например, можно добавить подкаталоги для языков fr и de. При необходимости эти каталоги будут содержать строки на французском и немецком языках, а также языковые пакеты.  
  
#### <a name="step-2-to-create-the-productxml-manifest-file"></a>Шаг 2. Создание файла манифеста product.xml  
  
1. Создайте текстовый файл с именем `product.xml` .  
  
2. В файл product.xml добавьте следующий XML-код. Убедитесь, что вы не перезаписали существующий XML-код.  
  
    ```  
    <Product  
      xmlns="http://schemas.microsoft.com/developer/2004/01/bootstrapper"  
      ProductCode="Microsoft.Sample.EULA">  
      <!-- Defines the list of files to be copied on build. -->  
      <PackageFiles CopyAllPackageFiles="false">  
        <PackageFile Name="ConsentDialog.exe"/>  
      </PackageFiles>  
  
      <!-- Defines how to run the Setup package.-->  
      <Commands >  
        <Command PackageFile = "ConsentDialog.exe" Arguments=''>  
          <ExitCodes>  
            <ExitCode Value="0" Result="Success" />  
            <ExitCode Value="-1" Result="Fail" String="AU_Unaccepted" />  
            <DefaultExitCode Result="Fail"   
              FormatMessageFromSystem="true" String="GeneralFailure" />  
          </ExitCodes>  
        </Command>  
      </Commands>  
  
    </Product>  
    ```  
  
3. Сохраните файл в каталоге начального загрузчика Упдатеконсентдиалог.  
  
#### <a name="step-3-to-create-the-packagexml-manifest-file-and-the-software-license-terms"></a>Шаг 3. Создание файла манифеста package.xml и условий лицензионного соглашения на использование программного обеспечения  
  
1. Создайте текстовый файл с именем `package.xml` .  
  
2. В файле package.xml добавьте следующий XML-код, чтобы определить языковой стандарт и включить условия лицензионного соглашения на использование программного обеспечения. Убедитесь, что вы не перезаписали существующий XML-код.  
  
    ```  
    <Package   
      xmlns="http://schemas.microsoft.com/developer/2004/01/bootstrapper"  
      Name="DisplayName"  
      Culture="Culture"  
      LicenseAgreement="eula.rtf">  
      <PackageFiles>  
        <PackageFile Name="eula.rtf"/>  
      </PackageFiles>  
  
      <!-- Defines a localizable string table for error messages. -->  
      <Strings>  
        <String Name="DisplayName">Update Consent Dialog</String>  
        <String Name="Culture">en</String>  
        <String Name="AU_Unaccepted">The automatic update agreement is not accepted.</String>  
        <String Name="GeneralFailure">A failure occurred attempting to launch the setup.</String>  
      </Strings>  
    </Package>  
    ```  
  
3. Сохраните файл в подкаталог EN в каталоге начального загрузчика Упдатеконсентдиалог.  
  
4. Создайте документ с именем EULA. RTF для условий лицензионного соглашения на использование программного обеспечения.  
  
    > [!NOTE]
    > Условия лицензии на программное обеспечение должны включать сведения о лицензировании, гарантиях, обязательствах и местных законах. Эти файлы должны быть специфичными для определенного языкового стандарта, поэтому убедитесь, что файл сохранен в формате, который поддерживает символы MBCS или UNICODE. Обратитесь к своему юридическому отделу о содержимом условий лицензионного соглашения на использование программного обеспечения.  
  
5. Сохраните документ в подкаталог EN в каталоге начального загрузчика Упдатеконсентдиалог.  
  
6. При необходимости создайте новый файл манифеста package.xml и новый документ EULA. RTF для условий лицензионного соглашения на использование программного обеспечения для каждого языкового стандарта. Например, если были созданы подкаталоги для языков fr и de, создайте отдельные файлы манифеста package.xml и условия лицензионного соглашения на использование программного обеспечения и сохраните их в подкаталогах fr и de.  
  
## <a name="setting-the-update-consent-application-as-a-prerequisite"></a>Настройка приложения согласия на обновление в качестве необходимого компонента  
 В Visual Studio можно задать приложение согласия на обновление как необходимое условие.  
  
#### <a name="to-set-the-update-consent-application-as-a-prerequisite"></a>Установка приложения согласия на обновление в качестве необходимого компонента  
  
1. В **Обозреватель решений**щелкните имя приложения, которое требуется развернуть.  
  
2. В меню **Проект** выберите пункт *Имя проекта* **Свойства**.  
  
3. Щелкните страницу **Публикация** и выберите **необходимые компоненты**.  
  
4. Выберите **диалоговое окно обновления согласия**.  
  
    > [!NOTE]
    > Возможно, потребуется закрыть и снова открыть Visual Studio, чтобы открыть диалоговое окно "согласие на обновление" в диалоговом окне "необходимые компоненты".  
  
5. Нажмите кнопку **ОК**.  
  
## <a name="creating-and-testing-the-setup-program"></a>Создание и тестирование программы установки  
 После установки приложения согласия на обновление в качестве необходимого компонента можно создать установщик и загрузчик для приложения.  
  
#### <a name="to-create-and-test-the-setup-program-by-not-clicking-i-agree"></a>Создание и тестирование программы установки без нажатия кнопки «я принимаю»  
  
1. В **Обозреватель решений**щелкните имя приложения, которое требуется развернуть.  
  
2. В меню **Проект** выберите пункт *Имя проекта* **Свойства**.  
  
3. Перейдите на страницу **Публикация** и нажмите кнопку **Опубликовать сейчас**.  
  
4. Если выходные данные публикации не открываются автоматически, перейдите к выходу публикации.  
  
5. Запустите программу Setup.exe.  
  
     Программа установки отображает лицензионное соглашение на использование диалогового окна "согласие на обновление".  
  
6. Прочитайте лицензионное соглашение на использование программного обеспечения и нажмите кнопку **принять**.  
  
     Откроется диалоговое окно согласия на обновление, в котором будет показан следующий текст: приложение, которое вы собираетесь установить, проверяет наличие последних обновлений в Интернете. Нажимая кнопку "принимаю", вы разрешаете приложению автоматически проверять наличие обновлений в Интернете.  
  
7. Закройте приложение или нажмите кнопку Отмена.  
  
     В приложении отображается ошибка: при установке системных компонентов для *applicationName*произошла ошибка. Установка не может быть продолжена до тех пор, пока все системные компоненты не будут успешно установлены.  
  
8. Нажмите кнопку сведения, чтобы отобразить следующее сообщение об ошибке: диалоговое окно согласия обновления компонента не удалось установить со следующим сообщением об ошибке: "соглашение об автоматическом обновлении не принято". Не удалось установить следующие компоненты:-диалоговое окно согласия на обновление  
  
9. Щелкните **Закрыть**.  
  
#### <a name="to-create-and-test-the-setup-program-by-clicking-i-agree"></a>Чтобы создать и протестировать программу установки, нажмите кнопку Принимаю  
  
1. В **Обозреватель решений**щелкните имя приложения, которое требуется развернуть.  
  
2. В меню **Проект** выберите пункт *Имя проекта* **Свойства**.  
  
3. Перейдите на страницу **Публикация** и нажмите кнопку **Опубликовать сейчас**.  
  
4. Если выходные данные публикации не открываются автоматически, перейдите к выходу публикации.  
  
5. Запустите программу Setup.exe.  
  
     Программа установки отображает лицензионное соглашение на использование диалогового окна "согласие на обновление".  
  
6. Прочитайте лицензионное соглашение на использование программного обеспечения и нажмите кнопку **принять**.  
  
     Откроется диалоговое окно согласия на обновление, в котором будет показан следующий текст: приложение, которое вы собираетесь установить, проверяет наличие последних обновлений в Интернете. Нажимая кнопку "принимаю", вы разрешаете приложению автоматически проверять наличие обновлений в Интернете.  
  
7. Установите флажок **я принимаю**, а затем нажмите кнопку " **Далее**".  
  
     Приложение начинает установку.  
  
8. Если откроется диалоговое окно Установка приложения, нажмите кнопку **установить**.  
  
## <a name="see-also"></a>См. также:  
 [Необходимые условия для развертывания приложения](../deployment/application-deployment-prerequisites.md)   
 [Создание пакетов начального загрузчика](../deployment/creating-bootstrapper-packages.md)   
 [Как создать манифест продукта](../deployment/how-to-create-a-product-manifest.md)   
 [Как создать манифест пакета](../deployment/how-to-create-a-package-manifest.md)   
 [Справочные сведения о схеме пакетов и продуктов](../deployment/product-and-package-schema-reference.md)
