---
title: Пошаговое руководство. Развертывание вручную приложения ClickOnce | Документация Майкрософт
ms.date: 11/15/2016
ms.prod: visual-studio-dev14
ms.technology: vs-ide-deployment
ms.topic: conceptual
dev_langs:
- VB
- CSharp
- C++
helpviewer_keywords:
- Mage.exe, manual ClickOnce deployments
- MageUI.exe, manual ClickOnce deployments
- deploying applications [ClickOnce], manual ClickOnce deployments
- ClickOnce deployment, manually
- ClickOnce deployment, SDK tools
- manual ClickOnce deployments
- manifests [ClickOnce]
ms.assetid: ccee6551-a1b9-4ca2-8845-9c1cf4ac2560
caps.latest.revision: 51
author: mikejo5000
ms.author: mikejo
manager: jillfra
ms.openlocfilehash: 239fdcea9b8b9613bcdaa2419aba211c2a2a98f4
ms.sourcegitcommit: 08fc78516f1107b83f46e2401888df4868bb1e40
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 05/15/2019
ms.locfileid: "65686330"
---
# <a name="walkthrough-manually-deploying-a-clickonce-application"></a>Пошаговое руководство. Развертывание вручную приложения ClickOnce
[!INCLUDE[vs2017banner](../includes/vs2017banner.md)]

Если Visual Studio нельзя использовать для развертывания вашего [!INCLUDE[ndptecclick](../includes/ndptecclick-md.md)] приложения, или если необходимо использовать дополнительные функции развертывания, например технологии развертывания доверенных приложений следует использовать средство командной строки Mage.exe для создания вашего [!INCLUDE[ndptecclick](../includes/ndptecclick-md.md)] манифесты. В этом пошаговом руководстве описывается создание [!INCLUDE[ndptecclick](../includes/ndptecclick-md.md)] развертывания с помощью командной строки версии (Mage.exe) или графической версии (MageUI.exe) Manifest Generation and Editing Tool.  
  
## <a name="prerequisites"></a>Предварительные требования  
 В этом пошаговом руководстве имеет некоторые предварительные условия и параметры, которые необходимо выбрать до создания развертывания.  
  
- Установите Mage.exe и MageUI.exe.  
  
     Mage.exe и MageUI.exe являются частью [!INCLUDE[winsdklong](../includes/winsdklong-md.md)]. Вы должны либо иметь [!INCLUDE[winsdkshort](../includes/winsdkshort-md.md)] установлен или версию [!INCLUDE[winsdkshort](../includes/winsdkshort-md.md)] поставляемой с Visual Studio. Дополнительные сведения см. в разделе [пакета Windows SDK](http://go.microsoft.com/fwlink/?LinkId=158044) на сайте MSDN.  
  
- Создать приложения для развертывания.  
  
     В этом пошаговом руководстве предполагается, что это приложение Windows, которое вы готовы к развертыванию. Это приложение будет называться AppToDeploy.  
  
- Определите, как будут распределяться развертывания.  
  
     Возможны следующие варианты: Интернет, файловый ресурс или компакт-диска. Для получения дополнительной информации см. [ClickOnce Security and Deployment](../deployment/clickonce-security-and-deployment.md).  
  
- Определите, требуется ли приложению повышенного уровня доверия.  
  
     Если приложение требует полного доверия, например, полный доступ к системе пользователя, можно использовать `-TrustLevel` параметр Mage.exe для этого. Если вы хотите определить пользовательский набор разрешений для приложения, можно скопировать в разделе разрешения в Интернете или интрасети из другого манифеста, изменить его в соответствии с потребностями и его добавления в манифест приложения, используя текстовый редактор или MageUI.exe. Для получения дополнительной информации см. [Trusted Application Deployment Overview](../deployment/trusted-application-deployment-overview.md).  
  
- Получите сертификат Authenticode.  
  
     Следует подписать развертывание с помощью сертификата Authenticode. Можно создать тестовый сертификат с помощью средств Visual Studio, MageUI.exe, или MakeCert.exe и Pvk2Pfx.exe, или сертификат можно получить из центром сертификации (ЦС). Если вы решили использовать развертывание доверенных приложений, необходимо также выполнить однократную установку сертификата на всех клиентских компьютерах. Для получения дополнительной информации см. [Trusted Application Deployment Overview](../deployment/trusted-application-deployment-overview.md).  
  
    > [!NOTE]
    > Также можно подписать развертывание с сертификатом CNG, который можно получить в центре сертификации.  
  
- Убедитесь, что у приложения нет манифеста с помощью сведений об UAC.  
  
     Необходимо определить, содержит ли приложение манифест со сведениями контроля учетных записей (UAC), такие как `<dependentAssembly>` элемент. Чтобы просмотреть манифест приложения, можно использовать Windows Sysinternals [Sigcheck](http://go.microsoft.com/fwlink/?LinkId=158035) служебной программы.  
  
     Если приложение содержит манифест с подробными сведениями контроля учетных Записей, необходимо повторно создать его без сведений об UAC. Для проекта C# в Visual Studio откройте свойства проекта и выберите вкладку "приложения". В **манифеста** стрелку раскрывающегося списка выберите **создать приложение без манифеста**. Для проекта Visual Basic в Visual Studio, откройте свойства проекта, выберите вкладку "приложения" и нажмите кнопку **параметров контроля учетных Записей представление**. В открытом файле манифеста, удалите все элементы с одним `<asmv1:assembly>` элемент.  
  
- Определите, требуется ли приложению необходимые компоненты на клиентском компьютере.  
  
     [!INCLUDE[ndptecclick](../includes/ndptecclick-md.md)] приложения, развертываемые из Visual Studio, могут включать предварительные условия для установки загрузчика (setup.exe) с развертыванием. В этом пошаговом руководстве создается два манифеста, необходимые для [!INCLUDE[ndptecclick](../includes/ndptecclick-md.md)] развертывания. Загрузчик необходимых компонентов можно создать с помощью [задача GenerateBootstrapper](../msbuild/generatebootstrapper-task.md).  
  
### <a name="to-deploy-an-application-with-the-mageexe-command-line-tool"></a>Чтобы развернуть приложение с помощью средства командной строки Mage.exe  
  
1. Создайте каталог, где будут храниться ваши [!INCLUDE[ndptecclick](../includes/ndptecclick-md.md)] файлы развертывания.  
  
2. В каталоге развертывания, который вы только что создали создайте подпапку версии. Если это первый раз, что вы развертываете приложение, имя, которое в подпапку версии **1.0.0.0**.  
  
    > [!NOTE]
    > Версия развертывания может отличаться от версии приложения.  
  
3. Скопируйте все файлы приложения в подпапку версии, включая исполняемые файлы, сборки, ресурсы и файлы данных. При необходимости можно создать дополнительные вложенные каталоги, содержащие дополнительные файлы.  
  
4. Откройте [!INCLUDE[winsdkshort](../includes/winsdkshort-md.md)] или команды Visual Studio и замените в подпапку версии.  
  
5. Создайте манифест приложения с помощью вызова Mage.exe. Следующая инструкция создает манифест приложения для кода, скомпилированного для выполнения на процессоре Intel x86.  
  
    ```  
    mage -New Application -Processor x86 -ToFile AppToDeploy.exe.manifest -name "My App" -Version 1.0.0.0 -FromDirectory .   
    ```  
  
    > [!NOTE]
    > Не забудьте включить точку (.) после `-FromDirectory` параметр, который указывает на текущий каталог. Если точка не будет включен, необходимо указать путь к файлам приложения.  
  
6. Подписать манифест приложения с помощью сертификата Authenticode. Замените *mycert.pfx* с путем к файлу сертификата. Замените *passwd* с паролем для файла сертификата.  
  
    ```  
    mage -Sign AppToDeploy.exe.manifest -CertFile mycert.pfx -Password passwd  
    ```  
  
     Чтобы подписать манифест приложения с сертификатом CNG, используйте следующий код. Замените *cngCert.pfx* с путем к файлу сертификата.  
  
    ```  
    mage -Sign AppToDeploy.exe.manifest -CertFile cngCert.pfx  
    ```  
  
7. Измените корневой каталог развертывания.  
  
8. Создайте манифест развертывания с помощью вызова Mage.exe. По умолчанию пометит Mage.exe вашей [!INCLUDE[ndptecclick](../includes/ndptecclick-md.md)] развертывания как установленное приложение, так что он может выполняться как в интерактивном и автономном режиме. Чтобы сделать приложение доступным только в том случае, если пользователь находится в сети, используйте `-Install` параметр со значением `false`. Если пользователи будут устанавливать приложение из веб-сайт или общую папку по умолчанию, убедитесь, что значение `-ProviderUrl` манифеста указывает расположение приложения на веб-сервер или общую папку.  
  
    ```  
    mage -New Deployment -Processor x86 -Install true -Publisher "My Co." -ProviderUrl "\\myServer\myShare\AppToDeploy.application" -AppManifest 1.0.0.0\AppToDeploy.exe.manifest -ToFile AppToDeploy.application  
    ```  
  
9. Подписать манифест развертывания с помощью сертификата Authenticode или CNG.  
  
    ```  
    mage -Sign AppToDeploy.application -CertFile mycert.pfx -Password passwd  
    ```  
  
     или  
  
    ```  
    mage -Sign AppToDeploy.exe.manifest -CertFile cngCert.pfx  
    ```  
  
10. Скопируйте все файлы в каталоге развертывания назначение развертывания или носителя. Это может быть папка на веб-сайта или сайта FTP, общей папки или компакт-диска.  
  
11. Предоставить пользователям URL-адрес, UNC-путь или носитель, необходимые для установки приложения. Если указать URL-адрес или UNC-путь, необходимо предоставить пользователям полный путь к манифесту развертывания. Например, если развертывается AppToDeploy http://webserver01/ в каталоге AppToDeploy полный путь URL-адрес будет иметь http://webserver01/AppToDeploy/AppToDeploy.application.  
  
### <a name="to-deploy-an-application-with-the-mageuiexe-graphical-tool"></a>Чтобы развернуть приложение с помощью графического средства MageUI.exe  
  
1. Создайте каталог, где будут храниться ваши [!INCLUDE[ndptecclick](../includes/ndptecclick-md.md)] файлы развертывания.  
  
2. В каталоге развертывания, который вы только что создали создайте подпапку версии. Если это первый раз, что вы развертываете приложение, имя, которое в подпапку версии **1.0.0.0**.  
  
    > [!NOTE]
    > Версия развертывания может отличаться от версии приложения.  
  
3. Скопируйте все файлы приложения в подпапку версии, включая исполняемые файлы, сборки, ресурсы и файлы данных. При необходимости можно создать дополнительные вложенные каталоги, содержащие дополнительные файлы.  
  
4. Запуск графического средства MageUI.exe.  
  
    ```  
    MageUI.exe  
    ```  
  
5. Создайте новый манифест приложения, выбрав **файл**, **New**, **манифест приложения** в меню.  
  
6. По умолчанию **имя** вкладке, введите имя и номер версии данного развертывания. Также укажите **процессора** , сборки приложения, например x86.  
  
7. Выберите **файлы** и нажмите кнопку с многоточием (**...** ) рядом с пунктом **каталога приложения** текстовое поле. Появится диалоговое окно Выбор папки.  
  
8. Выберите в подпапку версии, содержащий файлы приложения и нажмите кнопку **ОК**.  
  
9. Если вы развернете из Internet Information Services (IIS), выберите **при заполнении добавить расширение .deploy любой файл, который не имеет** "флажок".  
  
10. Нажмите кнопку **заполнить** кнопку, чтобы добавить все файлы приложения в список файлов. Если приложение содержит более одного исполняемого файла, пометьте главный исполняемый файл для этого развертывания в качестве запускаемого приложения, выбрав **точки входа** из **тип файла** стрелку раскрывающегося списка. (Если приложение содержит только один исполняемый файл, MageUI.exe пометит его автоматически.)  
  
11. Выберите **разрешения, необходимые** и выберите уровень доверия, что требуется приложению. По умолчанию используется **FullTrust**, которое подойдет для большинства приложений.  
  
12. Выберите **файл**, **Сохранить как** в меню. Параметры создания подписей диалоговое окно появляется при попытке подписать манифест приложения.  
  
13. При наличии сертификата, хранящегося в виде файла в файловой системе, используйте **подписывать с файлом сертификата** и выберите сертификат из файловой системы, нажав кнопку с многоточием (**...** ) кнопку. Затем введите пароль сертификата.  
  
     -или-  
  
     Если сертификат содержится в хранилище сертификатов, доступном с компьютера, выберите **входа, сохраненным сертификатом** и выберите сертификат из предоставленного списка.  
  
14. Нажмите кнопку **ОК** чтобы подписать манифест приложения. Будет открыто диалоговое окно Сохранить как.  
  
15. В диалоговом окне Сохранение укажите каталог версии и нажмите кнопку **Сохранить**.  
  
16. Выберите **файл**, **New**, **манифест развертывания** меню, чтобы создать манифест развертывания.  
  
17. На **имя** задайте имя и номер версии для этого развертывания (**1.0.0.0** в этом примере). Также укажите **процессора** , сборки приложения, например x86.  
  
18. Выберите **описание** и укажите значения для **издателя** и **продукта**. (**Продукта** — это имя, данное приложение в меню Пуск в Windows при установке приложения на клиентский компьютер для автономного использования.)  
  
19. Выберите **варианты развертывания** вкладку и в **начальное расположение** текстовом окне укажите расположение манифеста приложения на веб-сервера или общей папки. Например \\\myServer\myShare\AppToDeploy.application.  
  
20. Если вы добавили расширение .deploy на предыдущем шаге, также выберите **использовать расширение .deploy** здесь.  
  
21. Выберите **параметры обновления** вкладке и укажите частоту обновления приложения. Если приложение использует <xref:System.Deployment.Application.UpdateCheckInfo> для самостоятельной проверки обновлений, снимите **это приложение должно проверять наличие обновлений** "флажок".  
  
22. Выберите **ссылка приложения** вкладке и нажмите кнопку **выбрать манифест** кнопки. Откройте диалоговое окно.  
  
23. Выберите манифест приложения, который был создан ранее и нажмите кнопку **откройте**.  
  
24. Выберите **файл**, **Сохранить как** в меню. Параметры создания подписей диалоговое окно появляется при попытке подписать манифест развертывания.  
  
25. При наличии сертификата, хранящегося в виде файла в файловой системе, используйте **подписывать с файлом сертификата** и выберите сертификат из файловой системы, нажав кнопку с многоточием (**...** ) кнопку. Затем введите пароль сертификата.  
  
     -или-  
  
     Если сертификат содержится в хранилище сертификатов, доступном с компьютера, выберите **входа, сохраненным сертификатом** и выберите сертификат из предоставленного списка.  
  
26. Нажмите кнопку **ОК** чтобы подписать манифест развертывания. Будет открыто диалоговое окно Сохранить как.  
  
27. В **Сохранить как** диалоговое окно, перемещение на один уровень выше в корневой каталог развертывания и нажмите кнопку **Сохранить**.  
  
28. Скопируйте все файлы в каталоге развертывания назначение развертывания или носителя. Это может быть папка на веб-сайта или сайта FTP, общей папки или компакт-диска.  
  
29. Предоставить пользователям URL-адрес, UNC-путь или носитель, необходимые для установки приложения. Если указать URL-адрес или UNC-путь, необходимо предоставить пользователям полный путь манифеста развертывания. Например, если развертывается AppToDeploy http://webserver01/ в каталоге AppToDeploy полный путь URL-адрес будет иметь http://webserver01/AppToDeploy/AppToDeploy.application.  
  
## <a name="next-steps"></a>Следующие шаги  
 Если необходимо развернуть новую версию приложения, создайте новый каталог с именем новой версии — например, 1.0.0.1—and скопируйте файлы нового приложения в новый каталог. Далее необходимо выполнить приведенные выше шаги, чтобы создать и подписать новый манифест приложения и обновить и подписать манифест развертывания. Будьте внимательны указать ту же версию, более поздней версии в Mage.exe `-New` и `–Update` вызовы, как [!INCLUDE[ndptecclick](../includes/ndptecclick-md.md)] обновляет только новые версии с наибольшее целое число слева. Если вы использовали MageUI.exe, можно обновить манифест развертывания, открыв его, выбрав **ссылка приложения** вкладки, щелкнув **выбрать манифест** кнопку, а затем выбрав обновленный манифест приложения.  
  
## <a name="see-also"></a>См. также  
 [Mage.exe (средство создания и редактирования манифеста)](https://msdn.microsoft.com/library/77dfe576-2962-407e-af13-82255df725a1)   
 [MageUI.exe (средство создания и редактирования манифестов, графический клиент)](https://msdn.microsoft.com/library/f9e130a6-8117-49c4-839c-c988f641dc14)   
 [Публикация приложений ClickOnce](../deployment/publishing-clickonce-applications.md)   
 [Манифест развертывания ClickOnce](../deployment/clickonce-deployment-manifest.md)   
 [ClickOnce Application Manifest](../deployment/clickonce-application-manifest.md)
