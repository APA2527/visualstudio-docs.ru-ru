---
title: Выбор стратегии обновления ClickOnce | Документация Майкрософт
ms.date: 11/15/2016
ms.prod: visual-studio-dev14
ms.technology: vs-ide-deployment
ms.topic: conceptual
dev_langs:
- VB
- CSharp
- C++
helpviewer_keywords:
- application updates, ClickOnce
- updates, ClickOnce
- ClickOnce deployment, update strategies
ms.assetid: d8b6e7bb-4ea0-47f3-91cd-48580bdceccc
caps.latest.revision: 25
author: mikejo5000
ms.author: mikejo
manager: jillfra
ms.openlocfilehash: 8215b8e0955b79224341d5d43b51a473740f5fe5
ms.sourcegitcommit: 47eeeeadd84c879636e9d48747b615de69384356
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/23/2019
ms.locfileid: "63442341"
---
# <a name="choosing-a-clickonce-update-strategy"></a>Выбор стратегии обновления ClickOnce
[!INCLUDE[vs2017banner](../includes/vs2017banner.md)]

[!INCLUDE[ndptecclick](../includes/ndptecclick-md.md)] может предоставлять автоматические обновления приложения. Приложение [!INCLUDE[ndptecclick](../includes/ndptecclick-md.md)] периодически читает файл своего манифеста развертывания, чтобы узнать, имеются ли обновления приложения. Если обновление доступно, загружается и выполняется новая версия приложения. Для обеспечения эффективности работы загружаются только измененные файлы.  
  
 При разработке приложения [!INCLUDE[ndptecclick](../includes/ndptecclick-md.md)] необходимо определить стратегию, используемую приложением для проверки доступных обновлений. Существует три базовые стратегии, которые можно использовать: проверка наличия обновлений при запуске приложения, проверка наличия обновлений после запуска приложения (выполнение в фоновом потоке) или предоставление пользовательского интерфейса для обновлений.  
  
 Кроме того, можно определить частоту проверок приложением наличия обновлений и можно выполнить требуемые обновления.  
  
> [!NOTE]
> Для обновлений приложений необходима связность узлов сети. Если сетевое подключение отсутствует, приложение выполняется без проверки наличия обновлений независимо от выбранной стратегии обновлений.  
  
> [!NOTE]
> В .NET Framework 2.0 и .NET Framework 3.0 при проверке приложением наличия обновлений в любое время, до или после запуска, либо с помощью API-функции <xref:System.Deployment.Application> необходимо установить параметр `deploymentProvider` в манифесте развертывания. Элемент `deploymentProvider` соответствует в Visual Studio полю **Местоположение обновления** в диалоговом окне **Обновления** на вкладке **Публикация**. Это правило — нестрогое в .NET Framework 3.5. Дополнительные сведения см. в разделе [развертывание ClickOnce приложений для тестирования и рабочих серверов без Resigning](../deployment/deploying-clickonce-applications-for-testing-and-production-servers-without-resigning.md).  
  
## <a name="checking-for-updates-after-application-startup"></a>Проверка наличия обновлений после запуска приложения  
 Используя эту стратегию, приложение пытается найти и прочитать файл манифеста развертывания в фоновом режиме во время работы приложения. Если обновление доступно, при следующем запуске пользователем приложения будет выведен запрос на загрузку и установку обновления.  
  
 Эта стратегия оптимальна для малопроизводительных сетевых подключений и для больших приложений, которым могут потребоваться продолжительные загрузки.  
  
 Чтобы включить эту стратегию обновления, щелкните **После запуска приложения** в разделе **Выбрать, когда приложение должно проверять наличие обновлений** диалогового окна **Обновления приложения**. Затем укажите интервал обновления в разделе **Указать, как часто приложение должно проверять обновления**.  
  
 Это то же самое, что и изменение в манифесте развертывания элемента **Обновление** следующим образом:  
  
```  
<!-- When to check for updates -->  
<subscription>  
   <update>  
      <expiration maximumAge="6" unit="hours" />  
   </update>  
</subscription>  
```  
  
## <a name="checking-for-updates-before-application-startup"></a>Проверка наличия обновлений до запуска приложения  
 Стратегия по умолчанию представляет собой поиск и чтение файла манифеста развертывания до запуска приложения. Используя данную стратегию, приложение пытается найти и прочитать файл манифеста развертывания при каждом запуске приложения. Если обновление доступно, оно загружается и запускается; в противном случае запускается существующая версия приложения.  
  
 Данная стратегия оптимальна для высокопроизводительных сетевых подключений; при использовании малопроизводительных подключений задержка в запуске приложения может быть неприемлемо большой.  
  
 Чтобы включить данную стратегию обновления, щелкните **До запуска приложения** в разделе **Выбрать, когда приложение должно проверять наличие обновлений** диалогового окна **Обновления приложения**.  
  
 Это то же самое, что и изменение в манифесте развертывания элемента **Обновление** следующим образом:  
  
```  
<!-- When to check for updates -->  
<subscription>  
   <update>  
      <beforeApplicationStartup />  
   </update>  
</subscription>  
```  
  
## <a name="making-updates-required"></a>Перевод обновлений в разряд обязательных  
 Возможны случаи, когда необходимо, чтобы пользователи запускали обновленную версию приложения в обязательном порядке. Например, может потребоваться внесение во внешний ресурс, такой как веб-служба, изменения, которое не позволит правильно работать более ранней версии приложения. В этом случае желательно пометить обновление как обязательное и тем самым предотвратить запуск пользователями более ранней версии приложения.  
  
> [!NOTE]
> Хотя обновления можно сделать обязательными с помощью других стратегий обновления, проверка **До запуска приложения** является единственным способом гарантировать, что более старая версия не сможет быть запущена. Когда при запуске обнаруживается обязательное обновление, пользователь должен либо принять обновление, либо закрыть приложение.  
  
 Для пометки обновления как обязательного щелкните **Указать минимальную требуемую версию этого приложения** в диалоговом окне **Обновления приложения**, а затем укажите версию публикации (**Основная**, **Второстепенная**, **Сборка**, **Редакция**), задающую минимальный номер версии приложения, которая может быть установлена.  
  
 Это то же самое, что и установка атрибута **minimumRequiredVersion** элемента **Deployment** в манифесте развертывания; например:  
  
```  
<deployment install="true" minimumRequiredVersion="1.0.0.0">  
```  
  
## <a name="specifying-update-intervals"></a>Задание интервалов обновления  
 Можно также указать, как часто приложение должно проверять наличие обновлений. Чтобы сделать это, укажите, что приложение проверяет наличие обновлений после запуска, как описано выше в разделе "Проверка наличия обновлений после запуска приложения" этой статьи.  
  
 Чтобы задать интервал обновления, установите свойства в разделе **Указать, как часто приложение должно проверять обновления** в диалоговом окне **Обновления приложения**.  
  
 Это то же самое, что установка атрибутов **maximumAge** и **unit** элемента **Update** в манифесте развертывания.  
  
 Например, проверка может выполняться при каждом запуске приложения, или один раз в неделю, или один раз в месяц. Если сетевое подключение отсутствует в заданное время, проверка обновления выполняется в следующий указанный момент.  
  
## <a name="providing-a-user-interface-for-updates"></a>Предоставление пользовательского интерфейса для обновлений  
 При использовании этой стратегии разработчик приложения предоставляет пользовательский интерфейс, который дает пользователю возможность выбирать время и частоту проверок приложением наличия обновлений. Например, может предоставляться команда "Check for Updates Now" (Проверить наличие обновлений сейчас) или диалоговое окно "Параметры обновления" с вариантами выбора разных интервалов обновления. API развертывания [!INCLUDE[ndptecclick](../includes/ndptecclick-md.md)] предоставляет основу для программирования собственного пользовательского интерфейса обновлений. Дополнительные сведения см. в описании пространства имен <xref:System.Deployment.Application>.  
  
 Если приложение использует функции API развертывания для управления собственным алгоритмом обновления, следует блокировать проверку обновлений, как описано в теме "Блокирование проверки обновлений" в следующих разделах.  
  
 Эта стратегия оптимальна для случаев, когда для разных пользователей требуются разные стратегии обновления.  
  
## <a name="blocking-update-checking"></a>Блокирование проверки обновлений  
 Имеется также возможность запрета проверки приложением наличия обновлений. Например, может иметься простое приложение, которое никогда не будет обновляться, но необходимо воспользоваться преимуществом простой установки, предлагаемым технологией развертывания [!INCLUDE[ndptecclick](../includes/ndptecclick-md.md)].  
  
 Проверку наличия обновлений следует также блокировать, если приложение использует функции API развертывания для выполнения своих собственных обновлений; см. выше в этой статье тему "Предоставление пользовательского интерфейса для обновлений".  
  
 Чтобы блокировать проверку обновлений, снимите флажок **Приложение должно проверять доступные обновления** в диалоговом окне "Обновления приложения".  
  
 Проверку наличия обновлений можно также блокировать, удалив из манифеста развертывания тег `<Subscription>`.  
  
## <a name="permission-elevation-and-updates"></a>Повышение уровня разрешений и обновления  
 Если для выполнения новой версии приложения [!INCLUDE[ndptecclick](../includes/ndptecclick-md.md)] требуется более высокий уровень доверия, чем для предыдущей версии, [!INCLUDE[ndptecclick](../includes/ndptecclick-md.md)] запрашивает у пользователя, следует ли предоставить приложению этот более высокий уровень доверия. Если пользователь не может гарантировать высокий уровень доверия, обновление не будет установлено. При следующем перезапуске [!INCLUDE[ndptecclick](../includes/ndptecclick-md.md)] снова запросит у пользователя разрешение на установку приложения. Если на этом этапе пользователь отклонит предоставление более высокого уровня доверия, и обновление не помечено как обязательное, запустится старая версия приложения. Однако если обновление является обязательным, приложение не запустится повторно до тех пор, пока пользователь не разрешит предоставление более высокого уровня доверия.  
  
 Если используется технология развертывания доверенных приложений, запрос по уровням доверия не будет выводиться. Для получения дополнительной информации см. [Trusted Application Deployment Overview](../deployment/trusted-application-deployment-overview.md).  
  
## <a name="see-also"></a>См. также  
 <xref:System.Deployment.Application>   
 [Развертывание и безопасность технологии ClickOnce](../deployment/clickonce-security-and-deployment.md)   
 [Выбор стратегии развертывания ClickOnce](../deployment/choosing-a-clickonce-deployment-strategy.md)   
 [Защита приложений ClickOnce](../deployment/securing-clickonce-applications.md)   
 [Выполнение обновлений приложения службой ClickOnce](../deployment/how-clickonce-performs-application-updates.md)   
 [Практическое руководство. Управление обновлениями для ClickOnce-приложения](../deployment/how-to-manage-updates-for-a-clickonce-application.md)
