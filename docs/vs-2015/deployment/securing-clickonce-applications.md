---
title: Защита приложений ClickOnce | Документация Майкрософт
ms.date: 11/15/2016
ms.prod: visual-studio-dev14
ms.technology: vs-ide-deployment
ms.topic: conceptual
dev_langs:
- VB
- CSharp
- C++
helpviewer_keywords:
- Windows applications, ClickOnce security
- ClickOnce deployment, security
- deploying applications, ClickOnce security
ms.assetid: a05b5f2f-d1f2-471a-8096-8b11f7554265
caps.latest.revision: 47
author: mikejo5000
ms.author: mikejo
manager: jillfra
ms.openlocfilehash: 2a2610c1fef92bb77d150dad7972bb991b6ef4a4
ms.sourcegitcommit: 08fc78516f1107b83f46e2401888df4868bb1e40
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 05/15/2019
ms.locfileid: "65686009"
---
# <a name="securing-clickonce-applications"></a>Защита приложений ClickOnce
[!INCLUDE[vs2017banner](../includes/vs2017banner.md)]

К приложению[!INCLUDE[ndptecclick](../includes/ndptecclick-md.md)] могут применяться ограничения управления доступом для кода на платформе .NET Framework, позволяющие ограничить доступ кода к защищенным ресурсам и операциям. Важно понимать влияние управления доступом для кода, чтобы писать приложения [!INCLUDE[ndptecclick](../includes/ndptecclick-md.md)] соответствующим образом. Для ограничения доступа приложение может использовать зоны с полным или частичным доверием, такие как Интернет и интрасеть.  
  
 Кроме того, ClickOnce использует сертификаты для проверки подлинности издателя приложения, подписи приложения и манифестов развертывания, чтобы удостовериться в том, что файлы не были изменены злоумышленником. Подписывание — это необязательный шаг, который упрощает изменение файлов приложения после создания манифестов. Без подписанных манифестов, однако, трудно гарантировать, что установщик приложения не был изменен злоумышленником (атака "злоумышленник в середине"). По этой причине рекомендуется подписывать манифесты приложений и развертываний для защиты приложений.  
  
## <a name="zones"></a>Зоны  
 Для приложений, развертываемых с помощью технологии [!INCLUDE[ndptecclick](../includes/ndptecclick-md.md)] , ограничен доступ к наборам разрешений и действий, которые определены в зоне безопасности. Зоны безопасности определены в Internet Explorer и берут за основу местоположение приложения. Разрешения по умолчанию, основанные на местоположении развертывания, перечисляются в следующей таблице:  
  
|Местоположение развертывания|Зона безопасности|  
|-------------------------|-------------------|  
|Запуск из Интернета|Зона Интернета|  
|Установка из Интернета|Зона Интернета|  
|Установка из общего сетевого файлового ресурса|Зона локальной интрасети|  
|Установка с компакт-диска|Full Trust|  
  
 Разрешения по умолчанию основываются на местоположении, из которого была развернута исходная версия приложения. Обновления приложения наследуют эти разрешения. Если приложение настроено на проверку обновлений из Интернета или сетевого местоположения, и доступна более новая версия, исходная установка может получить разрешения для зоны Интернета или интрасети вместо разрешений полного доверия. Чтобы запретить вывод запросов, администратор системы может задать политику развертывания ClickOnce, которая определит конкретного издателя приложения в качестве доверенного источника. Для компьютеров, на которых развернута эта политика, разрешения предоставляются автоматически, и пользователям не выводятся запросы. Для получения дополнительной информации см. [Trusted Application Deployment Overview](../deployment/trusted-application-deployment-overview.md). Чтобы настроить развертывание доверенного приложения, сертификат можно установить для уровня компьютера или предприятия. Дополнительные сведения см. в разделе [Практическое руководство. добавить надежного издателя на клиентский компьютер для приложений ClickOnce](../deployment/how-to-add-a-trusted-publisher-to-a-client-computer-for-clickonce-applications.md).  
  
## <a name="code-access-security-policies"></a>Политики управления доступом для кода  
 Разрешения для приложения определяются параметрами в элементе [\<trustInfo > Element](../deployment/trustinfo-element-clickonce-application.md) манифеста приложения. [!INCLUDE[vsprvs](../includes/vsprvs-md.md)] автоматически создает эти данные на основе настроек проекта со страницы свойств **Безопасность** . Приложению [!INCLUDE[ndptecclick](../includes/ndptecclick-md.md)] предоставляются только определенные разрешения, которые им запрошены. Например, если там, где для доступа к файлу требуются разрешения полного доверия, приложение запрашивает разрешение на доступ к файлу, ему будет предоставлено только разрешение на доступ к файлу, а не разрешения полного доверия. При разработке приложения [!INCLUDE[ndptecclick](../includes/ndptecclick-md.md)] необходимо убедиться в запросе только определенных разрешений, которые требуются приложению. В большинстве случаев для ограничения приложения частичным доверием можно использовать зоны Интернета или локальной интрасети. Дополнительные сведения см. в разделе [Практическое руководство. Установка зоны безопасности для ClickOnce-приложения](../deployment/how-to-set-a-security-zone-for-a-clickonce-application.md). Если приложению требуются пользовательские разрешения, можно создать пользовательскую зону. Дополнительные сведения см. в разделе [Практическое руководство. Установка пользовательских разрешений для ClickOnce-приложения](../deployment/how-to-set-custom-permissions-for-a-clickonce-application.md).  
  
 При включении разрешения, не являющегося частью разрешения, устанавливаемого по умолчанию для зоны, из которой было развернуто приложение, пользователю будет предложено предоставить разрешение во время установки или обновления. Чтобы запретить вывод запросов, администратор системы может задать политику развертывания ClickOnce, которая определит конкретного издателя приложения в качестве доверенного источника. На компьютерах, на которых развернута эта политика, разрешения предоставляются автоматически, и для пользователя не выводятся запросы.  
  
 Ответственность за работу приложения с надлежащими разрешениями лежит на разработчике. Если приложение во время исполнения запрашивает разрешения за пределами зоны, может возникнуть исключение безопасности. [!INCLUDE[vsprvs](../includes/vsprvs-md.md)] позволяет отлаживать приложения в целевой зоне безопасности. и помогает разрабатывать защищенные приложения. Дополнительные сведения см. в разделе [Практическое руководство. отладить приложение ClickOnce с ограниченными разрешениями](../deployment/how-to-debug-a-clickonce-application-with-restricted-permissions.md).  
  
 Дополнительные сведения об управлении доступом для кода и ClickOnce см. в статье [Code Access Security for ClickOnce Applications](../deployment/code-access-security-for-clickonce-applications.md).  
  
## <a name="code-signing-certificates"></a>Сертификаты подписи кода  
 Чтобы опубликовать приложение с использованием развертывания [!INCLUDE[ndptecclick](../includes/ndptecclick-md.md)] , необходимо подписать манифесты приложения и развертывания для приложения парой открытого и закрытого ключа. Средства для подписи манифеста доступны на странице **Подпись** в **конструкторе проектов**. Дополнительные сведения см. в разделе [Signing Page, Project Designer](../ide/reference/signing-page-project-designer.md). Можно также подписывать манифесты при помощи файла ключей во время процесса публикации, используя мастер публикаций.  
  
 После подписи манифестов сведения об издателе, основанные на подписи Authenticode, показываются пользователю в диалоговом окне разрешений во время установки, чтобы пользователь мог убедиться, что приложение получено из надежного источника.  
  
 Дополнительные сведения о ClickOnce и сертификатах см. в статье [ClickOnce and Authenticode](../deployment/clickonce-and-authenticode.md).  
  
## <a name="aspnet-form-based-authentication"></a>Проверка подлинности, основанная на форме ASP.NET  
 Если требуется контролировать, к каким развертываниям имеет доступ каждый пользователь, не следует включать анонимный доступ к приложениям [!INCLUDE[ndptecclick](../includes/ndptecclick-md.md)] , развертываемым на веб-сервере. Предпочтительнее разрешить доступ пользователей к установленным развертываниям на основе удостоверения пользователя, используя проверку подлинности Windows.  
  
 [!INCLUDE[ndptecclick](../includes/ndptecclick-md.md)] не поддерживает проверку подлинности на основе форм ASP.NET, так как она предполагает использование постоянных файлов Cookie; эти файлы представляют угрозу безопасности, поскольку они находятся в кэше Internet Explorer и могут быть объектом вредоносной атаки. Поэтому при развертывании приложений [!INCLUDE[ndptecclick](../includes/ndptecclick-md.md)] никакие сценарии проверки подлинности, кроме проверки подлинности Windows, не поддерживаются.  
  
## <a name="passing-arguments"></a>Передача аргументов  
 Если в приложение [!INCLUDE[ndptecclick](../includes/ndptecclick-md.md)] передаются аргументы, возникают дополнительные вопросы по безопасности. [!INCLUDE[ndptecclick](../includes/ndptecclick-md.md)] предоставляет разработчикам возможность передачи строки запроса в приложения, развернутые через Интернет. Строка запроса принимает вид последовательности пар "имя-значение" в конце URL-адреса, используемого для запуска приложения:  
  
 `http://servername.adatum.com/WindowsApp1.application?username=joeuser`  
  
 По умолчанию аргументы строки запроса отключены. Чтобы включить их, для приложения должен быть установлен атрибут `trustUrlParameters` в манифесте развертывания. Это значение может быть установлено из [!INCLUDE[vsprvs](../includes/vsprvs-md.md)] и из MageUI.exe. Подробные инструкции по включению передачи строк запросов, см. в разделе [как: извлечь сведения строки запроса в интернет-приложении ClickOnce](../deployment/how-to-retrieve-query-string-information-in-an-online-clickonce-application.md).  
  
 Никогда не следует передавать аргументы, извлекаемые с помощью строки запроса, в базу данных или командную строку без проверки аргументов с целью убедиться, что они безопасны. Ненадежные аргументы — это аргументы, которые содержат escape-символы базы данных или командной строки, позволяющие злоумышленникам управлять приложением для выполнения произвольных команд.  
  
> [!NOTE]
> Аргументы строки запроса представляют единственный способ передачи аргументов в приложение [!INCLUDE[ndptecclick](../includes/ndptecclick-md.md)] при запуске. В приложение [!INCLUDE[ndptecclick](../includes/ndptecclick-md.md)] нельзя передавать аргументы из командной строки.  
  
## <a name="deploying-obfuscated-assemblies"></a>Развертывание малопонятных сборок  
 Может возникнуть желание сделать приложение малопонятным с помощью Dotfuscator, чтобы предотвратить раскрытие программного кода приложения. Однако процедура запутывания кода сборки не встроена ни в интегрированную среду разработки Visual Studio, ни в процесс развертывания ClickOnce. Поэтому запутывание кода должно выполняться вне процесса развертывания, возможно, на этапе после построения. После построения проекта можно выполнить следующие шаги вручную, вне Visual Studio:  
  
1. Выполните запутывание кода, используя средство Dotfuscator.  
  
2. Средство Mage.exe или MageUI.exe используется для генерирования манифестов ClickOnce и их подписания. Дополнительные сведения см. в разделе [Mage.exe (средство редактирования и Manifest Generation)](https://msdn.microsoft.com/library/77dfe576-2962-407e-af13-82255df725a1) и [MageUI.exe (средство создания и редактирования манифестов, графический клиент)](https://msdn.microsoft.com/library/f9e130a6-8117-49c4-839c-c988f641dc14).  
  
3. Вручную опубликуйте (скопируйте) файлы в исходное местоположение развертывания (веб-сервер, общий UNC-ресурс или на компакт-диск).  
  
## <a name="see-also"></a>См. также  
 [Развертывание и безопасность технологии ClickOnce](../deployment/clickonce-security-and-deployment.md)   
 [Выбор стратегии развертывания ClickOnce](../deployment/choosing-a-clickonce-deployment-strategy.md)
