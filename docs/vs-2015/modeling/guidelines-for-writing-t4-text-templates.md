---
title: Рекомендации по написанию текстовых шаблонов T4 | Документация Майкрософт
ms.date: 11/15/2016
ms.prod: visual-studio-dev14
ms.technology: vs-ide-modeling
ms.topic: conceptual
ms.assetid: 04dd3fc4-10e8-488a-bdea-4d615f50f063
caps.latest.revision: 11
author: gewarren
ms.author: gewarren
manager: jillfra
ms.openlocfilehash: f88666d15293e6900ae99cecdc39853cda8e2f9e
ms.sourcegitcommit: 94b3a052fb1229c7e7f8804b09c1d403385c7630
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/23/2019
ms.locfileid: "62546613"
---
# <a name="guidelines-for-writing-t4-text-templates"></a>Рекомендации по написанию текстовых шаблонов T4
[!INCLUDE[vs2017banner](../includes/vs2017banner.md)]

Эти общие рекомендации могут быть полезны при создании программного кода или других ресурсов приложения в [!INCLUDE[vsprvs](../includes/vsprvs-md.md)]. Они не являются фиксированными правилами.  
  
## <a name="guidelines-for-design-time-t4-templates"></a>Рекомендации для шаблонов времени разработки T4  
 Шаблоны T4 времени разработки представляют собой шаблоны, создание кода в вашей [!INCLUDE[vsprvs](../includes/vsprvs-md.md)] проекта во время разработки. Дополнительные сведения см. в разделе [создание кода во время разработки с помощью текстовых шаблонов T4](../modeling/design-time-code-generation-by-using-t4-text-templates.md).  
  
 Создание переменных аспектов приложения.  
 Создание кода наиболее полезна для тех аспектов приложения, могут измениться во время проекта или приведет к изменению между разными версиями приложения. Отделите эти переменные аспекты от относительно неизменных аспектов таким образом, можно более легко определить, что может быть создан. Например если приложение предоставляет веб-сайта, отдельные стандартные функции предоставления страниц от логика, которая определяет пути перехода от одной страницы в другую.  
  
 Напишите код переменных аспектов в одной или нескольких моделей источника.  
 Модель — это файл или базу данных, который считывает каждый шаблон для получения определенных значений для переменных частей кода, который будет создан. Модели могут быть базы данных, XML-файлы конструктора, схем или предметно ориентированных языков. Как правило, одна модель используется для создания многих файлов в [!INCLUDE[vsprvs](../includes/vsprvs-md.md)] проекта. Каждый файл создается отдельный шаблон.  
  
 Более одной модели можно использовать в проекте. Например можно определить модель для перехода между веб-страниц и отдельная модель для макета страниц.  
  
 Фокусировки модели на потребности пользователей и словарь, а не на вашей реализации.  
 Например в приложении веб-сайта, можно ожидать модель для ссылки на веб-страницы и гиперссылки.  
  
 Выберите форму, подходящий для материалов, который представляет модель представления. Например модель путей перехода по веб-сайта можно использовать схему, прямоугольников и стрелок.  
  
 Тестирование созданного кода.  
 С помощью ручных или автоматических тестов убедитесь, что полученного кода работает как нужно пользователям. Не следует создавать тесты из той же модели, из которого создается код.  
  
 В некоторых случаях общие тесты могут выполняться на модели непосредственно. Например можно написать тест, который гарантирует, что каждой страницы в веб-сайта можно осуществлять путем навигации из любой другой.  
  
 Разрешение пользовательского кода: возможность создания разделяемых классов.  
 Разрешить для создаваемого кода вручную в дополнение к сгенерированному коду. Это нередко схеме создания кода иметь возможность учесть все возможные варианты, которые могут возникнуть. Таким образом следует ожидать добавить или переопределить некоторые из созданного кода. Где автоматически создаваемый материал — на языке .NET, такие как [!INCLUDE[csprcs](../includes/csprcs-md.md)] или [!INCLUDE[vbprvb](../includes/vbprvb-md.md)], особенно полезны две стратегии:  
  
- Создаваемые классы должны быть разделяемыми. Это позволяет для добавления содержимого в созданном коде.  
  
- Классы должны создаваться парами, один наследование от другого. Базовый класс должен содержать все созданные методы и свойства, и производный класс должен содержать только конструкторы. Это позволяет коду написан вручную переопределять любые созданные методы.  
  
  В других языках созданный, например XML, используйте `<#@include#>` директива с легкостью объединять рукописных и созданного содержимого. В более сложных случаях может потребоваться написать постобработки, объединяющее созданный файл с любыми файлами, созданный вручную.  
  
  Перемещение общего материала в включаемых файлов или шаблонов во время выполнения  
  Чтобы избежать повторения похожих блоков текста и кода в нескольких шаблонах, используйте `<#@ include #>` директива. Дополнительные сведения см. в разделе [директива Include T4](../modeling/t4-include-directive.md).  
  
  Можно также создавать шаблоны текста во время выполнения в отдельном проекте и затем вызывать их из шаблона времени разработки. Чтобы сделать это, используйте `<#@ assembly #>` директиву, чтобы получить доступ к отдельному проекту.
  
  Рекомендуется переместить большие блоки кода в отдельную сборку.  
  Если у вас есть большие блоки и блоки возможностей класса, можно переместить некоторые из этого кода в методы, которые компилируются в отдельном проекте. Можно использовать `<#@ assembly #>` директива для доступа к коду в шаблоне. Дополнительные сведения см. в разделе [директива Assembly T4](../modeling/t4-assembly-directive.md).  
  
  Методы можно поместить в абстрактный класс, который может наследовать шаблона. Абстрактный класс должен наследовать из <xref:Microsoft.VisualStudio.TextTemplating.TextTransformation?displayProperty=fullName>. Дополнительные сведения см. в разделе [директива Template T4](../modeling/t4-template-directive.md).  
  
  Создание кода, не файлы конфигурации  
  Одним из способов написания изменяющегося приложения является написание универсальный программный код, который принимает файл конфигурации. Приложения, написанного таким образом является очень гибкой и можно перенастраивать при изменении требований бизнеса без повторной сборки приложения. Недостаток этого подхода то, что приложение будет работать хуже, чем более конкретного приложения. Кроме того его программный код будет более сложным, чтение и обслуживание, отчасти потому, что он всегда имеет дело с более универсальными типами.  
  
  В отличие от этого, переменные части создаются перед компиляцией приложения может быть строго типизированным. Это позволяет гораздо проще и надежнее писать код вручную и интегрировать его с автоматически создаваемыми частями программного обеспечения.  
  
  Чтобы получить максимальную выгоду от создания кода, попробуйте создать программный код вместо файлов конфигурации.  
  
  Использовать папку с созданным кодом  
  Поместите шаблоны и созданные файлы в папку проекта с именем **созданный код**, чтобы сделать его очистки, что эти файлы не следует редактировать непосредственно. Если вы создаете пользовательский код, чтобы переопределить или добавить к созданным классам, поместите эти классы в папке с именем **пользовательский код**. Структура типичный проект выглядит следующим образом:  
  
```  
MyProject  
   Custom Code  
      Class1.cs  
      Class2.cs  
   Generated Code  
      Class1.tt  
          Class1.cs  
      Class2.tt  
          Class2.cs  
   AnotherClass.cs  
  
```  
  
## <a name="guidelines-for-run-time-preprocessed-t4-templates"></a>Рекомендации по шаблонам времени выполнения (предварительно обработанном) T4  
 Перемещение общего материала в наследуемые шаблоны  
 Можно использовать наследование для совместного использования методов и блоков текста между текстовых шаблонов T4. Дополнительные сведения см. в разделе [директива Template T4](../modeling/t4-template-directive.md).  
  
 Также можно включать файлы, имеющие шаблонам времени выполнения.  
  
 Перемещение больших фрагментов кода в разделяемый класс.  
 Каждый шаблон времени выполнения создает определение разделяемого класса, который имеет имя, совпадающее с именем шаблона. Можно написать файл кода, содержащий другом частичном определении того же класса. Класс таким образом, можно добавить методы, поля и конструкторы. Эти элементы могут вызываться из блоков кода в шаблоне.  
  
 Преимуществом этого является то, что код проще писать, так как технология IntelliSense доступна. Кроме того можно добиться более четким разделением презентации и базовой логики.  
  
 Например, в **MyReportText.tt**:  
  
 `The total is: <#= ComputeTotal() #>`  
  
 В **MyReportText Methods.cs**:  
  
 `private string ComputeTotal() { ... }`  
  
 Разрешение пользовательского кода: предоставление точек расширения  
 Рассмотрите возможность создания виртуальных методов в \<#+ класс функция блокирует #>. Это позволяет один шаблон для использования во многих контекстах без изменений. Вместо редактирования шаблона, можно создать производный класс, который предоставляет минимальную дополнительную логику. Производный класс может быть либо обычный код или он может быть шаблоном во время выполнения.  
  
 Например в MyStandardRunTimeTemplate.tt:  
  
```  
This page is copyright <#= CompanyName() #>.  
<#+ protected virtual string CompanyName() { return ""; } #>  
```  
  
 В коде приложения:  
  
```  
class FabrikamTemplate : MyStandardRunTimeTemplate  
{  
  protected override string CompanyName() { return "Fabrikam"; }  
}  
...  
  string PageToDisplay = new FabrikamTemplate().TextTransform();  
  
```  
  
## <a name="guidelines-for-all-t4-templates"></a>Рекомендации по все шаблоны T4  
 Отделение сбора данных от создания текста  
 Не рекомендуется смешивать вычисления и блоки текста. В каждом текстовом шаблоне используйте первый \<блок кода #, #> для задания переменных и выполнения сложных вычислений. Из первого текстового блока вниз до конца шаблона, либо первый \<возможность класса #+ блокировать #>, избегайте длинных выражений и избежать циклов и условий, если они не содержат блоки текста. Такой подход делает шаблон проще читать и поддерживать.  
  
 Не используйте `.tt` для включаемых файлов  
 Использовать другое расширение файла, например `.ttinclude` для включаемых файлов. Используйте `.tt` только для файлов, которые вы хотите быть обработано как во время выполнения или во время разработки текстовые шаблоны. В некоторых случаях [!INCLUDE[vsprvs](../includes/vsprvs-md.md)] распознает `.tt` файлы и автоматически устанавливает их свойства для обработки.  
  
 Начинайте каждый шаблон с фиксированного прототипа.  
 Напишите пример кода или текста, который требуется создать и убедитесь, что это правильный. Затем измените его расширение на .tt и постепенно вставлять код, который изменяет содержимое, считывая модель.  
  
 Рассмотрите возможность использования типизированных моделей.  
 Несмотря на то, что можно создать схему XML или базы данных для моделей, может быть полезным создать предметно-ориентированного языка (DSL). DSL имеет то преимущество, что он создает класс для представления каждого узла в схеме и свойства для представления атрибутов. Это означает, что вы можете программировать с точки зрения бизнес-модели. Пример:  
  
```  
Team Members:  
<# foreach (Person p in team.Members)   
 { #>   
    <#= p.Name #>   
<# } #>  
```  
  
 Рассмотрите возможность использования схемы для моделей.  
 Наиболее эффективно предоставляются несколько моделей и управляемых в виде текстовых таблиц, особенно в том случае, если они имеют очень большой размер.  
  
 Тем не менее для некоторых видов бизнес-требований, очень важно четко представить сложные наборы связей и рабочих процессов и схемы являются наилучшим образом подходит носитель. Преимуществом схемы является то, что это просто для обсуждения с пользователями и другими заинтересованными лицами. Создание кода из модели на уровне бизнес-требований, можно сделать код более гибким при изменении требований.  
  
 UML-схемы классов и действий, часто можно адаптировать для этих целей. Можно также создать собственный тип схемы как доменный язык (DSL). Код можно создавать из UML и DSL. Дополнительные сведения см. в разделе [анализ и моделирование архитектуры](../modeling/analyze-and-model-your-architecture.md) и [анализ и моделирование архитектуры](../modeling/analyze-and-model-your-architecture.md).  
  
## <a name="see-also"></a>См. также  
 [Создание кода во время разработки с помощью текстовых шаблонов T4](../modeling/design-time-code-generation-by-using-t4-text-templates.md)   
 [Создание текста во время выполнения с помощью текстовых шаблонов T4](../modeling/run-time-text-generation-with-t4-text-templates.md)
