---
title: Создание пользовательских обработчиков директив текстовых шаблонов T4 | Документация Майкрософт
ms.date: 11/15/2016
ms.prod: visual-studio-dev14
ms.technology: vs-ide-modeling
ms.topic: conceptual
helpviewer_keywords:
- text templates, custom directive processors
ms.assetid: 422b47af-5441-4b02-b5ad-1b8b328457e3
caps.latest.revision: 31
author: jillre
ms.author: jillfra
manager: jillfra
ms.openlocfilehash: eef9fd14dc78ff1f377ffb94bcf76fde0c401783
ms.sourcegitcommit: 6cfffa72af599a9d667249caaaa411bb28ea69fd
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 09/02/2020
ms.locfileid: "72651218"
---
# <a name="creating-custom-t4-text-template-directive-processors"></a>Создание пользовательских обработчиков директив для текстовых шаблонов T4
[!INCLUDE[vs2017banner](../includes/vs2017banner.md)]

*Процесс преобразования текстовых шаблонов* принимает текстовый файл *шаблона* в качестве входных данных и создает текстовый файл в качестве выходных данных. *Обработчик преобразования текстовых шаблонов* управляет процессом, а обработчик взаимодействует с узлом преобразования текстового шаблона и одним или несколькими *обработчиками директив* текстового шаблона для завершения процесса. Дополнительные сведения см. [в разделе процесс преобразования текстовых шаблонов](../modeling/the-text-template-transformation-process.md).

 Для создания пользовательского процессора директив создается класс, наследующий <xref:Microsoft.VisualStudio.TextTemplating.DirectiveProcessor> либо <xref:Microsoft.VisualStudio.TextTemplating.RequiresProvidesDirectiveProcessor>.

 Разница между этими двумя методами заключается в том, что <xref:Microsoft.VisualStudio.TextTemplating.DirectiveProcessor> реализует минимальный интерфейс, необходимый для получения параметров от пользователя и для создания кода, который создает выходной файл шаблона. <xref:Microsoft.VisualStudio.TextTemplating.RequiresProvidesDirectiveProcessor> реализует шаблон разработки Requires/предоставляет. <xref:Microsoft.VisualStudio.TextTemplating.RequiresProvidesDirectiveProcessor> обрабатывает два специальных параметра: `requires` и `provides` .  Например, пользовательский обработчик директив может принять имя файла от пользователя, открыть и прочитать файл, а затем сохранить текст файла в переменной с именем `fileText` . Подкласс <xref:Microsoft.VisualStudio.TextTemplating.RequiresProvidesDirectiveProcessor> класса может принимать имя файла от пользователя в качестве значения `requires` параметра и имя переменной, в которой будет храниться текст в качестве значения `provides` параметра. Этот обработчик открывает и считывает файл, а затем сохраняет текст файла в указанной переменной.

 Перед вызовом пользовательского обработчика директив из текстового шаблона в [!INCLUDE[vsprvs](../includes/vsprvs-md.md)] необходимо зарегистрировать его.

 Дополнительные сведения о том, как добавить раздел реестра, см. [в разделе Развертывание пользовательского обработчика директив](../modeling/deploying-a-custom-directive-processor.md).

## <a name="custom-directives"></a>Пользовательские директивы
 Пользовательская директива выглядит следующим образом:

 `<#@ MyDirective Processor="MyDirectiveProcessor" parameter1="value1" … #>`

 Можно использовать пользовательский обработчик директив, если требуется получить доступ к внешним данным или ресурсам из текстового шаблона.

 Различные текстовые шаблоны могут совместно использовать функциональные возможности, предоставляемые процессором с одними директивами, поэтому процессоры директив предоставляют способ факторинга кода для повторного использования. Встроенная `include` директива аналогична, так как ее можно использовать для разложения кода и совместного использования с другими текстовыми шаблонами. Разница заключается в том, что все функциональные возможности, `include` предоставляемые директивой, являются фиксированными и не принимают параметры. Если требуется предоставить общий набор функций для текстового шаблона и разрешить шаблону передавать параметры, необходимо создать пользовательский обработчик директив.

 Ниже приведены некоторые примеры пользовательских обработчиков директив.

- Обработчик директив, возвращающий данные из базы данных, которые принимают имя пользователя и пароль в качестве параметров.

- Обработчик директив для открытия и чтения файла, принимающего имя файла в качестве параметра.

### <a name="principal-parts-of-a-custom-directive-processor"></a>Основные части пользовательского обработчика директив
 Для разработки обработчика директив необходимо создать класс, наследующий от <xref:Microsoft.VisualStudio.TextTemplating.DirectiveProcessor> или <xref:Microsoft.VisualStudio.TextTemplating.RequiresProvidesDirectiveProcessor> .

 `DirectiveProcessor`Ниже перечислены наиболее важные методы, которые необходимо реализовать.

- `bool IsDirectiveSupported(string directiveName)` — Возвращает `true` , если процессор директив может работать с именованной директивой.

- `void ProcessDirective (string directiveName, IDictionary<string, string> arguments)` — Обработчик шаблонов вызывает этот метод для каждого вхождения директивы в шаблоне. Ваш процессор должен сохранить результаты.

  После всех вызовов Процессдирективе () подсистема шаблонов будет вызывать следующие методы:

- `string[] GetReferencesForProcessingRun()` — Возврат имен сборок, необходимых коду шаблона.

- `string[] GetImportsForProcessingRun()` — Возврат пространств имен, которые могут использоваться в коде шаблона.

- `string GetClassCodeForProcessingRun()` — Возврат кода методов, свойств и других объявлений, которые может использовать код шаблона. Самый простой способ сделать это — создать строку, содержащую код C# или Visual Basic. Чтобы процессор директив мог быть вызван из шаблона, использующего любой язык среды CLR, можно создать инструкции в виде дерева CodeDom, а затем вернуть результат сериализации дерева на языке, используемом шаблоном.

- Дополнительные сведения см. [в разделе Пошаговое руководство. Создание пользовательского обработчика директив](../modeling/walkthrough-creating-a-custom-directive-processor.md).

## <a name="in-this-section"></a>в этом разделе
 [Развертывание пользовательского обработчика директив](../modeling/deploying-a-custom-directive-processor.md) Описывает, как зарегистрировать пользовательский обработчик директив.

 [Пошаговое руководство. Создание пользовательского обработчика директив](../modeling/walkthrough-creating-a-custom-directive-processor.md) Описывает, как создать пользовательский обработчик директив, как зарегистрировать и проверить обработчик директив, а также как отформатировать выходной файл как HTML.
