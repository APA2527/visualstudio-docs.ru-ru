---
title: Создание кода из UML-схемах классов | Документация Майкрософт
ms.date: 11/15/2016
ms.prod: visual-studio-dev14
ms.technology: vs-ide-modeling
ms.topic: conceptual
f1_keywords:
- vs.teamarch.logicalclassdiagram.shapes.properties.Templates
- vs.teamarch.logicalclassdiagram.shapes.properties.Templates.TextTransformationDataCollectionEditor
helpviewer_keywords:
- code generation, UML class diagrams
- class diagrams - UML, generating code
- UML diagrams, generating code
ms.assetid: 2790e64d-7728-4c2e-a4dd-4131e795f730
caps.latest.revision: 53
author: gewarren
ms.author: gewarren
manager: jillfra
ms.openlocfilehash: c95a361f00e9b744aa78f443ad7c173209a5a0bd
ms.sourcegitcommit: 47eeeeadd84c879636e9d48747b615de69384356
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/23/2019
ms.locfileid: "63442432"
---
# <a name="generate-code-from-uml-class-diagrams"></a>Создание кода на основе схем классов UML
[!INCLUDE[vs2017banner](../includes/vs2017banner.md)]

Чтобы создать код Visual C# .NET из схем классов UML в Visual Studio, используйте **создать код** команды. По умолчанию команда создает тип C# для каждого выбранного типа UML. Это поведение можно изменить и расширить, изменив или скопировав текстовые шаблоны для создания кода. Можно задать другое поведение для типов, которые содержатся в разных пакетах модели.  

 **Создать код** команда хорошо подходит для создания кода из выбранных пользователем элементов и создания отдельных файлов для каждого класса UML или других элементов. Например, на снимке экрана показаны два файла C#, созданные из двух UML-классов.  

 Кроме того, если вы хотите создать код, в котором сформированные файлы не имеют отношение 1:1 с UML-элементами, имеет смысл создать текстовые шаблоны, которые вызываются с **преобразовать все шаблоны** команды. Дополнительные сведения об этом методе см. в разделе [Создание файлов из модели UML](../modeling/generate-files-from-a-uml-model.md).  

 ![UML классов схемы и созданный C&#35; файлы классов. ](../modeling/media/oob-gencode1.png "oob_GenCode1")  

 Подробнее о схемах классов UML в Visual Studio читайте в следующих разделах:  

- [Схемы классов UML: справочник](../modeling/uml-class-diagrams-reference.md)  

- [Схемы классов UML: рекомендации](../modeling/uml-class-diagrams-guidelines.md)  

  Чтобы узнать, какие версии Visual Studio поддерживают схемы классов UML, см. в разделе [поддержка версий для инструментов моделирования и архитектуры](../modeling/what-s-new-for-design-in-visual-studio.md#VersionSupport).  

## <a name="using-the-generate-code-command"></a>Использование команды создания кода  
 Следующая процедура описывает поведение по умолчанию **создать код** команды:  

#### <a name="to-generate-a-separate-file-for-each-element"></a>Создание отдельного файла для каждого элемента  

1. Создайте UML-модель, содержащую классы. Возможно, потребуется применить к элементам модели стереотипы.  

    Дополнительные сведения см. в разделе [по умолчанию преобразования создания кода](#default).  

2. На схеме классов или в **Обозреватель моделей UML**, выберите элементы, из которых требуется создать код. Можно выбрать один из следующих вариантов:  

   - Конкретный набор элементов.  

   - Пакет или модель для создания кода из содержимого пакета или модели.  

   - Схема, на которой можно выбрать все элементы.  

3. Откройте контекстное меню для выбранного элемента, а затем выберите **создать код**.  

    При первом использовании **создать код** в конкретной модели, отображается диалоговое окно. Это диалоговое окно позволяет изменять параметры создания кода модели.  

    Выберите **ОК** Если известно, что вы хотите изменить эти параметры.  

    Чтобы вернуться к этому диалоговому окну позже, откройте **Обозреватель моделей UML**. Откройте контекстное меню проекта моделирования, а затем выберите **настроить создание кода**. Дополнительные сведения см. в разделе [Настройка команды создания кода](#custom).  

   Создаются файлы, содержащие код C#. В сценарии по умолчанию для каждого типа создается отдельный файл. Такие файлы создаются в проекте библиотеки классов C#. Однако можно выполнить пользовательскую настройку такого поведения. Дополнительные сведения см. в разделе [Настройка команды создания кода](#custom).  

   С моделью выполняются некоторые проверочные тесты, позволяющие убедиться, что модель можно преобразовать в C#. Если модель не проходит тесты, отображается сообщение об ошибке, создание кода не выполняется. Если была создана команда меню проверки, код создается только для элементов, успешно прошедших такую проверку. Дополнительные сведения см. в разделе [определение ограничений проверки для моделей UML](../modeling/define-validation-constraints-for-uml-models.md).  

## <a name="default"></a> Преобразования создания кода по умолчанию  
 В этом разделе приведены результаты, созданные с помощью **создать код** команды, если не настроить команды. Дополнительные сведения см. в разделе [Настройка команды создания кода](#custom).  

- Для каждого выбранного в UML-модели типа создается один тип C#. Каждый тип помещается в отдельный файл кода в разделе **GeneratedCode** папки.  

- Если UML-тип содержится в пакете, созданный тип C# помещается в пространство имен, а файл создается в папке, имя которой совпадает с именем пространства имен.  

- Свойство C# создается для каждого атрибута `Attribute` UML-класса.  

- Метод C# создается для каждой операции `Operation` UML-типа.  

- Поле C# создается для каждой ассоциации с возможностью перехода, в которой участвует класс.  

  Добавление стереотипов в каждый UML-тип позволяет контролировать больше свойств созданного типа C#.  

|**Для создания этого типа C#**|**UML-типа**|**Применение стереотипа**|  
|---------------------------------|----------------------------|-------------------------------|  
|Класс|Класс|\<None > или<br /><br /> класс C#|  
|Интерфейс|Интерфейс|\<None > или<br /><br /> интерфейс C#|  
|Перечисление|Перечисление|\<None > или<br /><br /> C# enum|  
|делегат|Класс|делегат C#|  
|Структура|Класс|C# struct|  

#### <a name="to-set-a-stereotype-on-a-type-or-other-element"></a>Задание стереотипа в типе или другом элементе  

1. Откройте контекстное меню для элемента на схеме или в **Обозреватель моделей UML**, а затем выберите **свойства**.  

2. В **свойства** окно, щелкните стрелку раскрывающегося списка в **стереотипы** свойства, а затем выберите флажок напротив стереотипа, который вы хотите применить.  

   > [!TIP]
   > Если стереотипы C# не отображаются, включите профиль C# для модели или пакета, содержащего нужные элементы модели. Выберите пакет или корень модели в **Обозреватель моделей UML**. Затем в **свойства** окно, выберите **профиль**, а затем включите профиль C#.  

3. Разверните **стереотипы** свойство, чтобы увидеть дополнительные свойства, которые можно задать.  

   **Описание** свойства типов, атрибутов, операций и ассоциаций записываются в `<summary>` комментарии в созданном коде. Элементы комментариев, связанные с типами, записываются в комментарии `<remarks>`.  

## <a name="varying-the-generated-code"></a>Варьирование созданного кода  
 Созданный код варьируется в зависимости от свойств каждого типа, атрибута или операции. Например, если задать **является абстрактным** свойство класса значение true, то `abstract` в созданном классе будет отображаться ключевое слово. Если задать **кратность** атрибуту **0..\\***, созданное свойство будет иметь `IEnumerable<>` типа.  

 Кроме того, каждый стереотип предоставляет несколько дополнительных свойств, которые можно задать. Эти значения преобразуются в соответствующие ключевые слова в коде C#. Например, если задать значения для свойства `Is Static` в классе, класс C# будет `static`.  

 Чтобы задать эти дополнительные свойства, выберите класс или другой элемент на схеме. В окне «Свойства» разверните **стереотипы**, а затем разверните стереотип C#, таких как **класс C#**.  Для классов такие дополнительные свойства включают:  

- CLR-атрибуты  

- Является разделенным  

- Является статическим  

- Является небезопасным  

- Видимость пакета  

  Каждый атрибут и операция имеет свойства стереотипа, которые можно задать. Если вы не видите свойства на новый атрибут, запустите **создать код**.  

## <a name="custom"></a> Настройка команды создания кода  
 **Создать код** работу команды, преобразуя элементы модели с использованием набора текстовых шаблонов. Дополнительные сведения о текстовых шаблонах см. в разделе [создание кода и текстовые шаблоны T4](../modeling/code-generation-and-t4-text-templates.md).  

 Шаблоны задаются в наборе *привязки шаблонов текста*. Привязка текстового шаблона задает, какой шаблон нужно применить и где должны размещаться выходные данные и другие параметры **создать код** команды.  

 При первом запуске **создать код** команду на определенной модели к корню модели прикрепляется набор привязок шаблонов по умолчанию. Эти привязки применимы ко всем элементам модели.  

 Однако набор этих привязок по умолчанию можно переопределить и расширить, прикрепив пользовательские привязки к пакетам, классам или другим элементам. Привязка применима ко всем элементам, которые содержатся внутри элемента, к которому прикреплена привязка. Например, если требуется преобразовать все типы внутри определенного пакета с использованием другого набора шаблонов или сохранить выходные данные в другой папке, можно прикрепить к пакету привязки шаблонов.  

 Чтобы проверить привязки шаблонов, прикрепленные к элементу модели, нажмите кнопку с многоточием **[...]**  в **привязки шаблонов текста** свойства в окне «Свойства».  

 **Создать код** команда применяет шаблоны к каждому элементу модели, которая выбрана. Применяемым набором шаблонов для каждого элемента является совокупный набор шаблонов, прикрепленный к контейнерам элемента, вплоть до корня модели и включая его.  

 Если две привязки шаблонов в этом наборе имеют одно и то же имя, привязка в более мелком контейнере переопределяет привязку в более крупном. Например, корень модели имеет привязку с именем **шаблона класса**. Чтобы иметь свой собственный шаблон, примененная к содержимому определенного пакета, определите собственную привязку шаблонов с именем **шаблона класса**.  

 К элементу модели можно применить несколько шаблонов. Из каждого элемента модели можно создать несколько файлов.  

> [!NOTE]
> Привязки, прикрепленные к корню модели, выполняют функции привязок по умолчанию для всех элементов модели. Чтобы просмотреть эти привязки по умолчанию, откройте **Обозреватель моделей UML**. Откройте контекстное меню проекта моделирования, а затем выберите **настроить создание кода**. Кроме того, можно выбрать корень модели в обозревателе моделей UML. В окне «Свойства» выберите **[...]**  в **привязки шаблонов текста** свойство. Привязки не будет отображаться, пока вы использовали **создать код** команды по крайней мере один раз. Привязки шаблонов невозможно прикрепить к схеме.  

#### <a name="to-attach-text-template-bindings-to-a-package-or-other-model-element"></a>Прикрепление привязок текстовых шаблонов к пакету или другому элементу модели  

1. В **Обозреватель моделей UML**, откройте контекстное меню для элемента модели и затем выберите **свойства**. Как правило, привязки текстовых шаблонов прикрепляются к пакету или к корню модели.  

2. В **свойства** окно, нажмите кнопку с многоточием (**[...]** ) в **привязки шаблонов текста** свойство.  

    **Привязки шаблонов текста** откроется диалоговое окно.  

3. Выберите **добавить** создать новую привязку шаблона текста.  

    \- или -  

    Выберите существующую привязку, чтобы изменить ее.  

    Каждая привязка шаблонов определяет способ применения заданного шаблона к выбранному элементу модели и другим элементам модели, которые в нем содержатся.  

4. В диалоговом окне задайте свойства привязки текстовых шаблонов.  

   |    **Property**    |                                                                                                                                                                                                                                                                                                                    **Описание**                                                                                                                                                                                                                                                                                                                    |
   |--------------------|-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
   |        name        |                                                                                                                                                                                                                                                  Имя данной привязки. Чтобы переопределить привязку, наследованную от содержащего элементы пакета или модели, используйте имя, совпадающее с именем привязки, которую требуется переопределить.                                                                                                                                                                                                                                                  |
   |     Перезаписать      |                                                                                                                                                                                                                                                                                                      Если это свойство имеет значение true, существующий код перезаписывается.                                                                                                                                                                                                                                                                                                       |
   |    Целевое имя     | Имя создаваемого файла.<br /><br /> Выражения в эту строку можно вставить такие как `{Name}` или `{Owner.Name}`. Например, можно написать: `{Owner.Name}_{Name}`. Выражение оценивается в элементе модели. Оно может использовать свойства элементов, но не его методы. Чтобы узнать, какие свойства можно использовать, просмотрите свойства типов в **Microsoft.VisualStudio.Uml.\\***. \*\*Важно:* \* `{Name}` или `{Owner.Name}` может использоваться только в **имя целевого** свойство. Чтобы изменить имя созданного класса, необходимо изменить шаблон. Дополнительные сведения см. в разделе [написание текстового шаблона](#writing). |
   |    Путь проекта    |                                                                      Задает путь к проекту [!INCLUDE[vsprvs](../includes/vsprvs-md.md)], в котором будут содержаться выходные файлы преобразования. Для создания нового проекта используйте типизированные значения. Нажмите кнопку с многоточием (**[...]** ) для выбора существующего проекта.<br /><br /> Если проекта не существует, будет создан новый проект. Это будет проект библиотеки классов C#.<br /><br /> Для этого необходимо указать проект напрямую. Можно включить макрос переменной среды, такой как %ProgramFiles% или %LocalAppData%.                                                                       |
   |  Конечный каталог  |                                                                                          Папка, в которой создается целевой файл. Путь является относительным по отношению к папке проекта.<br /><br /> Можно воспользоваться выражением `{PackageStructure}`, чтобы вставить путь, соответствующий именам содержащих элементы пакетов. Значение по умолчанию — `\GeneratedCode\{PackageStructure}`. Кроме того, можно включить переменные среды, например %TEMP% или %HomePath%. **Важно:** `{PackageStructure}` может использоваться только в **целевой каталог** свойство.                                                                                          |
   | Путь к файлу шаблона |                                                                                                                                                           Шаблон, который будет выполнять преобразование.<br /><br /> Можно использовать предоставленные шаблоны или создать свой собственный. Предоставленные шаблоны можно найти в следующем расположении:<br /><br /> …\Program Files\Microsoft Visual Studio 12.0\Common7\IDE\Extensions\Microsoft\Architecture Tools\Extensibility\Templates\Text\                                                                                                                                                           |

5. К элементу можно прикрепить любое количество привязок.  

## <a name="writing"></a> Написание текстового шаблона  
 Можно создать собственные текстовые шаблоны. Текстовые шаблоны позволяют создавать программный код или текстовые файлы любого другого вида.  

 Рекомендуется начать с изменения копий стандартных шаблонов. Можно копировать шаблоны из следующих местоположений:  

 …\Program Files\Microsoft Visual Studio 12.0\Common7\IDE\Extensions\Microsoft\Architecture Tools\Extensibility\Templates\Text\  

 Сведения о текстовых шаблонах см. в следующих разделах.  

- Текстовый шаблон — это прототип получаемого файла, который содержит текст и программный код, выполняющий считывание модели. Дополнительные сведения см. в разделе [создание кода и текстовые шаблоны T4](../modeling/code-generation-and-t4-text-templates.md).  

- Для осуществления перехода по UML-модели в программном коде необходимо использовать API-интерфейс UML. Дополнительные сведения см. в разделе [Навигация по UML-модели](../modeling/navigate-the-uml-model.md) и [Справочник по API для расширения моделей UML](../modeling/api-reference-for-uml-modeling-extensibility.md).  

  Для использования шаблонов с помощью **создать код** команды, необходимо включить директиву Modeling. Пример:  

  `<#@ Modeling ElementType="Microsoft.VisualStudio.Uml.Classes.IClass" Processor="ModelingProcessor" #>`  

  Атрибут `ElementType` определяет тип UML-элемента, к которому применим данный шаблон.  

  В этом шаблоне `this` принадлежит временному классу со следующими свойствами:  

- `Element` = UML-элемент <xref:Microsoft.VisualStudio.Uml.Classes.IElement>, к которому применяется шаблон.  

- `Errors`: <xref:System.CodeDom.Compiler.CompilerErrorCollection>  

- `Host`: <xref:Microsoft.VisualStudio.TextTemplating.ITextTemplatingEngineHost>  

- `ModelBus`: <xref:Microsoft.VisualStudio.Modeling.Integration.ModelBus>. Дополнительные сведения см. в разделе [интеграция моделей UML с другими моделями и средствами](../modeling/integrate-uml-models-with-other-models-and-tools.md).  

- `ProfileName` = "C#Profile"  

- `ServiceProvider`: <xref:System.IServiceProvider>  

- `Session`: <xref:Microsoft.VisualStudio.TextTemplating.TextTemplatingSession>.  

- `Store`: <xref:Microsoft.VisualStudio.Modeling.Store>. Это хранилище пакета Visualization and Modeling SDK, к которому применяется хранилище UML ModelStore. Для получения UML-хранилища <xref:Microsoft.VisualStudio.ArchitectureTools.Extensibility.Uml.IModelStore> воспользуйтесь методом `this.Element.GetModelStore()`.  

  Следующие советы могут оказаться полезными при создании текстового шаблона. Эти сведения подробно в [создание кода и текстовые шаблоны T4](../modeling/code-generation-and-t4-text-templates.md).  

- Задать расширение имени получаемого файла можно в директиве `Output`. Каждому текстовому шаблону требуется отдельная директива `Output`.  

- Шаблон автоматически ссылается на некоторые сборки. Эти сборки включают, к примеру, System.dll и Microsoft.VisualStudio.Uml.Interfaces.dll.  

   Для использования других сборок в создаваемом программном коде необходимо использовать директиву `Assembly`. Пример:  

   `<#@ Assembly Name="%ProgramFiles%\Microsoft Visual Studio 12.0\Common7\IDE\PublicAssemblies\Microsoft.VisualStudio.ArchitectureTools.Extensibility.dll" #>`  

- Некоторые пространства имен, такие как `System`, автоматически импортируются в программный код. Для других пространств имен можно использовать директиву `Import` так же, как использовалась бы инструкция `using`. Пример:  

   `<#@ Import Namespace="Microsoft.VisualStudio.Uml.Classes" #>`  

   `<#@ Import Namespace="Microsoft.VisualStudio.ArchitectureTools.Extensibility.Uml" #>`  

- Используйте директиву `Include`, чтобы создать ссылку на текст другого файла.  

- Части шаблона, заключенные в квадратные скобки `<# ... #>` выполняемых **создать код** команды. Части шаблона за пределами этих скобок копируются в получаемый файл. Важно различать генерирующий код и генерируемый текст. Текст может генерироваться на любом языке.  

- Выражения `<#= Expressions #>` оцениваются и преобразуются в строки.  

## <a name="see-also"></a>См. также  
 [Схемы классов UML: Справочник по](../modeling/uml-class-diagrams-reference.md)   
 [Схемы классов UML: Рекомендации](../modeling/uml-class-diagrams-guidelines.md)   
 [Создание файлов на основе модели UML](../modeling/generate-files-from-a-uml-model.md)
