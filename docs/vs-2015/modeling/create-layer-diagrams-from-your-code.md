---
title: Создание схем слоев из кода | Документация Майкрософт
ms.date: 11/15/2016
ms.prod: visual-studio-dev14
ms.technology: vs-ide-modeling
ms.topic: conceptual
helpviewer_keywords:
- architecture, layer diagrams
- layer diagrams
- diagrams - modeling, layer
- constraints, architectural
ms.assetid: 58c3ea71-2dbc-4963-bf82-40f1924cf973
caps.latest.revision: 64
author: gewarren
ms.author: gewarren
manager: jillfra
ms.openlocfilehash: 8fd8188ef0efbe540e086ca6ce284a49b71444ed
ms.sourcegitcommit: 47eeeeadd84c879636e9d48747b615de69384356
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/23/2019
ms.locfileid: "63433380"
---
# <a name="create-layer-diagrams-from-your-code"></a>Создание схем слоев на основе кода
[!INCLUDE[vs2017banner](../includes/vs2017banner.md)]

Для визуализации программного обеспечения системы высокоуровневой логической архитектуры, создайте *схему слоев* в Visual Studio. Чтобы убедиться в том, что код соответствует этой структуре, проверьте его с помощью схемы слоев. Можно создать схемы слоев для проектов Visual C# .NET и Visual Basic .NET. Чтобы узнать, какие версии Visual Studio поддерживают эту функцию, см. в разделе [поддержка версий для инструментов моделирования и архитектуры](../modeling/what-s-new-for-design-in-visual-studio.md#VersionSupport)  
  
 ![Создайте схему слоев](../modeling/media/layerdiagramvisualizecode.png "LayerDiagramVisualizeCode")  
  
 Схема слоев позволяет упорядочить элементы решения Visual Studio в логические, абстрактные группы, называемые *слои*. Слои можно использовать для описания основных задач, выполняемых этими артефактами, или основных компонентов системы. Каждый слой может содержать другие слои, описывающие более подробные задачи. Можно также указать предполагаемые или существующие *зависимости* между слоями. Эти зависимости, представленные в виде стрелок, указывают, какие слои могут использовать или в настоящее время используют функциональные возможности, представленные другими слоями. Для поддержки архитектурного контроля кода добавьте предполагаемые зависимости в схему, а затем проверьте код по схеме.  
  
## <a name="CreateDiagram"></a> Создание схемы слоев  
 Перед созданием схемы слоев решение должно иметь проект моделирования. См. в разделе [UML Создание проектов и схем моделирования](../modeling/create-uml-modeling-projects-and-diagrams.md).  
  
> [!IMPORTANT]
> Не следует добавлять, перетаскивать или копировать существующую схему слоев из одного проекта моделирования в другой проект моделирования или в другое местоположение в решении. Это позволит сохранить ссылки из исходной схемы при изменении схемы. Кроме того, это может привести к тому, что проверка схемы будет работать неправильно, и к другим потенциальным проблемам, таким как отсутствующие элементы или другие ошибки при попытке открыть схему.  
>   
> Вместо этого добавьте новую схему слоев в проект моделирования. Скопируйте элементы из исходной схемы в новую схему. Сохраните оба проекта моделирования и новую схему слоев.  
  
#### <a name="to-add-a-new-layer-diagram-to-a-modeling-project"></a>Добавление новой схемы слоев в проект моделирования  
  
1. На **архитектура** меню, выберите **создать схему UML или схему слоев**.  
  
2. В разделе **шаблоны**, выберите **схему слоев**.  
  
3. Назовите схему.  
  
4. В **добавьте в проект моделирования**найдите и выделите существующий проект моделирования в решении.  
  
     -или-  
  
     Выберите **создайте новый проект моделирования** для добавления в решение новый проект моделирования.  
  
    > [!NOTE]
    > Схема слоя должна существовать внутри проекта моделирования. Однако ее можно связать с элементами в любом месте решения.  
  
5. Убедитесь, что сохранены оба проекта моделирования и схема слоев.  
  
## <a name="CreateLayers"></a> Создать слои из артефактов  
 Слои можно создать из элементов решения Visual Studio, таких как проекты, файлы кода, пространства имен, классы и методы. При этом автоматически создаются связи между слоями и элементами, которые включаются в процесс проверки слоев.  
  
 Слои также можно связывать с элементами, которые не поддерживают проверку, такими как документы Word или презентации PowerPoint, чтобы можно было связать слой со спецификациями или планами. Кроме того, слои можно связать с файлами в проектах, которые являются общими для нескольких приложений, но в процесс проверки не войдут слои, которые отображаются с универсальными именами, например "Уровень 1" и "Уровень 2".  
  
 Чтобы узнать, если связанный элемент проводить проверку, откройте **обозреватель слоев** и изучите **поддерживает проверку** свойства элемента. См. в разделе [управление ссылками на артефакты](#Managing).  
  
|**Задача**|**Выполните следующие действия**|  
|------------|----------------------------|  
|Создать слой для одного артефакта|<ol><li>Перетащите элемент на схему слоев из указанных ниже источников.<br /><br /> <ul><li>**Обозреватель решений**<br /><br />         Например, можно перетаскивать файлы или проекты.</li><li>Карты кода<br /><br />         См. в разделе [сопоставление зависимостей в решениях](../modeling/map-dependencies-across-your-solutions.md) и [использование карт кода для отладки приложений](../modeling/use-code-maps-to-debug-your-applications.md).</li><li>**Представление классов** или **обозреватель объектов**</li></ul><br />     Слой отображается на схеме и связан с артефактом.</li><li>Переименуйте слой, чтобы отразить обязанности связанного кода или артефактов.</li></ol> **Внимание!**  Перетаскивание двоичных файлов на схему слоев не добавляет ссылки на них в проект моделирования автоматически. Необходимо вручную добавить двоичные файлы, которые нужно проверить, в проект моделирования. **Добавление двоичных файлов в проект моделирования** <ol><li>В **обозревателе решений**, откройте контекстное меню для проекта моделирования и выберите **добавить существующий элемент**.</li><li>В **добавить существующий элемент** диалоговом окне перейдите к двоичным файлам, выберите их и нажмите кнопку **ОК**.     Двоичные файлы отображаются в проекте моделирования.</li><li>В **обозревателе решений**, выберите двоичный файл, который вы добавили и нажмите клавишу **F4** открыть **свойства** окна.</li><li>Для каждого двоичного файла задайте **действие при построении** свойства **Validate**.</li></ol>|  
|Создание единственного слоя для всех выбранных артефактов|Одновременно перетащите на схему слоев все артефакты.<br /><br /> Слой отображается в схеме и связан со всеми артефактами.|  
|Создание слоя для каждого выбранного артефакта|Нажмите и удерживайте **SHIFT** ключа, одновременно перетаскивая все артефакты на схему слоев. **Примечание.**  Если вы используете **SHIFT** ключ для выбора диапазона элементов отпустите клавишу после выбора артефактов. Нажмите и удерживайте ее снова при перетаскивании артефактов в схему. <br /><br /> Слой для каждого артефакта отображается в схеме и связан с каждым артефактом.|  
|Добавление артефакта в слой|Перетащите артефакт в слой.|  
|Создание нового несвязанного слоя|В **элементов**, разверните **схему слоев** раздела, а затем перетащите **слой** на схему слоев.<br /><br /> Чтобы добавить несколько слоев, дважды щелкните средство. Когда вы закончите, нажмите кнопку **указатель** средство или нажмите клавишу **ESC** ключ.<br /><br /> -или-<br /><br /> Откройте контекстное меню схемы слоев, выберите **добавить**, а затем выберите **слой**.|  
|Создание вложенных слоев|Перетащите существующий слой в другой слой.<br /><br /> -или-<br /><br /> Откройте контекстное меню слоя, выберите **добавить**, а затем выберите **слой**.|  
|Создание нового слоя, который содержит два или более существующих слоев|Выберите слои, откройте контекстное меню для выбранного элемента и нажмите кнопку **группы**.|  
|Изменение цвета слоя|Задайте его **цвет** свойства нужного цвета.|  
|Указание, что артефакт, связанный со слоем, не должен более принадлежать указанному пространству имен|Введите пространства имен в свойстве слоя **Запрещенные пространства имен** свойство. Используйте точку с запятой (**;**) для разделения пространства имен.|  
|Указание, что артефакт, связанный со слоем, не может зависеть от указанного пространства имен|Введите пространства имен в свойстве слоя **Запрещенные зависимости пространства имен** свойство. Используйте точку с запятой (**;**) для разделения пространства имен.|  
|Указание, что артефакт, связанный со слоем, должен принадлежать одному из указанных пространств имен|Введите пространство имен в свойстве слоя **обязательные пространства имен** свойство. Используйте точку с запятой (**;**) для разделения пространства имен.|  
  
 Число на слое обозначает количество артефактов, связанных со слоем. Однако при считывании этого числа учитывайте следующее.  
  
- Если слой связан с артефактом, содержащим другие артефакты, но слой не связан с другими артефактами напрямую, то число включает только связанный артефакт. Однако для анализа в ходе проверки слоя включаются другие артефакты.  
  
     Например, если слой связан с одним пространством имен, то число связанных артефактов равно 1, даже если пространство имен содержит классы. Если слой также связан с каждым классом в пространстве имен, то число будет включать эти связанные классы.  
  
- Если слой содержит другие слои, связанные с артефактами, то слой-контейнер также связан с этими артефактами, даже если число в слое-контейнере не включает эти артефакты.  
  
## <a name="Managing"></a> Управление ссылками между слоями и артефактами  
  
1. На схеме слоев откройте контекстное меню слоя и выберите **Просмотр ссылок**.  
  
     **Обозреватель слоев** показывает ссылки артефакта для выбранного слоя.  
  
2. Для управления этими ссылками можно использовать следующие задачи:  
  
|**Задача**|**В обозревателе слоев**|  
|------------|---------------------------|  
|Удалить ссылку между слоем и артефактом|Откройте контекстное меню связи артефакта, а затем выберите **удалить**.|  
|Переместить ссылку из одного слоя в другой|Перетащите ссылку артефакта в существующий слой на схеме.<br /><br /> -или-<br /><br /> 1.  Откройте контекстное меню связи артефакта, а затем выберите **Вырезать**.<br />2.  На схеме слоев откройте контекстное меню слоя и выберите **вставить**.|  
|Скопировать ссылку из одного слоя в другой|1.  Откройте контекстное меню связи артефакта, а затем выберите **копирования**.<br />2.  На схеме слоев откройте контекстное меню слоя и выберите **вставить**.|  
|Создать новый слой из существующей ссылки артефакта|Перетащите ссылку артефакта в пустую область на схеме.|  
|Убедитесь, что связанный артефакт поддерживает проверку относительно схемы слоев.|Рассмотрим **поддержка проверки** столбец связи артефакта.|  
  
## <a name="Discovering"></a> Реконструирование существующих зависимостей  
 Зависимости существуют там, где артефакт, связанный с одним слоем, ссылается на артефакт, связанный с другим слоем. Например, класс в одном слое объявляет переменную, которая имеет класс в другом слое. Реконструировать существующие зависимости можно для артефактов, связанных со слоями в схеме.  
  
> [!NOTE]
> Для определенных видов артефактов реконструировать зависимости невозможно. Например, зависимости не могут быть реконструированы из или в слой, связанный с текстовым файлом. Чтобы увидеть, какие артефакты имеют зависимости, которые можно реконструировать, откройте контекстное меню для одного или нескольких слоев и выберите **Просмотр ссылок**. В **обозреватель слоев**, изучите **поддержка проверки** столбца. Зависимости не будут реконструированы для артефактов, для которых в этом столбце отображается **False**.  
  
- Выберите один или несколько слоев, откройте контекстное меню выбранного слоя и затем выберите **создать зависимости**.  
  
  Как правило, на этом этапе можно увидеть некоторые зависимости, которых быть не должно. Эти зависимости можно изменить для соответствия предполагаемой структуре.  
  
## <a name="EditDependencies"></a> Изменение слоев и зависимостей для отображения предполагаемой структуры  
 Чтобы описать изменения, которые планируется внести в систему или предполагаемую архитектуру, измените схему слоев.  
  
|**Задача**|**Выполните следующие действия**|  
|------------|-----------------------------|  
|Изменить или ограничить направление зависимости|Задайте его **направление** свойство.|  
|Создать новые зависимости|Используйте **зависимостей** и **Двунаправленная зависимость** средства.<br /><br /> Чтобы нарисовать несколько зависимостей, дважды щелкните средство. Когда вы закончите, нажмите кнопку **указатель** средство или нажмите клавишу **ESC** ключ.|  
|Указание, что артефакт, связанный со слоем, не может зависеть от указанного пространства имен|Введите пространства имен в свойстве слоя **Запрещенные зависимости пространства имен** свойство. Используйте точку с запятой (**;**) для разделения пространства имен.|  
|Указание, что артефакт, связанный со слоем, не должен более принадлежать указанному пространству имен|Введите пространства имен в свойстве слоя **Запрещенные пространства имен** свойство. Используйте точку с запятой (**;**) для разделения пространства имен.|  
|Указание, что артефакт, связанный со слоем, должен принадлежать одному из указанных пространств имен|Введите пространство имен в свойстве слоя **обязательные пространства имен** свойство. Используйте точку с запятой (**;**) для разделения пространства имен.|  
  
## <a name="EditLayout"></a> Изменение внешнего вида элементов на схеме  
 Можно изменить размер, фигуру, цвет, положение слоев или цвет зависимостей, изменив их свойства.  
  
## <a name="Codemaps"></a> Обнаружение закономерностей и зависимостей на карте кода  
 При создании схемы слоев, можно также создать **карты кода**. Они помогают обнаружить закономерности и зависимости при анализе кода. Воспользуйтесь обозревателем решений, представлением классов или обозревателем объектов, чтобы изучить сборки, пространства имен и классы, которые часто находятся в точном соответствии с существующими слоями. Подробнее о картах кода читайте в следующих разделах:  
  
- [Сопоставление зависимостей во всех решениях](../modeling/map-dependencies-across-your-solutions.md)  
  
- [Использование карт кода для отладки приложений](../modeling/use-code-maps-to-debug-your-applications.md)  
  
- [Поиск потенциальных проблем с помощью анализаторов карт кода](../modeling/find-potential-problems-using-code-map-analyzers.md)  
  
## <a name="see-also"></a>См. также  
 [Видео на Channel 9. Для проектирования и проверки архитектуры с использованием схем слоев](http://go.microsoft.com/fwlink/?LinkID=252073)   
 [Схемы слоев: Справочник по](../modeling/layer-diagrams-reference.md)   
 [Схемы слоев: Рекомендации](../modeling/layer-diagrams-guidelines.md)   
 [Проверка кода по схемам слоев](../modeling/validate-code-with-layer-diagrams.md)   
 [Визуализация кода](../modeling/visualize-code.md)