---
title: Создание приложения OpenGL ES в Android и iOS | Документы Майкрософт
ms.date: 11/15/2016
ms.prod: visual-studio-dev14
ms.technology: tgt-pltfrm-cross-plat
ms.topic: conceptual
dev_langs:
- C++
ms.assetid: 76a67886-df57-4a81-accb-2e3c2eaf607b
caps.latest.revision: 7
author: corob-msft
ms.author: corob
manager: jillfra
ms.openlocfilehash: b9f5db4ccd70136b711f5bd221244418cf843485
ms.sourcegitcommit: 6cfffa72af599a9d667249caaaa411bb28ea69fd
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 09/02/2020
ms.locfileid: "68151117"
---
# <a name="build-an-opengl-es-application-on-android-and-ios"></a>Build an OpenGL ES Application on Android and iOS
[!INCLUDE[vs2017banner](../includes/vs2017banner.md)]

Установив компонент Visual C++ для разработки кроссплатформенных мобильных приложений, вы можете создавать решения и проекты Visual Studio для приложений iOS и Android с общим кодом. В этом пошаговом руководстве показано, как разработать шаблон приложения, который служит для создания как простейшего приложения iOS, так и приложения Android Native Activity. Приложения имеют общий код C++, который использует технологию OpenGL ES для отображения одинакового анимированного вращающегося куба на обеих платформах. OpenGL ES (GLES) — это интерфейс API двухмерной и трехмерной графики, который поддерживается многими мобильными устройствами.  
  
 [Необходимость](#req)   
 [Создание нового проекта приложения OpenGL](#Create)   
 [Сборка и запуск приложения Android](#BuildAndroid)   
 [Сборка и запуск приложения iOS](#BuildIOS)   
 [Настройка приложений](#Customize)  
  
## <a name="requirements"></a><a name="req"></a> Требования  
 Перед созданием приложения OpenGL ES для iOS и Android убедитесь в том, что выполняются все требования к системе. В Visual Studio 2015 необходимо установить Visual C++ для разработки кроссплатформенных мобильных приложений. Убедитесь в том, что в установку включены необходимые средства и пакеты SDK сторонних разработчиков и что установлен эмулятор Visual Studio для Android. Дополнительные сведения и подробные инструкции см. в разделе [Install Visual C++ для разработки кросс-платформенных мобильных приложений](../cross-platform/install-visual-cpp-for-cross-platform-mobile-development.md). Для сборки и тестирования приложения iOS вам потребуется компьютер Mac, настроенный в соответствии с инструкциями по установке. Дополнительные сведения о настройке разработки для iOS см. в [статье Установка и настройка средств для сборки с помощью iOS](../cross-platform/install-and-configure-tools-to-build-using-ios.md) .  
  
## <a name="create-a-new-opengles-application-project"></a><a name="Create"></a> Создание нового проекта приложения OpenGL  
 В этом учебном руководстве вы сначала создадите проект приложения OpenGL ES, а затем выполните сборку и запуск приложения по умолчанию в эмуляторе Visual Studio для Android. После этого вы выполните сборку приложения для iOS и запустите его в эмуляторе iOS.  
  
#### <a name="to-create-a-new-project"></a>Создание нового проекта  
  
1. Запустите Visual Studio. В строке меню выберите **Файл**, **Создать**, **Проект**.  
  
2. В диалоговом окне **Новый проект** в разделе **Шаблоны**щелкните пункт **Visual C++**, **Кроссплатформенный**, а затем выберите шаблон **Приложение OpenGLES (Android, iOS)** .  
  
3. Назначьте приложению имя, например `MyOpenGLESApp`, а затем нажмите кнопку **ОК**.  
  
    ![Новый проект "Приложение OpenGLES"](../cross-platform/media/cppmdd-opengles-newproj.PNG "CPPMDD_OpenGLES_NewProj")  
  
    Visual Studio создаст новое решение и откроет обозреватель решений.  
  
    ![MyOpenGLESApp в обозревателе решений](../cross-platform/media/cppmdd-opengles-solexpl.PNG "CPPMDD_OpenGLES_SolExpl")  
  
   Новое решение приложения OpenGL ES включает в себя три проекта библиотек и два проекта приложений. В папке Libraries находится проект общего кода и два проекта под конкретные платформы, которые ссылаются на общий код.  
  
- **MyOpenGLESApp.Android.NativeActivity** содержит ссылки и связующий код, который реализует приложение Native Activity для Android. Реализация точек входа из связующего кода находится в файле main.cpp, который включает общий код из MyOpenGLESApp.Shared. Предварительно откомпилированные заголовки находятся в файле pch.h. Проект приложения Native Activity компилируется в файл общей библиотеки (SO), который передается в проект MyOpenGLESApp.Android.Packaging.  
  
- **MyOpenGLESApp.iOS.StaticLibrary** создает файл статической библиотеки iOS (A), который содержит общий код из MyOpenGLESApp.Shared. Он связан с приложением, создаваемым проектом MyOpenGLESApp.iOS.Application.  
  
- **MyOpenGLESApp.Shared** содержит общий код, который работает на разных платформах. В нем используются макросы препроцессора для условной компиляции кода под конкретную платформу. Общий код передается по ссылке на проект в MyOpenGLESApp.Android.NativeActivity и MyOpenGLESApp.iOS.StaticLibrary.  
  
  Решение включает два проекта для создания приложений для платформ Android и iOS.  
  
- **MyOpenGLESApp.Android.Packaging** создает APK-файл для развертывания на устройстве Android или в эмуляторе Android. Он содержит ресурсы и файл AndroidManifest.xml, в котором задаются свойства манифеста. В него также входит XML-файл, управляющий процессом сборки Ant. По умолчанию он задан как начальный проект, который можно развернуть и запустить непосредственно из Visual Studio.  
  
- **MyOpenGLESApp.iOS.Application** содержит ресурсы и связующий код Objective-C для создания приложения iOS, связанного с кодом статической библиотеки C++ в MyOpenGLESApp.iOS.StaticLibrary. Этот проект создает пакет сборки, который передается на компьютер Mac средой Visual Studio и удаленным агентом. При сборке этого проекта среда Visual Studio отправляет файлы и команды для сборки и развертывания приложения на компьютере Mac.  
  
## <a name="build-and-run-the-android-app"></a><a name="BuildAndroid"></a> Сборка и запуск приложения Android  
 Решение, созданное с помощью шаблона, задает приложение Android в качестве проекта по умолчанию.  Вы можете выполнить сборку и запуск этого приложения, чтобы проверить его установку и настройку. Для первоначального теста запустите приложение в одном из профилей устройств, установленных эмулятором Visual Studio для Android. Если вы предпочитаете тестировать приложение на другой платформе, загрузите целевой эмулятор или подключите устройство к компьютеру.  
  
#### <a name="to-build-and-run-the-android-native-activity-app"></a>Сборка и запуск приложения Android Native Activity  
  
1. Выберите пункт **x86** из раскрывающегося списка **Платформы решения** , если он еще не выбран.  
  
    ![Установка Платформы решения на x86](../cross-platform/media/cppmdd-opengles-solutionplat.png "CPPMDD_OpenGLES_SolutionPlat")  
  
    Используйте 32-разрядную платформу для эмулятора Android для Windows. Если вы выполняете сборку для устройства, выберите платформу решения в соответствии с процессором устройства. Если список **платформы решения** не отображается, выберите пункт **платформы решения** в списке **Добавить или удалить кнопки** , а затем выберите свою платформу.  
  
2. В **обозревателе решений**откройте контекстное меню проекта MyOpenGLESApp.Android.Packaging и выберите команду **Сборка**.  
  
    ![Проект сборки упаковки Android](../cross-platform/media/cppmdd-opengles-andbuild.png "CPPMDD_OpenGLES_AndBuild")  
  
    В окне "Выходные данные" отображаются выходные данные процесса сборки для общей библиотеки Android и приложения Android.  
  
    ![Выходные данные сборки для проектов Android](../cross-platform/media/cppmdd-opengles-andoutput.png "CPPMDD_OpenGLES_AndOutput")  
  
3. Выберите один из профилей эмулятора Visual Studio для телефона Android (32-разрядный) в качестве цели развертывания.  
  
    ![Выбор целевого объекта развертывания](../cross-platform/media/cppmdd-opengles-pickemulator.png "CPPMDD_OpenGLES_PickEmulator")  
  
    Если вы установили другие эмуляторы или подключили устройство Android, то можете выбрать их в раскрывающемся списке платформы развертывания. Для запуска приложения платформа решения сборки должна совпадать с платформой целевого устройства.  
  
4. Нажмите клавишу F5 для запуска процесса отладки или Shift + F5 для запуска без отладки.  
  
    Visual Studio запускает эмулятор, который за несколько секунд загружает и развертывает код. Ниже показано, как приложение выглядит в эмуляторе Visual Studio для Android.  
  
    ![Приложение, выполняющееся в эмуляторе Android](../cross-platform/media/cppmdd-opengles-andemulator.png "CPPMDD_OpenGLES_AndEmulator")  
  
    После запуска приложения можно задать точки останова и использовать отладчик для проверки кода, языковых стандартов и контрольных значений.  
  
5. Для останова процесса отладки нажмите Shift + F5.  
  
    Эмулятор является отдельным процессом, который продолжает выполняться. Вы можете изменять, компилировать и развертывать код несколько раз в одном эмуляторе. Ваше приложение находится в коллекции приложений эмулятора, откуда его можно запускать напрямую.  
  
   Созданные проекты приложения Android Native Activity и библиотеки помещают общий код C++ в динамическую библиотеку, которая включает связующий код для взаимодействия с платформой Android. Это означает, что большая часть кода приложения находится в библиотеке, а манифест, ресурсы и инструкции сборки — в проекте упаковки. Общий код вызывается из main.cpp в проекте NativeActivity. Более подробную информацию о программировании Android Native Activity см. на странице [Concepts](https://developer.android.com/ndk/guides/concepts.html) (Основные понятия) в Android Developer NDK.  
  
   Visual Studio выполняет сборку проектов Android Native Activity с помощью пакета Android NDK, в котором в качестве набора инструментов платформы используется Clang. Visual Studio сопоставляет свойства в проекте NativeActivity с параметрами командной строки, которые используются для компиляции, компоновки и отладки на целевой платформе. Чтобы получить подробные сведения, откройте диалоговое окно **Страницы свойств** для проекта MyOpenGLESApp.Android.NativeActivity. Более подробную информацию о параметрах командной строки см. в [руководстве пользователя компилятора Clang](http://clang.llvm.org/docs/UsersManual.html).  
  
## <a name="build-and-run-the-ios-app"></a><a name="BuildIOS"></a> Сборка и запуск приложения iOS  
 Проект приложения iOS создается и редактируется в Visual Studio, но из-за лицензионных ограничений его сборку и развертывание необходимо выполнять с компьютера Mac. Visual Studio взаимодействует с удаленным агентом, запущенным на компьютере Mac, для передачи файлов проекта и выполнения команд сборки, развертывания и отладки. Перед сборкой приложения iOS необходимо настроить компьютер Mac и среду Visual Studio для обмена данными. Подробные инструкции см. [в статье Установка и настройка средств для сборки с помощью iOS](../cross-platform/install-and-configure-tools-to-build-using-ios.md). После того как удаленный агент будет запущен, а среда Visual Studio сопряжена с компьютером Mac, вы сможете выполнить сборку и запуск приложения iOS для проверки установки и настройки.  
  
#### <a name="to-build-and-run-the-ios-app"></a>Сборка и запуск приложения iOS  
  
1. Убедитесь в том, что удаленный агент запущен на компьютере Mac, а среда Visual Studio сопряжена с удаленным агентом. Чтобы запустить удаленный агент, откройте окно приложения "Терминал" и введите `vcremote`. Дополнительные сведения см. в разделе [Настройка удаленного агента в Visual Studio](../cross-platform/install-and-configure-tools-to-build-using-ios.md#ConfigureVS).  
  
    ![Окно терминала Mac, в котором выполняется команда vcremote](../cross-platform/media/cppmdd-common-vcremote.png "CPPMDD_common_vcremote")  
  
2. Выберите пункт **x86** из раскрывающегося списка **Платформы решения** , если он еще не выбран.  
  
    ![Установка Платформы решения на x86](../cross-platform/media/cppmdd-opengles-solutionplat.png "CPPMDD_OpenGLES_SolutionPlat")  
  
    Используйте 32-разрядную платформу в качестве целевой для эмулятора iOS. Если вы выполняете сборку для устройства iOS, выберите платформу решения в соответствии с процессором устройства (обычно это процессор ARM). Если список **платформы решения** не отображается, выберите пункт **платформы решения** в списке **Добавить или удалить кнопки** , а затем выберите свою платформу.  
  
3. В обозревателе решений откройте контекстное меню проекта MyOpenGLESApp.iOS.Application и выберите команду **Сборка**.  
  
    ![Создание проекта приложения для iOS](../cross-platform/media/cppmdd-opengles-iosbuild.png "CPPMDD_OpenGLES_iOSBuild")  
  
    В окне "Выходные данные" отображаются выходные данные процесса сборки для статической библиотеки iOS и приложения iOS. На компьютере Mac в окне "Терминал", в котором выполняется удаленный агент, отображается команда и действие передачи файлов.  
  
    На компьютере Mac может появиться запрос на принятие запроса подписания кода. Чтобы продолжить, нажмите "Разрешить".  
  
4. На панели инструментов выберите **Эмулятор iOS** , чтобы запустить приложение в эмуляторе iOS на компьютере Mac. На запуск эмулятора может потребоваться некоторое время. Чтобы увидеть выходные данные эмулятора на компьютере Mac, может потребоваться перевести его на передний план.  
  
    ![Приложение, работающее в симуляторе iOS](../cross-platform/media/cppmdd-opengles-iossimulator.png "CPPMDD_OpenGLES_iOSSimulator")  
  
    После запуска приложения можно задать точки останова и использовать отладчик Visual Studio для проверки локальных значений, стека вызовов и контрольных значений.  
  
    ![Отладчик в точке останова в приложении iOS](../cross-platform/media/cppmdd-opengles-iosdebug.png "CPPMDD_OpenGLES_iOSDebug")  
  
5. Для останова процесса отладки нажмите Shift + F5.  
  
    Эмулятор iOS является отдельным процессом, который продолжает выполняться на компьютере Mac. Вы можете изменять, компилировать и развертывать код несколько раз в одном экземпляре эмулятора iOS. Вы также можете выполнять код непосредственно в эмуляторе после его развертывания.  
  
   Созданные проекты приложения и библиотеки iOS помещают код C++ в статическую библиотеку, которая реализует только общий код. Большая часть кода приложения находится в проекте приложения. Вызовы кода общей библиотеки в этом проекте шаблона осуществляются в файле GameViewController.m. Для сборки приложения iOS среда Visual Studio использует набор средств платформы Xcode, которому требуется взаимодействовать с удаленным клиентом, запущенным на компьютере Mac.  
  
   Visual Studio передает файлы проекта и отправляет команды удаленному клиенту для сборки приложения с помощью Xcode. Удаленный клиент отправляет сведения о состоянии сборки обратно среде Visual Studio. После успешного завершения сборки приложения можно использовать Visual Studio для отправки команд на выполнение и отладку приложения. Отладчик Visual Studio управляет выполнением приложения в эмуляторе iOS, работающем на компьютере Mac, или на подключенном устройстве iOS. Visual Studio сопоставляет свойства в проекте StaticLibrary с параметрами командной строки, которые используются для сборки, компоновки и отладки на целевой платформе iOS. Чтобы получить подробную информацию о параметрах командной строки компилятора, откройте диалоговое окно **Страницы свойств** для проекта MyOpenGLESApp.iOS.StaticLibrary.  
  
## <a name="customize-your-apps"></a><a name="Customize"></a> Настройка приложений  
 Вы можете изменить общий код C++, чтобы добавить или изменить общие функциональные возможности. В соответствии с этим нужно изменить вызовы общего кода в проектах MyOpenGLESApp.Android.NativeActivity и MyOpenGLESApp.iOS.Application. Для указания разделов общего кода, предназначенных для конкретной платформы, можно использовать макросы препроцессора. При выполнении сборки для Android предварительно определен макрос препроцессора `__ANDROID__` . При выполнении сборки для iOS предварительно определен макрос препроцессора `__APPLE__` .  
  
 Чтобы увидеть подсказку IntelliSense для конкретной платформы проекта, выберите проект в раскрывающемся списке переключателя контекстов на панели навигации в верхней части окна редактора.  
  
 ![Раскрывающийся список переключателя контекстов проекта в редакторе](../cross-platform/media/cppmdd-opengles-contextswitcher.png "CPPMDD_OpenGLES_ContextSwitcher")  
  
 Проблемы, найденные IntelliSense в текущем проекте, подчеркиваются красной волнистой линией. Проблемы в других проектах подчеркиваются фиолетовой волнистой линией. По умолчанию Visual Studio не поддерживает выделение кода цветом и технологию IntelliSense для файлов с кодом Java и Objective-C. Однако вы все же можете изменять исходные файлы и ресурсы для настройки имени приложения, значка и других особенностей реализации.
