---
title: MSBuild | Документы Майкрософт
ms.date: 11/15/2016
ms.prod: visual-studio-dev14
ms.technology: msbuild
ms.topic: conceptual
helpviewer_keywords:
- MSBuild, about MSBuild
- MSBuild, overview
ms.assetid: e39f13f7-1e1d-4435-95ca-0c222bca071c
caps.latest.revision: 62
author: mikejo5000
ms.author: mikejo
manager: jillfra
ms.openlocfilehash: 13029e05e4f29e532918562afd2fee520b387464
ms.sourcegitcommit: 75807551ea14c5a37aa07dd93a170b02fc67bc8c
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 07/11/2019
ms.locfileid: "67821628"
---
# <a name="msbuild"></a>MSBuild
[!INCLUDE[vs2017banner](../includes/vs2017banner.md)]

[!INCLUDE[vstecmsbuildengine](../includes/vstecmsbuildengine-md.md)] представляет собой платформу для сборки приложений. Компонент MSBuild обеспечивает для файла проекта схему XML, определяющую способы, используемые платформой сборки для обработки и сборки приложений. Visual Studio использует MSBuild, но MSBuild не зависит от Visual Studio. С помощью вызова msbuild.exe для файла проекта или решения можно контролировать и собирать в продукты в средах без установленного экземпляра Visual Studio.  
  
 Visual Studio использует MSBuild для загрузки и сборки управляемых проектов. Файлы проектов в Visual Studio (с расширением CSPROJ, VBPROJ, VCXPROJ) содержат код XML MSBuild, который выполняется при сборке проекта с помощью интегрированной среды разработки. Проекты Visual Studio импортируют все необходимые параметры и процессы сборки для выполнения стандартной работы по разработке, но их можно расширять и изменять в Visual Studio или в редакторе XML.  
  
 Сведения об MSBuild для C++ см. в разделе [MSBuild (Visual C++)](https://msdn.microsoft.com/library/7a1be7ff-0312-4669-adf2-5f5bf507d560).  
  
 В следующих примерах показаны случаи, когда сборки можно запускать с помощью командной строки MSBuild, а не интегрированной среды разработки Visual Studio.  
  
- Среда Visual Studio не установлена.  
  
- Необходимо использовать 64-разрядную версию MSBuild. Эта версия MSBuild обычно не нужна, но она позволяет MSBuild обращаться к большему объему памяти.  
  
- Сборку требуется выполнять в нескольких процессах. Однако можно использовать интегрированную среду разработки, чтобы добиться того же результата для проектов на C++ и C#.  
  
- Требуется изменить систему сборки. Например, может потребоваться выполнить следующие действия:  
  
  - предварительная обработка файлов перед их компиляцией;  
  
  - копирование выходных данных сборки в другое место;  
  
  - создание сжатых файлов из выходных данных сборки;  
  
  - пост-обработка. Например, может потребоваться присвоить сборке другой номер версии.  
  
  Можно написать код в интегрированной среде разработки Visual Studio, но запускать сборку с помощью MSBuild. В качестве альтернативы можно выполнять сборку кода в интегрированной среде разработки на компьютере разработчика, но использовать командную строку MSBuild для сборки и интеграции кода, полученного от нескольких разработчиков.  
  
> [!NOTE]
> С помощью Team Foundation Build можно автоматически компилировать, тестировать и развертывать приложение. Система сборки может автоматически запускать сборку, когда разработчики возвращают код (например, как часть стратегии непрерывной интеграции) или по расписанию (например, выполнять ежедневную ночную тестовую сборку). Team Foundation Build компилирует код с использованием MSBuild. Дополнительные сведения см. в разделе [Сборка приложения](https://msdn.microsoft.com/library/a971b0f9-7c28-479d-a37b-8fd7e27ef692).  
  
 В этом разделе представлен обзор MSBuild. Вводную информацию см. в статье [Пошаговое руководство. в Visual Studio](../msbuild/walkthrough-using-msbuild.md).  
  
 **Содержание раздела**  
  
- [Использование MSBuild в командной строке](#BKMK_CommandPrompt)  
  
- [Файл проекта](#BKMK_ProjectFile)  
  
  - [Свойства](#BKMK_Properties)  

  - [Элементы](#BKMK_Items)  

  - [Задачи](#BKMK_Tasks)  

  - [Целевые объекты](#BKMK_Targets)  

- [Журналы построений](#BKMK_BuildLogs)  
  
- [Использование MSBuild в Visual Studio](#BKMK_VisualStudio)  
  
- [Настройка для различных версий](#BKMK_Multitargeting)  
  
## <a name="BKMK_CommandPrompt"></a> Использование MSBuild в командной строке  
 Чтобы запустить [!INCLUDE[vstecmsbuild](../includes/vstecmsbuild-md.md)] из командной строки, передайте файл проекта в MSBuild.exe с использованием соответствующих параметров командной строки. Параметры командной строки позволяют задавать свойства, выполнять определенные целевые объекты и задавать другие параметры, управляющие процессом построения. Например, используя следующий синтаксис командной строки, можно создать файл `MyProj.proj` со свойством `Configuration`, для которого задается значение `Debug`.  
  
```  
MSBuild.exe MyProj.proj /property:Configuration=Debug  
```  
  
 Дополнительные сведения о параметрах командной строки [!INCLUDE[vstecmsbuild](../includes/vstecmsbuild-md.md)] см. в [справочнике по командной строке](../msbuild/msbuild-command-line-reference.md).  
  
> [!IMPORTANT]
> Перед загрузкой проекта определите, можно ли доверять коду.  
  
## <a name="BKMK_ProjectFile"></a> Файл проекта  
 [!INCLUDE[vstecmsbuild](../includes/vstecmsbuild-md.md)] использует открытый и расширяемый формат файлов проекта на базе XML. Формат файла проекта [!INCLUDE[vstecmsbuild](../includes/vstecmsbuild-md.md)] позволяет разработчикам описывать создаваемые элементы, а также способы их построения для разных операционных систем и конфигураций. Кроме того, формат файла проекта позволяет разработчикам создавать многократно используемые правила сборки, которые можно разложить на отдельные файлы, чтобы сборки могли выполняться единообразно в различных проектах в составе соответствующего продукта.  
  
 В следующих разделах описаны некоторые из базовых элементов формата файла проекта [!INCLUDE[vstecmsbuild](../includes/vstecmsbuild-md.md)]. См. дополнительные сведения о [создании базового файла проекта Создание файла проекта MSBuild с нуля](../msbuild/walkthrough-creating-an-msbuild-project-file-from-scratch.md).  
  
### <a name="BKMK_Properties"></a> Свойства  
 Свойства представляют пары ключ-значение, с помощью которых выполняется настройка построения. Для объявления свойства создается элемент с таким же именем как у свойства, который является дочерним по отношению к элементу [PropertyGroup](../msbuild/propertygroup-element-msbuild.md). Например, в следующем коде создается свойство `BuildDir` со значением `Build`.  
  
```  
<PropertyGroup>  
    <BuildDir>Build</BuildDir>  
</PropertyGroup>  
```  
  
 Свойство можно определить условно, задав атрибут `Condition` в элементе. Содержимое условных элементов игнорируется, пока значение условия не станет `true`. В следующем примере определяется элемент `Configuration`, если он еще не был определен.  
  
```  
<Configuration  Condition=" '$(Configuration)' == '' ">Debug</Configuration>  
```  
  
 Для обращения к свойствам в файле проекта используется синтаксис $(*ИмяСвойства*). Например, к свойствам из предыдущих примеров можно обращаться с помощью конструкций `$(BuildDir)` и `$(Configuration)`.  
  
 Дополнительные сведения о свойствах см. в разделе [Свойства MSBuild](msbuild-properties1.md).  
  
### <a name="BKMK_Items"></a> Элементы  
 Элементы — это входные данные для системы сборки, как правило, представляющие файлы. Элементы группируются в типы на основе определяемых пользователем имен элементов. Эти типы элементов можно использовать в качестве параметров для задач, в которых с помощью отдельных элементов выполняются этапы процесса построения.  
  
 Для объявления элементов в файле проекта создается элемент с именем типа элементов, являющийся дочерним по отношению к элементу [ItemGroup](../msbuild/itemgroup-element-msbuild.md). Например, с помощью приведенного ниже кода создается тип элементов с именем `Compile`, в который входят два файла.  
  
```  
<ItemGroup>  
    <Compile Include = "file1.cs"/>  
    <Compile Include = "file2.cs"/>  
</ItemGroup>  
```  
  
 Для обращения к типам элементов в файле проекта используется синтаксис @(*ТипЭлемента*). Например, ссылка на тип элементов в этом примере выглядела бы следующим образом: `@(Compile)`.  
  
 В MSBuild имена элементов и атрибутов задаются с учетом регистра. А имена свойств, элементов (item) и метаданных — нет. В следующем примере создается тип элементов `Compile`, `comPile` или любого другого варианта написания, и типу элементов присваивается значение "one.cs;two.cs".  
  
```  
<ItemGroup>  
  <Compile Include="one.cs" />  
  <comPile Include="two.cs" />  
</ItemGroup>  
```  
  
 При объявлении элементов можно использовать подстановочные знаки; элементы могут содержать дополнительные метаданные для расширенных сценариев построения. Дополнительные сведения об элементах см. в разделе [Элементы](../msbuild/msbuild-items.md).  
  
### <a name="BKMK_Tasks"></a> Задачи  
 Задачи — это блоки исполняемого кода, с помощью которых в проектах [!INCLUDE[vstecmsbuild](../includes/vstecmsbuild-md.md)] выполняются операции построения. Например, в задаче может выполняться компиляция входных файлов или запускаться внешняя программа. Созданные задачи могут использоваться совместно и многократно разными разработчиками в различных проектах.  
  
 Алгоритм выполнения задачи записан в управляемом коде и сопоставлен с [!INCLUDE[vstecmsbuild](../includes/vstecmsbuild-md.md)] с помощью элемента [UsingTask](../msbuild/usingtask-element-msbuild.md). Для создания собственной задачи можно разработать управляемый тип, реализующий интерфейс <xref:Microsoft.Build.Framework.ITask>. Дополнительные сведения о способах создания задач см. в разделе [Написание задач](../msbuild/task-writing.md).  
  
 [!INCLUDE[vstecmsbuild](../includes/vstecmsbuild-md.md)] включает стандартные задачи, которые можно изменять в соответствии с требованиями.  Примеры: [Copy](../msbuild/copy-task.md) — копирование файлов, [MakeDir](../msbuild/makedir-task.md) — создание каталогов, [Csc](../msbuild/csc-task.md) — компиляция файлов исходного кода Visual C#. Список доступных задач и сведения об их использовании см. в разделе [Справочник по задачам](../msbuild/msbuild-task-reference.md).  
  
 Задача выполняется в файле проекта [!INCLUDE[vstecmsbuild](../includes/vstecmsbuild-md.md)] путем создания элемента с таким же именем как у задачи в виде дочернего элемента по отношению к элементу [Target](../msbuild/target-element-msbuild.md). Задачи, как правило, принимают параметры, которые передаются как атрибуты элемента. В качестве параметров можно использовать свойства и элементы [!INCLUDE[vstecmsbuild](../includes/vstecmsbuild-md.md)]. Например, с помощью следующего кода вызывается задача [MakeDir](../msbuild/makedir-task.md) и ей передается значение свойства `BuildDir`, объявленного в предыдущем примере.  
  
```  
<Target Name="MakeBuildDirectory">  
    <MakeDir  Directories="$(BuildDir)" />  
</Target>  
```  
  
 Дополнительные сведения о задачах см. в разделе [Задачи](../msbuild/msbuild-tasks.md).  
  
### <a name="BKMK_Targets"></a> Целевые объекты  
 Целевые объекты позволяют группировать задачи в определенном порядке и использовать разделы файла проекта в качестве точек входа в процесс построения. Целевые объекты часто группируются в логические разделы, чтобы повысить удобочитаемость и расширяемость. Благодаря разбиению действий построения на множество целевых объектов можно вызывать один фрагмент процесса построения из других целевых объектов, не создавая при этом копии соответствующего раздела кода в каждом целевом объекте. Например, если требуется создать ссылки для нескольких точек входа в процесс сборки, можно создать целевой объект, который выполняет сборку ссылок, и выполнять этот целевой объект из каждой нужной точки входа.  
  
 Целевые объекты объявляются в файле проекта с помощью элемента [Target](../msbuild/target-element-msbuild.md). Например, с помощью следующего кода создается целевой объект с именем `Compile`, который затем вызывает задачу [Csc](../msbuild/csc-task.md) со списком элементов, объявленным в предыдущем примере.  
  
```  
<Target Name="Compile">  
    <Csc Sources="@(Compile)" />  
</Target>  
```  
  
 В более сложных сценариях целевые объекты могут использоваться для описания связей друг с другом и выполнять анализ зависимостей, что позволяет пропускать целые разделы процесса сборки, если такой целевой объект актуален. Дополнительные сведения о целевых объектах см. в разделе [Целевые объекты](../msbuild/msbuild-targets.md).  
  
## <a name="BKMK_BuildLogs"></a> Журналы построений  
 Ошибки, предупреждения и сообщения журнала сборки можно выводить на консоль или на другое устройство вывода. Дополнительные сведения см. в разделах [Получение журналов построения](../msbuild/obtaining-build-logs-with-msbuild.md) и [Ведение журнала в MSBuild](../msbuild/logging-in-msbuild.md).  
  
## <a name="BKMK_VisualStudio"></a> Использование MSBuild в Visual Studio  
 В [!INCLUDE[vsprvs](../includes/vsprvs-md.md)] используется формат файла проекта [!INCLUDE[vstecmsbuild](../includes/vstecmsbuild-md.md)] для хранения данных построения об управляемых объектах. Параметры проекта, добавленные или измененные с помощью интерфейса [!INCLUDE[vsprvs](../includes/vsprvs-md.md)], отражаются в PROJ-файле, который создается для каждого проекта. Для построения управляемых проектов в [!INCLUDE[vsprvs](../includes/vsprvs-md.md)] используется размещенный экземпляр [!INCLUDE[vstecmsbuild](../includes/vstecmsbuild-md.md)]. Это означает, что выполнить построение управляемого проекта можно в [!INCLUDE[vsprvs](../includes/vsprvs-md.md)] или в командной строке (даже при отсутствии [!INCLUDE[vsprvs](../includes/vsprvs-md.md)]), и результаты будут одинаковыми.  
  
 См. дополнительные сведения об [использовании MSBuild в Visual Studio](../msbuild/walkthrough-using-msbuild.md).  
  
## <a name="BKMK_Multitargeting"></a> Настройка для различных версий  
 С помощью Visual Studio можно компилировать приложение для его запуска на любой из нескольких версий платформы .NET Framework. Например, можно компилировать приложение для запуска в .NET Framework 2.0 на 32-разрядной платформе, а также компилировать то же приложение для запуска в .NET Framework 4.5 на 64-разрядной платформе. Возможность компиляции для нескольких платформ называется настройкой для различных версий.  
  
 Ниже приведены несколько преимуществ настройки для различных версий:  
  
- Можно разрабатывать приложения, которые предназначены для более ранних версий платформы .NET Framework, например версий 2.0, 3.0 и 3.5.  
  
- Можно ориентироваться на платформы, отличные от .NET Framework, например на Silverlight.  
  
- Можно ориентироваться на *профиль платформы*, который представляет собой предопределенное подмножество целевой платформы.  
  
- После появления пакета обновления для текущей версии .NET Framework можно выбрать его в качестве целевой платформы.  
  
- Поддержка различных платформ гарантирует, что приложение использует только те функциональные возможности, которые доступны в целевой версии .NET Framework и платформы.  
  
  Дополнительные сведения см. в разделе [Настройка для различных версий](../msbuild/msbuild-multitargeting-overview.md).  
  
## <a name="related-topics"></a>См. также  
  
|Заголовок|Описание|  
|-----------|-----------------|  
|[Пошаговое руководство: создание файла проекта MSBuild с нуля](../msbuild/walkthrough-creating-an-msbuild-project-file-from-scratch.md)|Содержит описание способов пошагового создания основного файла проекта путем использования только текстового редактора.|  
|[Пошаговое руководство: Использование MSBuild](../msbuild/walkthrough-using-msbuild.md)|Содержит вводную информацию о стандартных блоках MSBuild и описание способов записи, управления и отладки проектов MSBuild без выхода из интегрированной среды разработки Visual Studio.|  
|[Основные понятия MSBuild](../msbuild/msbuild-concepts.md)|Содержит информацию о четырех стандартных блоках MSBuild: свойствах, элементах, целевых объектах и задачах.|  
|[Элементы](../msbuild/msbuild-items.md)|Содержит описание общих понятий, относящихся к формату файлов [!INCLUDE[vstecmsbuild](../includes/vstecmsbuild-md.md)], и способов взаимодействия фрагментов.|  
|[Свойства MSBuild](msbuild-properties1.md)|Содержит вводную информацию о свойствах и коллекциях свойств. Свойства представляют собой пары ключ-значение, с помощью которых выполняется настройка сборок.|  
|[Целевые объекты](../msbuild/msbuild-targets.md)|Содержит объяснение группировки задач в определенном порядке и вызова разделов процесса построения из командной строки.|  
|[Задачи](../msbuild/msbuild-tasks.md)|Описывает процесс создания блока исполняемого кода, с помощью которого [!INCLUDE[vstecmsbuild](../includes/vstecmsbuild-md.md)] выполняет атомарные операции построения.|  
|[Условия](../msbuild/msbuild-conditions.md)|Рассматривает использование атрибута `Condition` в элементе MSBuild.|  
|[Дополнительные возможности](../msbuild/msbuild-advanced-concepts.md)|Содержит информацию о пакетной обработке, выполнении преобразований, использовании нескольких целевых платформ и других дополнительных возможностях.|  
|[Ведение журнала в MSBuild](../msbuild/logging-in-msbuild.md)|Описание возможностей записи в журнал событий, сообщений и ошибок сборки.|  
|[Дополнительные ресурсы](../msbuild/additional-msbuild-resources.md)|Содержит список ресурсов сообщества и службы поддержки с дополнительной информацией о MSBuild.|  
  
## <a name="reference"></a>Ссылка  
 [Справочные сведения о MSBuild](../msbuild/msbuild-reference.md)  
 Содержит ссылки на разделы, содержащие справочную информацию.  
  
 Глоссарий  
 Содержит определения общих терминов MSBuild.
