---
title: Добавление данных взаимодействия уровней из командной строки | Документы Майкрософт
description: В функциях многоуровневых приложений, взаимодействующих с одной или несколькими базами данных, профилирование уровневого взаимодействия позволяет получить сведения о времени выполнения синхронных вызовов.
ms.custom: SEO-VS-2020
ms.date: 11/04/2016
ms.topic: conceptual
helpviewer_keywords:
- tier interaction profiling method
- profiling tools,tier interaction method
author: mikejo5000
ms.author: mikejo
manager: jmartens
monikerRange: vs-2017
ms.workload:
- multiple
ms.openlocfilehash: 9070e515fd59f7b29427f20322ef6cb1a01afaee
ms.sourcegitcommit: ae6d47b09a439cd0e13180f5e89510e3e347fd47
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 02/08/2021
ms.locfileid: "99901330"
---
# <a name="add-tier-interaction-data-from-the-command-line"></a>Добавление данных о взаимодействии уровней из командной строки

Профилирование уровневого взаимодействия позволяет получить дополнительные сведения о времени выполнения синхронных вызовов [!INCLUDE[vstecado](../data-tools/includes/vstecado_md.md)] в функциях многоуровневых приложений, взаимодействующих с одной или несколькими базами данных.

**Windows 8 и Windows Server 2012**

Чтобы собрать данные об уровневом взаимодействии на классических приложениях Windows 8 и приложениях Windows Server 2012, необходимо использовать метод инструментирования. Сбор данных по взаимодействию уровней в приложениях универсальной платформы Windows не поддерживается.

**Выпуски Visual Studio**

Сведения о профилировании уровневого взаимодействия можно собирать с помощью любого выпуска Visual Studio. Но данные профилирования уровневого взаимодействия можно просматривать только в Visual Studio Enterprise.

**Сбор данных об уровневом взаимодействии на удаленном компьютере**

Чтобы собирать сведения об уровневом взаимодействии на удаленном компьютере, необходимо скопировать и установить файл **vs_profiler\_** _\<Platform>_ **\_** _\<Language>_ **.exe** из папки _%VSInstallDir%_ **\Team Tools\Performance Tools\Setups** на компьютере с Visual Studio. Нельзя использовать средства профилирования в пакете загрузки [Удаленная отладка](../debugger/remote-debugging.md).

**Отчеты TIP**

Данные об уровневом взаимодействии можно просматривать только в Visual Studio Enterprise Получение отчетов об уровневом взаимодействии (TIP) на основе файлов с помощью [VSPerfReport](../profiling/vsperfreport.md) недоступно.

## <a name="add-tier-interaction-data-with-vsperfcmd"></a>Добавление данных об уровневом взаимодействии с помощью VSPerfCmd

Программа командной строки VSPerfASPNETCmd позволяет получить доступ к полному набору функций, доступных в средствах профилирования. Чтобы добавить сведения об уровневом взаимодействии в данные профилирования, собранные с помощью VSPerfCmd, необходимо использовать программу **VSPerfCLREnv** для установки и удаления переменных среды, которые обеспечивают сбор данных о взаимодействии. Указываемые параметры и процедуры, необходимые для сбора данных, зависят от типа профилируемого приложения.

## <a name="profile-stand-alone-applications"></a>Профилирование автономных приложений

Чтобы добавить данные об уровневом взаимодействии в приложение, которое выполняется другим процессом (например, в классическое приложение Windows, осуществляющее синхронные вызовы [!INCLUDE[vstecado](../data-tools/includes/vstecado_md.md)] к базе данных SQLServer), используйте параметр **VSPerfClrEnv /InteractionOn**, чтобы задать переменные среды, и параметр **VSPerfClrEnv /InteractionOff** для их удаления.

В следующем примере выполняется профилирование классического приложения Windows с помощью метода инструментирования и сбор данных об уровневом взаимодействии.

### <a name="profile-a-windows-desktop-application-example"></a>Пример профилирования классического приложения Windows

1. Откройте окно командной строки как администратор. В меню **Пуск** наведите указатель мыши на пункт **Все программы**, выберите пункт **Стандартные**. Щелкните правой кнопкой мыши пункт **Командная строка** и выберите команду **Запуск от имени администратора**.

2. Инициализируйте профилирование .NET и переменные среды TIP. Введите такие команды:

    ```cmd
    vsperfclrenv /traceon
    vsperfclrenv /interactionon
    ```

3. Запуск профилировщика. Введите следующую команду:

    ```cmd
    vsperfcmd /start:trace /output:Desktop_tip.vsp
    ```

4. Запустите приложение с помощью программы VSPerfCmd. Введите следующую команду:

    ```cmd
    vsperfcmd /launch:DesktopApp.exe
    ```

5. Запустите приложение для сбора данных профилирования, а затем закройте приложение обычным способом.

6. Сбросьте переменные среды TIP. Введите следующую команду:

    ```cmd
    vsperfclrenv /off
    ```

Дополнительные сведения см. в статье [Профилирование автономных приложений из командной строки](../profiling/command-line-profiling-of-stand-alone-applications.md).

## <a name="profile-services"></a>Профилирование служб

Для профилирования служб, включая приложения [!INCLUDE[vstecasp](../code-quality/includes/vstecasp_md.md)], используйте параметр **VSPerfClrEnv /GlobalInteractionOn**, чтобы задать переменные среды, и параметр **VSPerfClrEnv /GlobalInteractionOff** для их удаления.

При профилировании служб, включая веб-приложения [!INCLUDE[vstecasp](../code-quality/includes/vstecasp_md.md)], вам потребуется часто перезагружать компьютер, чтобы включить профилирование.

В следующем примере выполняется профилирование службы Windows с помощью метода инструментирования и сбор данных об уровневом взаимодействии.

### <a name="profile-a-windows-service-example"></a>Пример профилирования службы Windows

1. При необходимости установите службу.

2. Откройте окно командной строки как администратор. В меню **Пуск** наведите указатель мыши на пункт **Все программы**, выберите пункт **Стандартные**. Щелкните правой кнопкой мыши пункт **Командная строка** и выберите команду **Запуск от имени администратора**.

3. Инициализируйте переменные среды профилирования .NET. Введите следующую команду:

    ```cmd
    vsperfclrenv /globaltraceon
    ```

4. Инициализируйте переменные среды TIP. Введите следующую команду:

    ```cmd
    vsperfclrenv /globalinteractionon
    ```

5. Перезагрузите компьютер, чтобы зарегистрировать переменные среды.

6. Откройте окно командной строки как администратор.

7. Запуск профилировщика. Введите следующую команду:

    ```cmd
    vsperfcmd /start:trace /output:MiddleTier_tip.vsp /user:SYSTEM /crosssession
    ```

8. При необходимости запустите службу.

9. Подключите профилировщик к службе. Введите следующую команду:

    ```cmd
    vsperfcmd /attach:MiddleTier.exe /output:MyService_tip.vsp /user:SYSTEM /crosssession
    ```

10. Запустите службу и сбор данных профилирования.

11. Остановите профилировщик. Введите следующую команду:

     `vsperfcmd /detach`

12. Сбросьте переменные среды профилирования .NET и TIP. Введите следующую команду:

    ```cmd
    vsperfclrenv /globaloff
    ```

13. Перезагрузите компьютер, чтобы зарегистрировать сброшенные переменные среды.

Дополнительные сведения см. в одном из следующих разделов:

[Профилирование веб-приложений ASP.NET](../profiling/command-line-profiling-of-aspnet-web-applications.md)

[Профилирование служб](../profiling/command-line-profiling-of-services.md)

## <a name="add-tier-interaction-data-with-vsperfaspnetcmd"></a>Добавление данных об уровневом взаимодействии с помощью VSPerfASPNETCmd

Программа командной строки VSPerfASPNETCmd позволяет без труда профилировать веб-приложения [!INCLUDE[vstecasp](../code-quality/includes/vstecasp_md.md)]. У этой программы меньше параметров по сравнению с программой командной строки **VSPerfCmd**, в ней не нужно задавать переменные среды и не требуется перезагрузка компьютера. Эти возможности VSPerfASPNETCmd делают сбор данных об уровневом взаимодействии чрезвычайно простым.

Чтобы добавить сведения об уровневом взаимодействии в данные профилирования, собранные с помощью VSPerfASPNETCmd, добавьте в командную строку параметр **/TIP**. Например, используйте следующую командную строку для сбора данных об уровневом взаимодействии для веб-приложения [!INCLUDE[vstecasp](../code-quality/includes/vstecasp_md.md)] с помощью метода инструментирования:

```cmd
vsperfaspnetcmd /tip /trace http://localhost/MyWebApp
```

Дополнительные сведения о команде VSPerfASPNETCmd см. в статье [Быстрое профилирование веб-сайтов с помощью средства VSPerfASPNETCmd](../profiling/rapid-web-site-profiling-with-vsperfaspnetcmd.md).
