---
title: Анализ использования памяти для объектов .NET | Документация Майкрософт
ms.date: 12/9/2019
ms.topic: conceptual
helpviewer_keywords:
- memory allocation, memory usage
author: Sagar-S-S
ms.author: sashe
manager: AndSter
ms.workload:
- multiple
ms.openlocfilehash: 9518ffd618a6d82505feca33b37b5151a3a9f961
ms.sourcegitcommit: aa302af53de342e75793bd05b10325939dc69b53
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/11/2020
ms.locfileid: "75886764"
---
# <a name="analyze-memory-usage-using-the-net-object-allocation-tool"></a>Анализ использования памяти с помощью средства выделения объектов .NET

С помощью средства выделения объектов .NET можно узнать, сколько памяти использует приложение и для каких путей к коду выделяется наибольший объем памяти.

После запуска средства можно увидеть пути выполнения функций, для которых выделяются объекты, чтобы проследить путь к корню дерева вызовов, который использует больше всего памяти.

## <a name="setup"></a>Установка

1. Откройте Профилировщик производительности (**ALT+F2**) в Visual Studio.
2.  Установите флажок **Отслеживание выделения объектов .NET**.

![Центр диагностики](../profiling/media/diaghub.png "Центр диагностики")

> [!NOTE]
> По умолчанию в качестве **целевого объекта анализа** выбран запускаемый проект, но его можно изменить на выполняющийся процесс, исполняемые файлы, выполняющиеся приложения и установленные приложения. Для этого откройте меню **Изменить целевой объект** и выберите один из доступных вариантов.

   В раскрывающемся меню средства выделения объектов .NET в настоящее время нельзя выбрать исполняемые файлы. Для этого придется воспользоваться системой проектов исполняемых файлов. Закройте текущее решение (**Файл** -> **Закрыть решение**), а затем выберите пункт **Файл** -> **Открыть проект или решение** и выберите файл EXE.

![Целевой объект анализа](../profiling/media/analysistarget.png "Целевой объект анализа")

3. Нажмите кнопку **Запуск**, чтобы запустить средство.

![Остановить сбор](../profiling/media/stopcollection.png "Остановить сбор")

4. После запуска средства выполните нужные действия в приложении, а затем нажмите кнопку **Остановить сбор** или закройте приложение, чтобы просмотреть данные.
5. Перейдите на вкладку **Выделение**, содержимое которой должно выглядеть примерно так, как показано ниже.

![Allocation](../profiling/media/allocation.png "Выделение")

Поздравляем! Теперь вы можете проанализировать выделение памяти объектам.

## <a name="understand-your-data"></a>Анализ данных

### <a name="collection"></a>Collection

![Коллекция](../profiling/media/collection.png "Collection")

В представлении сбора можно увидеть, сколько объектов было собрано во время сборки мусора и сколько осталось. В нем также имеется несколько круговых диаграмм для визуализации собранных и сохранившихся объектов по типу.

- В столбце **Собрано** показано количество объектов, собранных сборщиком мусора.
- В столбце **Осталось** показано количество объектов, сохранившихся после работы сборщика мусора.

### <a name="allocation"></a>Выделение

![Развернутое представление "Выделение"](../profiling/media/allocationexpanded.png "Развернутое представление "Выделение"")

В представлении выделения можно увидеть местонахождение объектов, которым выделена память, и объем выделенной им памяти.

- Столбец **Имя** содержит список различных классов и структур, занимающих память. Каждый элемент в нем представляет собой узел, который можно развернуть, если в этой категории есть элементы, занимающие память. (Только представление **Выделение**.)
- В столбце **Всего (выделения)** показано количество занимающих память объектов, относящихся к определенному типу выделения. (Представления **Выделение**, **Дерево вызовов** и **Функции**.)
- В столбце **Самостоятельно (выделения)** показано количество занимающих память объектов, относящихся к отдельному элементу. (Представления **Выделение**, **Дерево вызовов** и **Функции**.)
- Все эти три столбца можно сортировать. Элементы в столбце **Имя** сортируются по алфавиту (в прямом или обратном порядке). Столбы **Всего** и **Самостоятельно (выделения)** можно сортировать как числовые (в порядке возрастания или убывания).
- Столбцы **Общий размер (байт)** и **Собственный размер (байт)** по умолчанию не включены. Чтобы добавить их, щелкните правой кнопкой мыши столбец **Имя**, **Всего** или **Самостоятельно (выделения)** , а затем установите флажки **Общий размер** и **Собственный размер**. Эти два столбца похожи на **Всего (выделения)** и **Самостоятельно (выделения)** за тем исключением, что вместо количества объектов, занимающих память, в них показан общий объем занимаемой ими памяти в байтах. (Только представление "Выделение".)

### <a name="call-tree"></a>Дерево вызовов

![Дерево вызовов](../profiling/media/calltree.png "Дерево вызовов")

В представлении **Дерево вызовов** отображаются пути выполнения функций, содержащие объекты, для которых выделяется много памяти.

- В столбце **Имя функции** показан процесс или имя функции, содержащей объекты, для которых выделяется память, в соответствии с уровнем проверяемого узла.
- В столбцах **Всего** и **Самостоятельно (выделения)** приводятся те же сведения, что и в представлении **Выделение**.
- В столбце **Имя модуля** показан модуль, содержащий вызывающую функцию или процесс.

![Критический путь](../profiling/media/hotpath.png "Горячий путь")

- При нажатии кнопки **Развернуть критический путь** выделяется путь выполнения функции, содержащий много объектов, для которых выделяется память. Алгоритм выделяет путь с наибольшим количеством выделений, начиная с выбранного пользователем узла, помогая изучать использование памяти.
- Кнопка **Показать критический путь** включает или отключает значки, указывающие, какие узлы входят в **критический путь**.

### <a name="functions"></a>Функции

![Функции](../profiling/media/functions.png "Функции")

В представлении **Функции** показаны процессы, модули и функции, для которых выделяется память.

- В столбце **Имя** отображаются процессы в качестве узлов верхнего уровня. Под процессами располагаются модули, а под ними — функции.
- В столбцах **Всего** и **Самостоятельно (выделения)** приводятся те же сведения, что и в представлении **Выделение**.

В каждом из представлений **Выделения**, **Дерево вызовов** и **Функции** есть параметры **Показать только мой код**, **Показать машинный код** и **Поиск**:

![Панель фильтров](../profiling/media/filterbar.png "Панель фильтров")

- Параметр **Показать только мой код** сворачивает системный код, код платформ и другой код, не написанный пользователем, во фреймы **[Внешний код]** , чтобы можно было сосредоточиться на пользовательском коде. Дополнительные сведения см. в статье [Отладка пользовательского кода с использованием параметра "Только мой код"](../debugger/just-my-code.md).
- Параметр **Показать машинный код** отображает машинный код целевого объекта анализа, включая код, не являющийся пользовательским, если выбран соответствующий параметр.
- **Поле фильтра** позволяет отфильтровать столбец **Имя** или **Имя функции** по указанному параметру. Просто введите текст в поле, и в таблице останутся только те типы, которые содержат указанную строку.
