---
title: Измерение производительности из командной строки
description: Измеряйте производительность ЦП и использование управляемой памяти в приложении из командной строки.
ms.custom: ''
ms.date: 02/21/2020
ms.topic: conceptual
helpviewer_keywords:
- Profiling Tools, command-line
- Diagnostics Tools, command-line
- CPU Usage, command-line
author: mikejo5000
ms.author: mikejo
manager: jillfra
monikerRange: '>= vs-2019'
ms.workload:
- multiple
ms.openlocfilehash: c109e2ae1db28f8e08ed7c34a7ee0871a6efe670
ms.sourcegitcommit: bf2e9d4ff38bf5b62b8af3da1e6a183beb899809
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 02/22/2020
ms.locfileid: "77558121"
---
# <a name="measure-application-performance-from-the-command-line"></a>Измерение производительности приложения из командной строки

Сведения о производительности приложения можно собирать с помощью программы командной строки.

В примере, описанном в этой статье, вы можете собирать данные производительности для Блокнота (Майкрософт), но тот же метод можно использовать для профилирования любого процесса.

## <a name="prerequisites"></a>Предварительные требования

* Visual Studio 2019, предварительная версия 3, или более поздней версии

* Знание программы командной строки

## <a name="collect-performance-data"></a>Сбор данных производительности

Профилирование с помощью средств CLI диагностики Visual Studio осуществляется путем присоединения к процессу средства профилирования, а также одного из агентов-сборщиков. При подключении средства профилирования вы начинаете сеанс диагностики, который фиксирует и сохраняет данные профилирования, пока средство не будет остановлено, после чего эти данные экспортируются в файл *.diagsession*. Затем этот файл можно открыть в Visual Studio, чтобы проанализировать результаты.

1. Запустите Блокнот и откройте диспетчер задач, чтобы получить его идентификатор процесса (PID). В диспетчере задач найдите PID на вкладке **Сведения**.

1. Откройте командную строку и перейдите в каталог с исполняемыми агентами сборки.

   ```<Visual Studio installation folder>\2019\Preview\Team Tools\DiagnosticsHub\Collector\```

1. Запустите *VSDiagnostics.exe*, введя следующую команду.

   ```cmd
   VSDiagnostics.exe start <id> /attach:<pid> /loadConfig:<configFile>
   ```

   Необходимо включить следующие аргументы:

   * \<*id*> Указывает сеанс сбора. Идентификатор должен быть числом от 1 до 255.
   * \<*pid*> Идентификатор процесса, для которого вы будете выполнять профилирование. В этом случае — идентификатор процесса, найденный на шаге 1
   * \<*configFile*> Файл конфигурации для агента сборки, который вы хотите запустить. Дополнительные сведения см. в разделе [Файлы конфигурации для агентов](#config_file).

1. Измените размер Блокнот или введите в него текст, чтобы собрать интересные данные профилирования.

1. Остановите сеанс сбора и отправьте выходные данные в файл, введя следующую команду.

   ```cmd
   VSDiagnostics.exe stop <id> /output:<path to file>
   ```

1. Перейдите в выходной файл из предыдущей команды и откройте его в Visual Studio, чтобы изучить собранные сведения.

## <a name="config_file"></a> Файлы конфигурации агента

Агенты сборки являются взаимозаменяемыми компонентами, которые собирают различные типы данных в зависимости от того, что вы пытаетесь измерить.

Для удобства можно хранить эту информацию в файле конфигурации агента. Файл конфигурации — это файл *.json*, содержащий как минимум имя *.dll* и его CLSID COM. Вот пример файлов конфигурации, которые находятся в следующей папке:

```<Visual Studio installation folder>\2019\Preview\Team Tools\DiagnosticsHub\Collector\AgentConfigs\```

* Конфигурации CpuUsage (базовая/низкая/высокая), которые соответствуют данным, собранным для средства профилирования [загрузки ЦП](../profiling/cpu-usage.md).
* Конфигурации DotNetObjectAlloc (базовая/низкая), которые соответствуют данным, собранным для [средства распределения объектов .NET](../profiling/dotnet-alloc-tool.md).

Базовая/низкая/высокая конфигурации означают частоту выборки. Например, "Низкая" означает 100 выборок в секунду, а "Высокая" — 4000 выборок в секунду.

Чтобы средство *VSDiagnostics.exe* работало с агентом сборки, ему требуется DLL и CLSID COM для соответствующего агента, и у агента могут быть дополнительные параметры конфигурации. Если вы используете агент без файла конфигурации, используйте формат в следующей команде.

```cmd
VSDiagnostics.exe start <id> /attach:<pid> /loadAgent:<agentCLSID>;<agentName>[;<config>]
```

## <a name="permissions"></a>Разрешения

Чтобы выполнить профилирование приложения, которое требует повышенного уровня разрешений, используйте командную строку с повышенными привилегиями.
