---
title: Измерение производительности с помощью средств профилирования
description: Краткий обзор различных средств диагностики, доступных в Visual Studio.
ms.custom: mvc
ms.date: 05/18/2018
ms.topic: quickstart
helpviewer_keywords:
- diagnostic tools
ms.assetid: d2ee0301-ea78-43d8-851a-71b7b2043d73
author: mikejo5000
ms.author: mikejo
manager: jillfra
ms.workload:
- multiple
ms.openlocfilehash: 5dff10c90a51dffece1e93e575ab7ae3cbf75367
ms.sourcegitcommit: 08fc78516f1107b83f46e2401888df4868bb1e40
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 05/15/2019
ms.locfileid: "65704508"
---
# <a name="quickstart-first-look-at-profiling-tools"></a>Краткое руководство. Первое знакомство со средствами профилирования

Visual Studio предоставляет широкий набор средств профилирования для выявления различных типов проблем с производительностью в зависимости от типа приложения.

Средства профилирования, которыми можно воспользоваться во время сеанса отладки, доступны в окне "Средства диагностики". Окно "Средства диагностики" появится автоматически, если вы не отключали эту функцию. Чтобы открыть окно, щелкните **Отладка | Окна | Показать средства диагностики**. В открытом окне можно выбирать средства, для которых требуется собрать данные.

![Окно "Средства диагностики"](../profiling/media/prof-tour-diagnostic-tools.png "Средства диагностики")

При отладке можно использовать окно **Средства диагностики** для анализа использования ЦП и памяти, а также просматривать события, отображающие сведения, связанные с производительностью.

![Сводка в окне "Средства диагностики"](../profiling/media/prof-tour-cpu-and-memory-graph.gif "Сводка в окне \"Средства диагностики\"")

Использование окна **Средства диагностики** часто является предпочтительным способом профилирования приложений, но для сборок выпуска вместо этого также можно выполнять последующий анализ приложения. Дополнительные сведения о различных подходах см. в разделе [Выполнение средств профилирования с отладчиком и без него](../profiling/running-profiling-tools-with-or-without-the-debugger.md). См. дополнительные сведения о [рекомендуемом средстве профилирования](#which-tool-should-i-use) с поддержкой разных типов приложений.

> [!NOTE]
> Вы можете использовать средства последующего анализа с Windows 7 и более поздними версиями. Для запуска средств профилирования с отладчиком (окно **Средства диагностики**) требуется Windows 8 и более поздние версии.

## <a name="analyze-cpu-usage"></a>Анализ использования ЦП

Средство загрузки ЦП является хорошей отправной точкой для анализа производительности приложения. С его помощью вы получите дополнительные сведения о ресурсах ЦП, используемых приложением. Более подробное пошаговое руководство по работе со средством загрузки ЦП см. в разделе [Руководство по профилированию производительности для начинающих](../profiling/beginners-guide-to-performance-profiling.md).

В представлении **Сводка** окна средств диагностики выберите **Включить профилирование ЦП** (необходимо быть в сеансе отладки).

![Включение отображения данных о загрузке ЦП в окне "Средства диагностики"](../profiling/media/prof-tour-enable-cpu-profiling.png "Данные о загрузке ЦП в окне \"Средства диагностики\"")

Для наиболее эффективного использования средства установите в коде две точки останова: одну в начале и одну в конце функции и области кода, которую требуется проанализировать. Проверьте данные профилирования во время приостановки во второй точке останова.

В представлении **Загрузка ЦП** отображается список функций, упорядоченных по самой продолжительно выполняющейся (эта функция расположена в верхней части). Это поможет переходить к функциям, где наблюдаются проблемы с производительностью.

![Представление данных о загрузке ЦП в окне "Средства диагностики"](../profiling/media/prof-tour-cpu-usage.png "Данные о загрузке ЦП в окне \"Средства диагностики\"")

Дважды щелкните нужную функцию, после чего откроется подробное представление с тремя панелями (представление "бабочки"): выбранная функция будет находиться в центре окна, вызываемая функция — в левой части, а вызывающая функция — в правой. В разделе **Тело функции** также показан общий объем времени (и доля времени), затраченного в теле функции за исключением времени, затраченного в вызываемых и вызывающих функциях. Эти данные помогут оценить, оказывает ли негативное влияние на производительность сама функция.

![Представление "бабочки" с вызывающей и вызываемой функциями в окне "Средства диагностики"](../profiling/media/prof-tour-cpu-usage-caller-callee.png "Представление вызывающей и вызываемой функциями в окне \"Средства диагностики\"")

## <a name="analyze-memory-usage"></a>Анализ данных об использовании памяти

В окне **средств диагностики** также можно оценить использование памяти в приложении. Например, можно узнать число и размер объектов в куче. Подробные инструкции по анализу памяти см. в статье об [анализе использования памяти](../profiling/memory-usage.md).

Для анализа использования памяти необходимо сделать хотя бы один снимок памяти во время отладки. Часто наилучшим способом анализа памяти является создание двух снимков: первый создается непосредственно перед возникновением потенциальной проблемы с памятью, а второй — сразу же после возникновения этой проблемы. Затем можно просмотреть различия двух моментальных снимков и точно определить, что изменилось.

![Создание снимка в окне "Средства диагностики"](../profiling/media/prof-tour-take-snapshots.gif "Создание снимка в окне \"Средства диагностики\"")

При щелчке одной из ссылок со стрелкой откроется разностное представление кучи (красная стрелка вверх ![Увеличение использования памяти](../profiling/media/prof-tour-mem-usage-up-arrow.png "Увеличение использования памяти") показывает растущее количество объектов (слева) или увеличивающийся размер памяти (справа)). Если щелкнуть ссылку справа, откроется разностное представление кучи, упорядоченное по объектам, которые привели к максимальному увеличению размера кучи. Это может помочь выявить проблемы с памятью. Например, на следующем рисунке байты, используемые объектами `ClassHandlersStore`, увеличены на 3 492 байт на втором моментальном снимке.

![Разностное представление кучи в окне "Средства диагностики"](../profiling/media/prof-tour-mem-usage-diff-heap.png "Разностное представление кучи в окне \"Средства диагностики\"")

Если в представлении **Использование памяти** щелкнуть ссылку слева, представление кучи будет упорядочено по количеству объектов. Объекты определенного типа, количество которых максимально выросло, отображаются в верхней части (отсортированы по столбцу **Count Diff** (Разница числа)).

## <a name="examine-performance-events"></a>Изучение событий производительности

В представлении **События** в окне средств диагностики отображаются различные события, которые возникают при отладке, например операция задания точки останова или пошагового выполнения кода. Можно проверить такие сведения, как длительность события (измеряется с момента последней приостановки отладчика или с момента запуска приложения). Например, при пошаговом выполнении кода (F10, F11) в представлении **События** отображается длительность выполнения приложения с операции на предыдущем шаге до текущего шага.

![Представление событий в окне "Средства диагностики"](../profiling/media/prof-tour-events.png "Представление событий в окне \"Средства диагностики\"")

 > [!NOTE]
 > Если у вас установлен выпуск Visual Studio Enterprise, на этой вкладке вы можете увидеть [события IntelliTrace](../debugger/intellitrace.md).

Эти же события также отображаются в редакторе кода в виде советов для повышения производительности.

![Обзор профилирования — советы по повышению производительности](../profiling/media/prof-tour-perf-tips.png "Обзор профилирования — советы по повышению производительности")

## <a name="examine-ui-performance-and-accessibility-events-uwp"></a>Проверка событий производительности и доступности пользовательского интерфейса (UWP)

В приложениях UWP в окне **Средства диагностики** можно включить параметр **Анализ пользовательского интерфейса**. Средство выполняет поиск общих проблем производительности или доступности и во время отладки отображает их в представлении **События**. В описаниях событий содержатся сведения, которые могут помочь при устранении неполадок.

![Просмотр событий анализа пользовательского интерфейса в средствах диагностики](../profiling/media/prof-tour-ui-analysis.png "Представление \"События анализа пользовательского интерфейса\" в окне \"Средства диагностики\"")

## <a name="post_mortem"></a> Профилирование сборок выпусков без отладчика

Средства профилирования, такие как "Загрузка ЦП " и "Использование памяти", можно использовать с отладчиком (см. предыдущие разделы) либо их можно впоследствии запустить с помощью профилировщика производительности, который предназначен для анализа сборок **Выпуск**. В профилировщике производительности можно собрать диагностические сведения во время работы приложения, а затем проанализировать их после его остановки. Дополнительные сведения о различных подходах см. в статье [Выполнение средств профилирования с отладчиком и без него](../profiling/running-profiling-tools-with-or-without-the-debugger.md).

![Профилировщик производительности](../profiling/media/prof-tour-performance-profiler.png "Профилировщик производительности")

Откройте профилировщик производительности, последовательно выбрав **Отладка** > **Профилировщик производительности**.

В окне можно выбрать несколько средств профилирования, доступных в разных сценариях. Средства, такие как "Загрузка ЦП", могут предоставлять дополнительные данные, полезные для проведения анализа.

## <a name="analyze-resource-consumption-xaml"></a>Анализ использования ресурсов (XAML)

В приложениях XAML, таких как классические приложения WPF и приложения универсальной платформы Windows, можно анализировать потребление ресурсов, используя средство "Временная шкала приложения". Например, вы можете проанализировать время, затраченное приложением на подготовку кадров пользовательского интерфейса (макет и обработка), обработку запросов от сети и дисков, а также на такие сценарии, как запуск приложения, загрузка страницы и изменение размера окон. Чтобы использовать это средство, выберите **Временная шкала приложения** в профилировщике производительности и нажмите кнопку **Запустить**. В приложении выполните сценарий с предполагаемой проблемой потребления ресурсов, а затем щелкните **Остановка сбора**, чтобы создать отчет.

Низкие значения частоты кадров на графе **Пропускная способность визуализации** может означать наличие проблем визуализации, присутствующих при запуске приложения. Аналогично, высокие показатели на графе **Использование потока пользовательского интерфейса** могут соответствовать проблемам со скоростью отклика пользовательского интерфейса. В отчете можно выбрать временной период предполагаемой проблемы производительности и затем в представлении "Подробная временная шкала" (нижняя панель) изучить подробные действия потока пользовательского интерфейса.

![Средство профилирования — временная шкала приложения](../profiling/media/prof-tour-application-timeline.gif "Обзор профилирования — временная шкала приложения")

В представлении "Подробная временная шкала" находятся такие сведения, как тип действия (или затронутый элемент пользовательского интерфейса), а также длительность действия. Например, на рисунке событие **Макета** для элемента управления сетки длится 57,53 мс.

Дополнительные сведения см. в разделе [Временная шкала приложения](../profiling/application-timeline.md).

## <a name="analyze-gpu-usage-direct3d"></a>Анализ использования GPU (Direct3D)

В приложениях Direct3D (компоненты Direct3D должны быть в C++) можно изучить действие GPU и проанализировать проблемы производительности. Дополнительные сведения см. в разделе [Использование GPU](../debugger/gpu-usage.md). Чтобы использовать это средство, выберите **Использование GPU** в профилировщике производительности и нажмите кнопку **Запустить**. В приложении выполните нужные действия профилирования, а затем щелкните **Остановка сбора**, чтобы создать отчет.

Выберите период времени на графах и щелкните **Просмотреть сведения**. В нижней панели появится представление подробных сведений. В этом представлении можно узнать, сколько событий происходит в каждом ЦП и графическом процессоре. Выбирайте события в самой нижней панели, чтобы открывать всплывающие окна на временной шкале. Например, выберите событие **Присутствующие**, чтобы просмотреть всплывающие окна по вызову **Присутствующий**. (Светло-серые вертикальные линии Vsync можно использовать в качестве справочных сведений, позволяющих понять, попустили ли вертикальную синхронизацию определенные вызовы с типом **Присутствующий**. Чтобы приложение постоянно поддерживало 60 кадров/с, между каждыми двумя вертикальными синхронизациями должен быть один вызов с типом **Присутствующий**.

![Средство профилирования — использование GPU](../profiling/media/prof-tour-gpu-usage.png "Диалоговое окно \"Использование GPU\"")

Графы также можно использовать для определения узких мест производительности ЦП или GPU.

::: moniker range="vs-2017"
## <a name="analyze-performance-javascript-uwp"></a>Анализ производительности (JavaScript UWP)

Для приложений UWP можно использовать средство "Память JavaScript" и средство "Скорость реагирования пользовательского интерфейса HTML".

Средство "Память JavaScript" аналогично средству "Использование памяти", доступному для других типов приложений. Это средство можно использовать для анализа использования памяти и поиска утечек памяти в приложении. Дополнительные сведения об этом средстве см. в разделе [Память JavaScript](../profiling/javascript-memory.md).

![Средство профилирования — память JavaScript](../profiling/media/diagjsmemory.png "Диалоговое окно \"Память JavaScript\"")

Для диагностики скорости отклика пользовательского интерфейса, медленной загрузки и медленных визуальных обновлений в приложениях UWP используйте средство "Скорость реагирования пользовательского интерфейса HTML". Это средство аналогично инструменту "Временная шкала приложения" для других типов приложений. Дополнительные сведения см. в разделе [Скорость реагирования пользовательского интерфейса HTML](../profiling/html-ui-responsiveness.md).

![Средство профилирования — скорость реагирования пользовательского интерфейса HTML](../profiling/media/diaghtmlresp.png "Диалоговое окно \"Скорость реагирования пользовательского интерфейса HTML\"")
::: moniker-end

## <a name="analyze-network-usage-uwp"></a>Анализ использования сети (UWP)

В приложениях UWP можно анализировать выполняемые сетевые операции с помощью API `Windows.Web.Http`. Это средство может помочь устранить такие проблемы, как ошибки доступа и проверки подлинности, неправильное использование кэша и никакая производительность отображения и скорости загрузки. Чтобы использовать это средство, выберите **Сеть** в профилировщике производительности и нажмите кнопку **Запустить**. В приложении выполните нужные действия, где используется `Windows.Web.Http`, а затем щелкните **Остановка сбора**, чтобы создать отчет.

![Средство профилирования — использование сети](../profiling/media/prof-tour-network-usage.png "Диалоговое окно \"Использование сети\"")

Выберите операцию в представлении "Сводка", чтобы просмотреть более подробные сведения.

![Подробные сведения в средстве профилирования сети](../profiling/media/prof-tour-network-usage-details.png "Окно с подробными сведениями об использовании сети")

Дополнительные сведения см. в разделе [Использование сети](../profiling/network-usage.md).

## <a name="analyze-performance-legacy-tools"></a>Анализ производительности (устаревшие инструменты)

Если требуются функции, которые в настоящее время отсутствуют в средствах "Загрузка ЦП" или "Использование памяти", и вы работаете с классическими приложениями или приложениями ASP.NET, воспользуйтесь обозревателем производительности, поддерживающем профилирование. (Не поддерживается в приложениях UWP). Дополнительные сведения см. в разделе [Обозреватель производительности](../profiling/performance-explorer.md).

![Средство "Обозреватель производительности"](../profiling/media/prof-tour-performance-explorer.png "Обозреватель производительности")

## <a name="which-tool-should-i-use"></a>Какие средства следует использовать?

Ниже приведена таблица со списком различных средств, предлагаемых в Visual Studio, и различных типов проектов, в которых эти средства можно использовать.

|Средство производительности|Классические приложения Windows|UWP|ASP.NET/ASP.NET Core|
|----------------------|---------------------|-------------|-------------|
|[Использование ЦП](../profiling/cpu-usage.md)|да|да|да|
|[Использование памяти](../profiling/memory-usage.md)|да|да|да|
|[Использование GPU](../debugger/gpu-usage.md)|да|да|нет|
|[Временная шкала приложения](../profiling/application-timeline.md)|да|да|Нет|
|[PerfTips](../profiling/perftips.md)|да|да для XAML, нет для HTML|да|
|[Обозреватель производительности](../profiling/performance-explorer.md)|да|Нет|да|
|[IntelliTrace](../debugger/intellitrace.md)|Только .NET с Visual Studio Enterprise|Только .NET с Visual Studio Enterprise|Только .NET с Visual Studio Enterprise|
|[Использование сети](../profiling/network-usage.md)|Нет|да|Нет|
|[HTML UI responsiveness](../profiling/html-ui-responsiveness.md)|Нет|да для HTML, нет для XAML|Нет|
|[Память JavaScript](../profiling/javascript-memory.md)|Нет|да для HTML, нет для XAML|Нет|

## <a name="see-also"></a>См. также
- [Отладка в Visual Studio](/visualstudio/debugger/debugger-feature-tour)
