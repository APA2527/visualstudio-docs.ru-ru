---
title: Пошаговое руководство. Создание и отладка решения рабочих процессов SharePoint | Документация Майкрософт
ms.date: 02/02/2017
ms.topic: conceptual
f1_keywords:
- VS.SharePointTools.Workflow.WorkflowConditions
- VS.SharePointTools.Workflow.WorkflowList
dev_langs:
- VB
- CSharp
helpviewer_keywords:
- SharePoint development in Visual Studio, workflows
- workflows [SharePoint development in Visual Studio]
author: John-Hart
ms.author: johnhart
manager: jillfra
ms.workload:
- office
ms.openlocfilehash: ad39c8b8bad373cd7892a1eeda89b149622913a7
ms.sourcegitcommit: 47eeeeadd84c879636e9d48747b615de69384356
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/23/2019
ms.locfileid: "63430365"
---
# <a name="walkthrough-create-and-debug-a-sharepoint-workflow-solution"></a>Пошаговое руководство. Создание и отладка решения рабочих процессов SharePoint
  В этом пошаговом руководстве показано, как создать шаблон базовый последовательный рабочий процесс. Рабочий процесс выполняет проверку свойства библиотеку общих документов, чтобы определить, выполнялось ли рецензирование документа. Если в документе были проверены, рабочий процесс завершается.

 В данном пошаговом руководстве рассмотрены следующие задачи:

- Создание проекта последовательного рабочего процесса определения списка SharePoint в [!INCLUDE[vsprvs](../sharepoint/includes/vsprvs-md.md)].

- Создание действия рабочего процесса.

- Обработка событий действий рабочего процесса.

> [!NOTE]
> Несмотря на то, что в этом пошаговом руководстве используется проект последовательного рабочего процесса, процесс идентичен для проекта рабочего процесса состояние компьютера.
>
> Кроме того, на компьютере могут отображаться различные имена или расположения некоторых пользователя Visual Studio элементы интерфейса в следующих инструкциях. Это зависит от имеющегося выпуска Visual Studio и используемых параметров. Дополнительные сведения см. в разделе [Персонализация интегрированной среды разработки Visual Studio](../ide/personalizing-the-visual-studio-ide.md).

## <a name="prerequisites"></a>Предварительные требования
 Ниже приведены компоненты, необходимые для выполнения данного пошагового руководства.

- Поддерживаемые редакции Microsoft Windows и SharePoint.

- Visual Studio.

## <a name="add-properties-to-the-sharepoint-shared-documents-library"></a>Добавлять свойства к библиотеке общих документов SharePoint
 Чтобы отслеживать состояние просмотра документов в **общих документов** библиотеки, мы создадим три новых свойства для общих документов на сайте SharePoint: `Status`, `Assignee`, и `Review Comments`. Мы определяем эти свойства в **Общие документы** библиотеки.

#### <a name="to-add-properties-to-the-sharepoint-shared-documents-library"></a>Для добавления свойств в SharePoint Общие документы библиотеки

1. Откройте сайт SharePoint, например http://\<системное имя > / SitePages/Home.aspx в веб-браузере.

2. На панели быстрого запуска выберите **SharedDocuments**.

3. Выберите **библиотеки** на **средства библиотеки** ленты, а затем выберите **создать столбец** кнопку на ленте, чтобы создать новый столбец.

4. Присвойте столбцу имя **статус документа**, установите для него **Выбор (меню)**, укажите один из следующих трех вариантов, а затем выберите **ОК** кнопки:

    - **Необходимо выполнить проверку**

    - **Завершена проверка**

    - **Запрос на изменение**

5. Создайте еще два столбца и назовите их **Assignee** и **комментарии**. Задайте тип столбца уполномоченное лицо как одна строка текста и типа столбца комментарии несколько строк текста.

## <a name="enable-documents-to-be-edited-without-requiring-a-check-out"></a>Включение редактирования без необходимости извлечения документов
 Это проще тестировать шаблон процесса, при редактировании документов без необходимости их извлечения. В следующей процедуре вы настроите для сайта SharePoint.

#### <a name="to-enable-documents-to-be-edited-without-checking-them-out"></a>Чтобы включить редактирования без их извлечения документов

1. На панели быстрого запуска выберите **Общие документы** ссылку.

2. На **средства библиотеки** ленте, выберите **библиотеки** вкладке, а затем выберите **параметры библиотеки** кнопку, чтобы отобразить **параметры библиотеки документов** страницы.

3. В **Общие параметры** выберите **параметры управления версиями** ссылку, чтобы отобразить **параметры управления версиями** страницы.

4. Убедитесь, что для параметра **требовать документов быть извлечен перед редактированием** — **нет**. Если это не так, измените его на **нет** и выберите **ОК** кнопки.

5. Закройте браузер.

## <a name="create-a-sharepoint-sequential-workflow-project"></a>Создание проекта последовательного рабочего процесса SharePoint
 Последовательный рабочий процесс — это набор действий, выполняемых в порядке до завершения последнего действия. В этой процедуре мы создадим последовательного рабочего процесса, которое будет применяться к наш список общих документов. Мастер рабочего процесса позволяет связать рабочий процесс с помощью определения сайта или определения списка и позволяет определить начала рабочего процесса.

#### <a name="to-create-a-sharepoint-sequential-workflow-project"></a>Создание проекта последовательного рабочего процесса SharePoint

1. Запустите [!INCLUDE[vsprvs](../sharepoint/includes/vsprvs-md.md)].

2. В строке меню выберите **файл** > **New** > **проекта** для отображения **новый проект** диалоговое окно.

3. Разверните **SharePoint** расположенный в области **Visual C#** или **Visual Basic**, а затем выберите **2010** узла.

4. В **шаблоны** панели выберите **проект SharePoint 2010** шаблона.

5. В **имя** введите **MySharePointWorkflow** и выберите **ОК** кнопки.

     **Мастер настройки SharePoint** отображается.

6. В **Укажите сайт и уровень безопасности для отладки** выберите **развернуть как решение фермы** переключатель, а затем выберите **Готово** кнопку, чтобы принять доверие уровень и сайт по умолчанию.

     Этот шаг задается уровень доверия для решения фермы, единственным доступным параметром для проектов рабочих процессов. Дополнительные сведения см. в разделе [замечания об изолированных решениях](../sharepoint/sandboxed-solution-considerations.md).

7. В **обозревателе решений**, выберите узел проекта и затем в строке меню выберите **проекта** > **Добавление нового элемента**.

8. В группе **Visual C#** или **Visual Basic**, разверните **SharePoint** узел, а затем выберите **2010** узла.

9. В **шаблоны** панели выберите **последовательного рабочего процесса (только для решения фермы)** шаблона и нажмите кнопку **добавить** кнопки.

     **Мастер настройки SharePoint** отображается.

10. В **укажите имя рабочего процесса для отладки** странице, примите имя по умолчанию (**MySharePointWorkflow - Workflow1**). Сохранение значения типа шаблона рабочего процесса по умолчанию, **рабочий процесс списка**, а затем выберите **Далее** кнопки.

11. В **будет ли Visual Studio автоматически связывать рабочий процесс в сеансе отладки?** выберите **Далее** кнопку, чтобы принять все настройки по умолчанию.

     Этот шаг автоматически связываются с в библиотеку Shared Documents.

12. В **укажите условия запуска рабочего процесса** странице, оставьте параметры по умолчанию в **как требуется запускать рабочий процесс?** раздел и выберите **Готово** кнопки.

     Эта страница позволяет указать, при запуске рабочего процесса. По умолчанию рабочий процесс запускается либо когда пользователь вручную запускает его в SharePoint или при создании элемента, с которым связан рабочий процесс.

## <a name="create-workflow-activities"></a>Создание действия рабочего процесса
 Рабочие процессы содержат один или несколько *действия* , представляющие выполняемых действий. Использование конструктора рабочих процессов для упорядочения действий рабочего процесса. В этой процедуре мы добавим два действия в рабочий процесс: HandleExternalEventActivity и OnWorkFlowItemChanged. Эти действия проверки состояния просмотра документов в **Общие документы** списка

#### <a name="to-create-workflow-activities"></a>Для создания действий рабочего процесса

1. Рабочий процесс должен отображаться в конструкторе рабочих процессов. Если это не так, затем откройте окно **Workflow1.cs** или **Workflow1.vb** в **обозревателе решений**.

2. В конструкторе выберите **OnWorkflowActivated1** действия.

3. В **свойства** окно, введите **onWorkflowActivated** рядом с полем **Invoked** свойство, а затем нажмите клавишу ВВОД.

     Открывается редактор кода, и метод обработчика событий с именем onWorkflowActivated добавляется в файл кода Workflow1.

4. Переключитесь в конструкторе рабочих процессов, откройте область элементов и затем разверните **Windows Workflow v3.0** узла.

5. В **Windows Workflow v3.0** узел **элементов**, выполните одно из следующих действий:

    1. Откройте контекстное меню для **хотя** действия, а затем выберите **копирования**. В конструкторе рабочих процессов откройте контекстное меню для строки под **onWorkflowActivated1** действия, а затем выберите **вставить**.

    2. Перетащите **хотя** действия из **элементов** в конструктор рабочих процессов и подсоедините действие к строке под **onWorkflowActivated1** действия.

6. Выберите **WhileActivity1** действия.

7. В **свойства** окне **условие** условие кода.

8. Разверните **условие** свойство, введите **isWorkflowPending** рядом с дочерним **условие** свойства, а затем нажмите клавишу ВВОД.

     Открывается редактор кода, и метод с именем isWorkflowPending добавляется в файл кода Workflow1.

9. Переключитесь в конструкторе рабочих процессов, откройте область элементов и затем разверните **рабочего процесса SharePoint** узла.

10. В **рабочего процесса SharePoint** узел **элементов**, выполните одно из следующих действий:

    - Откройте контекстное меню для **OnWorkflowItemChanged** действия, а затем выберите **копирования**. В конструкторе рабочих процессов откройте контекстное меню для строки внутри **whileActivity1** действия, а затем выберите **вставить**.

    - Перетащите **OnWorkflowItemChanged** действия из **элементов** в конструктор рабочих процессов и подсоедините действие к строке внутри **whileActivity1** действия.

11. Выберите **onWorkflowItemChanged1** действия.

12. В **свойства** окна, задайте свойства, как показано в следующей таблице.

    |Свойство|Значение|
    |--------------|-----------|
    |**CorrelationToken**|**workflowToken**|
    |**Вызывается**|**onWorkflowItemChanged**|

## <a name="handle-activity-events"></a>Обработка событий действий
 Наконец проверьте состояние документа из каждого действия. Если в документе были проверены, рабочий процесс завершается.

#### <a name="to-handle-activity-events"></a>Обработка событий действий

1. В *Workflow1.cs* или *Workflow1.vb*, добавьте следующее поле в верхнюю часть `Workflow1` класса. Это поле используется в действии, чтобы определить, завершена ли рабочий процесс.

    ```vb
    Dim workflowPending As Boolean = True
    ```

    ```csharp
    Boolean workflowPending = true;
    ```

2. Добавьте следующий метод в класс `Workflow1` . Этот метод проверяет значение параметра `Document Status` свойство из списка документов, чтобы определить, ли рецензирование документа. Если `Document Status` свойству `Review Complete`, то `checkStatus` метода задает `workflowPending` поле **false** означает Готово к завершению рабочего процесса.

    ```vb
    Private Sub checkStatus()
        If CStr(workflowProperties.Item("Document Status")) = "Review Complete" Then
            workflowPending = False
        End If
    End Sub
    ```

    ```csharp
    private void checkStatus()
    {
        if ((string)workflowProperties.Item["Document Status"] == "Review Complete")
        workflowPending = false;
    }
    ```

3. Добавьте следующий код, чтобы `onWorkflowActivated` и `onWorkflowItemChanged` методы для вызова `checkStatus` метод. При запуске рабочего процесса, `onWorkflowActivated` вызовы методов `checkStatus` метод, чтобы определить, является ли документ уже были проверены. Если он не проверена, рабочий процесс продолжает работу. При сохранении документа, `onWorkflowItemChanged` вызовы методов `checkStatus` метод, чтобы определить, ли рецензирование документа. Хотя `workflowPending` полю присваивается **true**, рабочий процесс продолжает выполняться.

    ```vb
    Private Sub onWorkflowActivated(ByVal sender As System.Object, ByVal e As System.Workflow.Activities.ExternalDataEventArgs)
        checkStatus()
    End Sub

    Private Sub onWorkflowItemChanged(ByVal sender As System.Object, ByVal e As System.Workflow.Activities.ExternalDataEventArgs)
        checkStatus()
    End Sub
    ```

    ```csharp
    private void onWorkflowActivated(object sender, ExternalDataEventArgs e)
    {
        // Check the status.
        checkStatus();
    }

    private void onWorkflowItemChanged(object sender, ExternalDataEventArgs e)
    {
        // Check the status.
        checkStatus();
    }
    ```

4. Добавьте следующий код, чтобы `isWorkflowPending` метод для проверки состояния `workflowPending` свойство. При каждом сохранении документа **whileActivity1** действие вызывает `isWorkflowPending` метод. Этот метод проверяет <xref:System.Workflow.Activities.ConditionalEventArgs.Result%2A> свойство <xref:System.Workflow.Activities.ConditionalEventArgs> объектом, чтобы определить ли **WhileActivity1** следует продолжить или завершить действие. Если задано значение **true**, действие продолжает. В противном случае завершения действия и рабочий процесс завершается.

    ```vb
    Private Sub isWorkflowPending(ByVal sender As System.Object, ByVal e As System.Workflow.Activities.ConditionalEventArgs)
        e.Result = workflowPending
    End Sub
    ```

    ```csharp
    private void isWorkflowPending(object sender, ConditionalEventArgs e)
    {
        e.Result = workflowPending;
    }
    ```

5. Сохраните проект.

## <a name="test-the-sharepoint-workflow-template"></a>Проверка шаблона рабочего процесса SharePoint
 При запуске отладчика, [!INCLUDE[vsprvs](../sharepoint/includes/vsprvs-md.md)] развертывает шаблон рабочего процесса на сервере SharePoint и связывает рабочий процесс с **Общие документы** списка. Чтобы протестировать рабочий процесс, запустите экземпляр рабочего процесса из документа в **Общие документы** списка.

#### <a name="to-test-the-sharepoint-workflow-template"></a>Проверка шаблона рабочего процесса SharePoint

1. В *Workflow1.cs* или *Workflow1.vb*, установите точку останова рядом с полем **onWorkflowActivated** метод.

2. Выберите **F5** ключ для сборки и запуска решения.

     Откроется сайт SharePoint.

3. В области навигации в SharePoint, выберите **Общие документы** ссылку.

4. В **Общие документы** выберите **документов** ссылку на **средства библиотеки** вкладке, а затем выберите **отправить документ** кнопки .

5. В **отправить документ** диалоговое окно, выберите **Обзор** кнопку, щелкните любой файл документа, выберите пункт **откройте** кнопку, а затем выберите **ОК** кнопки.

     Это отправляет выбранный документ в **Общие документы** список и запускает рабочий процесс.

6. В [!INCLUDE[vsprvs](../sharepoint/includes/vsprvs-md.md)], убедитесь, что отладчик останавливается в точке останова рядом с полем `onWorkflowActivated` метод.

7. Выберите **F5** клавишу для продолжения выполнения.

8. Можно изменить параметры для документа, но оставьте их значения по умолчанию сейчас, выбрав **Сохранить** кнопки.

     Вы вернетесь на **Общие документы** страницы веб-сайта SharePoint по умолчанию.

9. В **Общие документы** странице, убедитесь, что значение под **MySharePointWorkflow - Workflow1** столбцу присваивается **In Progress**. Это означает, что рабочий процесс выполняется и что документа ожидает рассмотрения.

10. В **Общие документы** странице, щелкните его, нажмите кнопку со стрелкой, которая появится, а затем выберите **изменение свойств** пункта меню.

11. Задайте **статус документа** для **Review Complete**и нажмите кнопку **Сохранить** кнопки.

     Вы вернетесь на **Общие документы** страницы веб-сайта SharePoint по умолчанию.

12. В **Общие документы** странице, убедитесь, что значение под **статус документа** столбцу присваивается **Review Complete**. Обновить **Общие документы** странице и убедитесь, что значение под **MySharePointWorkflow - Workflow1** столбцу присваивается **завершено**. Это означает, что рабочий процесс завершен, и рецензирование документа.

## <a name="next-steps"></a>Следующие шаги
 Дополнительные сведения о создании шаблонов рабочих процессов в следующих разделах:

- Дополнительные сведения о действиях рабочих процессов SharePoint, см. в разделе [действия рабочих процессов для SharePoint Foundation](http://go.microsoft.com/fwlink/?LinkId=178992).

- Дополнительные сведения о действиях Windows Workflow Foundation, см. в разделе [System.Workflow.Activities-пространство имен](http://go.microsoft.com/fwlink/?LinkId=178993).

## <a name="see-also"></a>См. также
- [Создание решений рабочих процессов SharePoint](../sharepoint/creating-sharepoint-workflow-solutions.md)
- [Проектов и шаблоны элементов проектов SharePoint](../sharepoint/sharepoint-project-and-project-item-templates.md)
- [Сборка и отладка решений SharePoint](../sharepoint/building-and-debugging-sharepoint-solutions.md)
