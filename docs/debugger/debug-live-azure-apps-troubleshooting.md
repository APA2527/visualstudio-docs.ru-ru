---
title: Устранение неполадок отладки моментальных снимков | Документация Майкрософт
ms.custom: ''
ms.date: 04/24/2019
ms.topic: troubleshooting
helpviewer_keywords:
- debugger
ms.assetid: 511a0697-c68a-4988-9e29-8d0166ca044a
author: mikejo5000
ms.author: mikejo
manager: jillfra
ms.workload:
- multiple
ms.openlocfilehash: e3c66ba4a5031326ec288d3a5f2f3c4851d17ca6
ms.sourcegitcommit: 74c5360186731de07828764eb32ea1033a8c2275
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 07/03/2019
ms.locfileid: "67559766"
---
# <a name="troubleshooting-and-known-issues-for-snapshot-debugging-in-visual-studio"></a>Устранение неполадок и известные проблемы отладки моментальных снимков в Visual Studio

Если действия, описанные в этой статье не решило проблему, найдите проблемы на [сообщества разработчиков](https://developercommunity.visualstudio.com/spaces/8/index.html) или сообщить новый вопрос, выбрав **помочь** > **отправить отзыв**   >  **Сообщить о проблеме** в Visual Studio.

## <a name="issue-attach-snapshot-debugger-encounters-an-http-status-code-error"></a>Проблема. «Подключить Snapshot Debugger» возникает ошибка кода состояния HTTP

Если вы видите следующую ошибку в **вывода** окно при попытке присоединить, он может быть известная проблема, перечисленных ниже. Попробуйте предлагаемых решений и если проблема сохранится, обратитесь в предыдущем псевдоним.

`[TIMESTAMP] Error --- Unable to Start Snapshot Debugger - Attach Snapshot Debugger failed: System.Net.WebException: The remote server returned an error: (###) XXXXXX`

### <a name="401-unauthorized"></a>Не авторизовано (401)

Эта ошибка означает, что вызов REST выдан Visual Studio для Azure использует недопустимые учетные данные. Известная ошибка в модуле OAuth Azure Active Directory легко может вызывать эту ошибку.

Выполните следующие шаги.

* Убедитесь, что учетная запись персонализации Visual Studio содержит разрешения в подписку Azure и ресурсов, присоединении к. Быстро чтобы определить это, чтобы проверить, является ли ресурс доступен в диалоговом окне из **Отладка** > **подключить Snapshot Debugger...**   >  **Ресурсов azure** > **выбрать существующую**, или в Cloud Explorer.
* Если эта ошибка повторяется, используйте один из каналов по обратной связи, описанные в начале этой статьи.

### <a name="403-forbidden"></a>(403 запрещено)

Эта ошибка означает, что разрешение будет запрещено. Это может быть вызвано множество различных факторов.

Выполните следующие шаги.

* Убедитесь, что учетную запись Visual Studio имеет действующую подписку Azure с необходимыми разрешениями управления доступом на основе ролей (RBAC) для ресурса. Для службы приложений, проверьте наличие разрешений на [запроса](https://docs.microsoft.com/rest/api/appservice/appserviceplans/get) план службы приложений, где размещается приложение.
* Убедитесь, что отметка времени клиентского компьютера правильными и актуальными. Серверы с отметками времени off с более чем за 15 минут отметка времени запроса обычно вызывать эту ошибку.
* Если эта ошибка повторяется, используйте один из каналов по обратной связи, описанные в начале этой статьи.

### <a name="404-not-found"></a>(404) не найден

Эта ошибка означает, что не удалось найти веб-сайт на сервере.

Выполните следующие шаги.

* Убедитесь, что у вас есть веб-сайт развертывания и запуска в службе приложений, который вы подключаете к.
* Убедитесь, что сайт доступен по https://\<ресурсов\>. azurewebsites.net
* Если эта ошибка повторяется, используйте один из каналов по обратной связи, описанные в начале этой статьи.

### <a name="406-not-acceptable"></a>(406) неприемлемо

Эта ошибка указывает, что сервер не сможет отвечать на типа, установленного в заголовке "Accept" запроса.

Выполните следующие шаги.

* Убедитесь, что сайт доступен по https://\<ресурсов\>. azurewebsites.net
* Убедитесь, что веб-узла не была перенесена на новые экземпляры. Отладчик моментальных снимков используется понятие ARRAffinity для маршрутизации запросов к конкретным экземплярам, которые можно периодически вызывать эту ошибку.
* Если эта ошибка повторяется, используйте один из каналов по обратной связи, описанные в начале этой статьи.

### <a name="409-conflict"></a>(409) конфликт

Эта ошибка означает, что запрос конфликтует с текущим состоянием сервера.

Это известная проблема, которая происходит, когда пользователь пытается подключить Snapshot Debugger от службу приложений, для которой ApplicationInsights. ApplicationInsights задает AppSettings с разным регистром, чем в Visual Studio, причиной проблемы.

::: moniker range=">= vs-2019"
Мы были устранены в Visual Studio 2019.
::: moniker-end

Выполните следующие шаги.

::: moniker range="vs-2017"

* На портале Azure убедитесь, что AppSettings для отладчика моментальных снимков (SNAPSHOTDEBUGGER_EXTENSION_VERSION) и InstrumentationEngine (INSTRUMENTATIONENGINE_EXTENSION_VERSION) записываются прописными буквами. Если это не так, обновите параметры вручную, который принудительно перезагружает сайта.
::: moniker-end
* Если эта ошибка повторяется, используйте один из каналов по обратной связи, описанные в начале этой статьи.

### <a name="500-internal-server-error"></a>(500) Внутренняя ошибка сервера

Эта ошибка означает, что узел является полностью выключена или сервер не может обработать запрос. Моментальный снимок только функции отладчика при выполнении приложений. [Application Insights Snapshot Debugger](https://docs.microsoft.com/azure/azure-monitor/app/snapshot-debugger) предоставляет моментальные снимки для исключений и может быть лучшим средством для ваших потребностей.

### <a name="502-bad-gateway"></a>(502) Недопустимый шлюз

Эта ошибка указывает на неполадку сети на стороне сервера и может быть временным.

Выполните следующие шаги.

* Подождите несколько минут и повторите подключение Snapshot Debugger еще раз.
* Если эта ошибка повторяется, используйте один из каналов по обратной связи, описанные в начале этой статьи.

## <a name="issue-snappoint-does-not-turn-on"></a>Проблема. Точка прикрепления к включению

Если со своей точкой моментальных снимков вместо обычного значка точки моментальных снимков отображается значок предупреждения ![значок предупреждения точки моментальных снимков](../debugger/media/snapshot-troubleshooting-snappoint-warning-icon.png "значок предупреждения точки моментальных снимков"), в таком случае точка моментальных снимков не включается.

![Точка моментальных снимков не включается](../debugger/media/snapshot-troubleshooting-dont-turn-on.png "Точка моментальных снимков не включается")

Выполните следующие шаги.

1. Убедитесь, что у вас есть ту же версию исходного кода, который использовался для создания и развертывания приложения. Убедитесь, что вы загружаете правильные символы для развертывания. Для выполнения этого действия во время отладки моментальных снимков откройте окно **Модули** и убедитесь, что в столбце "Файл символов" отображается PDB-файл, загруженный для модуля, который вы отлаживаете. Snapshot Debugger попытается загрузить и использовать символы для вашего развертывания автоматически.

## <a name="issue-symbols-do-not-load-when-i-open-a-snapshot"></a>Проблема. При открытии моментального снимка не загружать символы

Если отображается следующее окно, это означает, что символы не загрузились.

![Символы не загружаются](../debugger/media/snapshot-troubleshooting-symbols-wont-load.png "Символы не загружаются")

Выполните следующие шаги.

- Щелкните ссылку **Изменить параметры символов...** на этой странице. В параметрах **Отладка > Символ** добавьте каталог кэша символов. Перезапустите отладку моментального снимка после задания пути к символам.

   Символы или PDB-файлы, доступные в вашем проекте, должны соответствовать развертыванию Службы приложений. Большинство развертываний (развертывание через Visual Studio, CI/CD с помощью Azure Pipelines или Kudu и т. д.) опубликует ваши файлы символов вместе со Службой приложений. Установка каталога кэша символов позволяет Visual Studio использовать эти символы.

   ![Параметры символов](../debugger/media/snapshot-troubleshooting-symbol-settings.png "Параметры символов")

- В качестве альтернативы, если организация использует сервер символов или удаляет символы в другом пути, используйте параметры символов, чтобы загрузить правильные символы для своего развертывания.

## <a name="issue-i-cannot-see-the-attach-snapshot-debugger-option-in-the-cloud-explorer"></a>Проблема. Я не вижу параметр «Присоединить отладчик моментальных снимков» в Cloud Explorer

Выполните следующие шаги.

- Убедитесь, что компонент Snapshot Debugger установлен. Откройте Visual Studio Installer и проверьте компонент **Snapshot Debugger** в рабочей нагрузке Azure.
::: moniker range="< vs-2019"
- Убедитесь, что ваше приложение поддерживается. В настоящее время поддерживаются только приложения ASP.NET (4.6.1+) и ASP.NET Core (2.0+), развернутые в Службах приложений Azure.
::: moniker-end
::: moniker range=">= vs-2019"
- Убедитесь, что ваше приложение поддерживается.
  - Служба приложений Azure. Приложения ASP.NET, выполняющиеся на платформе .NET Framework 4.6.1 или более поздней версии.
  - Служба приложений Azure. Приложения ASP.NET Core, выполняющиеся на платформе .NET Core 2.0 или более поздней версии под управлением Windows.
  - Виртуальные машины Azure (и масштабируемый набор виртуальных машин). Приложения ASP.NET, выполняющиеся на платформе .NET Framework 4.6.1 или более поздней версии.
  - Виртуальные машины Azure (и масштабируемый набор виртуальных машин). Приложения ASP.NET, выполняющиеся на платформе .NET Core 2.0 или более поздней версии под управлением Windows.
  - Служба Azure Kubernetes. Приложения ASP.NET Core, выполняющиеся на платформе .NET Core 2.2 или более поздней версии под управлением Debian 9.
  - Служба Azure Kubernetes. Приложения ASP.NET Core, выполняющиеся на платформе .NET Core 2.2 или более поздней версии под управлением Alpine 3.8.
  - Служба Azure Kubernetes. Приложения ASP.NET Core, выполняющиеся на платформе .NET Core 2.2 или более поздней версии под управлением Ubuntu 18.04.
::: moniker-end

## <a name="issue-i-only-see-throttled-snapshots-in-the-diagnostic-tools"></a>Проблема. Я вижу только регулирование моментальные снимки в окне средств диагностики

![Регулируемый моментальный снимок](../debugger/media/snapshot-troubleshooting-throttled-snapshots.png "Регулируемый моментальный снимок")

Выполните следующие шаги.

- Моментальные снимки занимают мало памяти, но для них выделяется фиксированное количество памяти. Если Snapshot Debugger обнаружит, что ваш сервер находится под большой нагрузкой памяти, он не будет делать снимки. Вы можете удалить уже полученные снимки, остановив сеанс Snapshot Debugger и повторив попытку.

::: moniker range=">= vs-2019"
## <a name="issue-snapshot-debugging-with-multiple-versions-of-the-visual-studio-gives-me-errors"></a>Проблема. Отладка моментальных снимков с несколькими версиями Visual Studio дает мне ошибки

2019 г. Visual Studio требуется более новая версия расширение сайта Snapshot Debugger в вашей службе приложений Azure.  Эта версия не совместима с более старой версией расширение сайта Snapshot Debugger, используемые Visual Studio 2017.  При попытке присоединить отладчик моментальных снимков в Visual Studio 2019 в службу приложений Azure, который ранее отладки отладчиком моментальных снимков в Visual Studio 2017, вы получите следующую ошибку:

![Несовместимые расширение сайта Snapshot Debugger Visual Studio 2019](../debugger/media/snapshot-troubleshooting-incompatible-vs2019.png "расширение сайта Snapshot Debugger, несовместимые 2019 г. Visual Studio")

И наоборот Если вы используете Visual Studio 2017 для присоединения отладчика моментальных снимков в службу приложений Azure, который ранее отладки отладчиком моментальных снимков в Visual Studio 2019 г., вы получите следующую ошибку:

![Несовместимые расширение сайта Snapshot Debugger Visual Studio 2017](../debugger/media/snapshot-troubleshooting-incompatible-vs2017.png "расширение сайта несовместимые отладчика моментальных снимков Visual Studio 2017")

Чтобы устранить эту проблему, удалите следующие параметры приложения на портале Azure и подключите Snapshot Debugger повторно.

- INSTRUMENTATIONENGINE_EXTENSION_VERSION
- SNAPSHOTDEBUGGER_EXTENSION_VERSION
::: moniker-end

## <a name="issue-i-am-having-problems-snapshot-debugging-and-i-need-to-enable-more-logging"></a>Проблема. У меня возникли проблемы при отладке моментальных снимков и необходимо включить дополнительные ведения журнала

### <a name="enable-agent-logs"></a>Включение журналов агента

Чтобы включить и отключить ведение журнала агента, откройте Visual Studio и выберите *Средства > Параметры > Snapshot Debugger > Включить ведение журнала агента*. Обратите внимание, что если функция *Удалять старые журналы агента при запуске сеанса* также включена, каждое успешное вложение Visual Studio будет удалять предыдущие журналы агента.

Журналы агентов можно найти в следующей папке.

- Службы приложений.
  - Перейдите на сайт Kudu Службы приложений (то есть yourappservice.**scm**.azurewebsites.net), а затем на консоль отладки.
  - Журналы агента хранятся в следующем каталоге:  D:\home\LogFiles\SiteExtensions\DiagnosticsAgentLogs\
- Виртуальная машина / Масштабируемые наборы виртуальных машин.
  - Войдите на виртуальную Машину, агент, который журналы хранятся следующим образом:  C:\WindowsAzure\Logs\Plugins\Microsoft.Azure.Diagnostics.IaaSDiagnostics\<Version>\SnapshotDebuggerAgent_*.txt
- AKS
  - Перейдите к следующему каталогу: /tmp/diag/AgentLogs/*

### <a name="enable-profilerinstrumentation-logs"></a>Включите Profiler / Instrumentation Logs (журналы инструментирования)

Журналы инструментирования можно найти в следующей папке.

- Службы приложений.
  - Ведение журнала ошибок, будут автоматически отправляться D:\Home\LogFiles\eventlog.xml, будут отмечены события `<Provider Name="Instrumentation Engine" />` или «Производственного точки останова»
- Виртуальная машина / Масштабируемые наборы виртуальных машин.
  - Войдите на виртуальную машину и откройте "Просмотр событий".
  - Откройте следующее представление: *Журналы Windows > приложение*.
  - *Отфильтруйте текущий журнал* по *источнику события*, используя *производственные точки останова* или *ядро инструментирования*.
- AKS
  - Ведение журнала ядра инструментария происходит на /tmp/diag/log.txt (задается MicrosoftInstrumentationEngine_FileLogPath в DockerFile)
  - Ведение журнала ProductionBreakpoint происходит в /tmp/diag/shLog.txt

## <a name="known-issues"></a>Известные проблемы

- Отладка моментальных снимков с несколькими клиентами Visual Studio в одной и той же Службе приложений в настоящее время не поддерживается.
- Оптимизации Roslyn IL поддерживаются в проектах ASP.NET Core не полностью. В некоторых проектах ASP.NET Core вы не сможете увидеть некоторые переменные или использовать их в условных выражениях.
- Специальные переменные, такие как *$FUNCTION* или *$CALLER*, не могут выполняться в условных операторах или точках ведения журнала для проектов ASP.NET Core.
- Отладка моментальных снимков не работает в службах приложений, в которых включено [локальное кэширование](/azure/app-service/app-service-local-cache).
- Отладка моментальных снимков приложений API в настоящее время не поддерживается.

## <a name="site-extension-upgrade"></a>Обновление расширения сайта

Отладка моментальных снимков и Application Insights зависит от ICorProfiler, который загружается в процесс сайта и вызывает проблемы, состоящие в блокировке файлов во время обновления. Мы рекомендуем выполнить этот процесс, чтобы избежать простоя на производственном сайте.

- Создайте [слот развертывания](/azure/app-service/web-sites-staged-publishing) в Службе приложений и разверните свой сайт в слоте.
- Переключите слот с рабочей средой из Cloud Explorer в Visual Studio или с портала Azure.
- Остановите сайт слота. Завершение процесса сайта w3wp.exe во всех экземплярах займет несколько секунд.
- Обновите расширение сайта слота с сайта Kudu или портала Azure (*колонка "Служба приложений" > Средства разработки > Расширения > Обновление*).
- Запустите сайт слота. Мы рекомендуем посетить сайт, чтобы снова его подготовить.
- Переключите слот с рабочей средой.

## <a name="see-also"></a>См. также

- [Отладка в Visual Studio](../debugger/index.md)
- [Отладка работающих приложений ASP.NET, с помощью отладчика моментальных снимков](../debugger/debug-live-azure-applications.md)
- [Отладка динамического ASP.NET Azure Machines\Virtual машин масштабируемые наборы виртуальных машин с помощью отладчика моментальных снимков](../debugger/debug-live-azure-virtual-machines.md)
- [Отладка с помощью отладчика моментальных снимков Kubernetes динамической ASP.NET в Azure](../debugger/debug-live-azure-kubernetes.md)
- [Ответы на часто задаваемые вопросы по отладке моментальных снимков](../debugger/debug-live-azure-apps-faq.md)
