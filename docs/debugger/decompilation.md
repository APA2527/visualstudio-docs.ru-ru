---
title: Декомпилировать код .NET во время отладки | Документация Майкрософт
ms.date: 2/2/2020
ms.topic: conceptual
dev_langs:
- CSharp
helpviewer_keywords:
- decompilation, debugger, exception
- debugging [Visual Studio], decompilation, source not found
author: mikejo5000
ms.author: mikejo
manager: jillfra
ms.workload:
- multiple
monikerRange: '>= vs-2019'
ms.openlocfilehash: 5087c439533aa447708d0f1bfae653054fd16089
ms.sourcegitcommit: a86ee68e3ec23869b6eaaf6c6b7946b1d9a88d01
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 02/11/2020
ms.locfileid: "77144785"
---
# <a name="generate-source-code-from-net-assemblies-while-debugging"></a>Создание исходного кода из сборок .NET во время отладки

При отладке приложения .NET может оказаться, что вы хотите просмотреть неимеющийся исходный код. Например, прерывание на исключении или использование стека вызовов для перехода к исходному расположению.

> [!NOTE]
> * Создание исходного кода (декомпилирование) доступно только для приложений .NET и основано на проекте [ILSpy](https://github.com/icsharpcode/ILSpy) с открытым исходным кодом.
> * Декомпиляция доступна только в Visual Studio 2019 16,5 и более поздних версиях.

## <a name="generate-source-code"></a>Создать исходный код

При отладке без доступа к исходному коду в Visual Studio отображается документ **источник не найден** , или если у вас нет символов для сборки, документ **не загружен в символы** . Оба документа имеют параметр **декомпиляции исходного кода** , который создает C# код для текущего расположения. Созданный C# код можно использовать так же, как и любой другой исходный код. Можно просматривать код, проверять переменные, устанавливать точки останова и т. д.

### <a name="no-symbols-loaded"></a>Символы не загружены

На следующем рисунке показано сообщение " **нет загруженных символов** ".

![Снимок экрана: документ без загруженного символа](media/decompilation-no-symbol-found.png)

### <a name="source-not-found"></a>Источник не найден

На следующем рисунке показано сообщение **источник не найден** .

![Снимок экрана документа "источник не найден"](media/decompilation-no-source-found.png)

## <a name="generate-and-embed-sources-for-an-assembly"></a>Создание и внедрение источников для сборки

Помимо создания исходного кода для определенного расположения, можно создать весь исходный код для данной сборки .NET. Для этого перейдите в окно **модули** и в контекстном меню сборки .NET, а затем выберите команду **декомпилировать исходный код** . Visual Studio создает файл символов для сборки, а затем внедряет источник в файл символов. На более позднем этапе можно [извлечь](#extract-and-view-the-embedded-source-code) внедренный исходный код.

![Снимок экрана: контекстное меню сборки в окне "модули" с командой "декомпиляция исходного кода".](media/decompilation-decompile-source-code.png)

## <a name="extract-and-view-the-embedded-source-code"></a>Извлечение и просмотр внедренного исходного кода

Исходные файлы, внедренные в файл символов, можно извлечь с помощью команды **извлечь исходный код** в контекстном меню окна **модули** .

![Снимок экрана: контекстное меню сборки в окне "модули" с командой "извлечь источники".](media/decompilation-extract-source-code.png)

Извлеченные исходные файлы добавляются в решение в виде [прочих файлов](../ide/reference/miscellaneous-files.md). По умолчанию в Visual Studio функция "Прочие файлы" отключена. Эту функцию можно включить с помощью **средств** > **параметры** > **Среда** > **документы** > **Показывать прочие файлы в Обозреватель решений** . Без включения этой функции вы не сможете открыть извлеченный исходный код.

![Снимок экрана со страницей параметров инструментов с включенным параметром "Прочие файлы".](media/decompilation-tools-options-misc-files.png)

Извлеченные исходные файлы появятся в других файлах в **Обозреватель решений**.

![Снимок экрана: Обозреватель решений с прочими файлами.](media/decompilation-solution-explorer.png)

## <a name="known-limitations"></a>Известные ограничения

### <a name="requires-break-mode"></a>Требуется режим приостановки выполнения

Создание исходного кода с помощью декомпиляции возможно только в том случае, если отладчик находится в режиме приостановки выполнения и приложение приостановлено. Например, Visual Studio переходит в режим прерывания, когда он достигает точки останова или исключения. Вы можете легко активировать Visual Studio для прерывания при следующем выполнении кода с помощью команды " **прервать все** " (![значок "прерывать все"](media/decompilation-break-all.png)).

### <a name="decompilation-limitations"></a>Ограничения декомпиляции

Создание исходного кода из промежуточного формата (IL), используемого в сборках .NET, имеет некоторые ограничения. Таким образом, созданный исходный код не похож на исходный исходный код. Большая часть различий заключается в том, где информация в исходном исходном коде не требуется во время выполнения. Например, такие сведения, как пробелы, комментарии и имена локальных переменных, не требуются во время выполнения. Мы рекомендуем использовать созданный источник, чтобы понять, как выполняется программа, а не как заменить исходный исходный код.

### <a name="debug-optimized-or-release-assemblies"></a>Отладка оптимизированных или окончательных сборок

При отладке кода, декомпилированного из сборки, которая была скомпилирована с помощью оптимизации компилятора, могут возникнуть следующие проблемы.
- Точки останова не всегда могут быть привязаны к соответствующему расположению источников.
- Шаг с заходом не всегда должен быть указан правильно.
- Имена локальных переменных не могут быть точными.
- Некоторые переменные могут быть недоступны для оценки.

Дополнительные сведения см. в разделе [Интеграция с ичсарпкомпилер. декомпилятором в ОТЛАДЧИК VS](https://github.com/icsharpcode/ILSpy/issues/1901).

### <a name="decompilation-reliability"></a>Надежность декомпиляции

Относительно небольшой процент попыток декомпиляции может привести к сбою. Это происходит из-за ошибки ссылки на точку последовательности со значением NULL в ILSpy.  Проблема устранена за счет перехвата этих проблем и корректного сбоя попытки декомпиляции.

Дополнительные сведения см. в разделе [Интеграция с ичсарпкомпилер. декомпилятором в ОТЛАДЧИК VS](https://github.com/icsharpcode/ILSpy/issues/1901).

### <a name="limitations-with-async-code"></a>Ограничения с помощью асинхронного кода

Результаты декомпиляции модулей с шаблонами кода async/await могут быть неполными или полностью завершаться ошибкой. Реализация ILSpy async/await и yield State-Machines реализована только частично. 

Дополнительные сведения можно найти в [состоянии генератора PDB: состояние](https://github.com/icsharpcode/ILSpy/issues/1422).

### <a name="just-my-code"></a>Только мой код

Параметры [только мой код (JMC)](https://docs.microsoft.com/visualstudio/debugger/just-my-code) позволяют Visual Studio выполнять шаг с обходом системы, платформы, библиотеки и других вызовов, не являющихся пользователями. Во время сеанса отладки в окне **модули** отображаются модули кода, которые отладчик будет рассматривать как мой код (пользовательский код).

При декомпиляции оптимизированных или выпусков модулей создается код, не являющийся пользовательским. Если отладчик прерывает работу в декомпилированном коде, который не является пользователем, например, отображается окно **без исходного** кода. Чтобы отключить Только мой код, перейдите в **меню сервис** > **Параметры** (или **Параметры** > **отладки** ) > **Отладка** > **Общие**, а затем снимите флажок **включить только мой код**.

### <a name="extracted-sources"></a>Извлеченные источники

Исходный код, извлеченный из сборки, имеет следующие ограничения.
- Имя и расположение созданных файлов не могут быть настроены.
- Файлы являются временными и будут удалены в Visual Studio.
- Файлы помещаются в одну папку и иерархию папок, которые не использовались в исходных источниках.
- Имя файла для каждого файла содержит хэш контрольной суммы файла.

### <a name="generated-code-is-c-only"></a>Созданный код является C# только
При декомпиляции создаются только файлы исходного кода C#в. Нет возможности создавать файлы на любом другом языке.