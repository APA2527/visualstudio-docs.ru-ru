---
title: Создание визуальной карты стека вызовов | Документация Майкрософт
ms.date: 11/26/2018
ms.topic: conceptual
f1_keywords:
- vs.progression.debugwithcodemaps
dev_langs:
- CSharp
- VB
- FSharp
- C++
helpviewer_keywords:
- call stacks, code maps
- Call Stack window, mapping calls
- debugging [Visual Studio], diagramming the call stack
- call stacks, mapping
- Call Stack window, visualizing
- debugging code visually
- debugging [Visual Studio], mapping the call stack
- call stacks, visualizing
- debugging, code maps
- Call Stack window, tracing calls visually
- Call Stack window, show on code map
- debugging [Visual Studio], tracing the call stack visually
- debugging [Visual Studio], visualizing the call stack
ms.assetid: d6a72e5e-f88d-46fc-94a3-1789d34805ef
author: mikejo5000
ms.author: mikejo
manager: jillfra
ms.workload:
- multiple
ms.openlocfilehash: 135c7c66c9c6602f8c2e32bbdc1ba6e2fd28f548
ms.sourcegitcommit: 257fc60eb01fefafa9185fca28727ded81b8bca9
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 10/25/2019
ms.locfileid: "72911518"
---
# <a name="create-a-visual-map-of-the-call-stack-while-debugging-c-visual-basic-c-javascript"></a>Создание визуальной карты стека вызовов во время отладки (C#, Visual Basic, C++, JavaScript)

Для визуального отслеживания стека вызовов при отладке можно создать карту кода. Вы можете вести заметки на карте, чтобы следить за деятельностью кода и сосредоточиться на поиске ошибок.

Пошаговое руководство см. в этом видеоролике: [Видео. Отладка в визуальном режиме с помощью интеграции карты кода с отладчиком (Channel 9)](https://channel9.msdn.com/Series/Visual-Studio-2012-Premium-and-Ultimate-Overview/Visual-Studio-Ultimate-2012Debug-visually-with-Code-Map-debugger-integration)

Сведения о командах и действиях, которые можно использовать при работе с картами кода, см. в статье [Просмотр и переупорядочение карт кода](../modeling/browse-and-rearrange-code-maps.md).

>[!IMPORTANT]
>Карты кода можно создавать только в [выпуске Visual Studio Enterprise](https://visualstudio.microsoft.com/downloads).

Вот краткий обзор карты кода.

 ![Отладка со стеками вызовов на картах кода](../debugger/media/debuggermap_overview.png "DebuggerMap_Overview")

## <a name="map-the-call-stack"></a><a name="MapStack"></a> Сопоставление стека вызова

1. В проекте Visual Studio Enterprise C#, Visual Basic, C++ или JavaScript запустите отладку, выбрав **Отладка** > **Начать отладку** или нажав клавишу **F5**.

1. При переходе приложения в режим приостановки выполнения или при входе в определенную функцию выберите **Отладка** > **Карта кода** или нажмите сочетание клавиш **CTRL**+**SHIFT**+ **`** .

   Текущий стек вызовов выделен в новой карте кода оранжевым цветом:

   ![См. стек вызовов на карте кода](../debugger/media/debuggermap_seeundocallstack.png "DebuggerMap_SeeUndoCallStack")

При возобновлении отладки карта кода обновится автоматически. Изменение элементов или макета карты никак не влияет на код. Можно свободно переименовать, изменить или удалить любой элемент в сопоставлении.

Чтобы получить дополнительные сведения об элементе, наведите на него указатель мыши и прочитайте подсказку. Можно также выбрать элемент **Условные обозначения** на панели инструментов, чтобы узнать, что означает каждый значок.

![Условные обозначения карты кода](../debugger/media/debuggermap_showlegend.png "Условные обозначения карты кода")

>[!NOTE]
>Сообщение **Диаграмма может быть составлена с использованием более старой версии кода** в верхней части карты кода означает, что код мог измениться с момента последнего обновления карты. Например, вызов в сопоставлении может уже не существовать в коде. Закройте сообщение, а затем попытайтесь повторить сборку решения, прежде чем повторно обновлять сопоставление.

## <a name="map-external-code"></a>Отображение внешнего кода

По умолчанию в сопоставлении отображается только ваш код. Чтобы просмотреть внешний код на карте, выполните следующие действия.

- Щелкните правой кнопкой мыши в окне **Стек вызовов** и выберите в контекстном меню пункт **Показать внешний код**.

  ![Отображение внешнего кода с помощью окна стека вызовов](../debugger/media/debuggermap_callstackmenu.png "DebuggerMap_CallStackMenu")
- Или снимите флажок **Включить только мой код**, выбрав в Visual Studio **Сервис** (или **Отладка**) > **Параметры** > **Отладка**.

  ![Отображение внешнего кода с помощью диалогового окна параметров](../debugger/media/debuggermap_debugoptions.png "DebuggerMap_DebugOptions")

## <a name="control-the-maps-layout"></a>Управление макетом карты

Изменение макета карты никак не влияет на код.

Для управления макетом карты используется меню **Макет** на панели инструментов карты.

С помощью меню **Макет** можно выполнять следующие задачи.

- Изменить макет по умолчанию.
- Остановить автоматическую перекомпоновку карты, отключив параметр **Автоматически формировать макет при отладке**.
- Выполнить минимальную перекомпоновку карты при добавлении элементов, отключив параметр **Последовательный макет**.

## <a name="make-notes-about-the-code"></a><a name="MakeNotes"></a> Добавление примечаний к коду

Вы можете добавить комментарии для отслеживания операций, выполняемых в коде.

Чтобы добавить комментарий, щелкните правой кнопкой мыши карту кода и выберите **Изменить** > **Новый комментарий**, а затем введите комментарий.

Чтобы добавить новую строку в комментарий, нажмите клавиши **SHIFT**+**ВВОД**.

 ![Добавление комментария к стеку вызовов на карте кода](../debugger/media/debuggermap_addcomment.png "DebuggerMap_AddComment")

## <a name="update-the-map-with-the-next-call-stack"></a><a name="UpdateMap"></a> Обновление сопоставления путем добавления следующего стека вызовов

При выполнении приложения до следующей точки останова или входе в функцию новые стеки вывозов добавляются на карту автоматически.

![Обновление карты кода следующим стеком вызовов](../debugger/media/debuggermap_addclearcallstack.png "DebuggerMap_AddClearCallStack")

Чтобы остановить автоматическое добавление новых стеков вызова на карту,выберите ![Автоматически показывать стек вызовов на карте кода](../debugger/media/debuggermap_automaticupdateicon.gif "Автоматическое отображение стека вызовов на карте кода") на панели инструментов карты кода. Схема продолжит выделять существующие стеки вызовов. Чтобы вручную добавить текущий стек вызовов на карту, нажмите клавиши **CTRL**+**SHIFT**+ **`** .

## <a name="add-related-code-to-the-map"></a><a name="AddRelatedCode"></a> Добавление связанного кода в сопоставление

Теперь, когда у вас есть карта, при работе с C# или Visual Basic можно добавлять на нее элементы, такие как поля, свойства и методы, для отслеживания операций в коде.

Для перехода к определению метода в коде дважды щелкните метод на карте или выберите его и нажмите клавишу **F12** либо щелкните его правой кнопкой мыши и выберите пункт **Перейти к определению**.

![Переход к определению кода метода на карте кода](../debugger/media/debuggermap_gotocodedefinition.png "DebuggerMap_GoToCodeDefinition")

Чтобы добавить отслеживаемые элементы на карту, щелкните метод правой кнопкой мыши и выберите нужные элементы. Последние добавленные элементы отображаются зеленым цветом.

![Поля, связанные с методом на карте кода со стеком вызовов](../debugger/media/debuggermap_showedfields.png "DebuggerMap_ShowedFields")

>[!NOTE]
>По умолчанию при добавлении элементов в сопоставление также добавляются узлы родительской группы, соответствующие, например, классу, пространству имен или сборке. Эту функцию можно отключать и включать с помощью кнопки **Включить родительские элементы** на панели инструментов карты кода или нажав клавишу **CTRL** во время добавления элементов.

![Отображение полей в методе на карте кода со стеком вызовов](../debugger/media/debuggermap_showfields.png "DebuggerMap_ShowFields")

Продолжайте формировать сопоставление, чтобы увидеть дополнительный код.

 ![См. методы, использующие поле: карта кода со стеком вызовов](../debugger/media/debuggermap_findallreferences.png "DebuggerMap_FindAllReferences")

 ![Методы, использующие поле на карте кода со стеком вызовов](../debugger/media/debuggermap_foundallreferences.png "DebuggerMap_FoundAllReferences")

## <a name="find-bugs-using-the-map"></a><a name="FindBugs"></a> Поиск ошибок с помощью сопоставления
 Визуализация кода поможет вам быстрее находить ошибки. Например: предположим, что вы ищете ошибку в программе для рисования. Когда вы создаете линию и пробуете отменить ее создание, ничего не происходит до тех пор, пока не будет нарисована следующая линия.

 Установив точки останова в методах `clear`, `undo` и `Repaint`, вы начинаете отладку и создаете сопоставление, аналогичное представленному ниже:

 ![Добавление другого стека вызовов на карту кода](../debugger/media/debuggermap_addpaintobjectcallstack.png "DebuggerMap_AddPaintObjectCallStack")

 Учтите, что все жесты пользователя в сопоставлении вызывают метод `Repaint`, за исключением `undo`. Возможно, именно поэтому функция `undo` срабатывает не сразу.

 Когда вы исправите ошибку и продолжите выполнение приложения, на карту будет добавлен новый вызов из `undo` в `Repaint`.

 ![Добавление нового вызова метода в стек вызовов на карте кода](../debugger/media/debuggermap_addnewcallforrepaint.png "DebuggerMap_AddNewCallForRepaint")

## <a name="share-the-map-with-others"></a>Использование карты совместно с другими пользователями

Вы можете экспортировать карту, отправлять ее другим пользователям с помощью Microsoft Outlook, сохранять ее в решении и проверять в системе управления версиями.

Чтобы предоставить общий доступ к карте или сохранить карту, нажмите кнопку **Поделиться** на панели инструментов карты кода.

![Предоставление другим пользователям доступа к карте кода со стеком вызовов](../debugger/media/debuggermap_sharewithothers.png "Предоставление другим пользователям доступа к карте кода со стеком вызовов")

## <a name="see-also"></a>См. также
[Сопоставление зависимостей во всех решениях](../modeling/map-dependencies-across-your-solutions.md)

[Использование карт кода для отладки приложений](../modeling/use-code-maps-to-debug-your-applications.md)

[Поиск потенциальных проблем с помощью анализаторов карт кода](../modeling/find-potential-problems-using-code-map-analyzers.md)

[Просмотр и реорганизация карт кода](../modeling/browse-and-rearrange-code-maps.md)
