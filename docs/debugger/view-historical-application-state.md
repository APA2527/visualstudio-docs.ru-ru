---
title: Просмотр предыдущего состояния приложения с помощью IntelliTrace
description: Узнайте, как создавать и просматривать моментальные снимки с помощью функции возврата на шаг назад IntelliTrace
ms.custom: seodec18
ms.date: 09/19/2018
ms.topic: tutorial
ms.assetid: 7c60d929-d993-49dc-9db3-43b30be9912b
author: mikejo5000
ms.author: mikejo
manager: jillfra
ms.workload:
- multiple
ms.openlocfilehash: 78b755991bd90684c08c7126cb17fd169db7e57c
ms.sourcegitcommit: 94b3a052fb1229c7e7f8804b09c1d403385c7630
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/23/2019
ms.locfileid: "62901729"
---
# <a name="inspect-previous-app-states-using-intellitrace-step-back-in-visual-studio-visual-studio-enterprise"></a>Проверка предыдущих состояний приложения с помощью функции возврата на шаг назад IntelliTrace в Visual Studio (Visual Studio Enterprise)

Функция возврата на шаг назад в IntelliTrace автоматически создает моментальный снимок вашего приложения для каждого события точки останова и шага отладчика. Используя записанные моментальные снимки, вы можете возвращаться к этим точкам останова и шагам, просматривая предыдущее состояние приложения. Возможность возврата на шаг назад в IntelliTrace позволяет сэкономить время в тех случаях, когда вам нужно просмотреть предыдущее состояние приложения, но не требуется перезапускать отладку или воссоздавать необходимое состояние приложения.

Функция возврата на шаг назад IntelliTrace доступна, начиная с Visual Studio Enterprise 2017 версии 15.5 и более поздних. Для ее использования требуется установка Windows 10 Anniversary Update или более поздней версии. На данный момент эта функция поддерживается для отладки приложений ASP.NET, WinForms, WPF, управляемых консольных приложений, а также управляемых библиотек классов. Начиная с Visual Studio 2017 Enterprise версии 15.7, эта функция также поддерживается для ASP.NET Core и .NET Core. Начиная с Visual Studio 2017 Enterprise 15.9 (предварительная версия 2), эта функция также поддерживается для собственных приложений, предназначенных для Windows. Отладка приложений универсальной платформы Windows в настоящее время не поддерживается.

В этом руководстве рассмотрены следующие задачи:

> [!div class="checklist"]
> * Включение моментальных снимков и событий IntelliTrace
> * Навигация между событиями с использованием команд для перехода на шаг назад и вперед
> * Просмотр моментальных снимков событий

## <a name="enable-intellitrace-events-and-snapshots-mode"></a>Включение режима событий и моментальных снимков IntelliTrace

1. Откройте проект в Visual Studio Enterprise.

1. Выберите **Сервис** > **Параметры** > **IntelliTrace**, а затем — **События и моментальные снимки IntelliTrace**.

    Начиная с Visual Studio 2017 Enterprise 15.9 (предварительная версия 2), этот параметр называется **Моментальные снимки IntelliTrace (управляемый и машинный код)**.

    ![Включение режима событий и моментальных снимков IntelliTrace](../debugger/media/intellitrace-enable-snapshots.png "Включение режима событий и моментальных снимков IntelliTrace")

1. Чтобы настроить параметры просмотра моментальных снимков при исключениях, выберите **IntelliTrace** > **Дополнительно** в диалоговом окне **Параметры**.

    Эти параметры доступны, начиная с Visual Studio 2017 Enterprise версии 15.7.

    ![Настройка поведения для моментальных снимков при исключениях](../debugger/media/intellitrace-enable-snapshots-on-exceptions.png)

    Если включены события и моментальные снимки, также по умолчанию включается создание моментальных снимков при исключениях. Чтобы отключить эту возможность, снимите флажок **Сбор моментальных снимков для событий исключения**. Если эта функция включена, для необработанных исключений будут создаваться моментальные снимки. Для обработанных исключений моментальные снимки создаются только в том случае, если создаваемое исключение не является повтором ранее вызванного исключения. В раскрывающемся списке вы можете задать максимальное количество моментальных снимков, создаваемых при исключениях. Это ограничение применяется каждый раз, когда приложение переходит в режим приостановки выполнения (например, при попадании в точку останова для приложения).

    > [!NOTE]
    > Моментальные снимки создаются только для тех событий исключения, которые являются записями IntelliTrace. Для управляемого кода можно задать регистрируемые IntelliTrace события. Для этого необходимо выбрать **Сервис** > **Параметры** > **События IntelliTrace**.

1. В проекте задайте одну или несколько точек останова и запустите отладку (нажмите клавишу **F5**) либо запустите отладку в пошаговом режиме (клавиша **F10** или **F11**).

    IntelliTrace будет создавать моментальный снимок процесса приложения для каждого шага отладчика, события точки останова или необработанного события исключения. Эти события записываются на вкладке **События** в окне **Средства диагностики** наряду с другими событиями IntelliTrace. Чтобы открыть это окно, выберите **Отладка** > **Окна** > **Отображение средств диагностики**.

    Рядом с событиями, для которых доступны моментальные снимки, отображается значок камеры.

    ![Вкладка "События" с моментальными снимками](../debugger/media/intellitrace-events-tab-with-snapshots.png "Вкладка \"События\" с моментальными снимками для точек останова и шагов")

    В целях оптимизации производительности при слишком малом интервале между шагами отладки моментальные снимки не создаются. Если рядом с шагом не отображается значок камеры, попробуйте сделать временной интервал между шагами немного больше.

## <a name="navigate-and-view-snapshots"></a>Переход между моментальными снимками и их просмотр

1. Для перехода между событиями используйте кнопки **На шаг назад (ALT+[)** и **На шаг вперед (Alt+])** в панели инструментов "Отладка".

    С помощью этих кнопок можно перейти к событиям, которые отображаются на вкладке **События** в окне **Средства диагностики**. При переходе на шаг назад или вперед к событию автоматически активируется [отладка с ведением журнала](../debugger/historical-debugging.md) для выбранного события.

    ![Кнопки перехода на шаг назад и вперед](../debugger/media/intellitrace-step-back-icons-description.png "Кнопки перехода на шаг назад и вперед")

    При переходе на шаг назад или вперед Visual Studio автоматически переходит в режим отладки с ведением журнала. В этом режиме контекст отладчика переключается на момент времени, когда было зарегистрировано выбранное событие. Visual Studio также перемещает указатель в соответствующую строку в окне исходного кода.

    В этом представлении вы можете проверить значения в окнах **Стек вызовов**, **Локальные**, **Видимые** и **Контрольные значения**. Кроме того, вы можете просматривать подсказки по данным, наводя указатель мыши на переменные, а также вычислять выражения в окне **Интерпретация**. Отображаемые данные поступают из моментального снимка процесса приложения, созданного на рассматриваемый момент времени.

    Например, если после попадания в точку останова вы выполнили шаг отладки (клавиша **F10**), при нажатии кнопки **На шаг назад** среда Visual Studio переключится в режим отладки с ведением журнала в строке кода, соответствующей точке останова.

    ![Активация режима отладки с ведением журнала для события с моментальным снимком](../debugger/media/intellitrace-historical-mode-with-snapshot.png "Активация режима отладки с ведением журнала для события с моментальным снимком")

2. Чтобы вернуться к отладке в режиме реального времени, выберите **Продолжить (F5)** или щелкните ссылку **Вернуться к динамической отладке** в информационной панели.

3. Также можно просмотреть моментальный снимок на вкладке **События**. Для этого выберите событие с моментальным снимком и щелкните **Активировать отладку с ведением журнала**.

    ![Активация отладки с ведением журнала для события](../debugger/media/intellitrace-activate-historical-debugging.png "Активация отладки с ведением журнала для события")

    В отличие от команды **Следующая инструкция** при просмотре моментального снимка не осуществляется повторное выполнение кода. В этом случае вы получаете статическое представление состояния приложения на момент времени в прошлом.

    ![Общие сведения о функции возврата на шаг назад IntelliTrace](../debugger/media/intellitrace-step-back-overview.png "Общие сведения о функции возврата на шаг назад IntelliTrace")

    Подробнее о проверке переменных в Visual Studio см. в описании [возможностей отладчика](../debugger/debugger-feature-tour.md).

## <a name="frequently-asked-questions"></a>Вопросы и ответы

#### <a name="how-is-intellitrace-step-back-different-from-intellitrace-events-only-mode"></a>Чем функция возврата на шаг назад IntelliTrace отличается от режима "Только для событий IntelliTrace"?

В режиме "Только для событий IntelliTrace" вы не можете активировать отладку с ведением журнала для шагов и точек останова отладчика. Тем не менее IntelliTrace будет регистрировать данные в окнах **Локальные** и **Видимые** только в том случае, если эти окна открыты. При этом будут записываться только те данные, которые развернуты и находятся в представлении. В режиме "Только для событий" зачастую отсутствует полное представление о состоянии переменных и составных объектов. Кроме того, не поддерживается возможность вычисления выражений и просмотра данных в **окне контрольных значений**.

В режиме событий и моментальных снимков IntelliTrace записывает моментальный снимок всего процесса приложения, включая составные объекты. В строке кода вы увидите ту же информацию, что и при попадании в точку останова (независимо от того, была ли ранее развернута эта информация). Кроме того, при просмотре моментальных снимков поддерживается вычисление выражений.  

#### <a name="what-is-the-performance-impact-of-this-feature"></a>Как эта функция влияет на производительность? 

Влияние на общую производительность пошаговой отладки зависит от приложения. Создание моментального снимка занимает примерно 30 мс. При создании моментального снимка процесс разветвляется, а ответвленная копия приостанавливается. При просмотре моментального снимка Visual Studio присоединяет ответвленную копию процесса. Для каждого моментального снимка Visual Studio копирует только таблицу страниц и присваивает страницам атрибуты копирования при записи. Если объекты в куче изменяются между шагами отладчика, с которыми связаны моментальные снимки, соответствующая таблица страниц копируется, в результате чего потеря памяти будет минимальной. Если Visual Studio обнаруживает нехватку памяти для создания моментального снимка, снимок сделан не будет.

## <a name="known-issues"></a>Известные проблемы
* Если при работе в режиме событий и моментальных снимков IntelliTrace в версиях Windows, предшествующих Windows 10 Fall Creators Update (RS3), в качестве целевой платформы отладки для приложения задана платформа x86, IntelliTrace не будет создавать моментальные снимки.

    Обходные решения:
  * Если вы работаете в Windows 10 Anniversary Update (RS1) и ниже версии 10.0.14393.2273, [установите решение из статьи KB4103720](https://support.microsoft.com/help/4103720/windows-10-update-kb4103720).
  * Если вы работаете в Windows 10 Creators Update (RS2) и ниже версии 10.0.15063.1112, [установите решение из статьи KB4103722](https://support.microsoft.com/help/4103722/windows-10-update-4103722).
  * Установите Windows 10 Fall Creators Update (RS3) или выполните обновление до соответствующей версии.
  * Альтернативное решение:
    1. Установите набор инструментов VC++ 2015.3 версии 140 для классического компонента (x86, x64) из установщика Visual Studio.
    2. Выполните сборку целевого приложения.
    3. Воспользуйтесь средством editbin в командной строке, чтобы установить флаг `Largeaddressaware` для целевого исполняемого файла. Например, можно использовать эту команду (после изменения пути): "C:\Program Files (x86)\Microsoft Visual Studio\Preview\Enterprise\VC\Tools\MSVC\14.12.25718\bin\Hostx86\x86\editbin.exe" /Largeaddressaware "C:\Path\To\Application\app.exe".
    4. Чтобы начать отладку, нажмите клавишу **F5**. Теперь моментальные снимки создаются для шагов и точек останова отладчика.

       > [!Note]
       > Флаг `Largeaddressaware` необходимо устанавливать каждый раз, когда выполняется повторное построение исполняемого файла после внесения изменений.

* При создании моментального снимка процесса для приложения, которое использует сохраненный отображенный в память файл, процесс с моментальным снимком удерживает монопольную блокировку отображенного в память файла даже после того, как родительский процесс снимет блокировку. В результате другие процессы по-прежнему могут считывать отображенный в память файл, но не могут осуществлять запись в него.

    Решение
    * По окончании сеанса отладки удалите все моментальные снимки.

* При отладке приложения, процесс которого использует большое количество уникальных областей памяти (например, приложения, загружающего большое количество библиотек DLL), может снизиться производительность пошаговой отладки с включенным созданием моментальных снимков. В следующих версиях Windows эта ошибка будет устранена. Если вы столкнулись с этой проблемой, свяжитесь с нами по адресу stepback@microsoft.com.

* При сохранении файла с помощью команды **Отладка > IntelliTrace > Сохранить сеанс IntelliTrace** в режиме событий и моментальных снимков дополнительные данные, полученные из моментальных снимков, будут недоступны в файле .itrace. Для событий точки останова и шага отображается та же информация, как и в случае сохранения файла в режиме IntelliTrace только для событий.

## <a name="next-steps"></a>Следующие шаги

Из этого руководства вы узнали, как использовать функцию возврата на шаг назад IntelliTrace. Ознакомьтесь с дополнительными материалами, посвященными другим возможностям IntelliTrace.

> [!div class="nextstepaction"]
> [Возможности IntelliTrace](../debugger/intellitrace-features.md)
