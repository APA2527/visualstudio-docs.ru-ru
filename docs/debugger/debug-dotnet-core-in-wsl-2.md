---
title: Отладка приложений .NET Core в WSL 2
description: Узнайте, как запускать и отлаживать приложения .NET Core в WSL 2, не выходя из Visual Studio.
ms.date: 01/25/2021
ms.topic: conceptual
helpviewer_keywords:
- debugging, linux
- debugging, wsl2
author: mikejo5000
ms.author: mikejo
manager: jmartens
monikerRange: '>= vs-2019'
ms.workload:
- multiple
ms.openlocfilehash: 6ae43b79b9db766d752a25fb538b7f208e6f5e13
ms.sourcegitcommit: ae6d47b09a439cd0e13180f5e89510e3e347fd47
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 02/08/2021
ms.locfileid: "99865622"
---
# <a name="debug-net-core-apps-in-wsl-2-with-visual-studio"></a>Отладка приложений .NET Core в WSL 2 с помощью Visual Studio

Благодаря WSL 2 приложения .NET Core можно легко выполнять и отлаживать в Linux, не выходя из Visual Studio. Если вы разрабатываете кросс-платформенные приложения, этот метод предоставляет простой способ тестировать большинство целевых сред.

Для пользователей Windows .NET, разрабатывающих приложения для Linux, WSL 2 — это оптимальное сочетание реалистичной рабочей среды и высокой производительности. В Visual Studio вы уже можете выполнять отладку в удаленной среде Linux, используя [удаленный отладчик](../debugger/remote-debugging-dotnet-core-linux-with-ssh.md) или контейнеры с помощью [соответствующих средств](../containers/overview.md). Эти варианты подойдут, если больше всего необходимо достичь реалистичных условий. Если же важнее простота и скорость внутреннего цикла, WSL 2 — отличный вариант.

Не ограничивайтесь одним методом. Вы можете применять профиль запуска для Docker и WSL 2 в одном проекте, используя подходящий вариант для конкретного запуска. После развертывания приложения всегда можно подключить удаленный отладчик в случае возникновения проблемы.

## <a name="prerequisites"></a>Предварительные требования

- Visual Studio 2019 v16.9, предварительная версия 1, или более поздней версии с дополнительным компонентом .NET Core Debugging с использованием WSL 2.

  Дополнительный компонент предоставляется по умолчанию вместе с кросс-платформенными рабочими нагрузками .NET Core или нагрузками ASP.NET и веб-разработки. Необходимо установить одну или обе рабочие нагрузки.

- Установленный дистрибутив [WSL 2](/windows/wsl/about).

- Установленный [дистрибутив](https://aka.ms/wslstore) по вашему усмотрению.

## <a name="start-debugging-with-wsl-2"></a>Запуск отладки .NET Core с использованием WSL 2

1. После установки обязательных компонентов откройте веб-приложение ASP.NET Core или консольное приложение .NET Core в Visual Studio. Здесь отобразится новый профиль запуска с именем WSL 2:

   ![Профиль запуска WSL 2 в списке профилей](media/linux-wsl2-debugging-select-launch-profile.png)

1. Выберите этот профиль, чтобы добавить его в файл *launchSettings.json*.

   В следующем примере показаны некоторые ключевые атрибуты в файле.

    ```json
    "WSL 2": {
        "commandName": "WSL2",
        "launchBrowser": true,
        "launchUrl": "https://localhost:5001",
        "environmentVariables": {
            "ASPNETCORE_URLS": "https://localhost:5001;http://localhost:5000",
            "ASPNETCORE_ENVIRONMENT": "Development"
        },
        "distributionName": ""
    }
    ```

   Когда вы выберете новый профиль, расширение проверит, настроен ли дистрибутив WSL 2 для выполнения приложений .NET Core, и установит недостающие зависимости. После их установки можно приступать к отладке в WSL 2.

1. Запустите отладку привычным способом, и ваше приложение будет работать в дистрибутиве WSL 2 по умолчанию.

   Простой способ убедиться, что вы используете Linux, — проверить значение `Environment.OSVersion`.

>[!NOTE]
> Протестированы и поддерживаются только Ubuntu и Debian. Другие дистрибутивы, поддерживаемые .NET Core, должны работать, но для этого требуется вручную установить [среду выполнения .NET Core](https://aka.ms/wsldotnet) и [cURL](https://curl.haxx.se/).

## <a name="choose-a-specific-distribution"></a>Выбор конкретного дистрибутива

По умолчанию профиль запуска WSL 2 использует стандартный дистрибутив, заданный в файле *wsl.exe*. Если нужно запустить профиль для другого конкретного дистрибутива, независимо от используемого по умолчанию, можно изменить профиль запуска. Например, если вы отлаживаете веб-приложение и хотите проверить его в Ubuntu 20.04, профиль запуска будет выглядеть следующим образом:

```json
"WSL 2": {
    "commandName": "WSL2",
    "launchBrowser": true,
    "launchUrl": "https://localhost:5001",
    "environmentVariables": {
        "ASPNETCORE_URLS": "https://localhost:5001;http://localhost:5000",
        "ASPNETCORE_ENVIRONMENT": "Development"
    },
    "distributionName": "Ubuntu-20.04"
}
```

## <a name="target-multiple-distributions"></a>Ориентация на несколько дистрибутивов

Если вы создаете приложение, предназначенное выполняться в нескольких дистрибутивах, и хотите быстро проверить работу в каждом из них, следующим шагом будет создание нескольких профилей запуска. Например, если необходимо проверить консольное приложение в Debian, Ubuntu 18.04 и Ubuntu 20.04, можно использовать следующие профили запуска:

```json
"WSL 2 : Debian": {
    "commandName": "WSL2",
    "distributionName": "Debian"
},
"WSL 2 : Ubuntu 18.04": {
    "commandName": "WSL2",
    "distributionName": "Ubuntu-18.04"
},
"WSL 2 : Ubuntu 20.04": {
    "commandName": "WSL2",
    "distributionName": "Ubuntu-20.04"
}
```

Эти профили запуска обеспечивают легкое и удобное переключение между целевыми дистрибутивами, при этом не нужно выходить из Visual Studio.

![Несколько профилей запуска WSL 2 в списке профилей](media/linux-wsl2-debugging-switch-target-distribution.png)

## <a name="wsl-settings-in-the-launch-profile"></a>Параметры WSL в профиле запуска

В следующей таблице приведены параметры, которые поддерживаются в профиле запуска.

|Имя|По умолчанию|Назначение|Поддержка маркеров|
|-|-|-|-|
|executablePath|dotnet|Путь к исполняемому файлу, который следует запустить.|Да|
|commandLineArgs|Значение свойства "TargetPath" MSBuild, сопоставленное со средой WSL.|Аргументы командной строки, переданные согласно параметру executablePath.|Да|
|WorkingDirectory|Для консольных приложений — {*OutDir*}.</br>Для веб-приложений — {*ProjectDir*}.|Рабочий каталог, в котором следует запустить отладку.|Да|
|environmentVariables||Пары "ключ — значение" переменных среды, которые необходимо установить для отлаживаемого процесса.|Да|
|setupScriptPath||Скрипт, который следует запустить перед отладкой. Используется для выполнения таких скриптов, как ~/.bash_profile.|Да|
|distributionName||Имя дистрибутива WSL, который следует использовать.|Нет|
|launchBrowser|false|Указывает, следует ли запускать браузер.|Нет|
|launchUrl||URL-адрес, по которому следует перейти, если для параметра launchBrowser задано значение true.|Нет|

Поддерживаемые маркеры:

{*ProjectDir*} — путь к каталогу проекта.

{*OutDir*} — значение свойства `OutDir` MSBuild.

>[!NOTE]
> Все пути указываются для WSL, а не для Windows.
