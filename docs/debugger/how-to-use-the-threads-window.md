---
title: Отладка многопоточных приложений
description: Отладка с помощью окна потоков и панели инструментов места отладки в Visual Studio
ms.date: 11/21/2018
ms.topic: conceptual
dev_langs:
- CSharp
- VB
- FSharp
- C++
helpviewer_keywords:
- multithreaded debugging, tutorial
- tutorials, multithreaded debugging
ms.assetid: adfbe002-3d7b-42a9-b42a-5ac0903dfc25
author: mikejo5000
ms.author: mikejo
manager: jillfra
ms.workload:
- multiple
ms.openlocfilehash: e3a87fd0480727a524b36ab209f5126b0f996c30
ms.sourcegitcommit: 94b3a052fb1229c7e7f8804b09c1d403385c7630
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/23/2019
ms.locfileid: "62846927"
---
# <a name="walkthrough-debug-a-multithreaded-app-using-the-threads-window-c-visual-basic-c"></a>Пошаговое руководство. Отладка многопоточных приложений, с помощью окна потоков (C#, Visual Basic, C++)

Некоторые элементы пользовательского интерфейса Visual Studio помочь в отладке многопоточных приложений. В этой статье рассматриваются многопоточных возможности отладки в окне редактора кода **место отладки** инструментов и **потоков** окна. Сведения о других средствах для отладки многопоточных приложений, см. в разделе [Начало отладки многопоточных приложениях](../debugger/get-started-debugging-multithreaded-apps.md).

Завершение изучения этого учебника занимает всего несколько минут и вы узнаете, как с его основными отладки многопоточных приложений.

## <a name="create-a-multithreaded-app-project"></a>Создайте проект многопоточного приложения

Создайте следующий проект многопоточного приложения для использования в этом руководстве:

1. Откройте Visual Studio и создайте новый проект.

    ::: moniker range=">=vs-2019"
    Нажмите клавишу **ESC**, чтобы закрыть окно запуска. Тип **Ctrl + Q** для открытия окна поиска, введите **консоли** (или **c ++** ), выберите **шаблоны**, а затем:

    - Для C#, выберите **создать новый проект консольного приложения (.NET Framework)** для C#. В появившемся диалоговом окне выберите **Создать**.
    - Для C++, выберите **создать новый проект консольного приложения**. В появившемся диалоговом окне выберите **Создать**.

    Введите имя, например **MyThreadWalkthroughApp** и нажмите кнопку **создать**.
    ::: moniker-end
    ::: moniker range="vs-2017"
    В верхней строке меню выберите **Файл** > **Создать** > **Проект**. В левой части **новый проект** диалоговом окне выберите следующее:
    - Для C# приложения в разделе **Visual C#** , выберите **Windows Desktop**, а затем в средней области выберите **консольное приложение (.NET Framework)** .
    - Для C++ приложения в разделе **Visual C++** , выберите **Windows Desktop**,, а затем выберите **консольное приложение Windows**.

    Введите имя, например **MyThreadWalkthroughApp** и нажмите кнопку **ОК**.
    ::: moniker-end

    Если шаблон проекта **Консольное приложение** отсутствует, перейдите в меню **Сервис** > **Получить средства и компоненты...** , после чего запустится Visual Studio Installer. Выберите рабочую нагрузку **Разработка классических приложений .NET** или **Разработка классических приложений на C++** , а затем нажмите кнопку **Изменить**.

    Появится новый проект в **обозревателе решений**, и исходный файл с именем *Program.cs* или *MyThreadWalkthroughApp.cpp* откроется в окне исходного кода.

1. Замените код в файле источника с C# или C++ пример кода из [Начало отладки многопоточных приложениях](../debugger/get-started-debugging-multithreaded-apps.md).

1. Выберите **файл** > **сохранить все**.

## <a name="start-debugging"></a>Начать отладку

1. Найдите следующие строки в исходном коде:

   ```csharp
   Thread.Sleep(3000);
   Console.WriteLine();
   ```

   ```C++
   Thread::Sleep(3000);
   Console.WriteLine();
   ```

1. Установите точку останова на `Console.WriteLine();` строки, щелкнув в левом поле, или выбрав линию и нажав **F9**.

   Точка останова отображается как красный кружок в левом поле рядом со строкой кода.

1. Выберите **Отладка** > **начать отладку**, или нажмите клавишу **F5**.

   Приложение запускается в режиме отладки, а приостанавливается в точке останова.

1. В режиме приостановки, откройте **потоков** окно, выбрав **Отладка** > **Windows** > **потоков**. Будьте в сеансе отладки, чтобы открыть или см. в разделе **потоков** и других диалоговых окон отладки.

## <a name="examine-thread-markers"></a>Проверить маркеры потоков

1. В исходном коде, найдите `Console.WriteLine();` строки.

   1. Щелкните правой кнопкой мыши в **потоков** затем выберите **Показать потоки в исходном коде** ![Показать потоки в исходном коде](../debugger/media/dbg-multithreaded-show-threads.png "ThreadMarker") в меню.

   Области рядом с исходный код строки теперь отображает *маркер потока* значок ![маркер потока](../debugger/media/dbg-thread-marker.png "маркер потока"). маркер потока указывает, что некий поток остановлен в этом месте. Если имеется более одного потока в расположении, ![несколько потоков](../debugger/media/dbg-multithreaded-show-threads.png "несколько потоков") появляется значок.

1. Наведите указатель мыши на маркер потока. Появится подсказка, показывающая имя и Идентификационный номер для остановленного потока или потоков. Имена потоков может быть `<No Name>`.

   >[!TIP]
   >Чтобы идентифицировать безымянные потоки, можно переименовать их в **потоков** окна. Щелкните правой кнопкой мыши поток и выберите **Переименовать**.

1. Щелкните правой кнопкой мыши маркер потока в исходном коде, чтобы просмотреть доступные параметры в контекстном меню.

## <a name="flag-and-unflag-threads"></a>Установка и снятие отметки для потока

Можно пометить поток для отслеживания потоков, требуется уделить особое внимание.

Флаг и снять отметку с потока из редактора исходного кода или из **потоков** окна. Выберите, следует ли отображать только с помеченными и все потоки из **место отладки** или **потоков** панели окна инструментов. Выбранные в любом месте влияют на все расположения.

### <a name="flag-and-unflag-threads-in-source-code"></a>Снять отметку с потока в исходном коде и отметки

1. Откройте **место отладки** панели инструментов, выбрав **представление** > **панелей инструментов** > **место отладки**. Можно также правой кнопкой мыши в области панели инструментов и выберите **место отладки**.

1. **Место отладки** панель инструментов содержит три поля: **Процесс**, **потоков**, и **кадра стека**. Раскрывающийся список **потоков** список и обратите внимание на то, сколько потоков существует. В **поток** списке текущим выполняемым потоком отмеченного **>** символов.

1. В окне исходного кода наведите указатель мыши на значок маркера потока во внутренней области и выберите значок флага (или один из значков пустой флаг) в подсказке по данным. Значок флага станет красным.

   Щелкните правой кнопкой мыши маркер значок в виде потока, пункты **флаг**, а затем выберите поток, чтобы флаг в контекстном меню.

1. На **место отладки** панели инструментов, выберите **Показывать только отмеченные потоки** значок ![Показывать отмеченные потоки](../debugger/media/dbg-threads-show-flagged.png "Показывать отмеченные потоки"), справа от **потоков** поля. Значок неактивна, если один или несколько потоков, помечаются.

   Теперь отображается только отмеченные потоки в **поток** раскрывающегося списка на панели инструментов. Чтобы снова отобразить все потоки, выберите **Показывать только отмеченные потоки** значок еще раз.

   >[!TIP]
   >После Вы отметили некоторые потоки, можно поместить курсор в редакторе кода, щелкните правой кнопкой мыши и выберите **Запустить помеченные потоки до курсора**. Убедитесь в том, что выбрать достигнет кода, что все отмеченные потоки. **Выполнить до текущей позиции отмеченные потоки** будет приостанавливать потоки в выбранной строке кода, что упрощает для управления порядком выполнения по [Замораживание и размораживание потоков](#bkmk_freeze).

1. Чтобы переключить состояние помеченные или без отметки текущим выполняемым потоком, выберите одного флага **пометкой потока текущего состояние** кнопку на панели инструментов слева от **Показывать только отмеченные потоки** кнопка. Пометка текущего потока можно использовать для поиска текущего потока, когда отображаются только отмеченные потоки.

1. Чтобы снять отметку с потока, наведите указатель мыши на маркер потока в исходном коде и выберите значок красного флажка, чтобы очистить его, или щелкните правой кнопкой мыши маркер потока и выберите **снять отметку**.

### <a name="flag-and-unflag-threads-in-the-threads-window"></a>Пометка и снятие потоки в окне потоков

В **потоков** окна, отмеченные потоки имеют красный флаг значки рядом с ними, а непомеченные потоки, если отображается, пустой значков.

![Окно "Потоки"](../debugger/media/dbg-threads-window.png "окно \"Потоки\"")

Выберите значок флага, чтобы изменить состояние потока помеченные или без отметки, в зависимости от текущего состояния.

Можно также правой кнопкой мыши линию и выберите **флаг**, **снять отметку**, или **снять пометку со всех потоков** в контекстном меню.

**Потоков** также имеет панель инструментов окна **Показать потоков только помеченные** кнопки, равное righthand, один из значков два флага. Он работает так же, как кнопки на **место отладки** панели инструментов, а также одну из кнопок управляет отображением в обоих расположениях.

### <a name="other-threads-window-features"></a>Другие функции окна потоков

В **потоков** окно, выберите заголовок любого столбца, чтобы отсортировать потоки по этому столбцу. Выберите еще раз, чтобы изменить порядок сортировки. Если отображаются все потоки, выбрав значок столбца флаг Сортировка потоков по помеченные или без отметки состояния.

Во второй столбец **потоков** (без заголовка) является **текущий поток** столбца. Желтая стрелка в этом столбце помечает текущей точке выполнения.

**Расположение** столбец показывает, где каждый поток отображается в исходном коде. Выберите стрелку рядом с полем **расположение** записи или при наведении указателя мыши на этот элемент, чтобы показать частичный стек вызова для этого потока.

>[!TIP]
>Графическое представление стеки вызовов для потоков, используйте [Параллельные стеки](../debugger/using-the-parallel-stacks-window.md) окна. Чтобы открыть окно, во время отладки, выберите **Отладка**> **Windows** > **Параллельные стеки**.

В дополнение к **флаг**, **снять отметку**, и **снять пометку со всех потоков**, в контекстном меню для **потоков** имеет элементов окна:

- **Показать потоки в исходном коде** кнопки.
- **Шестнадцатеричный вывод**, какие изменения **Thread ID**s в **потоков** окно из десятичной в шестнадцатеричном формате.
- [Ключ для потока](#switch-to-another-thread), который немедленно переключит выполнение этого потока.
- **Переименовать**, которая позволяет изменить имя потока.
- [Замораживание и размораживание](#bkmk_freeze) команды.

## <a name="bkmk_freeze"></a> Замораживание и размораживание потоков выполнения

Вы можно заморозить и Разморозить, или приостановить и возобновить, потоки, чтобы управлять порядком, в котором потоки выполнения работы. Замораживание и размораживание потоков может помочь устранить проблемы параллелизма, например взаимоблокировки и состояния гонки.

> [!TIP]
> Один поток без замораживание других потоков, который также является обычный сценарий отладки см. в разделе [Начало отладки многопоточных приложений](../debugger/get-started-debugging-multithreaded-apps.md#bkmk_follow_a_thread).

**Закрепление и снятие закрепления потоков:**

1. В **потоков** окно, щелкните правой кнопкой мыши любой поток, а затем выберите **закрепить**. Объект **Пауза** значок в **текущий поток** столбец указывает, что поток заморожен.

1. Выберите **столбцы** в **потоков** окно инструментов, а затем выберите **счетчик приостановок** для отображения **счетчик приостановок** столбца. Значение счетчика приостановок замороженный поток **1**.

1. Щелкните правой кнопкой мыши замороженный поток и выберите **Разморозить**.

   **Пауза** значок исчезнет и **счетчик приостановок** примет значение **0**.

## <a name="switch-to-another-thread"></a>Переключение на другой поток

Может появиться **приложение находится в режиме приостановки выполнения** окно при попытке переключиться на другой поток. Это окно сообщает, что поток имеет любой код, который может отображать текущий отладчик. Например возможно, отладка управляемого кода, но поток представляет собой машинный код. В окне есть предложения по их устранению.

**Чтобы переключиться в другой поток.**

1. В **потоков** окна, запомните идентификатор текущего потока, который является потоком с желтой стрелкой в **текущий поток** столбца. Стоит переключиться обратно на этот поток, чтобы продолжить работу приложения.

1. Щелкните правой кнопкой мыши другой поток и выберите **коммутатора для потока** в контекстном меню.

1. Обратите внимание, что расположение желтая стрелка изменилось в **потоков** окна. Исходный маркер текущего потока также остается, как структуры.

   Взгляните на всплывающей подсказки в маркер потока в редакторе исходного кода, а в списке в **поток** раскрывающегося списка на **место отладки** панели инструментов. Обратите внимание, что текущий поток также там изменились.

1. На **место отладки** панели инструментов, выберите другой поток, **поток** списка. Обратите внимание, что текущий поток также изменяется в двух местах.

1. В редакторе исходного кода щелкните правой кнопкой мыши маркер потока, выберите пункт **коммутатора для потока**и выберите другой поток из списка. Обратите внимание, что текущий поток изменяется во всех трех местах.

С помощью маркер потока в исходном коде можно переключаться только на потоки, остановленные в этом расположении. С помощью окна **Потоки** и панели инструментов **Место отладки** можно переключиться на любой поток.

Теперь вы узнали основы отладки многопоточных приложений. Можно наблюдать, флаг и снять отметку и заморозить или Разморозить потоки с помощью **потоков** окне **поток** в списке **место отладки** панели инструментов или маркеры потоков в Редактор исходного кода.

## <a name="see-also"></a>См. также
- [Отладка многопоточных приложений](../debugger/debug-multithreaded-applications-in-visual-studio.md)
- [Практическое руководство. Переключение на другой поток при отладке](../debugger/how-to-switch-to-another-thread-while-debugging.md)
