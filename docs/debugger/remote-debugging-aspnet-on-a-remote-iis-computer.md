---
title: Удаленная отладка ASP.NET Core на удаленном компьютере IIS | Документация Майкрософт
ms.custom: remotedebugging
ms.date: 05/21/2018
ms.topic: conceptual
ms.assetid: 573a3fc5-6901-41f1-bc87-557aa45d8858
author: mikejo5000
ms.author: mikejo
manager: jillfra
ms.workload:
- aspnet
- dotnetcore
ms.openlocfilehash: 3e11480949545781630dec0c533949dd200ecbc7
ms.sourcegitcommit: 7a9d5c10690c594dcdb414d88b20e070d43e7a4c
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/28/2020
ms.locfileid: "82218890"
---
# <a name="remote-debug-aspnet-core-on-a-remote-iis-computer-in-visual-studio"></a>Удаленная отладка ASP.NET Core на удаленном компьютере IIS в Visual Studio

Чтобы выполнить отладку ASP.NET Core приложения, развернутого в службах IIS, установите и запустите средства удаленной отладки на компьютере, где развернуто приложение, а затем подключитесь к выполняющемуся приложению из Visual Studio.

![Компоненты удаленного отладчика](../debugger/media/remote-debugger-aspnet.png "Remote_debugger_components")

В этом руководство объясняется, как установить и настроить Visual Studio ASP.NET Core, развернуть его в IIS и подключить удаленный отладчик из Visual Studio. Сведения об удаленной отладке ASP.NET 4.5.2 см. в разделе [Удаленная отладка ASP.NET на компьютере IIS](../debugger/remote-debugging-aspnet-on-a-remote-iis-7-5-computer.md). Также можно выполнить развертывание и отладку служб IIS с помощью Azure. Для службы приложений Azure можно легко выполнить развертывание и отладку на предварительно настроенном экземпляре служб IIS и удаленном отладчике с помощью [snapshot Debugger](../debugger/debug-live-azure-applications.md) или путем [подключения отладчика из Обозреватель сервера](../debugger/remote-debugging-azure.md).

## <a name="prerequisites"></a>Предварительные условия

::: moniker range=">=vs-2019"
Visual Studio 2019 требуется для выполнения действий, описанных в этой статье.
::: moniker-end
::: moniker range="vs-2017"
Visual Studio 2017 требуется для выполнения действий, описанных в этой статье.
::: moniker-end

Эти процедуры были протестированы в следующих конфигурациях сервера:
* Windows Server 2012 R2 и IIS 8
* Windows Server 2016 и IIS 10

## <a name="network-requirements"></a>Требования к сети

Отладка между двумя компьютерами, подключенными через прокси-сервер, не поддерживается. Отладка через подключение с высокой задержкой или с низкой пропускной способностью, например удаленный доступ через Интернет или через Интернет в разных странах, не рекомендуется и может привести к сбою или неприемлемым медленно. Полный список требований см. в разделе [требования](../debugger/remote-debugging.md#requirements_msvsmon).

## <a name="app-already-running-in-iis"></a>Приложение уже запущено в службах IIS?

Эта статья содержит инструкции по настройке базовой конфигурации IIS в Windows Server и развертыванию приложения из Visual Studio. Эти шаги включены, чтобы убедиться, что на сервере установлены необходимые компоненты, что приложение может работать правильно и что вы готовы к удаленной отладке.

* Если приложение выполняется в службах IIS и требуется загрузить удаленный отладчик и начать отладку, перейдите к разделу [Загрузка и установка средств удаленной отладки на Windows Server](#BKMK_msvsmon).

* Если вы хотите убедиться, что приложение настроено, развернуто и правильно работает в службах IIS, чтобы можно было выполнить отладку, выполните все действия, описанные в этом разделе.

## <a name="create-the-aspnet-core-application-on-the-visual-studio-computer"></a>Создание ASP.NET Core приложения на компьютере с Visual Studio

1. Создайте новое веб-приложение ASP.NET Core. 

    ::: moniker range=">=vs-2019"
    В Visual Studio 2019 введите **CTRL + Q** , чтобы открыть поле поиска, введите **ASP.NET**, выберите **шаблоны**, а затем щелкните **создать новое ASP.NET Core веб-приложение**. В появившемся диалоговом окне назовите проект **мяспапп**и нажмите кнопку **создать**. Затем выберите **веб-приложение (модель-представление-контроллер)**, а затем щелкните **создать**.
    ::: moniker-end
    ::: moniker range="vs-2017"
    В Visual Studio 2017 выберите **файл > новый > проект**, а затем выберите **Visual C# > веб-> ASP.NET Core веб-приложение**. В разделе шаблоны ASP.NET Core выберите **веб-приложение (модель-представление-контроллер)**. Убедитесь, что выбран параметр ASP.NET Core 2,1, **включить поддержку DOCKER** не выбран, а для параметра **Проверка** подлинности — значение **без проверки подлинности**. Назовите проект **мяспапп**.
    ::: moniker-end

4. Откройте файл About.cshtml.cs и установите точку останова в `OnGet` методе (в старых шаблонах откройте HomeController.cs, а затем установите точку останова `About()` в методе).

## <a name="install-and-configure-iis-on-windows-server"></a><a name="bkmk_configureIIS"></a>Установка и Настройка служб IIS в Windows Server

[!INCLUDE [remote-debugger-install-iis-role](../debugger/includes/remote-debugger-install-iis-role.md)]

## <a name="update-browser-security-settings-on-windows-server"></a>Обновление параметров безопасности браузера в Windows Server

Если в Internet Explorer включена усиленная конфигурация безопасности (включена по умолчанию), может потребоваться добавить некоторые домены в качестве доверенных сайтов, чтобы можно было загрузить некоторые из компонентов веб-сервера. Добавьте Доверенные сайты, перейдя в **Internet Options > Security > Trusted sites > Sites**. Добавьте следующие домены.

- microsoft.com
- сайт go.microsoft.com;
- download.microsoft.com
- iis.net

При скачивании программного обеспечения могут быть получены запросы на предоставление разрешения на загрузку различных скриптов и ресурсов веб-сайта. Некоторые из этих ресурсов не являются обязательными, но для упрощения процесса нажмите кнопку **Добавить** при появлении соответствующего запроса.

## <a name="install-aspnet-core-on-windows-server"></a>Установка ASP.NET Core в Windows Server

1. Установите [пакет размещения .NET Core для Windows Server](https://aka.ms/dotnetcore-2-windowshosting) в размещающей системе. В составе пакета устанавливаются среда выполнения .NET Core, библиотека .NET Core и модуль ASP.NET Core. Более подробные инструкции см. в разделе [Публикация в IIS](/aspnet/core/publishing/iis?tabs=aspnetcore2x#iis-configuration).

    > [!NOTE]
    > Если система не подключена к Интернету, перед установкой пакета размещения .NET Core для Windows Server получите и установите *[Распространяемый компонент Microsoft Visual C++ 2015](https://www.microsoft.com/download/details.aspx?id=53840)*.

3. Перезапустите систему (или выполните в командной строке команду **net stop was /y**, а затем команду **net start w3svc**, чтобы изменение системной переменной PATH вступило в силу).

## <a name="choose-a-deployment-option"></a>Выбор варианта развертывания

Если вам нужна помощь в развертывании приложения в службах IIS, рассмотрите следующие варианты:

* Разверните, создав файл параметров публикации в IIS и импортировав параметры в Visual Studio. В некоторых сценариях это быстрый способ развертывания приложения. При создании файла параметров публикации разрешения автоматически настраиваются в службах IIS.

* Выполните развертывание путем публикации в локальной папке и копирования выходных данных предпочтительным методом в подготовленную папку приложения в службах IIS.

## <a name="optional-deploy-using-a-publish-settings-file"></a>Используемых Развертывание с помощью файла параметров публикации

С помощью этого параметра можно создать файл параметров публикации и импортировать его в Visual Studio.

> [!NOTE]
> В этом методе развертывания используется веб-развертывание. Если вы хотите настроить веб-развертывание вручную в Visual Studio вместо импорта параметров, можно установить веб-развертывание 3,6 вместо веб-развертывание 3,6 для серверов размещения. Однако при настройке веб-развертывание вручную необходимо убедиться, что в папке приложения на сервере настроены правильные значения и разрешения (см. раздел [Настройка веб-сайта ASP.NET](#BKMK_deploy_asp_net)).

### <a name="install-and-configure-web-deploy-for-hosting-servers-on-windows-server"></a>Установка и Настройка веб-развертывание для серверов размещения в Windows Server

[!INCLUDE [install-web-deploy-with-hosting-server](../deployment/includes/install-web-deploy-with-hosting-server.md)]

### <a name="create-the-publish-settings-file-in-iis-on-windows-server"></a>Создание файла параметров публикации в IIS в Windows Server

[!INCLUDE [install-web-deploy-with-hosting-server](../deployment/includes/create-publish-settings-iis.md)]

### <a name="import-the-publish-settings-in-visual-studio-and-deploy"></a>Импорт параметров публикации в Visual Studio и развертывание

[!INCLUDE [install-web-deploy-with-hosting-server](../deployment/includes/import-publish-settings-vs.md)]

После успешного развертывания приложение должно запускаться автоматически. Если приложение не запускается из Visual Studio, запустите приложение в службах IIS. Для ASP.NET Core необходимо убедиться, что в поле "Пул приложений" для **DefaultAppPool** задано значение **Без управляемого кода**.

1. В диалоговом окне **Параметры** Включите отладку, нажав кнопку **Далее**, выбрав конфигурацию **отладки** и выбрав пункт **удалить дополнительные файлы в месте назначения** в разделе Параметры **публикации файла** .

    > [!NOTE]
    > При выборе конфигурации выпуска при публикации отключается Отладка в файле *Web. config* .

1. Нажмите кнопку **сохранить** , а затем повторно опубликуйте приложение.

## <a name="optional-deploy-by-publishing-to-a-local-folder"></a>Используемых Развертывание путем публикации в локальной папке

Этот параметр можно использовать для развертывания приложения, если требуется скопировать приложение в IIS с помощью PowerShell, Robocopy или вручную скопировать файлы.

### <a name="configure-the-aspnet-core-web-site-on-the-windows-server-computer"></a><a name="BKMK_deploy_asp_net"></a>Настройка веб-сайта ASP.NET Core на компьютере Windows Server

1. Откройте проводник Windows и создайте новую папку **C:\publish**, где позже будет развернут проект ASP.NET Core.

2. Откройте **диспетчер службы IIS (IIS)**, если он еще не открыт. (В левой области диспетчер сервера выберите **IIS**. Щелкните сервер правой кнопкой мыши и выберите **Диспетчер служб IIS**.)

3. В разделе **соединения** в левой области перейдите к **узлу сайты**.

4. Выберите **веб-сайт по умолчанию**, выберите **Основные параметры**и задайте **физический путь** к **C:\publish**.

4. Щелкните правой кнопкой мыши узел **Веб-сайт по умолчанию** и выберите команду **Добавить приложение**.

5. Задайте для поля **псевдоним** значение **Мяспапп**, примите пул приложений по умолчанию (**DefaultAppPool**) и задайте для **физического пути** значение **C:\publish**.

6. В разделе **подключения**выберите **Пулы приложений**. Откройте **DefaultAppPool** и в поле пул приложений задайте значение **без управляемого кода**.

7. Щелкните правой кнопкой мыши новый сайт в диспетчере служб IIS, выберите пункт **изменить разрешения**и убедитесь, что учетная запись IUSR, IIS_IUSRS или пользователь, настроенный для доступа к веб-приложению, является полномочным пользователем с правами на чтение & выполнение.

    Если вы не видите одного из этих пользователей с доступом, выполните действия, чтобы добавить учетную запись IUSR в качестве пользователя с правами на чтение & выполнения.

### <a name="publish-and-deploy-the-app-by-publishing-to-a-local-folder-from-visual-studio"></a>Публикация и развертывание приложения путем публикации в локальной папке из Visual Studio

Можно также опубликовать и развернуть приложение с помощью файловой системы или других средств.

[!INCLUDE [remote-debugger-deploy-app-local](../debugger/includes/remote-debugger-deploy-app-local.md)]

## <a name="download-and-install-the-remote-tools-on-windows-server"></a><a name="BKMK_msvsmon"></a>Загрузка и установка средств удаленной установки на Windows Server

Скачайте версию средств удаленной подготовки, соответствующих вашей версии Visual Studio.

[!INCLUDE [remote-debugger-download](../debugger/includes/remote-debugger-download.md)]

## <a name="set-up-the-remote-debugger-on-windows-server"></a><a name="BKMK_setup"></a>Настройка удаленного отладчика в Windows Server

[!INCLUDE [remote-debugger-configuration](../debugger/includes/remote-debugger-configuration.md)]

> [!NOTE]
> Если необходимо добавить разрешения для дополнительных пользователей, изменить режим проверки подлинности или номер порта для удаленного отладчика, см. раздел [Настройка удаленного отладчика](../debugger/remote-debugging.md#configure_msvsmon).

Сведения о запуске удаленного отладчика в качестве службы см. в разделе [Запуск удаленного отладчика в качестве службы](../debugger/remote-debugging.md#bkmk_configureService).

## <a name="attach-to-the-aspnet-application-from-the-visual-studio-computer"></a><a name="BKMK_attach"></a>Подключение к приложению ASP.NET с компьютера Visual Studio

1. На компьютере Visual Studio откройте решение, которое вы пытаетесь отладить (**мяспапп** , если вы выполните все действия, описанные в этой статье).
2. В Visual Studio щелкните **отладка > присоединить к процессу** (Ctrl + Alt + P).

    > [!TIP]
    > В Visual Studio 2017 и более поздних версиях можно повторно присоединиться к тому же процессу, который был ранее присоединен к, с помощью **Debug > повторно присоединиться к процессу...** (Shift + Alt + P).

3. Задайте для ** \<поля квалификатор имя удаленного компьютера>** и нажмите клавишу **Ввод**.

    Убедитесь, что Visual Studio добавляет требуемый порт в имя компьютера, которое отображается в формате: ** \<имя удаленного компьютера>:p порт**

    ::: moniker range=">=vs-2019"
    В Visual Studio 2019 должно отобразиться ** \<имя удаленного компьютера>:4024**
    ::: moniker-end
    ::: moniker range="vs-2017"
    В Visual Studio 2017 должно отобразиться ** \<имя удаленного компьютера>:4022**
    ::: moniker-end
    Требуется указать порт. Если номер порта не отображается, добавьте его вручную.

4. Нажмите кнопку **Обновить**.
    В окне **Доступные процессы** должен появиться ряд процессов.

    Если вы не видите никаких процессов, попробуйте использовать IP-адрес вместо имени удаленного компьютера (порт является обязательным). Для получения IPv4 `ipconfig` -адреса можно использовать в командной строке.

    Если вы хотите использовать кнопку **найти** , может ПОТРЕБОВАТЬСЯ [открыть UDP-порт 3702](#bkmk_openports) на сервере.

5. Установите флажок  **Показать процессы, запущенные всеми пользователями**.

6. Введите первую букву имени процесса, чтобы быстро найти приложение.

    * Если в службах IIS используется [модель внутрипроцессного размещения](/aspnet/core/host-and-deploy/aspnet-core-module?view=aspnetcore-3.1#hosting-models) , выберите нужный процесс **w3wp. exe** . Начиная с .NET Core 3 это значение по умолчанию.

    * В противном случае выберите процесс **DotNet. exe** . (Это модель внешнего размещения.)

    Если у вас есть несколько процессов, показывающих *w3wp. exe* или *DotNet. exe*, проверьте столбец **имя пользователя** . В некоторых сценариях в столбце **имя пользователя** отображается имя пула приложений, например **IIS APPPOOL\DefaultAppPool**. Если вы видите пул приложений, но он не уникален, создайте новый именованный пул приложений для экземпляра приложения, который необходимо отладить, а затем легко найдите его в столбце **имя пользователя** .

    ::: moniker range=">=vs-2019"
    ![RemoteDBG_AttachToProcess](../debugger/media/vs-2019/remotedbg-attachtoprocess-aspnetcore.png "RemoteDBG_AttachToProcess")
    ::: moniker-end
    ::: moniker range="vs-2017"
    ![RemoteDBG_AttachToProcess](../debugger/media/remotedbg-attachtoprocess-aspnetcore.png "RemoteDBG_AttachToProcess")
    ::: moniker-end

7. Нажмите кнопку **Присоединить**.

8. Откройте веб-сайт удаленного компьютера. В браузере перейдите по адресу **http://\<имя удаленного компьютера>**.

    Должна открыться веб-страница ASP.NET.

9. В работающем приложении ASP.NET щелкните ссылку на страницу About ( **сведения** ).

    В Visual Studio должна быть достигнута точка останова.

## <a name="troubleshooting-open-required-ports-on-windows-server"></a><a name="bkmk_openports"></a> Устранение неполадок Откройте необходимые порты на Windows Server

В большинстве установок необходимые порты открываются при установке ASP.NET и удаленного отладчика. Однако может потребоваться проверка того, что порты открыты.

> [!NOTE]
> На виртуальной машине Azure необходимо открыть порты через [группу безопасности сети](/azure/virtual-machines/windows/nsg-quickstart-portal).

Требуемые порты:

* 80 — требуется для IIS
::: moniker range=">=vs-2019"
* 4024 — требуется для удаленной отладки из Visual Studio 2019 (Дополнительные сведения см. в разделе [назначение портов удаленного отладчика](../debugger/remote-debugger-port-assignments.md) ).
::: moniker-end
::: moniker range="vs-2017"
* 4022 — требуется для удаленной отладки из Visual Studio 2017 (Дополнительные сведения см. в разделе [назначение портов удаленного отладчика](../debugger/remote-debugger-port-assignments.md) ).
::: moniker-end
* Порт обнаружения UDP 3702-(необязательно) позволяет нажать кнопку **найти** при подключении к удаленному отладчику в Visual Studio.

1. Чтобы открыть порт в Windows Server, откройте меню " **Пуск** " и найдите **Брандмауэр Windows в области повышенной безопасности**.

2. Затем выберите **правила для входящих подключений > новое правило > порт**, а затем нажмите кнопку **Далее**. (Для UDP 3702 выберите вместо этого **правила исходящих подключений** .)

3. В разделе **определенные локальные порты**введите номер порта и нажмите кнопку **Далее**.

4. Щелкните **Разрешить подключение**и нажмите кнопку **Далее**.

5. Выберите один или несколько типов сетей, которые нужно включить для порта, и нажмите кнопку **Далее**.

    Выбранные типы должны включать сеть, к которой подключен удаленный компьютер.
6. Добавьте имя для правила входящего трафика (например, **IIS**, **веб-развертывание**или **msvsmon**) и нажмите кнопку **Готово**.

    Новое правило должно появиться в списке "Правила для входящих подключений" или "Правила для исходящих подключений".

    Дополнительные сведения о настройке брандмауэра Windows см. в разделе [Настройка брандмауэра Windows для удаленной отладки](../debugger/configure-the-windows-firewall-for-remote-debugging.md).

3. Создайте дополнительные правила для других требуемых портов.
