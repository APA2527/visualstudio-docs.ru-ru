---
title: Дистанционное отладка ASP.NET ядро на удаленном IIS компьютер (ru) Документы Майкрософт
ms.custom: remotedebugging
ms.date: 05/21/2018
ms.topic: conceptual
ms.assetid: 573a3fc5-6901-41f1-bc87-557aa45d8858
author: mikejo5000
ms.author: mikejo
manager: jillfra
ms.workload:
- aspnet
- dotnetcore
ms.openlocfilehash: b33ead969456935dab54c042ba4fbaf1f5ff44f4
ms.sourcegitcommit: cc58ca7ceae783b972ca25af69f17c9f92a29fc2
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/15/2020
ms.locfileid: "81385481"
---
# <a name="remote-debug-aspnet-core-on-a-remote-iis-computer-in-visual-studio"></a>Дистанционное отладка ASP.NET ядро на удаленном IIS компьютер в визуальной студии

Чтобы отладить приложение ASP.NET Core, развернутое в IIS, установите и запустите удаленные инструменты на компьютере, где вы развернули приложение, а затем прикрепите к запущенному приложению из Visual Studio.

![Компоненты дистанционного отладчика](../debugger/media/remote-debugger-aspnet.png "Remote_debugger_components")

В этом руководстве объясняется, как настроить и настроить Visual Studio ASP.NET Core, развернуть его на IIS и прикрепить удаленный отладчик из Visual Studio. Для удаленного отладки ASP.NET 4.5.2, см [ASP.NET.](../debugger/remote-debugging-aspnet-on-a-remote-iis-7-5-computer.md) Вы также можете развернуть и отладить IIS с помощью Azure. Для службы приложений Azure можно легко развернуть и отладить преднастроенный экземпляр IIS и удаленного отладчика, используя либо [Snapshot Debugger,](../debugger/debug-live-azure-applications.md) либо [прикрепив отладчик от Server Explorer.](../debugger/remote-debugging-azure.md)

## <a name="prerequisites"></a>Предварительные требования

::: moniker range=">=vs-2019"
Visual Studio 2019 обязан следовать шагам, показанным в этой статье.
::: moniker-end
::: moniker range="vs-2017"
Visual Studio 2017 обязан следовать шагам, показанным в этой статье.
::: moniker-end

Эти процедуры были протестированы на этих конфигурациях серверов:
* Windows Server 2012 R2 и IIS 8
* Windows Server 2016 и IIS 10

## <a name="network-requirements"></a>Требования к сети

Отладка между двумя компьютерами, подключенными через прокси, не поддерживается. Не рекомендуется отладка из-за высокой задержки или соединения с низкой пропускной способностью, например, в Интернете или через Интернет в разных странах, и может привести к сбою или недопустимо медленной. Полный список требований [можно](../debugger/remote-debugging.md#requirements_msvsmon)узнать на примере требований.

## <a name="app-already-running-in-iis"></a>Приложение уже работает в IIS?

Эта статья включает шаги по настройке базовой конфигурации IIS на сервере Windows и развертыванию приложения из Visual Studio. Эти шаги включены, чтобы убедиться, что сервер имеет необходимые компоненты установлены, что приложение может работать правильно, и что вы готовы к удаленной отладки.

* Если ваше приложение работает в IIS, и вы просто хотите скачать удаленный отладчик и начать отладку, перейдите на [загрузку и установку удаленных инструментов на Windows Server.](#BKMK_msvsmon)

* Если требуется помочь убедиться, что ваше приложение настроено, развернуто и работает правильно в IIS, чтобы можно было отладиться, выполните все действия в этой теме.

## <a name="create-the-aspnet-core-application-on-the-visual-studio-computer"></a>Создание приложения ASP.NET Core на компьютере Visual Studio

1. Создайте новое веб-приложение ASP.NET Core. 

    ::: moniker range=">=vs-2019"
    В Visual Studio 2019 введите **Ctrl,** чтобы открыть окно поиска, введите **asp.net,** выберите **шаблоны,** затем выберите **Создать новое ASP.NET основное веб-приложение.** В диалоговом окне, который появляется, назовите проект **MyASPApp,** а затем выберите **Создать**. Затем выберите **веб-приложение (Model-View-Controller),** а затем выберите **Создать**.
    ::: moniker-end
    ::: moniker range="vs-2017"
    В Visual Studio 2017 выберите **Файл > New > Project,** а затем выберите Visual **C'> Web > ASP.NET Core Web Application.** В разделе ASP.NET шаблонов «основные» — выберите **веб-приложение (Model-View-Controller).** Убедитесь, что ASP.NET Core 2.1 выбран, что **поддержка Enable Docker** не выбрана и что **аутентификация** не установлена **в ней.** Назовите проект **MyASPApp**.
    ::: moniker-end

4. Откройте About.cshtml.cs файл и установите `OnGet` точку разрыва в методе (в старых `About()` шаблонах, откройте вместо этого HomeController.cs и установите точку разрыва в методе).

## <a name="install-and-configure-iis-on-windows-server"></a><a name="bkmk_configureIIS"></a>Установка и настройка IIS на Сервере Windows

[!INCLUDE [remote-debugger-install-iis-role](../debugger/includes/remote-debugger-install-iis-role.md)]

## <a name="update-browser-security-settings-on-windows-server"></a>Обновление настроек безопасности браузера на Windows Server

Если расширенная конфигурация безопасности включена в Internet Explorer (она включена по умолчанию), то может потребоваться добавить некоторые домены в качестве надежных сайтов, чтобы вы могли загрузить некоторые компоненты веб-сервера. Добавить доверенные сайты, перейдя в **Интернет варианты > безопасности > надежных сайтов > сайтов**. Добавьте следующие домены.

- microsoft.com
- сайт go.microsoft.com;
- download.microsoft.com
- iis.net

При загрузке программного обеспечения, вы можете получить запросы на предоставление разрешения на загрузку различных сценариев веб-сайта и ресурсов. Некоторые из этих ресурсов не требуются, но для упрощения процесса нажмите **Добавить,** когда это вызвано.

## <a name="install-aspnet-core-on-windows-server"></a>Установка ASP.NET ядра на сервере Windows

1. Установите [пакет размещения .NET Core для Windows Server](https://aka.ms/dotnetcore-2-windowshosting) в размещающей системе. В составе пакета устанавливаются среда выполнения .NET Core, библиотека .NET Core и модуль ASP.NET Core. Для получения более подробных инструкций [см.](/aspnet/core/publishing/iis?tabs=aspnetcore2x#iis-configuration)

    > [!NOTE]
    > Если система не подключена к Интернету, перед установкой пакета размещения .NET Core для Windows Server получите и установите *[Распространяемый компонент Microsoft Visual C++ 2015](https://www.microsoft.com/download/details.aspx?id=53840)*.

3. Перезапустите систему (или выполните в командной строке команду **net stop was /y**, а затем команду **net start w3svc**, чтобы изменение системной переменной PATH вступило в силу).

## <a name="choose-a-deployment-option"></a>Выберите опцию развертывания

Если вам нужна помощь для развертывания приложения в IIS, рассмотрим следующие варианты:

* Развертывание путем создания файла параметров публикации в IIS и импорта настроек в Visual Studio. В некоторых сценариях это быстрый способ развертывания приложения. При создании файла параметров публикации разрешения автоматически настраиваются в IIS.

* Развертывание путем публикации в локальной папке и копирования вывода предпочтительным методом в подготовленную папку приложения на IIS.

## <a name="optional-deploy-using-a-publish-settings-file"></a>(Необязательно) Развертывание с помощью файла параметров публикации

Эту опцию можно использовать для создания файла параметров публикации и импорта в Visual Studio.

> [!NOTE]
> Этот метод развертывания использует Web Deploy. Если вы хотите настроить Web Deploy вручную в Visual Studio вместо импорта настроек, можно установить Web Deploy 3.6 вместо Web Deploy 3.6 для хостинговых серверов. Однако при настройке Web Deploy вручную необходимо убедиться, что папка приложения на сервере настроена с правильными значениями и разрешениями [(см. Настройка ASP.NET веб-сайте).](#BKMK_deploy_asp_net)

### <a name="install-and-configure-web-deploy-for-hosting-servers-on-windows-server"></a>Установка и настройка веб-развертывания для хостинга серверов на Сервере Windows

[!INCLUDE [install-web-deploy-with-hosting-server](../deployment/includes/install-web-deploy-with-hosting-server.md)]

### <a name="create-the-publish-settings-file-in-iis-on-windows-server"></a>Создание файла параметров публикации в IIS в Windows Server

[!INCLUDE [install-web-deploy-with-hosting-server](../deployment/includes/create-publish-settings-iis.md)]

### <a name="import-the-publish-settings-in-visual-studio-and-deploy"></a>Импорт параметров публикации в Visual Studio и развертывание

[!INCLUDE [install-web-deploy-with-hosting-server](../deployment/includes/import-publish-settings-vs.md)]

После успешного развертывания приложение должно запускаться автоматически. Если приложение не начинается с Visual Studio, запустите приложение в IIS. Для ASP.NET Core необходимо убедиться, что в поле "Пул приложений" для **DefaultAppPool** задано значение **Без управляемого кода**.

1. В диалоговом поле **«Настройки»** включите отладку, нажав **кнопку Next,** выберите конфигурацию **Debug,** а затем выберите **Удалить дополнительные файлы в пункте назначения** под параметры **Публикации файлов.**

    > [!NOTE]
    > Если вы выберете конфигурацию Release, вы отделаете отладку в файле *web.config* при публикации.

1. Нажмите **Сохранить,** а затем переиздать приложение.

## <a name="optional-deploy-by-publishing-to-a-local-folder"></a>(Необязательно) Развертывание путем публикации в локальной папке

Эту опцию можно использовать для развертывания приложения, если вы хотите скопировать приложение в IIS с помощью PowerShell, RoboCopy, или вы хотите вручную скопировать файлы.

### <a name="configure-the-aspnet-core-web-site-on-the-windows-server-computer"></a><a name="BKMK_deploy_asp_net"></a>Настройка веб-сайта ASP.NET Core на компьютере Windows Server

1. Откройте Windows Explorer и создайте новую **папку, C:'Опубликовать**, где вы позже развернете проект ASP.NET Core.

2. Если он еще не открыт, откройте **менеджер интернет-информационных служб (IIS).** (В левом стеле серверного менеджера выберите **IIS**. Щелкните сервер правой кнопкой мыши и выберите **Диспетчер служб IIS**.)

3. Под **соединениями** в левой панели, перейдите на **сайты**.

4. Выберите **веб-узел по умолчанию,** выберите **основные настройки**и установите **физический путь** к **C: «Опубликовать**.

4. Щелкните правой кнопкой мыши узел **Веб-сайт по умолчанию** и выберите команду **Добавить приложение**.

5. Установите поле **Alias** в **MyASPApp,** примите пул приложений по умолчанию **(DefaultAppPool),** и установите **физический путь** к **C:»Опубликовать**.

6. Под **соединениями**выберите **Пулы приложений.** Откройте **DefaultAppPool** и установите поле пула приложений **в No Managed Code.**

7. Нажмите на новый сайт в IIS Manager, выберите **разрешения на редакцию**и убедитесь, что IUSR, IIS_IUSRS или пользователь, настроенный для доступа к веб-приложению, является авторизованным пользователем с правами Read & Execute.

    Если вы не видите одного из этих пользователей с доступом, пройдите через шаги, чтобы добавить IUSR в качестве пользователя с правами Read & Execute.

### <a name="publish-and-deploy-the-app-by-publishing-to-a-local-folder-from-visual-studio"></a>Опубликовать и развернуть приложение путем публикации в локальную папку из Visual Studio

Вы также можете опубликовать и развернуть приложение с помощью файловой системы или других инструментов.

[!INCLUDE [remote-debugger-deploy-app-local](../debugger/includes/remote-debugger-deploy-app-local.md)]

## <a name="download-and-install-the-remote-tools-on-windows-server"></a><a name="BKMK_msvsmon"></a>Скачать и установить удаленные инструменты на Сервере Windows

Загрузите версию удаленных инструментов, которая соответствует вашей версии Visual Studio.

[!INCLUDE [remote-debugger-download](../debugger/includes/remote-debugger-download.md)]

## <a name="set-up-the-remote-debugger-on-windows-server"></a><a name="BKMK_setup"></a>Настройка удаленного отладчика на Сервере Windows

[!INCLUDE [remote-debugger-configuration](../debugger/includes/remote-debugger-configuration.md)]

> [!NOTE]
> Если вам необходимо добавить разрешения для дополнительных пользователей, измените режим проверки подлинности или номер порта для удаленного [отладчика, см.](../debugger/remote-debugging.md#configure_msvsmon)

Для получения информации о запуске удаленного отладчика в качестве службы [см.](../debugger/remote-debugging.md#bkmk_configureService)

## <a name="attach-to-the-aspnet-application-from-the-visual-studio-computer"></a><a name="BKMK_attach"></a>Прикрепите к ASP.NET приложению с компьютера Visual Studio

1. На компьютере Visual Studio откройте решение, которое вы пытаетесь отладить **(MyASPApp,** если вы следуете всем шагам в этой статье).
2. В Visual Studio щелкните **Debug > приложите к процессу** (Ctrl и Alt и P).

    > [!TIP]
    > В Visual Studio 2017 и более поздних версиях вы можете прикрепить его к тому же процессу, к который вы ранее прикреплялись, используя **Debug > Reattach к процессу...** (Shift и Alt s P).

3. Установите поле квалификации на ** \<удаленное имя компьютера>** и нажмите **Enter.**

    Проверить, что Visual Studio добавляет необходимый порт к названию компьютера, который появляется в формате: ** \<удаленное имя компьютера>:port**

    ::: moniker range=">=vs-2019"
    На Visual Studio 2019, вы должны увидеть ** \<удаленное имя компьютера>:4024**
    ::: moniker-end
    ::: moniker range="vs-2017"
    На Visual Studio 2017 вы должны увидеть ** \<удаленное имя компьютера>:4022**
    ::: moniker-end
    Порт необходим. Если вы не видите номер порта, добавьте его вручную.

4. Нажмите кнопку **Обновить**.
    В окне **Доступные процессы** должен появиться ряд процессов.

    Если вы не видите никаких процессов, попробуйте использовать IP-адрес вместо имени удаленного компьютера (требуется порт). Вы можете `ipconfig` использовать в командной строке, чтобы получить адрес IPv4.

    Если вы хотите использовать кнопку **«Найти»,** возможно, потребуется [открыть порт UDP 3702](#bkmk_openports) на сервере.

5. Установите флажок  **Показать процессы, запущенные всеми пользователями**.

6. Введите первую букву названия процесса, чтобы быстро найти приложение.

    * Если вы используете [модель хостинга в приложении](/aspnet/core/host-and-deploy/aspnet-core-module?view=aspnetcore-3.1#hosting-models) на IIS, выберите правильный процесс **w3wp.exe.** Начиная с .NET Core 3, это по умолчанию.

    * В противном случае выберите процесс **dotnet.exe.** (Это внепроцессная модель хостинга.)

    Если у вас есть несколько процессов, показывающих *w3wp.exe* или *dotnet.exe,* проверьте столбец **имени пользователя.** В некоторых сценариях в столбце **«Имя пользователя»** отображается имя пула приложений, например **IIS APPPOOL-DefaultAppPool.** Если вы видите пул приложений, но он не уникален, создайте новый пул приложений для экземпляра приложения, который вы хотите отладить, и тогда вы можете легко найти его в столбце **имени пользователя.**

    ::: moniker range=">=vs-2019"
    ![RemoteDBG_AttachToProcess](../debugger/media/vs-2019/remotedbg-attachtoprocess-aspnetcore.png "RemoteDBG_AttachToProcess")
    ::: moniker-end
    ::: moniker range="vs-2017"
    ![RemoteDBG_AttachToProcess](../debugger/media/remotedbg-attachtoprocess-aspnetcore.png "RemoteDBG_AttachToProcess")
    ::: moniker-end

7. Нажмите кнопку **Присоединить**.

8. Откройте веб-сайт удаленного компьютера. В браузере перейдите по адресу **http://\<имя удаленного компьютера>**.

    Должна открыться веб-страница ASP.NET.

9. В запущенном ASP.NET приложении щелкните по ссылке на страницу **«О».**

    В Visual Studio должна быть достигнута точка останова.

## <a name="troubleshooting-open-required-ports-on-windows-server"></a><a name="bkmk_openports"></a> Устранение неполадок Откройте необходимые порты на Windows Server

В большинстве установок требуемые порты открываются путем установки ASP.NET и удаленного отладчика. Тем не менее, вам может потребоваться проверить, что порты открыты.

> [!NOTE]
> На Azure VM необходимо открыть порты через [группу безопасности Сети.](/azure/virtual-machines/windows/nsg-quickstart-portal)

Обязательные порты:

* 80 - Требуется для IIS
::: moniker range=">=vs-2019"
* 4024 - Требуется для удаленной отладки от Visual Studio 2019 (см. [Удаленные назначения порта Debugger](../debugger/remote-debugger-port-assignments.md) для получения дополнительной информации).
::: moniker-end
::: moniker range="vs-2017"
* 4022 - Требуется для удаленной отладки от Visual Studio 2017 (см. [Удаленные назначения порта Debugger](../debugger/remote-debugger-port-assignments.md) для получения дополнительной информации).
::: moniker-end
* UDP 3702 - (Опциональный) порт Discovery позволяет вам кнопку **"Найти"** при подключении к удаленному отладчику в Visual Studio.

1. Чтобы открыть порт на Windows Server, откройте меню **«Пуск»,** ищите **Windows Firewall с помощью Расширенной безопасности.**

2. Затем выберите **входящие правила > новое правило > порт,** а затем нажмите **Далее**. (Для UDP 3702 выберите вместо этого **правила выезда.)**

3. В **специальных локальных портах**введите номер порта, нажмите **Далее.**

4. Нажмите **Разрешить подключение,** нажмите **далее**.

5. Выберите один или несколько типов сетей, чтобы включить порт и нажмите **Далее.**

    Выбранные типы должны включать сеть, к которой подключен удаленный компьютер.
6. Добавьте имя (например, **IIS,** **Web Deploy**или **msvsmon)** для входящего правила и нажмите **«Закончить».**

    Новое правило должно появиться в списке "Правила для входящих подключений" или "Правила для исходящих подключений".

    Если вам нужны более подробную информацию о настройке Windows Firewall, [см.](../debugger/configure-the-windows-firewall-for-remote-debugging.md)

3. Создайте дополнительные правила для других требуемых портов.
