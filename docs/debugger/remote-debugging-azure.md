---
title: Дистанционное отладка ASP.NET ядра на IIS и Azure (ru) Документы Майкрософт
ms.custom: remotedebugging
ms.date: 04/14/2020
ms.topic: conceptual
ms.assetid: a6c04b53-d1b9-4552-a8fd-3ed6f4902ce6
author: mikejo5000
ms.author: mikejo
manager: jillfra
ms.workload:
- aspnet
- dotnetcore
- azure
ms.openlocfilehash: 079e324f2304118c9041118c13e8ebc0cce2015c
ms.sourcegitcommit: cc58ca7ceae783b972ca25af69f17c9f92a29fc2
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/15/2020
ms.locfileid: "81385497"
---
# <a name="remote-debug-aspnet-core-on-iis-in-azure-in-visual-studio"></a>Дистанционное отладка ASP.NET ядро на IIS в Azure в визуальной студии

В этом руководстве объясняется, как настроить и настроить приложение Visual Studio ASP.NET Core, развернуть его в IIS с помощью Azure и прикрепить удаленный отладчик из Visual Studio.

Рекомендуемый способ удаленного отладки на Azure зависит от вашего сценария:

* Чтобы отладить ASP.NET Core в службе приложений Azure, см. [приложения Debug Azure с помощью snapshot Debugger.](../debugger/debug-live-azure-applications.md) Рекомендуем использовать этот метод.
* Чтобы отладить ASP.NET Core на Службе приложений Azure, используя более традиционные функции отладки, выполните последующие действия в этой теме (см. раздел [«Удаленная отладка» в службе приложений Azure).](#remote_debug_azure_app_service)

    В этом случае необходимо развернуть приложение из Visual Studio в Azure, но вам не нужно вручную устанавливать или настраивать IIS или удаленный отладчик (эти компоненты представлены пунктирными линиями), как показано на следующей иллюстрации.

    ![Компоненты дистанционного отладчика](../debugger/media/remote-debugger-azure-app-service.png "Remote_debugger_components")

* Чтобы отладить IIS на Azure VM, выполните последующие шаги в этой теме (см. раздел [Удаленное отладка на Azure VM).](#remote_debug_azure_vm) Это позволяет использовать настраиваемую конфигурацию IIS, но шаги по настройке и развертыванию являются более сложными.

    Для Azure VM необходимо развернуть приложение из Visual Studio в Azure, а также вручную установить роль IIS и удаленный отладчик, как показано на следующей иллюстрации.

    ![Компоненты дистанционного отладчика](../debugger/media/remote-debugger-azure-vm.png "Remote_debugger_components")

* Чтобы отладить ASP.NET Core на функции службы Azure Fabric, [см.](/azure/service-fabric/service-fabric-debugging-your-application#debug-a-remote-service-fabric-application)

> [!WARNING]
> Обязательно удалите ресурсы Azure, которые вы создаете, когда вы завершили шаги в этом учебнике. Таким образом, вы можете избежать ненужных сборов.

## <a name="prerequisites"></a>Предварительные требования

::: moniker range=">=vs-2019"
Visual Studio 2019 обязан следовать шагам, показанным в этой статье.
::: moniker-end
::: moniker range="vs-2017"
Visual Studio 2017 обязан следовать шагам, показанным в этой статье.
::: moniker-end

### <a name="network-requirements"></a>Требования к сети

Отладка между двумя компьютерами, подключенными через прокси, не поддерживается. Не рекомендуется отладка из-за высокой задержки или соединения с низкой пропускной способностью, например, в Интернете или через Интернет в разных странах, и она может вывести из строя или быть неприемлемо медленной. Полный список требований [можно](../debugger/remote-debugging.md#requirements_msvsmon)узнать на примере требований.

## <a name="create-the-aspnet-core-application-on-the-visual-studio-computer"></a>Создание приложения ASP.NET Core на компьютере Visual Studio

1. Создайте новое приложение ASP.NET Core.

    ::: moniker range=">=vs-2019"
    В Visual Studio 2019 введите **Ctrl,** чтобы открыть окно поиска, введите **asp.net,** выберите **шаблоны,** затем выберите **Создать новое ASP.NET основное веб-приложение.** В диалоговом окне, который появляется, назовите проект **MyASPApp,** а затем выберите **Создать**. Затем выберите **веб-приложение (Model-View-Controller),** а затем выберите **Создать**.
    ::: moniker-end
    ::: moniker range="vs-2017"
    В Visual Studio 2017 выберите **Файл > New > Project,** а затем выберите Visual **C'> Web > ASP.NET Core Web Application.** В разделе ASP.NET шаблонов «основные» — выберите **веб-приложение (Model-View-Controller).** Убедитесь, что ASP.NET Core 2.1 выбран, что **поддержка Enable Docker** не выбрана и что **аутентификация** не установлена **в ней.** Назовите проект **MyASPApp**.
    ::: moniker-end

1. Откройте About.cshtml.cs файл и установите `OnGet` точку разрыва в методе (в старых `About()` шаблонах, откройте вместо этого HomeController.cs и установите точку разрыва в методе).

## <a name="remote-debug-aspnet-core-on-an-azure-app-service"></a><a name="remote_debug_azure_app_service"></a>Дистанционное отладка ASP.NET ядро в службе приложений Azure

От Visual Studio можно быстро опубликовать и отладить приложение до полностью подготовленного экземпляра IIS. Тем не менее, конфигурация IIS является предустановленной, и вы не можете настроить его. Для получения более подробных инструкций [см. Развертывание веб-приложения ASP.NET Core в Azure с помощью Visual Studio.](/aspnet/core/tutorials/publish-to-azure-webapp-using-vs) (Если вам нужна возможность настроить IIS, попробуйте отладку на [Azure VM](#remote_debug_azure_vm).)

#### <a name="to-deploy-the-app-and-remote-debug-using-cloud-explorer"></a>Развертывание приложения и удаленная отладка с помощью Cloud Explorer

1. В Visual Studio, правой кнопкой мыши узла проекта и выбрать **Публикация**.

    Если ранее вы настроили какие-либо профили публикации, появится панель **Опубликовать**. Нажмите **новый профиль**.

1. Выберите **службу приложений Azure** из окна диалога **Publish,** выберите **«Создайте новое»** и следуйте запросам для создания профиля.

    Подробные инструкции см. в разделе [Развертывание веб-приложения ASP.NET Core в Azure с помощью Visual Studio](/aspnet/core/tutorials/publish-to-azure-webapp-using-vs).

    ![Опубликовать в Службе приложений Azure](../debugger/media/remotedbg_azure_app_service_profile.png)

1. В окне публикации выберите **конфигурацию «Изменить»** и переключитесь на конфигурацию Debug, а затем выберите **Publish**.

   Для отладки приложения требуется конфигурация Debug.

1. Open **Cloud Explorer** **(Посмотреть** > Cloud**Explorer),** нажмите на экземпляр службы приложений и выберите **Прикрепить Debugger**.

   Если Cloud Explorer недоступен, откройте Server Explorer. Затем нажмите на экземпляр службы приложений в Server Explorer и выберите **Прикрепить Debugger.**

1. В запущенном ASP.NET приложении щелкните по ссылке на страницу **«О».**

    В Visual Studio должна быть достигнута точка останова.

    Вот и все! Остальные шаги в этой теме применяются к удаленной отладке на Azure VM.

## <a name="remote-debug-aspnet-core-on-an-azure-vm"></a><a name="remote_debug_azure_vm"></a>Дистанционное отладка ASP.NET ядро на Azure VM

Можно создать VM Azure для Windows Server, а затем установить и настроить IIS и другие необходимые компоненты программного обеспечения. Это занимает больше времени, чем развертывание в службе приложений Azure, и требует, чтобы вы следовали оставшимся шагам в этом учебнике.

Эти процедуры были протестированы на этих конфигурациях серверов:
* Windows Server 2012 R2 и IIS 8
* Windows Server 2016 и IIS 10

### <a name="app-already-running-in-iis-on-the-azure-vm"></a>Приложение уже работает в IIS на Azure VM?

Эта статья включает шаги по настройке базовой конфигурации IIS на сервере Windows и развертыванию приложения из Visual Studio. Эти шаги включены, чтобы убедиться, что сервер имеет необходимые компоненты установлены, что приложение может работать правильно, и что вы готовы к удаленной отладки.

* Если ваше приложение работает в IIS, и вы просто хотите скачать удаленный отладчик и начать отладку, перейдите на [загрузку и установку удаленных инструментов на Windows Server.](#BKMK_msvsmon)

* Если требуется помочь убедиться, что ваше приложение настроено, развернуто и работает правильно в IIS, чтобы можно было отладиться, выполните все действия в этой теме.

  * Прежде чем начать, выполните все шаги, описанные в [Install и запустить IIS](/azure/virtual-machines/windows/quick-create-portal).

  * При открытии порта 80 в группе безопасности Сети также откройте [правильный порт](#bkmk_openports) для удаленного отладчика (4024 или 4022). Таким образом, вам не придется открывать его позже.

### <a name="update-browser-security-settings-on-windows-server"></a>Обновление настроек безопасности браузера на Windows Server

Если расширенная конфигурация безопасности включена в Internet Explorer (она включена по умолчанию), то может потребоваться добавить некоторые домены в качестве надежных сайтов, чтобы вы могли загрузить некоторые компоненты веб-сервера. Добавить доверенные сайты, перейдя в **Интернет варианты > безопасности > надежных сайтов > сайтов**. Добавьте следующие домены.

- microsoft.com
- сайт go.microsoft.com;
- download.microsoft.com
- iis.net

При загрузке программного обеспечения, вы можете получить запросы на предоставление разрешения на загрузку различных сценариев веб-сайта и ресурсов. Некоторые из этих ресурсов не требуются, но для упрощения процесса нажмите **Добавить,** когда это вызвано.

### <a name="install-aspnet-core-on-windows-server"></a>Установка ASP.NET ядра на сервере Windows

1. Установите [пакет размещения .NET Core для Windows Server](https://aka.ms/dotnetcore-2-windowshosting) в размещающей системе. В составе пакета устанавливаются среда выполнения .NET Core, библиотека .NET Core и модуль ASP.NET Core. Для получения более подробных инструкций [см.](/aspnet/core/publishing/iis?tabs=aspnetcore2x#iis-configuration)

    > [!NOTE]
    > Если система не подключена к Интернету, перед установкой пакета размещения .NET Core для Windows Server получите и установите *[Распространяемый компонент Microsoft Visual C++ 2015](https://www.microsoft.com/download/details.aspx?id=53840)*.

3. Перезапустите систему (или выполните в командной строке команду **net stop was /y**, а затем команду **net start w3svc**, чтобы изменение системной переменной PATH вступило в силу).

## <a name="choose-a-deployment-option"></a>Выберите опцию развертывания

Если вам нужна помощь для развертывания приложения в IIS, рассмотрим следующие варианты:

* Развертывание путем создания файла параметров публикации в IIS и импорта настроек в Visual Studio. В некоторых сценариях это быстрый способ развертывания приложения. При создании файла параметров публикации разрешения автоматически настраиваются в IIS.

* Развертывание путем публикации в локальной папке и копирования вывода предпочтительным методом в подготовленную папку приложения на IIS.

## <a name="optional-deploy-using-a-publish-settings-file"></a>(Необязательно) Развертывание с помощью файла параметров публикации

Эту опцию можно использовать для создания файла параметров публикации и импорта в Visual Studio.

> [!NOTE]
> Этот метод развертывания использует Web Deploy. Если вы хотите настроить Web Deploy вручную в Visual Studio вместо импорта настроек, можно установить Web Deploy 3.6 вместо Web Deploy 3.6 для хостинговых серверов. Однако при настройке Web Deploy вручную необходимо убедиться, что папка приложения на сервере настроена с правильными значениями и разрешениями [(см. Настройка ASP.NET веб-сайте).](#BKMK_deploy_asp_net)

### <a name="install-and-configure-web-deploy-for-hosting-servers-on-windows-server"></a>Установка и настройка веб-развертывания для хостинга серверов на Сервере Windows

[!INCLUDE [install-web-deploy-with-hosting-server](../deployment/includes/install-web-deploy-with-hosting-server.md)]

### <a name="create-the-publish-settings-file-in-iis-on-windows-server"></a>Создание файла параметров публикации в IIS в Windows Server

[!INCLUDE [install-web-deploy-with-hosting-server](../deployment/includes/create-publish-settings-iis.md)]

### <a name="import-the-publish-settings-in-visual-studio-and-deploy"></a>Импорт параметров публикации в Visual Studio и развертывание

[!INCLUDE [install-web-deploy-with-hosting-server](../deployment/includes/import-publish-settings-vs.md)]

После успешного развертывания приложение должно запускаться автоматически. Если приложение не начинается с Visual Studio, запустите приложение в IIS. Для ASP.NET Core необходимо убедиться, что в поле "Пул приложений" для **DefaultAppPool** задано значение **Без управляемого кода**.

1. В диалоговом поле **«Настройки»** включите отладку, нажав **кнопку Next,** выберите конфигурацию **Debug,** а затем выберите **Удалить дополнительные файлы в пункте назначения** под параметры **Публикации файлов.**

    > [!NOTE]
    > Если вы выберете конфигурацию Release, вы отделаете отладку в файле *web.config* при публикации.

1. Нажмите **Сохранить,** а затем переиздать приложение.

## <a name="optional-deploy-by-publishing-to-a-local-folder"></a>(Необязательно) Развертывание путем публикации в локальной папке

Эту опцию можно использовать для развертывания приложения, если вы хотите скопировать приложение в IIS с помощью PowerShell, RoboCopy, или вы хотите вручную скопировать файлы.

### <a name="configure-the-aspnet-core-web-site-on-the-windows-server-computer"></a><a name="BKMK_deploy_asp_net"></a>Настройка веб-сайта ASP.NET Core на компьютере Windows Server

Если вы импортируете настройки публикации, вы можете пропустить этот раздел.

1. Откройте **Диспетчер служб IIS** и перейдите к разделу **Сайты**.

2. Щелкните правой кнопкой мыши узел **Веб-сайт по умолчанию** и выберите команду **Добавить приложение**.

3. Установите поле **Alias** в **MyASPApp** и поле пула приложений **в No Managed Code.** Установите **физический путь** на **C:«Опубликовать** (где позже вы развернете проект ASP.NET Core).

4. С помощью сайта, выбранного в IIS Manager, выберите **разрешения на отображее**и убедитесь, что IUSR, IIS_IUSRS или пользователь, настроенный для пула приложений, является авторизованным пользователем с правами Read & Execute.

    Если вы не видите одного из этих пользователей с доступом, пройдите через шаги, чтобы добавить IUSR в качестве пользователя с правами Read & Execute.

### <a name="optional-publish-and-deploy-the-app-by-publishing-to-a-local-folder-from-visual-studio"></a>(Необязательно) Опубликовать и развернуть приложение путем публикации в локальную папку из Visual Studio

Если вы не используете Web Deploy, необходимо опубликовать и развернуть приложение с помощью файловой системы или других инструментов. Вы можете начать с создания пакета с помощью файловой системы, а затем либо развернуть пакет вручную или использовать другие инструменты, такие как PowerShell, RoboCopy, или XCopy. В этом разделе мы предполагаем, что вы вручную копируете пакет, если вы не используете Web Deploy.

[!INCLUDE [remote-debugger-deploy-app-local](../debugger/includes/remote-debugger-deploy-app-local.md)]

### <a name="download-and-install-the-remote-tools-on-windows-server"></a><a name="BKMK_msvsmon"></a>Скачать и установить удаленные инструменты на Сервере Windows

Загрузите версию удаленных инструментов, которая соответствует вашей версии Visual Studio.

[!INCLUDE [remote-debugger-download](../debugger/includes/remote-debugger-download.md)]

### <a name="set-up-the-remote-debugger-on-windows-server"></a><a name="BKMK_setup"></a>Настройка удаленного отладчика на Сервере Windows

[!INCLUDE [remote-debugger-configuration](../debugger/includes/remote-debugger-configuration.md)]

> [!NOTE]
> Если вам необходимо добавить разрешения для дополнительных пользователей, измените режим проверки подлинности или номер порта для удаленного [отладчика, см.](../debugger/remote-debugging.md#configure_msvsmon)

### <a name="attach-to-the-aspnet-application-from-the-visual-studio-computer"></a><a name="BKMK_attach"></a>Прикрепите к ASP.NET приложению с компьютера Visual Studio

1. На компьютере Visual Studio откройте решение, которое вы пытаетесь отладить **(MyASPApp,** если вы следуете за шагами в этой статье).
2. В Visual Studio щелкните **Debug > приложите к процессу** (Ctrl и Alt и P).

    > [!TIP]
    > В Visual Studio 2017 и более поздних версиях вы можете повторно прикрепить к тому же процессу, к который вы ранее прикреплялись, используя **Debug > Reattach к процессу...** (Shift-Alt-P).

3. Установите поле квалификации на ** \<удаленное имя компьютера>** и нажмите **Enter.**

    Проверить, что Visual Studio добавляет необходимый порт к названию компьютера, который появляется в формате: ** \<удаленное имя компьютера>:port**

    ::: moniker range=">=vs-2019"
    На Visual Studio 2019, вы должны увидеть ** \<удаленное имя компьютера>:4024**
    ::: moniker-end
    ::: moniker range="vs-2017"
    На Visual Studio 2017 вы должны увидеть ** \<удаленное имя компьютера>:4022**
    ::: moniker-end
    Порт необходим. Если вы не видите номер порта, добавьте его вручную.

4. Нажмите кнопку **Обновить**.
    В окне **Доступные процессы** должен появиться ряд процессов.

    Если вы не видите никаких процессов, попробуйте использовать IP-адрес вместо имени удаленного компьютера (требуется порт). Вы можете `ipconfig` использовать в командной строке, чтобы получить адрес IPv4.

    Если вы хотите использовать кнопку **«Найти»,** возможно, потребуется [открыть порт UDP 3702](#bkmk_openports) на сервере.

5. Установите флажок  **Показать процессы, запущенные всеми пользователями**.

6. Введите первую букву названия процесса, чтобы быстро найти приложение.

    * Выберите **dotnet.exe** (для .NET Core)

      Если у вас есть несколько процессов, **показывающих dotnet.exe,** проверьте столбец **имени пользователя.** В некоторых сценариях в столбце **«Имя пользователя»** отображается имя пула приложений, например **IIS APPPOOL-DefaultAppPool.** Если вы видите пул приложений, простой способ определить правильный процесс заключается в создании нового названного пула приложений для экземпляра приложения, который вы хотите отладить, и тогда вы можете легко найти его в столбце **имени пользователя.**

    * В некоторых сценариях IIS вы можете найти имя приложения в списке процессов, например **MyASPApp.exe.** Вы можете прикрепить к этому процессу вместо.

    ::: moniker range=">=vs-2019"
    ![RemoteDBG_AttachToProcess](../debugger/media/vs-2019/remotedbg-attachtoprocess-aspnetcore.png "RemoteDBG_AttachToProcess")
    ::: moniker-end
    ::: moniker range="vs-2017"
    ![RemoteDBG_AttachToProcess](../debugger/media/remotedbg-attachtoprocess-aspnetcore.png "RemoteDBG_AttachToProcess")
    ::: moniker-end

7. Нажмите кнопку **Присоединить**.

8. Откройте веб-сайт удаленного компьютера. В браузере перейдите по адресу **http://\<имя удаленного компьютера>**.

    Должна открыться веб-страница ASP.NET.
9. В запущенном ASP.NET приложении щелкните по ссылке на страницу **«О».**

    В Visual Studio должна быть достигнута точка останова.

### <a name="troubleshooting-open-required-ports-on-windows-server"></a><a name="bkmk_openports"></a> Устранение неполадок Откройте необходимые порты на Windows Server

В большинстве установок требуемые порты открываются путем установки ASP.NET и удаленного отладчика. Однако, если у вас возникли проблемы с развертыванием и приложение размещается за брандмауэром, возможно, потребуется убедиться, что правильные порты открыты.

На Azure VM необходимо открыть порты через [группу безопасности Сети.](/azure/virtual-machines/windows/nsg-quickstart-portal)

Обязательные порты:

* 80 - Требуется для IIS
::: moniker range=">=vs-2019"
* 4024 - Требуется для удаленной отладки от Visual Studio 2019 (см. [Удаленные назначения порта Debugger](../debugger/remote-debugger-port-assignments.md) для получения дополнительной информации).
::: moniker-end
::: moniker range="vs-2017"
* 4022 - Требуется для удаленной отладки от Visual Studio 2017 (см. [Удаленные назначения порта Debugger](../debugger/remote-debugger-port-assignments.md) для получения дополнительной информации).
::: moniker-end
* UDP 3702 - (Опциональный) порт Discovery позволяет вам кнопку **"Найти"** при подключении к удаленному отладчику в Visual Studio.

Кроме того, эти порты уже должны быть открыты ASP.NET установкой:
- 8172 - (Необязательно) Требуется для веб-развертывания для развертывания приложения из Visual Studio
