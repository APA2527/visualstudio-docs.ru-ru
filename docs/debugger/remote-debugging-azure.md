---
title: Удаленная отладка ASP.NET Core в IIS и Azure | Документация Майкрософт
ms.custom: remotedebugging
ms.date: 05/21/2018
ms.topic: conceptual
ms.assetid: a6c04b53-d1b9-4552-a8fd-3ed6f4902ce6
author: mikejo5000
ms.author: mikejo
manager: jillfra
ms.workload:
- aspnet
- dotnetcore
- azure
ms.openlocfilehash: afed42cbdb03ba0fb47880ed0126bad9858f83fa
ms.sourcegitcommit: 47eeeeadd84c879636e9d48747b615de69384356
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/23/2019
ms.locfileid: "63407769"
---
# <a name="remote-debug-aspnet-core-on-iis-in-azure-in-visual-studio"></a>Удаленная отладка ASP.NET Core в службах IIS на Azure в Visual Studio

В этом руководстве объясняется, как настроить и настройка приложения Visual Studio ASP.NET Core, развернуть его в IIS с помощью Azure и подключить удаленный отладчик из Visual Studio.

Рекомендуемый способ удаленная отладка в Azure зависит от сценария:

* Отладка ASP.NET Core в службе приложений Azure, см. в разделе [приложений отладка Azure с помощью отладчика моментальных снимков](../debugger/debug-live-azure-applications.md). Это рекомендуемый метод.
* Отладка ASP.NET Core в службе приложений Azure, с помощью более традиционные возможности отладки, следуйте инструкциям в этой статье (см. в разделе [удаленная отладка в службе приложений Azure](#remote_debug_azure_app_service)).

    В этом случае необходимо развернуть приложение из Visual Studio в Azure, но необходимо вручную установить или настроить IIS или удаленного отладчика (эти компоненты представлены в виде пунктирных линий), как показано на следующем рисунке.

    ![Компоненты удаленной отладки](../debugger/media/remote-debugger-azure-app-service.png "Remote_debugger_components")

* Для отладки IIS на виртуальной Машине Azure, следуйте инструкциям в этой статье (см. в разделе [удаленной отладки на виртуальной Машине Azure](#remote_debug_azure_vm)). Это позволяет использовать пользовательскую конфигурацию служб IIS, но шаги установки и развертывания, более сложны.

    Для виртуальной Машины Azure необходимо развернуть приложение из Visual Studio в Azure, а также необходимо вручную установить роль IIS и удаленным отладчиком, как показано на следующем рисунке.

    ![Компоненты удаленной отладки](../debugger/media/remote-debugger-azure-vm.png "Remote_debugger_components")

* Отладка ASP.NET Core в Service Fabric, см. в разделе [отладка удаленного приложения Service Fabric](/azure/service-fabric/service-fabric-debugging-your-application#debug-a-remote-service-fabric-application).

> [!WARNING]
> Не забудьте удалить ресурсы Azure, созданные после завершения действия в этом руководстве. Таким образом, чтобы избежать ненужных расходов.

## <a name="prerequisites"></a>Предварительные требования

::: moniker range=">=vs-2019"
2019 г. Visual Studio требуется выполнить действия, приведенные в этой статье.
::: moniker-end
::: moniker range="vs-2017"
Visual Studio 2017 необходим для выполнения действий, описанных в этой статье.
::: moniker-end

### <a name="network-requirements"></a>Требования к сети

Отладка между двумя компьютерами, подключенными через прокси-сервер не поддерживается. Отладка в различных странах высокой задержкой или низкой пропускной способностью, таких как удаленный доступ к Интернету, или через Интернет не рекомендуется и может произойти сбой или неприемлемо медленно. Полный список требований см. в разделе [требования](../debugger/remote-debugging.md#requirements_msvsmon).

## <a name="create-the-aspnet-core-application-on-the-visual-studio-computer"></a>Создание приложения ASP.NET Core на компьютере с Visual Studio

1. Создайте новое приложение ASP.NET Core.

    ::: moniker range=">=vs-2019"
    В Visual Studio 2019 г., введите **Ctrl + Q** для открытия окна поиска, введите **asp.net**, выберите **шаблоны**, затем выберите **создать новый веб-приложение ASP.NET Core** . В появившемся диалоговом окне, назовите проект **MyASPApp**, а затем выберите **создать**. Затем выберите **веб-приложение (Model-View-Controller)**, а затем выберите **создать**.
    ::: moniker-end
    ::: moniker range="vs-2017"
    В Visual Studio 2017, выберите **файл > Создать > проект**, а затем выберите **Visual C# > Web > веб-приложение ASP.NET Core**. В разделе шаблонов ASP.NET Core, выберите **веб-приложение (Model-View-Controller)**. Убедитесь, что выбран ASP.NET Core 2.1, **Включение поддержки Docker** не выбран и что **проверки подлинности** присваивается **без проверки подлинности**. Назовите проект **MyASPApp**.
    ::: moniker-end

1. Откройте файл About.cshtml.cs и установите точку останова в `OnGet` метод (в старые шаблоны, откройте файл HomeController.cs вместо и установить точку останова `About()` метод).

## <a name="remote_debug_azure_app_service"></a> Удаленная отладка ASP.NET Core в службу приложений Azure

Из Visual Studio можно быстро публиковать и отладка приложения в полностью подготовленные экземпляр IIS. Однако предустановку конфигурации IIS, и его нельзя настроить. Более подробные инструкции см. в разделе [развернуть веб-приложение ASP.NET Core в Azure с помощью Visual Studio](/aspnet/core/tutorials/publish-to-azure-webapp-using-vs). (Если вам нужна возможность настройки IIS, попробовать выполнить отладку [виртуальной Машины Azure](#remote_debug_azure_vm).)

#### <a name="to-deploy-the-app-and-remote-debug-using-server-explorer"></a>Для развертывания приложения и удаленная отладка с помощью обозревателя серверов

1. В Visual Studio, щелкните правой кнопкой мыши узел проекта и выберите **публикации**.

    Если ранее вы настроили какие-либо профили публикации, появится панель **Опубликовать**. Нажмите кнопку **новый профиль**.

1. Выберите **службе приложений Azure** из **публикации** выберите **Create New**и следуйте инструкциям на экране для публикации.

    Подробные инструкции см. в разделе [Развертывание веб-приложения ASP.NET Core в Azure с помощью Visual Studio](/aspnet/core/tutorials/publish-to-azure-webapp-using-vs).

    ![Публикация в службу приложений Azure](../debugger/media/remotedbg_azure_app_service_profile.png)

1. Откройте **обозревателя серверов** (**представление** > **обозревателя серверов**), щелкните правой кнопкой мыши на экземпляр службы приложений и выберите **подключить отладчик**.

1. В работающем приложении ASP.NET, щелкните ссылку, чтобы **о** страницы.

    В Visual Studio должна быть достигнута точка останова.

    Вот и все! Остальные шаги этого раздела применяются к удаленной отладки на виртуальной Машине Azure.

## <a name="remote_debug_azure_vm"></a> Удаленная отладка ASP.NET Core на виртуальной Машине Azure

Можно создать виртуальную Машину Azure для Windows Server и затем установить и настроить IIS и другие компоненты необходимое программное обеспечение. Это занимает больше времени, чем при развертывании в службе приложений Azure и необходимо выполнять оставшиеся шаги в этом руководстве.

Эти процедуры протестированы на эти конфигурации сервера:
* Windows Server 2012 R2 и служб IIS 8
* Windows Server 2016 и IIS 10

### <a name="app-already-running-in-iis-on-the-azure-vm"></a>Приложение уже выполняется в службах IIS на виртуальной Машине Azure?

В этой статье представлены инструкции по настройке базовую конфигурацию IIS на сервере Windows и развертывание приложения из Visual Studio. Чтобы убедиться в том, что на сервере установлены необходимые компоненты установлены, что приложение работает правильно и что вы готовы к удаленной отладки включены следующие действия.

* Если ваше приложение работает в IIS и просто хотите скачать удаленного отладчика и начать отладку, перейдите к [скачайте и установите инструменты удаленной отладки на сервере Windows](#BKMK_msvsmon).

* Если вам требуется помощь, чтобы убедиться в том, что приложение настройки, развертывания и неправильной работе в IIS, чтобы выполнять отладку, выполните действия, описанные в этом разделе.

    * Перед началом работы выполните все действия, описанные в [установки и запуска IIS](/azure/virtual-machines/windows/quick-create-portal).

    * Открыв порт 80 в группу безопасности сети, также открыть [исправьте порт](#bkmk_openports) удаленного отладчика (4024 или 4022). Таким образом, не придется открыть его позже.

### <a name="update-browser-security-settings-on-windows-server"></a>Обновить параметры безопасности браузера на сервере Windows

Если конфигурация усиленной безопасности включен в Internet Explorer (он включен по умолчанию), может потребоваться добавить некоторые домены в список надежных сайтов, чтобы можно было загрузить некоторые компоненты веб-сервера. Добавить надежных сайтов, выбрав **свойства обозревателя > Безопасность > надежных сайтов > сайты**. Добавьте следующие домены.

- microsoft.com
- go.microsoft.com
- download.microsoft.com
- iis.net

При загрузке программного обеспечения, можно получить запросы, чтобы предоставить разрешение для загрузки различные сценарии веб-сайт и ресурсы. Некоторые из этих ресурсов не являются обязательными, но чтобы упростить процесс, нажмите кнопку **добавить** при появлении запроса.

### <a name="install-aspnet-core-on-windows-server"></a>Установка ASP.NET Core в Windows Server

1. Установите [пакет размещения .NET Core для Windows Server](https://aka.ms/dotnetcore-2-windowshosting) в размещающей системе. В составе пакета устанавливаются среда выполнения .NET Core, библиотека .NET Core и модуль ASP.NET Core. Более подробные инструкции см. в разделе [публикация в службах IIS](/aspnet/core/publishing/iis?tabs=aspnetcore2x#iis-configuration).

    > [!NOTE]
    > Если система не подключена к Интернету, перед установкой пакета размещения .NET Core для Windows Server получите и установите *[Распространяемый компонент Microsoft Visual C++ 2015](https://www.microsoft.com/download/details.aspx?id=53840)*.

3. Перезапустите систему (или выполните в командной строке команду **net stop was /y**, а затем команду **net start w3svc**, чтобы изменение системной переменной PATH вступило в силу).

## <a name="choose-a-deployment-option"></a>Выберите вариант развертывания

Если необходимо развернуть приложение в IIS, рассмотрим следующие варианты.

* Развертывание, создав файл параметров публикации в службах IIS и импорта параметров в Visual Studio. В некоторых сценариях это быстрый способ развернуть приложение. При создании файла параметров публикации, разрешения автоматически настраиваются в службах IIS.

* Развертывание путем публикации в локальную папку и копирования выходных данных предпочтительным методом в папку подготовленных приложений на IIS.

## <a name="optional-deploy-using-a-publish-settings-file"></a>(Необязательно) Развертывание с помощью файла параметров публикации

Можно использовать этот параметр, создать файл параметров публикации и импортировать его в Visual Studio.

> [!NOTE]
> Этот метод развертывания использует веб-развертывания. Если вы хотите настроить веб-развертывание вручную в Visual Studio вместо импорта параметров, можно установить Web развертывание 3.6 вместо 3.6 Развертывание Web для размещения серверов. Тем не менее, если вы настраиваете веб-развертывания вручную, необходимо будет убедитесь, что в папке приложения на сервере настроены правильные значения и разрешения (см. в разделе [Настройка веб-узла ASP.NET](#BKMK_deploy_asp_net)).

### <a name="install-and-configure-web-deploy-for-hosting-servers-on-windows-server"></a>Установка и настройка веб-развертывания для размещения серверов в Windows Server

[!INCLUDE [install-web-deploy-with-hosting-server](../deployment/includes/install-web-deploy-with-hosting-server.md)]

### <a name="create-the-publish-settings-file-in-iis-on-windows-server"></a>Создание файла параметров публикации в IIS в Windows Server

[!INCLUDE [install-web-deploy-with-hosting-server](../deployment/includes/create-publish-settings-iis.md)]

### <a name="import-the-publish-settings-in-visual-studio-and-deploy"></a>Импорт параметров публикации в Visual Studio и развертывание

[!INCLUDE [install-web-deploy-with-hosting-server](../deployment/includes/import-publish-settings-vs.md)]

После успешного развертывания приложение должно запускаться автоматически. Если приложение не запускается из Visual Studio, запустите приложение в IIS. Для ASP.NET Core необходимо убедиться, что в поле "Пул приложений" для **DefaultAppPool** задано значение **Без управляемого кода**.

1. В **параметры** диалоговое окно, включите отладку, последовательно щелкнув **Далее**, выберите **Отладка** конфигурации, а затем выберите **удалять дополнительные файлы в Назначение** под **публикации файлов** параметры.

    > [!NOTE]
    > Если выбрать конфигурацию выпуска, отключить отладку в *web.config* файл во время публикации.

1. Нажмите кнопку **Сохранить** и затем повторно опубликовать приложение.

## <a name="optional-deploy-by-publishing-to-a-local-folder"></a>(Необязательно) Развертывание, публикуя их в локальную папку

Этот параметр можно использовать для развертывания приложения в том случае, если вы хотите скопировать приложение в IIS, с помощью Powershell, RoboCopy, или необходимо вручную скопировать файлы.

### <a name="BKMK_deploy_asp_net"></a> Настройка веб-узла ASP.NET на компьютере с Windows Server

Если вы импортируете параметры публикации, этот раздел можно пропустить.

1. Откройте **Диспетчер служб IIS** и перейдите к разделу **Сайты**.

2. Щелкните правой кнопкой мыши узел **Веб-сайт по умолчанию** и выберите команду **Добавить приложение**.

3. Задайте **псевдоним** поле **MyASPApp** и поле пула приложения **без управляемого кода**. Задайте **физический путь** для **C:\Publish** (где позже будет развернут проект ASP.NET).

4. Выбрав сайт в диспетчере служб IIS, выберите **изменение разрешений**и убедитесь, что IUSR IIS_IUSRS и пользователь настроен для пула приложений — авторизованного пользователя с правами на чтение и выполнение.

    Если вы не видите одно из этих пользователей, имеющих доступ, выполните действия, чтобы добавить IUSR в качестве пользователя с правами на чтение и выполнение.

### <a name="optional-publish-and-deploy-the-app-by-publishing-to-a-local-folder-from-visual-studio"></a>(Необязательно) Публикация и развертывание приложения публикуя их в локальную папку из Visual Studio

Если вы не используете веб-развертывания, необходимо опубликовать и развернуть приложение с помощью файловой системы или других средств. Можно начать с создания пакета с помощью файловой системы и затем развернуть пакет вручную или использовать другие средства, например XCopy, RoboCopy или PowerShell. В этом разделе предполагается, что пакет при копировании вручную в случае, если вы не используете веб-развертывания.

[!INCLUDE [remote-debugger-deploy-app-local](../debugger/includes/remote-debugger-deploy-app-local.md)]

### <a name="BKMK_msvsmon"></a> Скачайте и установите инструменты удаленной отладки на Windows Server

Скачайте версию инструментов удаленной отладки, которая соответствует вашей версии Visual Studio.

[!INCLUDE [remote-debugger-download](../debugger/includes/remote-debugger-download.md)]

### <a name="BKMK_setup"></a> Настройка удаленного отладчика в Windows Server

[!INCLUDE [remote-debugger-configuration](../debugger/includes/remote-debugger-configuration.md)]

> [!NOTE]
> Если требуется добавить разрешения для дополнительных пользователей, изменение режима проверки подлинности, или номер порта удаленного отладчика, см. в разделе [Настройка удаленного отладчика](../debugger/remote-debugging.md#configure_msvsmon).

### <a name="BKMK_attach"></a> Подключение к приложению ASP.NET с компьютера с Visual Studio

1. На компьютере с Visual Studio, откройте решение, которое вы пытаетесь отладить (**MyASPApp** при использовании действия, описанные в этой статье).
2. В Visual Studio щелкните **Отладка > присоединение к процессу** (Ctrl + Alt + P).

    > [!TIP]
    > В Visual Studio 2017 и более поздних версий, можно повторно присоединиться к же процессу, уже присоединена к с помощью **Отладка > повторно подключиться к процессу...** (Shift + Alt + P).

3. Установите в поле квалификатор  **\<имя удаленного компьютера >** и нажмите клавишу **ввод**.

    Убедитесь, что Visual Studio добавляет требуемый порт имя компьютера, которое отображается в формате:  **\<имя удаленного компьютера >: порт**

    ::: moniker range=">=vs-2019"
    В Visual Studio 2019 г., вы должны увидеть  **\<имя удаленного компьютера >: 4024**
    ::: moniker-end
    ::: moniker range="vs-2017"
    В Visual Studio 2017, вы должны увидеть  **\<имя удаленного компьютера >: 4022**
    ::: moniker-end
    Порт является обязательным. Если вы не видите номер порта, добавьте его вручную.

4. Нажмите кнопку **Обновить**.
    В окне **Доступные процессы** должен появиться ряд процессов.

    Если вы не видите все процессы, попробуйте использовать IP-адрес вместо имени удаленного компьютера (порт является обязательным). Можно использовать `ipconfig` в командной строке, чтобы получить адрес IPv4.

    Если вы хотите использовать **найти** кнопку, может потребоваться [откройте порт UDP 3702](#bkmk_openports) на сервере.

5. Установите флажок  **Показать процессы, запущенные всеми пользователями**.

6. Введите первую букву имени процесса для быстрого поиска приложения.

    * Выберите **dotnet.exe** (для .NET Core)

      При наличии нескольких процессов отображение **dotnet.exe**, проверьте **имя пользователя** столбца. В некоторых сценариях **имя пользователя** столбце отображается имя пула приложений, таких как **IIS APPPOOL\DefaultAppPool**. Если вы увидите, что пул приложений, чтобы правильно настроить процесс удобно для создания нового с именем пула приложений для экземпляра приложения, необходимо выполнить отладку и затем его можно найти простые способы **имя пользователя** столбца.

    * В некоторых сценариях IIS, возможно, имя вашего приложения в список процессов, таких как **MyASPApp.exe**. Можно присоединить к этому процессу вместо этого.

    ::: moniker range=">=vs-2019"
    ![RemoteDBG_AttachToProcess](../debugger/media/vs-2019/remotedbg-attachtoprocess-aspnetcore.png "RemoteDBG_AttachToProcess")
    ::: moniker-end
    ::: moniker range="vs-2017"
    ![RemoteDBG_AttachToProcess](../debugger/media/remotedbg-attachtoprocess-aspnetcore.png "RemoteDBG_AttachToProcess")
    ::: moniker-end

7. Нажмите кнопку **Присоединить**.

8. Откройте веб-сайт удаленного компьютера. В браузере перейдите по адресу **http://\<имя удаленного компьютера>**.

    Должна открыться веб-страница ASP.NET.
9. В работающем приложении ASP.NET, щелкните ссылку, чтобы **о** страницы.

    В Visual Studio должна быть достигнута точка останова.

### <a name="bkmk_openports"></a> Устранение неполадок: Откройте необходимые порты на Windows Server

В большинстве установок необходимые порты открыты при установке ASP.NET и удаленным отладчиком. Тем не менее при устранении неполадок в развертывании, а приложение размещается за брандмауэром, может потребоваться проверить, что необходимые порты открыты.

На виртуальной Машине Azure, необходимо открыть порты, через [группы безопасности сети](/azure/virtual-machines/windows/nsg-quickstart-portal).

Требуемые порты:

* 80 - необходимые для службы IIS
::: moniker range=">=vs-2019"
* 4024 - required для удаленной отладки из Visual Studio 2019 г. (см. в разделе [Remote Debugger Port Assignments](../debugger/remote-debugger-port-assignments.md) Дополнительные сведения).
::: moniker-end
::: moniker range="vs-2017"
* 4022 - required для удаленной отладки из Visual Studio 2017 (см. в разделе [Remote Debugger Port Assignments](../debugger/remote-debugger-port-assignments.md) Дополнительные сведения).
::: moniker-end
* UDP 3702 - порта (необязательно) обнаружения позволяет **найти** кнопку при присоединении удаленного отладчика в Visual Studio.

Кроме того эти порты уже должен быть открыт путем установки ASP.NET:
- 8172 — (необязательно.) требуется для веб-развертывания для развертывания приложения из Visual Studio
