---
title: Задать контрольное значение для переменных | Документация Майкрософт
ms.custom: seodec18
ms.date: 10/11/2018
ms.topic: conceptual
f1_keywords:
- vs.debug.watch
helpviewer_keywords:
- debugging [Visual Studio], Watch window
- expressions [debugger], evaluating
- variables [debugger], evaluating
- expression evaluation
- registers, evaluating
- debugging [Visual Studio], expression evaluation
author: mikejo5000
ms.author: mikejo
manager: jillfra
ms.workload:
- multiple
ms.openlocfilehash: ea3d2a1e82e92473859fef29754fbb831cf3685b
ms.sourcegitcommit: 0b90e1197173749c4efee15c2a75a3b206c85538
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 12/07/2019
ms.locfileid: "74904055"
---
# <a name="watch-variables-with-watch-windows-and-quickwatch"></a>Просмотр переменных с помощью окна "контрольные значения" и Быстрая проверка

Во время отладки можно использовать окна **контрольных значений** и **диалоговое окно "Быстрая проверка** " для просмотра переменных и выражений. Окна доступны только во время сеанса отладки.

Во время отладки в окнах **просмотра** может отображаться несколько переменных. В диалоговом окне **Быстрая проверка** отображается одна переменная за раз, и ее необходимо закрыть перед продолжением отладки.

Если вы впервые пытались выполнить отладку кода, вам может потребоваться ознакомиться с [отладкой для начинающих](../debugger/debugging-absolute-beginners.md) , а также [методов и средств отладки](../debugger/write-better-code-with-visual-studio.md) , прежде чем переходить к этой статье.

## <a name="observe-variables-with-a-watch-window"></a>Наблюдение за переменными с помощью окно контрольных значений

Можно открыть несколько окон **контрольных значений** и наблюдать за более чем одной переменной в окне **контрольных значений** .

Например, чтобы установить контроль над значениями `a`, `b`и `c` в следующем коде:

```C++
int main()
{
    int a, b, c;
    a = 1;
    b = 2;
    c = 0;

    for (int i = 0; i < 10; i++)
    {
        a++;
        b *= 2;
        c = a + b;
    }

    return 0;
}

```

1. Установите точку останова на `c = a + b;` строке, щелкнув в левом поле, выбрав **отладка** > **Переключить точку останова**или нажав клавишу **F9**.

1. Начните отладку, выбрав зеленую стрелку **запуска** или открыв **отладку > ** **начать отладку**или нажмите клавишу **F5**. Выполнение приостанавливается в точке останова.

1. Откройте окно **контрольных значений** , выбрав **Отладка** > **Windows** > **Watch** > **Контрольное значение 1**или нажав клавиши **CTRL**+**ALT**+**W** > **1**.

   Вы можете открыть дополнительные окна **контрольных значений** , выбрав Windows **2**, **3**или **4**.

1. В окне **Контрольные значения** выберите пустую строку и переменную типа `a`. Сделайте то же самое для `b` и `c`.

   ![Контрольные переменные](../debugger/media/watchvariables.png "ватчвариаблес")

1. Продолжайте отладку, выбрав **отладка** > **Шаг с заходом** или нажав клавишу **F11** , чтобы получить дополнительные инструкции. Значения переменных в окне **контрольных** значений меняются при итерации цикла `for`.

>[!NOTE]
>Только C++ для,
>- Может потребоваться квалифицировать контекст имени переменной или выражение, использующее имя переменной. Контекст — это функция, исходный файл или модуль, в котором находится переменная. Если необходимо уточнить контекст, используйте синтаксис [оператора контекста (C++)](../debugger/context-operator-cpp.md) в **имени** в окне **Контрольные значения** .
>
>- Можно добавить имена регистров и имена переменных с помощью **$\<зарегистрировать&nbsp;имя >** или **@\<зарегистрировать&nbsp;имени >** имени **в окне** **Контрольные значения** . Для получения дополнительной информации см. [Pseudovariables](../debugger/pseudovariables.md).

## <a name="use-expressions-in-a-watch-window"></a>Использование выражений в окно контрольных значений

Можно наблюдать за любым допустимым выражением, распознаваемым отладчиком в окне **контрольных значений** .

Например, для кода в предыдущем разделе можно получить среднее из трех значений, введя `(a + b + c) / 3` в окне **Контрольные значения** :

![Выражение контрольного значения](../debugger/media/watchexpression.png "Выражение контрольного значения")

Правила вычисления выражений в окне **Контрольные значения** обычно совпадают с правилами вычисления выражений в языке кода. Если в выражении есть синтаксическая ошибка, то следует возникать та же ошибка компилятора, что и в редакторе кода. Например, опечатка в предыдущем выражении выдает эту ошибку в окне **Контрольные значения** :

![Ошибка выражения контрольных значений](../debugger/media/watchexpressionerror.png "Ошибка выражения контрольных значений")

В окне **Контрольные значения** может появиться окружность с двумя волнистыми линиями. Этот значок означает, что отладчик не вычисляет выражение из-за возможной зависимости между потоками. Для оценки кода необходимо, чтобы другие потоки в приложении выполнялись временно, но, так как вы находится в режиме приостановки выполнения, все потоки в приложении обычно останавливаются. Возможность временного запуска других потоков может привести к непредвиденным последствиям для состояния приложения, и отладчик может игнорировать такие события, как точки останова и исключения в этих потоках.

::: moniker range=">= vs-2019" 
## <a name="search-in-the-watch-window"></a>Поиск в окно контрольных значений

Вы можете искать ключевые слова в столбцах "имя", "значение" и "тип" окна " **Контрольные значения** ", используя панель поиска над каждым окном. Нажмите клавишу ВВОД или выберите одну из стрелок, чтобы выполнить поиск. Чтобы отменить текущий поиск, щелкните значок "x" на панели поиска.

Используйте стрелки влево и вправо (Shift + F3 и F3 соответственно) для перехода между найденными совпадениями.

![Поиск в окне "контрольные значения"](../debugger/media/ee-search-watch.png "Поиск в окне "контрольные значения"")

Чтобы сделать поиск более или менее подробным, используйте раскрывающееся меню **Поиск** в верхней части окна **контрольных значений** , чтобы выбрать, сколько уровней глубже нужно искать во вложенных объектах. 

## <a name="pin-properties-in-the-watch-window"></a>Закрепление свойств в окно контрольных значений

>[!NOTE]
> Эта функция поддерживается в .NET Core 3,0 или более поздней версии.

Вы можете быстро проверить объекты по их свойствам в окно контрольных значений с помощью средства **свойств также прикрепляемые** .  Чтобы использовать это средство, наведите указатель мыши на свойство и выберите значок закрепления или щелкните правой кнопкой мыши и в появившемся контекстном меню выберите пункт **закрепить элемент как избранный** .  Это помещает это свойство в верхнюю часть списка свойств объекта, а имя и значение свойства отображается в столбце **значение** .  Чтобы открепить свойство, щелкните значок закрепления еще раз или выберите пункт **закрепить член как избранный** в контекстном меню.

![Закрепление свойств в окно контрольных значений](../debugger/media/basic-pin-watch.gif "Закрепление свойств в окно контрольных значений")

Можно также переключать имена свойств и отфильтровывать незакрепленные свойства при просмотре списка свойств объекта в окно контрольных значений.  Доступ к обоим параметрам можно получить, нажав кнопки на панели инструментов над окном контрольные значения.

::: moniker-end

### <a name="bkmk_refreshWatch"></a>Обновить значения контрольных значений

При вычислении выражения в окне **контрольных значений** может появиться значок обновления (круглая стрелка). Значок обновления указывает на ошибку или на устаревшее значение.

Чтобы обновить значение, щелкните значок обновления или нажмите клавишу пробел. Отладчик попытается пересчитать выражение. Однако вы не хотите или не сможете повторно вычислить выражение, в зависимости от того, почему значение не было оценено.

Наведите указатель мыши на значок обновления или просмотрите столбец **значение** , чтобы определить причину, по которой выражение не было оценено. Причины.

- При вычислении выражения произошла ошибка, как в предыдущем примере. Возможно, истекло время ожидания или переменная находится вне области действия.

- Выражение содержит вызов функции, который может активировать побочный результат в приложении. См. [побочные эффекты выражения](#bkmk_sideEffects).

- Автоматическое вычисление свойств и неявные вызовы функций отключены.

Если отображается значок обновления, поскольку автоматическое вычисление свойств и неявные вызовы функций отключены, его можно включить, выбрав **Включить вычисление свойства и другие неявные вызовы функций** в **меню сервис** > **Параметры** > **Отладка** > **Общие**.

Чтобы продемонстрировать использование значка обновления, выполните следующие действия.

1. В **меню сервис** > **Параметры** > **Отладка** > **Общие**снимите флажок **Включить вычисление свойства и другие неявные вызовы функций** .

1. Введите следующий код и в окне **Контрольные значения** задайте контрольное значение для свойства `list.Count`.

   ```csharp
   static void Main(string[] args)
   {
       List<string> list = new List<string>();
       list.Add("hello");
       list.Add("goodbye");
   }
   ```

1. Приступите к отладке. В окне **Контрольные значения** отображается примерно следующее сообщение:

   ![Обновить контрольные значения](../debugger/media/refreshwatch.png "Обновить контрольные значения")

1. Чтобы обновить значение, щелкните значок обновления или нажмите клавишу пробел. Отладчик повторно вычисляет выражение.

### <a name="bkmk_sideEffects"></a>Побочные эффекты выражения

Вычисление некоторых выражений может изменить значение переменной или иным образом повлиять на состояние приложения. Например, вычисление следующего выражения изменяет значение `var1`:

```csharp
var1 = var2
```

Этот код может вызвать [побочный результат](https://en.wikipedia.org/wiki/Side_effect_\(computer_science\)). Побочные эффекты могут усложнить отладку, изменив способ работы приложения.

Выражение с побочными эффектами вычисляется только один раз при первом его вводе. После этого выражение отображается серым цветом в окне **Контрольные значения** , а дальнейшие вычисления отключаются. Подсказка или столбец **значений** объясняет, что выражение вызывает побочный результат. Можно принудительно выполнить повторное вычисление, щелкнув значок обновления рядом с этим значением.

Один из способов предотвратить назначение побочных эффектов — отключить автоматическую оценку функций. В **меню сервис** > **Параметры** > **Отладка** > **Общие**, снимите флажок **Включить вычисление свойства и другие неявные вызовы функций**.

Только в случае, если вычисление свойств или неявные вызовы функций отключены, можно принудительно выполнить вычисление, добавив модификатор формата **AC** к имени переменной в окне **Контрольные значения** . C# См. раздел [Определители формата C#](../debugger/format-specifiers-in-csharp.md).

## <a name="bkmk_objectIds"></a>Использование идентификаторов объектов в окно контрольных значений (C# и Visual Basic)

Иногда требуется наблюдать за поведением определенного объекта. Например, может потребоваться отслеживание объекта, на который ссылается локальная переменная, после того, как эта переменная выходит за пределы области. В C# и Visual Basic можно создавать идентификаторы объектов для определенных экземпляров ссылочных типов и использовать их в окне **Контрольные значения** и условиях точек останова. Идентификатор объекта создается службами отладки среды CLR и связан с объектом.

> [!NOTE]
> Идентификаторы объектов создают слабые ссылки, не препятствующие сборке мусора для объекта. Они действительны только в рамках текущего сеанса отладки.

В следующем коде метод `MakePerson()` создает `Person` с помощью локальной переменной:

```csharp
class Person
{
    public Person(string name)
    {
        Name = name;
    }
    public string Name { get; set; }
}

public class Program
{
    static List<Person> _people = new List<Person>();
    public static void Main(string[] args)
    {
        MakePerson();
        DoSomething();
    }

    private static void MakePerson()
    {
        var p = new Person("Bob");
        _people.Add(p);
    }

    private static void DoSomething()
    {
        // more processing
         Console.WriteLine("done");
    }
}
```

Чтобы узнать имя `Person` в методе `DoSomething()`, можно добавить ссылку на `Person` идентификатор объекта в окне **Контрольные значения** .

1. Установите точку останова в коде после создания объекта `Person`.

1. Приступите к отладке.

1. Когда выполнение приостанавливается на точке останова, откройте окно **локальные** , выбрав **Отладка** > **Windows** > **локальные переменные**.

1. В окне **локальные** щелкните правой кнопкой мыши переменную `Person` и выберите пункт **создать идентификатор объекта**.

   Вы должны увидеть знак доллара ( **$** ) и число в окне **локальные** , которое является идентификатором объекта.

1. Добавьте идентификатор объекта в окно **Контрольные значения** , щелкнув правой кнопкой мыши идентификатор объекта и выбрав пункт **Добавить контрольное значение**.

1. Задайте другую точку останова в методе `DoSomething()`.

1. Продолжайте отладку. Когда выполнение приостанавливается в методе `DoSomething()`, в окне **Контрольные значения** отображается объект `Person`.

   > [!NOTE]
   > Если вы хотите просмотреть свойства объекта, например `Person.Name`, необходимо включить вычисление свойств, выбрав **сервис** > **Параметры** > **Отладка** > **Общие** > **Включить вычисление свойства и другие неявные вызовы функций**.

## <a name="dynamic-view-and-the-watch-window"></a>Динамическое представление и окно контрольных значений

Некоторые языки сценариев (например, JavaScript или Python) используют динамическую или [утка](https://en.wikipedia.org/wiki/Duck_typing) типизацию, а .net версии 4,0 и более поздних версий поддерживают объекты, которые трудно наблюдать в обычных окнах отладки.

В окне **Контрольные значения** эти объекты отображаются как динамические объекты, которые создаются из типов, реализующих интерфейс <xref:System.Dynamic.IDynamicMetaObjectProvider>. Динамические узлы объектов показывают динамические элементы динамических объектов, но не позволяют изменять значения элементов.

Чтобы обновить значения **динамического представления** , щелкните [значок обновления](#bkmk_refreshWatch) рядом с узлом динамического объекта.

Чтобы отобразить только **динамическое представление** объекта, добавьте описатель **динамического** формата после имени динамического объекта в окне **Контрольные значения** :

- Для C#: `ObjectName, dynamic`
- Для Visual Basic: `$dynamic, ObjectName`

>[!NOTE]
>- C# Отладчик не выполняет автоматическую переоценку значений в **динамическом представлении** при переходе к следующей строке кода.
>- Отладчик Visual Basic автоматически обновляет выражения, добавленные с помощью **динамического представления**.
>- Вычисление членов **динамического представления** может иметь [побочные эффекты](https://en.wikipedia.org/wiki/Side_effect_\(computer_science\)).

**Чтобы вставить новую переменную Watch, которая приводит объект к динамическому объекту:**

1. Щелкните правой кнопкой мыши любой дочерний элемент **динамического представления**.
1. Выберите **Добавить контрольное значение**. `object.name` становится `((dynamic) object).name` и отображается в новом окне **контрольных значений** .

Отладчик также добавляет дочерний узел **динамического представления** объекта в окно **видимые** . Чтобы открыть окно " **видимые** " во время отладки, выберите **Отладка** > **Windows** > **Авто**.

**Динамическое представление** также улучшает отладку для COM-объектов. Когда отладчик получает объект COM, упакованный в **System. __ComObject**, он добавляет узел **динамического представления** для объекта.

## <a name="observe-a-single-variable-or-expression-with-quickwatch"></a>Наблюдение за одной переменной или выражением с помощью быстрой проверки

Для наблюдения за одной переменной можно использовать параметр **Быстрая проверка** .

Например, для следующего кода:

```csharp
static void Main(string[] args)
{
    int a, b;
    a = 1;
    b = 2;
    for (int i = 0; i < 10; i++)
    {
        a = a + b;
    }
}
```

Чтобы просмотреть переменную `a`,

1. Установите точку останова на строке `a = a + b;` .

1. Приступите к отладке. Выполнение приостанавливается в точке останова.

1. Выберите переменную `a` в коде.

1. Выберите **отладка** > **Быстрая проверка**, нажмите **SHIFT**+**F9**или щелкните правой кнопкой мыши и выберите **Быстрая проверка**.

   Откроется диалоговое окно **Быстрая проверка** . Переменная `a` находится в поле **выражение** со **значением** **1**.

   ![Быстрая проверка переменной](../debugger/media/quickwatchvariable.png "Быстрая проверка переменной")

1. Чтобы вычислить выражение, использующее переменную, введите выражение, например `a + b`, в поле **выражение** и выберите повторное **Вычисление**.

   ![Выражение быстрой проверки](../debugger/media/quickwatchexpression.png "Выражение быстрой проверки")

1. Чтобы добавить переменную или выражение из окна " **Быстрая проверка** " в окно " **Контрольные значения** ", выберите **Добавить контрольное значение**.

1. Нажмите кнопку **Закрыть** , чтобы закрыть окно **Быстрая проверка** . (**Быстрая проверка** является модальным диалоговым окном, поэтому вы не сможете продолжать отладку, пока она открыта.)

1. Продолжайте отладку. Переменную можно наблюдать в окне **Контрольные значения** .

## <a name="see-also"></a>См. также:
- [Что такое отладка?](../debugger/what-is-debugging.md)
- [Методы и инструменты отладки](../debugger/write-better-code-with-visual-studio.md)
- [Первый взгляд на отладку](../debugger/debugger-feature-tour.md)
- [Окна отладчика](../debugger/debugger-windows.md)
