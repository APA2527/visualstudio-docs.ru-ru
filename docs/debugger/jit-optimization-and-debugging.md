---
title: JIT-оптимизация и отладка | Документация Майкрософт
description: Оптимизированный код труднее отлаживать, чем неоптимизированный. Сведения об оптимизации JIT, а также о том, когда и как ее нужно отменять.
ms.custom: SEO-VS-2020
ms.date: 11/04/2016
ms.topic: conceptual
dev_langs:
- CSharp
- VB
- FSharp
- C++
helpviewer_keywords:
- debugging [Visual Studio], optimized code
- optimized code, debugging
ms.assetid: 19bfabf3-1a2e-49dc-8819-a813982e86fd
author: mikejo5000
ms.author: mikejo
manager: jmartens
ms.workload:
- multiple
ms.openlocfilehash: 558a54f6ddcf4945da4937f75b8aa133949349a7
ms.sourcegitcommit: ae6d47b09a439cd0e13180f5e89510e3e347fd47
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 02/08/2021
ms.locfileid: "99931088"
---
# <a name="jit-optimization-and-debugging"></a>JIT-отладка и оптимизация
Проще всего выполнять отладку кода, когда он **НЕ** оптимизирован. Когда код оптимизирован, компилятор и среда выполнения вносят изменения в выпущенный код ЦП, поэтому он выполняется быстрее, но имеет не такое прямое сопоставление с начальным исходным кодом. Если сопоставление менее прямое, отладчикам часто не удается определить значения локальных переменных и пошаговое выполнение кода и точки останова могут не работать должным образом.

> [!NOTE]
> Дополнительные сведения о JIT-отладке см. в [этой документации](../debugger/debug-using-the-just-in-time-debugger.md).

## <a name="how-optimizations-work-in-net"></a>Принцип действия оптимизации в .NET 
Как правило, конфигурация сборки "Выпуск" создает оптимизированный код, а конфигурация сборки "Отладка" — нет. Свойство MSBuild `Optimize` определяет, нужно ли компилятору оптимизировать код.

В экосистеме .NET код преобразуется из исходного в инструкции ЦП в два этапа: сначала компилятор C# преобразует введенный текст в промежуточную двоичную форму, называемую MSIL, и записывает код MSIL в DLL-файлы. Затем среда выполнения .NET преобразует этот код MSIL в инструкции ЦП. Оба действия можно оптимизировать до некоторой степени, но второй шаг, выполняемый средой выполнения .NET, осуществляет более значительные оптимизации.

## <a name="the-suppress-jit-optimization-on-module-load-managed-only-option"></a>Параметр "Отключать JIT-оптимизацию при загрузке модуля (только управляемый код)"
Отладчик предоставляет параметр, который управляет тем, что происходит, когда библиотека DLL, скомпилированная с включенной оптимизацией, загружается внутри целевого процесса. Если этот флажок не установлен (состояние по умолчанию), то, когда среда выполнения .NET компилирует код MSIL в код CPU, оптимизация остается включенной. Если флажок установлен, отладчик запрашивает отключение оптимизации.

Чтобы найти параметр **Отключать JIT-оптимизацию при загрузке модуля (только управляемый код)** , щелкните **Сервис** > **Параметры**, а затем выберите страницу **Общие** в узле **Отладка**.

![Отключение JIT-оптимизации](../debugger/media/suppress-jit-tool-options.png "Отключение JIT-оптимизации")

## <a name="when-should-you-check-the-suppress-jit-optimization-option"></a>Когда следует включить параметр "Отключать JIT-оптимизацию"?
Установите этот флажок, если вы скачали библиотеки DLL из другого источника, например пакета NuGet, и хотите отладить код в этой библиотеке DLL. Чтобы отключение вступило в силу, необходимо также найти файл символов (PDB) для этой библиотеки DLL.

Если вас интересует отладка только локально создаваемого кода, лучше оставить этот флажок снятым, так как в некоторых случаях включение этого параметра значительно замедляет отладку. Для этого имеются две причины.

* Оптимизированный код выполняется быстрее. Если вы отключаете оптимизацию для большей части кода, это может повлиять на производительность.
* Если включен только пользовательский код, отладчик даже не будет пытаться загружать символы для оптимизированных DLL. Поиск символов может занять много времени.

## <a name="limitations-of-the-suppress-jit-optimization-option"></a>Ограничения для использования параметра "Отключать JIT-оптимизацию" 
Существует две ситуации, когда включение этого параметра **НЕ** работает.

1. В ситуациях, когда вы присоединяете отладчик к уже выполняющемуся процессу, этот параметр не влияет на модули, которые уже были загружены во время подключения отладчика.
2. Этот параметр не влияет на библиотеки DLL, которые были предварительно скомпилированы (созданы образы) в машинном коде. Однако использование предварительно скомпилированного кода можно отключить, запустив процесс с переменной среды **COMPlus_ReadyToRun** со значением **0**. Это укажет среде выполнения .NET Core на необходимость отключения использования предварительно скомпилированных образов и приведет к принудительной JIT-компиляции кода платформы. 

    > [!IMPORTANT]
    > Если вы используете .NET Framework или более старую версию .NET Core (2.x или ниже), добавьте переменную среды COMPlus_ZapDisable и задайте для нее значение 1.

    **Задание переменной среды для проекта .NET Core в Visual Studio**
    1. В **обозревателе решений** **щелкните правой кнопкой мыши** файл проекта и выберите **Свойства**.
    2. Перейдите на вкладку **Отладка** и в разделе **Переменные среды** нажмите кнопку **Добавить**.
    3. Задайте для параметра "Имя (ключ)" значение **COMPlus_ReadyToRun** и укажите **0** для параметра "Значение".

    ![Задание переменной среды COMPlus_ReadyToRun](../debugger/media/environment-variables-debug-menu.png "Задание переменной среды COMPlus_ReadyToRun")

## <a name="see-also"></a>См. также
- [Практическое руководство. Отладка исходного кода .NET Framework](../debugger/how-to-debug-dotnet-framework-source.md)
- [Отладка управляемого кода](../debugger/debugging-managed-code.md)
- [Навигация по коду с помощью отладчика](../debugger/navigating-through-code-with-the-debugger.md)
- [Подключение к выполняющимся процессам](../debugger/attach-to-running-processes-with-the-visual-studio-debugger.md)
- [Процесс управляемого выполнения](/dotnet/standard/managed-execution-process)
