---
title: 'Как: Миграция Расширяемые Проекты для визуальной студии 2017 Документы Майкрософт'
ms.date: 11/09/2016
ms.topic: conceptual
ms.assetid: 8ca07b00-a3ff-40ab-b647-c0a93b55e86a
author: acangialosi
ms.author: anthc
manager: jillfra
ms.workload:
- vssdk
monikerRange: vs-2017
ms.openlocfilehash: b0cae0261b185ee08400e5f3d25735634663f54a
ms.sourcegitcommit: 16a4a5da4a4fd795b46a0869ca2152f2d36e6db2
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/06/2020
ms.locfileid: "80710982"
---
# <a name="how-to-migrate-extensibility-projects-to-visual-studio-2017"></a>Как: Миграция расширяемости проектов Visual Studio 2017

В этом документе объясняется, как обновить проекты по повышению доступности до Visual Studio 2017. В дополнение к описанию того, как обновить файлы проекта, он также описывает, как обновить от расширения манифест версии 2 (VSIX v2) в новую версию 3 VSIX манифест формат (VSIX v3).

## <a name="install-visual-studio-2017-with-required-workloads"></a>Установка Visual Studio 2017 с необходимыми рабочими нагрузками

Убедитесь, что установка включает в себя следующие рабочие нагрузки:

* Разработка классических приложений .NET
* Разработка расширений Visual Studio

## <a name="open-vsix-solution-in-visual-studio-2017"></a>Открытое решение VSIX в визуальной студии 2017

Все проекты VSIX потребуют основной версии односторонней модернизации на Visual Studio 2017.

Файл проекта (например,*.csproj)* будет обновлен:

* MinimumVisualStudioVersion - теперь установлен на 15.0
* OldToolsVersion (если раньше существовал) - теперь установлен на 14,0

## <a name="update-the-microsoftvssdkbuildtools-nuget-package"></a>Обновление пакета Microsoft.VSSDK.BuildTools NuGet

> [!Note]
> Если ваше решение не ссылается на пакет Microsoft.VSSDK.BuildTools NuGet, вы можете пропустить этот шаг.

Для того, чтобы построить расширение в новом формате VSIX v3 (версия 3), ваше решение должно быть построено с новыми инструментами сборки VSSDK. Это будет установлено с Visual Studio 2017, но ваше расширение VSIX v2 может быть проведение ссылку на старую версию через NuGet. Если это так, вам нужно будет вручную установить обновление пакета Microsoft.VSSDK.BuildTools NuGet для вашего решения.

Обновление ссылок NuGet на Microsoft.VSSDK.BuildTools:

* Нажмите на решение правой кнопкой мыши и выберите **пакеты Управления NuGet для решения.**
* Перейдите на вкладку **Обновления.**
* Выберите **Microsoft.VSSDK.BuildTools (последняя версия).**
* **Обновление**прессы .

![Инструменты сборки VSSDK](media/vssdk-build-tools.png)

## <a name="make-changes-to-the-vsix-extension-manifest"></a>Внести изменения в манифест расширения VSIX

Чтобы убедиться, что установка пользователем Visual Studio имеет все сборки, необходимые для выполнения расширения, укажите все необходимые компоненты или пакеты в файле манифеста расширения. Когда пользователь пытается установить расширение, VSIXInstaller проверит, установлены ли все предпосылки. Если некоторые из них отсутствуют, пользователю будет предложено установить недостающие компоненты в процессе установки расширения.

> [!Note]
> Как минимум, все расширения должны указывать компонент основного редактора Visual Studio в качестве обязательного условия.

* Отображайте файл манифеста расширения (обычно *называемый source.extension.vsixmanifest).*
* Убедитесь, `InstallationTarget` что включает 15,0.
* Добавьте необходимые предпосылки установки (как показано на примере ниже).
  * Мы рекомендуем указать только иносы компонентов для предпосылок для установки.
  * Смотрите раздел в конце этого документа для [получения инструкций по идентификации компонентов](#find-component-ids).

Пример

```xml
<PackageManifest>
 ...
    <Prerequisites>
        <Prerequisite Id="Microsoft.VisualStudio.Component.CoreEditor" Version="[15.0,16.0)" />
        <Prerequisite Id="Microsoft.VisualStudio.Component.DiagnosticTools" Version="[15.0.25814.0,16.0)" />
        <Prerequisite Id="Microsoft.VisualStudio.Shell.12.0" Version="[12.0]" />
    </Prerequisites>
 ...
</PackageManifest>
```

### <a name="option-use-the-designer-to-make-changes-to-the-vsix-extension-manifest"></a>Вариант: Используйте конструктора для внесения изменений в манифест расширения VSIX

Вместо непосредственного редактирования манифеста XML, вы можете использовать новую вкладку **Prerequisites** в Manifest Designer, чтобы выбрать предпосылки, и XML будет обновлен для вас.

> [!Note]
> Разработчик манифеста позволит выбрать только компоненты (не рабочие нагрузки или пакеты), которые установлены на текущем экземпляре Visual Studio. Если необходимо добавить предпосылки для рабочей нагрузки, упаковки или компонента, который в настоящее время не установлен, отоделите манифест XML напрямую.

* Файл с открытым *исходным кодом.extension.vsixmanifest (дизайн)* файл.
* Выберите вкладку **Prerequisites** и нажмите **новую** кнопку.

   ![VSIX манифест дизайнер](media/vsix-manifest-designer.png)

* Откроется окно **Добавить новое предварительное окно.**

   ![добавить vsix предпосылки](media/add-vsix-prerequisite.png)

* Нажмите на выпадение **для имени** и выберите желаемое условие.
* При необходимости обновите версию.

   > [!Note]
   > Поле версии будет предварительно заполнено с версией установленного в настоящее время компонента, с диапазоном, охватывающим до (но не включая) следующую основную версию компонента.

   ![добавить предпосылки roslyn](media/add-roslyn-prerequisite.png)

* Нажмите кнопку **ОК**.

## <a name="update-debug-settings-for-the-project"></a>Обновление параметров дебуга для проекта

Если вы хотите отладить расширение в экспериментальном экземпляре Visual Studio, убедитесь, что настройки проекта для действия **Debug** > **Start** имеет **внешнюю программу Start:** значение, установленное в *файле devenv.exe* установки Visual Studio 2017.

Это может выглядеть следующим: *C:'Программные файлы (x86)»Microsoft Visual Studio»2017*

![начать внешнюю программу](media/start-external-program.png)

> [!Note]
> Действие запуска debug обычно хранится в файле *.csproj.user.* Этот файл обычно включается в файл *.gitignore* и, следовательно, обычно не сохраняется с другими файлами проекта при выполнении обязательств по управлению исходным ресурсом. Таким образом, если вы вытащили решение только что из элемента управления исходным ресурсом, скорее всего, проект не будет иметь значения, установленные для Start Action. Новые проекты VSIX, созданные с помощью Visual Studio 2017, будут иметь файл *.csproj.user,* созданный по умолчанию, указывающий на текущий каталог установки Visual Studio. Однако, если вы мигрируете расширение VSIX v2, вполне вероятно, что файл *.csproj.user* будет содержать ссылки на каталог установки предыдущей версии Visual Studio. Установка значения для действия **Debug** > **Start** позволит запустить правильный экспериментальный экземпляр Visual Studio при попытке отладить расширение.

## <a name="check-that-the-extension-builds-correctly-as-a-vsix-v3"></a>Убедитесь, что расширение строит правильно (как VSIX v3)

* Создайте проект VSIX.
* Расстегните генерируемый VSIX.
  * По умолчанию файл VSIX живет внутри *бен/ debug* или *бен / релиз,* как *"YourCustomExtension".vsix*.
  * Переименуйте *.vsix* в *.zip,* чтобы легко просмотреть содержимое.
* Проверьте наличие трех файлов:
  * *extension.vsixmanifest*
  * *manifest.json*
  * *catalog.json*

## <a name="check-when-all-required-prerequisites-are-installed"></a>Проверка, когда установлены все необходимые предпосылки

Проверьте, что VSIX успешно устанавливается на машину со всеми необходимыми предпосылками.

> [!Note]
> Перед установкой какого-либо расширения, пожалуйста, выключите все экземпляры Visual Studio.

Попытка установки расширения:

* На визуальной студии 2017

![VSIX установщик на Visual Studio 2017](media/vsixinstaller-vs-2017.png)

* Дополнительно: Проверьте предыдущие версии Visual Studio.
  * Доказывает обратную совместимость.
  * Должен работать для Visual Studio 2012, Visual Studio 2013, Visual Studio 2015.
* Дополнительно: Проверьте, что VSIX Установка Версия Checker предлагает выбор версий.
  * Включает предыдущие версии Visual Studio (если установлен).
  * Включает в себя Visual Studio 2017.

Если Visual Studio была недавно открыта, вы можете увидеть диалоговую коробку следующим образом:

![против запущенных процессов](media/vs-running-processes.png)

Подождите, пока процессы будут закрыты, или вручную завершите задачи. Вы можете найти процессы по указанному имени или с PID, перечисленным в скобках.

> [!Note]
> Эти процессы не будут автоматически выключаться во время работы экземпляра Visual Studio. Убедитесь, что вы закрыли все экземпляры Visual Studio на машине - в том числе от других пользователей, а затем продолжить повторную попытку.

## <a name="check-when-missing-the-required-prerequisites"></a>Проверка при пропаже необходимых предпосылок

* Попытка установить расширение на машину с Visual Studio 2017, которая не содержит всех компонентов, определенных в Предпосылках (см. выше).
* Убедитесь, что установка идентифицирует недостающий компонент/с и перечисляет их в качестве предпосылки в VSIXInstaller.
* Примечание: Высота будет необходима, если какие-либо предпосылки должны быть установлены с расширением.

![vsixinstaller отсутствует предпосылки](media/vsixinstaller-missing-prerequisite.png)

## <a name="decide-on-components"></a>Решение по компонентам

При поиске зависимостей можно обнаружить, что одна зависимость может отображаться на нескольких компонентах. Чтобы определить, какие зависимости следует указать в качестве предпосылки, мы предлагаем выбрать компонент, который имеет функциональность, похожую на ваше расширение, а также рассмотреть ваши пользователи и какой тип компонентов они, скорее всего, установили или не прочь установить. Мы также предлагаем строить ваши расширения таким образом, где необходимые предпосылки удовлетворяют только минимум, который позволит вашему расширению работать и для дополнительных функций они будут бездействующими, если некоторые компоненты не обнаружены.

Для получения дальнейших указаний мы определили несколько общих типов расширений и предлагаемые ими предпосылки:

Тип расширения | Отображаемое имя | ID
--- | --- | ---
Редактор | Основной редактор Visual Studio | Microsoft.VisualStudio.Component.CoreEditor
Рослин | C# и Visual Basic | Microsoft.VisualStudio.Component.Roslyn.LanguageServices
WPF | Основные средства рабочей нагрузки управляемого рабочего стола | Microsoft.VisualStudio.Component.ManagedDesktop.Core
Отладчик | JIT-отладчик | Microsoft.VisualStudio.Component.Debugger.JustInTime

## <a name="find-component-ids"></a>Поиск идонов компонентов

Список компонентов, отсортированных по продукту Visual Studio, находится на [рабочей нагрузке Visual Studio 2017 и идентиматологах.](/visualstudio/install/workload-and-component-ids?view=vs-2019) Используйте эти идолкомпоненты для предпосылок в манифесте.

Если вы не уверены, какой компонент содержит определенный двоичный файл, загрузите [таблицу «Компонент- > двоичная картографирование.](https://aka.ms/vs2017componentid-binaries)

### <a name="vs2017-componentbinarymappingxlsx"></a>vs2017-КомпонентБинарныйМакпинг.xlsx

Есть четыре столбца в листе Excel: **Название компонента**, **ComponentId**, **версия**, и **binary / Имена файлов**.  Вы можете использовать фильтры для поиска и поиска конкретных компонентов и бинарных файлов.

Для всех ваших ссылок сначала определите, какие из них находятся в компоненте основного редактора (Microsoft.VisualStudio.Component.CoreEditor).  Как минимум, мы требуем, чтобы основной компонент редактора был указан в качестве предпосылки для всех расширений. Из ссылок, которые остались, которые не находятся в основном редакторе, добавьте фильтры в разделе **«Имена файлов»,** чтобы найти компоненты, которые имеют любой из подмножеств этих ссылок.

Примеры:

* Если у вас есть расширение отладчика и знайте, что ваш проект имеет ссылку на *VSDebugEng.dll* и *VSDebug.dll*, нажмите на кнопку фильтра в **заголовке Binaries / Имена файлов.**  Поиск "VSDebugEng.dll" и выберите *OK*.  Затем нажмите на кнопку фильтра в **заголовке файлов / Имена файлов** снова и поиск "VSDebug.dll".  Выберите флажок **Добавить текущий выбор для фильтрации** и выбрать **OK.**  Теперь просмотрите **имя компонента,** чтобы найти компонент, который больше всего связан с типом расширения. В этом примере вы выбрали бы отладчик just-in-Time и добавили бы его в свой vsixmanifest.
* Если вы знаете, что ваш проект имеет дело с элементами отладчика, вы можете искать на "отладчик" в поле поиска фильтра, чтобы увидеть, какие компоненты содержат отладчик в его имени.

## <a name="specify-a-visual-studio-2017-release"></a>Укажите релиз Visual Studio 2017

Если для расширения требуется определенная версия Visual Studio 2017, например, это зависит от функции, выпущенной в 15.3, необходимо указать номер сборки в VSIX **InstallationTarget.** Например, выпуск 15.3 имеет номер сборки '15.0.26730.3'. Вы можете увидеть отображение релизов для создания чисел [здесь](../install/visual-studio-build-numbers-and-release-dates.md). Использование номера релиза '15.3' не будет работать правильно.

Если ваше расширение требует 15,3 или выше, вы объявите **версию InstallationTarget** как 15.0.26730.3, 16.0):

```xml
<Installation>
  <InstallationTarget Id="Microsoft.VisualStudio.Community" Version="[15.0.26730.3, 16.0)" />
</Installation>
```
