---
title: Практическое руководство. Перенос проектов расширяемости в Visual Studio 2017 | Документация Майкрософт
ms.date: 11/09/2016
ms.topic: conceptual
ms.assetid: 8ca07b00-a3ff-40ab-b647-c0a93b55e86a
author: madskristensen
ms.author: madsk
manager: jillfra
ms.workload:
- vssdk
monikerRange: vs-2017
ms.openlocfilehash: 802c55844be14192ea5bd5de1870e27e2063ccad
ms.sourcegitcommit: 40d612240dc5bea418cd27fdacdf85ea177e2df3
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 05/29/2019
ms.locfileid: "66319315"
---
# <a name="how-to-migrate-extensibility-projects-to-visual-studio-2017"></a>Практическое руководство. Перенос проектов расширяемости в Visual Studio 2017

В этом документе описывается порядок обновления проектов расширяемости в Visual Studio 2017. Кроме описания как обновить файлы проекта, он также описывает обновление с версии манифеста расширения 2 (VSIX v2) до новой версии 3 формат манифеста VSIX (VSIX v3).

## <a name="install-visual-studio-2017-with-required-workloads"></a>Установка Visual Studio 2017 с помощью рабочих нагрузок

Убедитесь, что установка включает следующие рабочие нагрузки:

* Разработка классических приложений .NET
* Разработка расширений Visual Studio

## <a name="open-vsix-solution-in-visual-studio-2017"></a>Откройте решение VSIX в Visual Studio 2017

Все проекты VSIX требует одностороннего обновления до Visual Studio 2017.

Файл проекта (например * *.csproj*) будут обновлены:

* Теперь значение MinimumVisualStudioVersion - 15.0
* OldToolsVersion (если существует ранее) — теперь значение 14.0

## <a name="update-the-microsoftvssdkbuildtools-nuget-package"></a>Обновите пакет Microsoft.VSSDK.BuildTools NuGet

> [!Note]
> Если решение не ссылаются на пакет Microsoft.VSSDK.BuildTools NuGet, этот шаг можно пропустить.

Для сборки расширения в новые v3 VSIX формате (версия 3), решение будет необходимо построить с помощью новых средств построения VSSDK. Это будет устанавливаться с помощью Visual Studio 2017, но расширение v2 VSIX может быть содержит ссылку на более старой версии с помощью NuGet. Если Да, необходимо будет вручную установить обновление пакета Microsoft.VSSDK.BuildTools NuGet для вашего решения.

Чтобы обновить ссылки NuGet Microsoft.VSSDK.BuildTools:

* Щелкните правой кнопкой мыши решение и выберите **управление пакетами NuGet для решения**.
* Перейдите к **обновления** вкладки.
* Выберите **Microsoft.VSSDK.BuildTools (последняя версия)** .
* Нажмите клавишу **обновления**.

![Средства сборки VSSDK](media/vssdk-build-tools.png)

## <a name="make-changes-to-the-vsix-extension-manifest"></a>Внесите изменения во манифеста расширения VSIX

Чтобы обеспечить все сборки, необходимые для запуска расширения пользователя установки Visual Studio, укажите все необходимые компоненты и пакеты в файл манифеста расширения. Когда пользователь пытается установить расширение, установщик VSIX проверит наличие всех необходимых компонентов. Если отсутствуют некоторые, пользователю будет предложено установить отсутствующие компоненты как часть процесса установки расширения.

> [!Note]
> Как минимум все расширения должны указать необходимый компонент основного компонента редактора Visual Studio.

* Редактирование файла манифеста расширения (обычно называют *source.extension.vsixmanifest*).
* Убедитесь, `InstallationTarget` включает 15.0.
* Добавьте необходимые условия для установки требуется (как показано в следующем примере).
   * Мы рекомендуем указать только идентификаторы компонентов для установки необходимых компонентов.
   * См. в разделе, в конце этого документа [инструкции по выявлению идентификаторы компонентов](#find-component-ids).

Пример

```xml
<PackageManifest>
 ...
    <Prerequisites>
        <Prerequisite Id="Microsoft.VisualStudio.Component.CoreEditor" Version="[15.0,16.0)" />
        <Prerequisite Id="Microsoft.VisualStudio.Component.DiagnosticTools" Version="[15.0.25814.0,16.0)" />
        <Prerequisite Id="Microsoft.VisualStudio.Shell.12.0" Version="[12.0]" />
    </Prerequisites>
 ...
</PackageManifest>
```

### <a name="option-use-the-designer-to-make-changes-to-the-vsix-extension-manifest"></a>Вариант. Использовать конструктор для изменения манифеста расширения VSIX

Вместо того чтобы непосредственно редактировать XML-ФАЙЛ манифеста, вы можете использовать новый **предварительные требования** вкладку в конструкторе манифеста, чтобы выбрать необходимые компоненты и XML будет обновляться автоматически.

> [!Note]
> Конструктор манифеста можно будет только для выбора компонентов (не рабочих нагрузок или пакеты), установленных в текущем экземпляре Visual Studio. Если вам нужно добавить необходимый компонент для рабочей нагрузки, пакета или компонента, который в настоящее время не установлен, отредактируйте сам файл манифеста XML.

* Откройте *source.extension.vsixmanifest [Design]* файл.
* Выберите **предварительные требования** вкладку и нажмите клавишу **New** кнопки.

   ![Конструктор манифеста VSIX](media/vsix-manifest-designer.png)

* **Добавление новых необходимых компонентов** окно.

   ![Добавление необходимого компонента vsix](media/add-vsix-prerequisite.png)

* Щелкните раскрывающийся список **имя** и выберите нужный необходимого компонента.
* При необходимости обновите версию.

   > [!Note]
   > Поле версии будут автоматически заполнены, с версией в настоящее время установленного компонента, с помощью диапазона охват до (но не включая) следующий основной номер версии компонента.

   ![Добавление необходимого компонента roslyn](media/add-roslyn-prerequisite.png)

* Нажмите кнопку **ОК**.

## <a name="update-debug-settings-for-the-project"></a>Обновить параметры отладки для проекта

Если вы хотите выполнить отладку расширения в экспериментальном экземпляре Visual Studio, убедитесь, что параметры проекта для **Отладка** > **действие при запуске** имеет **запуск внешних Программа:** значение *devenv.exe* файл установки Visual Studio 2017.

Он может выглядеть так: *C:\Program Files (x86)\Microsoft Visual Studio\2017\Enterprise\Common7\IDE\devenv.exe*

![Запуск внешней программы](media/start-external-program.png)

> [!Note]
> Отладка действие при запуске обычно хранятся в *. csproj.user* файл. Этот файл обычно входит в *.gitignore* файла и, следовательно, не сохраняется обычно с другими файлами проекта, при фиксации в систему управления версиями. Таким образом Если вы извлекли решения из системы управления версиями новые вполне вероятно, проект будет иметь нет значения, заданные для начального действия. Новые проекты VSIX, созданные с помощью Visual Studio 2017 будет иметь *. csproj.user* файл, созданный с параметрами по умолчанию, указывает на текущий каталог установки Visual Studio. Однако если вы переносите v2 расширение VSIX, весьма вероятно, *. csproj.user* файл будет содержать ссылки на каталог установки предыдущей версии Visual Studio. Значение свойства **Отладка** > **действие при запуске** позволит правильно экспериментальный экземпляр Visual Studio для запуска при отладке расширения.

## <a name="check-that-the-extension-builds-correctly-as-a-vsix-v3"></a>Проверьте, что расширение построений правильно (в виде VSIX v3)

* Создайте проект VSIX.
* Распакуйте формируемый VSIX.
   * По умолчанию, VSIX-файл находится в *bin/Debug* или *bin/Release* как *.vsix [YourCustomExtension]* .
   * Переименуйте *.vsix* для *ZIP-файл* позволяет легко просмотреть содержимое.
* Проверка существования три файла:
   * *extension.vsixmanifest*
   * *manifest.JSON*
   * *catalog.json*

## <a name="check-when-all-required-prerequisites-are-installed"></a>Проверьте, если установлены все необходимые компоненты

Проверьте, VSIX успешно устанавливается на компьютере с установлены все необходимые необходимые компоненты.

> [!Note]
> Прежде чем устанавливать любое расширение, завершите работу всех экземпляров Visual Studio.

Попытка установить расширение:

* В Visual Studio 2017

![Установщик VSIX в Visual Studio 2017](media/vsixinstaller-vs-2017.png)

* Необязательные: Проверьте в предыдущих версиях Visual Studio.
   * Подтверждает обратной совместимости.
   * Должен работать для Visual Studio 2012, Visual Studio 2013, Visual Studio 2015.
* Необязательные: Проверьте, что средство проверки версии установщик VSIX соответствует выбору версий.
   * Включает предыдущие версии Visual Studio (если установлена).
   * Включает в себя Visual Studio 2017.

Если недавно был открыт Visual Studio, может появиться диалоговое окно следующим образом:

![запущенные процессы VS](media/vs-running-processes.png)

Ожидания для процессов завершить работу, или вручную завершить задачи. Процессы можно найти по имени или с Идентификатором, перечисленные в скобках.

> [!Note]
> Эти процессы не будет завершать во время работы экземпляра Visual Studio. Убедитесь, что завершить работу всех экземпляров Visual Studio на компьютере - в том числе у других пользователей, и повторять попытки.

## <a name="check-when-missing-the-required-prerequisites"></a>Проверка при отсутствии необходимых компонентов

* Предпринята попытка установить расширение на компьютере с Visual Studio 2017, СОДЕРЖАЩИЕ не все компоненты, определенные в предварительных требованиях (см. выше).
* Убедитесь, что установки идентифицирует отсутствующий компонент/s и их список приводится в качестве необходимого компонента в установщик VSIX.
* Примечание. Если все необходимые компоненты должны быть установлены с расширением потребуется повышение прав.

![установщик VSIX отсутствует обязательный компонент](media/vsixinstaller-missing-prerequisite.png)

## <a name="decide-on-components"></a>Выбрать компоненты

При поиске зависимостей, вы обнаружите, что одна зависимость сопоставить нескольким компонентам. Чтобы определить, какие зависимости следует указать как вашей перед началом работы мы рекомендуем выбрать компонентом с функциями, аналогичными расширения и для пользователей и какой тип компонентов бы они скорее установить или не стал бы возражать установки. Также мы рекомендуем стандартных расширений в виде, где необходимые условия удовлетворяют минимально, позволяющее расширение для запуска, а также для дополнительных функций попросите быть неактивными, если некоторые компоненты не определяются.

Чтобы предоставить дополнительные рекомендации, мы определили несколько распространенных типов расширения и предлагаемые необходимых компонентах:

Тип расширения | Отображаемое имя | ID
--- | --- | ---
Редактор | Основной редактор Visual Studio | Microsoft.VisualStudio.Component.CoreEditor
Roslyn | C# и Visual Basic | Microsoft.VisualStudio.Component.Roslyn.LanguageServices
WPF | Основные средства рабочей нагрузки управляемого рабочего стола | Microsoft.VisualStudio.Component.ManagedDesktop.Core
Отладчик | JIT-отладчик | Microsoft.VisualStudio.Component.Debugger.JustInTime

## <a name="find-component-ids"></a>Найти идентификаторы компонентов

Список компонентов, отсортированный по продуктам Visual Studio представлен в [идентификаторы рабочих нагрузок и компонентов Visual Studio 2017](https://aka.ms/vs2017componentIDs). Используйте эти идентификаторы компонентов вашей готовности к установке идентификаторам в манифесте.

Если вы не уверены, какой компонент содержит конкретного двоичного файла, загрузите [компонент "->" листа сопоставления двоичных](https://aka.ms/vs2017componentid-binaries).

### <a name="vs2017-componentbinarymappingxlsx"></a>Visual Studio 2017 ComponentBinaryMapping.xlsx

В таблице Excel имеются четыре столбца: **Имя компонента**, **ComponentId**, **версии**, и **двоичный / имена файлов**.  Можно использовать фильтры для поиска конкретных компонентов и двоичные файлы.

Для всех ссылок сначала определите, какие из них находятся в основной компонент редактора (Microsoft.VisualStudio.Component.CoreEditor).  Как минимум требуется основного компонента редактора, чтобы указать в качестве необходимого компонента для всех расширений. Ссылок, которые остаются, не входящие в базовый редактор, добавить фильтры в **двоичные файлы и имена файлов** разделе можно найти компоненты, содержащие любое из подмножества этих ссылок.

Примеры

* Если у вас расширением отладчика и знать, что проект содержит ссылку на *VSDebugEng.dll* и *VSDebug.dll*, нажмите кнопку «фильтр» в **двоичные файлы и имена файлов**заголовка.  Поиск «VSDebugEng.dll» и выберите *ОК*.  Далее щелкните «фильтр» в **двоичные файлы и имена файлов** заголовок еще раз и выполните поиск «VSDebug.dll».  Установите флажок **добавить выбранные элементы для фильтрации** и выберите **ОК**.  Теперь просмотрите **имя компонента** найти компонент, который больше всего связан с типом вашего расширения. В этом примере вы выбрали Just-In-Time отладчика и добавить его в ваш vsixmanifest.
* Если вы знаете, что проект имеет дело с элементами отладчика, вы можете выполнять поиск «отладчик» в поле фильтра поиска компонентов содержат отладчика в его имени.

## <a name="specify-a-visual-studio-2017-release"></a>Укажите выпуск Visual Studio 2017

Если расширение требует определенной версии Visual Studio 2017, например, это зависит от компонентов, выпущена в версии 15.3, необходимо указать номер сборки в VSIX **InstallationTarget**. Например выпуске 15.3 имеет ряд сборки "15.0.26730.3». Вы увидите сопоставление выпусков для номера сборки [здесь](../install/visual-studio-build-numbers-and-release-dates.md). С помощью номер выпуска «15.3"будет работать неправильно.

Если для расширения требуется 15.3 или более поздней версии, можно объявить **InstallationTarget версии** как [15.0.26730.3, 16.0):

```xml
<Installation>
  <InstallationTarget Id="Microsoft.VisualStudio.Community" Version="[15.0.26730.3, 16.0)" />
</Installation>
```
