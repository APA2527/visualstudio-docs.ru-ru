---
title: Создание проектных инстанций с помощью проектных фабрик (ru) Документы Майкрософт
ms.date: 11/04/2016
ms.topic: conceptual
helpviewer_keywords:
- project factories
- projects [Visual Studio SDK], project factories
ms.assetid: 94c90012-8669-459c-af8e-307ac242c8c4
author: acangialosi
ms.author: anthc
manager: jillfra
ms.workload:
- vssdk
ms.openlocfilehash: 31ba5dd11af18f8a723b2271544eff2bd292e2e8
ms.sourcegitcommit: 16a4a5da4a4fd795b46a0869ca2152f2d36e6db2
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/06/2020
ms.locfileid: "80709062"
---
# <a name="create-project-instances-by-using-project-factories"></a>Создание экземпляров проектов с помощью проектных фабрик
Типы [!INCLUDE[vsprvs](../../code-quality/includes/vsprvs_md.md)] проектов используют *фабрику проектов* для создания экземпляров объектов проекта. Проектная фабрика похожа на фабрику стандартного класса для кокремированных объектов COM. Однако объекты проекта не являются кокремированными; они могут быть созданы только с помощью проектной фабрики.

 [!INCLUDE[vsprvs](../../code-quality/includes/vsprvs_md.md)] IDE называет фабрику проектов, реализованную в вашем VSPackage, когда пользователь [!INCLUDE[vsprvs](../../code-quality/includes/vsprvs_md.md)]загружает существующий проект или создает новый проект в. Новый объект проекта предоставляет IDE достаточно информации для заполнения **Solution Explorer.** Новый объект проекта также предоставляет необходимые интерфейсы для поддержки всех соответствующих действий uI, инициированных IDE.

 Вы можете <xref:Microsoft.VisualStudio.Shell.Interop.IVsProjectFactory> реализовать интерфейс в классе в проекте. Как правило, он находится в собственном модуле.

 Проекты, поддерживающие агрегированные владельцем, должны сохранять ключ владельца в файле проекта. Когда <xref:Microsoft.VisualStudio.Shell.Interop.IVsProjectFactory.CreateProject%2A> метод вызывается на проект с ключом владельца, принадлежащий проект преобразует ключ своего `CreateProject` владельца в музик project factory, затем вызывает метод на этой фабрике проекта, чтобы сделать фактическое творение.

## <a name="create-an-owned-project"></a>Создание принадлежащего проекту
 Владелец создает принадлежащий проект в два этапа:

1. Позвонив по методу. <xref:Microsoft.VisualStudio.Shell.Interop.IVsOwnedProjectFactory.PreCreateForOwner%2A> Это дает проекту возможность создать агрегированный объект проекта на `IUnknown`основе ввода управления. Принадлежащий проект передает `IUnknown` внутренний и агрегированный объект обратно в проект владельца. Это дает принадлежащим проекту возможность `IUnknown`хранить внутреннюю.

2. Позвонив по методу. <xref:Microsoft.VisualStudio.Shell.Interop.IVsOwnedProjectFactory.InitializeForOwner%2A> Принадлежащий проект делает все свое мгновенное воспроизведение, когда этот метод называется вместо вызова, `IVsProjectFactory::CreateProject` как это было бы в случае проектов, которые не принадлежат. Перечисление `VSOWNEDPROJECTOBJECT` входных вводов, как правило, является агрегированным проектом. Принадлежащий проект может использовать эту переменную, чтобы определить, был ли объект проекта уже создан (cookie не равен NULL) или должен быть создан (cookie равен NULL).

   Типы проектов идентифицируются по уникальному проекту GUID, аналогичному CLSID кокремированного объекта COM. Как правило, одна фабрика проектов обрабатывает случаи одного типа проекта, хотя можно иметь одну фабрику проекта обрабатывать более одного типа проекта GUID.

   Типы проектов связаны с определенным расширением имени файла. Когда пользователь пытается открыть существующий файл проекта или пытается создать новый проект путем клонирования шаблона, IDE использует расширение файла для определения соответствующего GUID проекта.

   Как только IDE определяет, должен ли он создать новый проект или открыть существующий проект определенного типа, IDE использует информацию в системном реестре в соответствии с **«HKEY_LOCAL_MACHINE»Программное обеспечение »Microsoft VisualStudio »8.0 »Проекты»,** чтобы найти, какие VSPackage реализует необходимый проект завода. IDE загружает этот VSPackage. В <xref:Microsoft.VisualStudio.Shell.Interop.IVsPackage.SetSite%2A> методе VSPackage должен зарегистрировать свою проектную фабрику <xref:Microsoft.VisualStudio.Shell.Interop.IVsRegisterProjectTypes.RegisterProjectType%2A> с IDE, позвонив по методу.

   Основным методом `IVsProjectFactory` интерфейса <xref:Microsoft.VisualStudio.Shell.Interop.IVsProjectFactory.CreateProject%2A>является, который должен обрабатывать два сценария: открытие существующего проекта и создание нового проекта. Большинство проектов хранят состояние проекта в файле проекта. Как правило, новые проекты создаются путем `CreateProject` создания копии файла шаблона, переданного методу, а затем открывания копии. Существующие проекты мгновенно открываются путем прямого `CreateProject` открытия файла проекта, передаваемого методу. Метод `CreateProject` может отображать дополнительные функции пользовательского интерфейса для пользователя по мере необходимости.

   Проект также может использовать файлы и вместо этого хранить состояние проекта в механизме хранения, кроме файловой системы, например базой данных или веб-сервере. В этом случае параметр имени `CreateProject` файла, передаваемый методу, на самом деле не является траекторией файловой системы, а уникальной строкой — URL-адресом для идентификации данных проекта. Вам не нужно копировать файлы шаблонов, которые передаются, чтобы `CreateProject` вызвать соответствующую последовательность построения, которая будет выполнена.

## <a name="see-also"></a>См. также
- <xref:Microsoft.VisualStudio.Shell.Interop.IVsOwnedProjectFactory>
- <xref:Microsoft.VisualStudio.Shell.Interop.IVsProjectFactory>
- <xref:Microsoft.VisualStudio.Shell.Interop.IVsRegisterProjectTypes>
- [Контрольный список: Создание новых типов проектов](../../extensibility/internals/checklist-creating-new-project-types.md)
