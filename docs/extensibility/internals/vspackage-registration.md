---
title: Регистрация VSPackage Документы Майкрософт
ms.date: 11/04/2016
ms.topic: conceptual
helpviewer_keywords:
- registration, VSPackages
- VSPackages, registering
ms.assetid: ecd20da8-b04b-4141-a8f4-a2ef91dd597a
author: acangialosi
ms.author: anthc
manager: jillfra
ms.workload:
- vssdk
ms.openlocfilehash: a05dec8fbef40143f31f2c0ac484824717ea2e32
ms.sourcegitcommit: 16a4a5da4a4fd795b46a0869ca2152f2d36e6db2
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/06/2020
ms.locfileid: "80703923"
---
# <a name="vspackage-registration"></a>Регистрация VSPackage
VSPackages должны [!INCLUDE[vsprvs](../../code-quality/includes/vsprvs_md.md)] сообщить, что они установлены и должны быть загружены. Этот процесс осуществляется путем написания информации в реестре. Это типичная работа установщика.

> [!NOTE]
> Использование саморегистрации является общепринятой практикой при разработке VSPackage. Тем [!INCLUDE[vsipprvsip](../../extensibility/includes/vsipprvsip_md.md)] не менее, партнеры не могут поставлять свою продукцию с помощью саморегистрации в рамках установки.

 Записи реестра в пакете установки Windows, как правило, сделаны в таблице реестра. Вы также можете зарегистрировать расширения файлов в таблице Реестра. Тем не менее, Windows Installer обеспечивает встроенную поддержку через программный идентификатор (ProgId), класс, расширение и таблицы глаголов. Для получения дополнительной информации [см.](/windows/desktop/Msi/database-tables)

 Убедитесь, что записи в реестре связаны с компонентом, подходящим для выбранной вами стратегии. Например, записи реестра для общего файла должны быть связаны с компонентом установки Windows этого файла. Аналогичным образом, записи реестра для файла, конкретного для версии, должны быть связаны с компонентом этого файла. В противном случае, установка или установка VSPackage для одной версии [!INCLUDE[vsprvs](../../code-quality/includes/vsprvs_md.md)] может сломать ваш VSPackage в других версиях. Для получения дополнительной [информации см.](../../extensibility/supporting-multiple-versions-of-visual-studio.md)

> [!NOTE]
> Самый простой способ управления регистрацией — использовать одни и те же данные в одних и тех же файлах как для регистрации разработчика, так и для регистрации времени установки. Например, некоторые инструменты разработки установки могут использовать файл в формате .reg во время сборки. Если разработчики сохраняют файлы .reg для своей повседневной разработки и отладки, эти же файлы могут быть включены в установщик автоматически. Если вы не можете автоматически обмениваться регистрационными данными, необходимо убедиться, что копия регистрационных данных установщика является актуальной.

## <a name="registering-unmanaged-vspackages"></a>Регистрация неуправляемых VSPackages
 Неуправляемые VSPackages (в том числе генерируемые шаблоном пакета Visual Studio) используют файлы ATL в стиле .rgs для хранения регистрационной информации. Формат файла .rgs специфичен для ATL и обычно не может быть использован как инструмент авторизации установки. Регистрационная информация для установки VSPackage должна поддерживаться отдельно. Например, разработчики могут хранить файлы в формате .reg в синхронизации с изменениями файлов .rgs. Файлы .reg могут быть объединены с RegEdit для разработки или использованы установщиком.

## <a name="registering-managed-vspackages"></a>Регистрация управляемых VSPackages
 Инструмент RegPkg считывает атрибуты регистрации из управляемого VSPackage и может либо записывать информацию непосредственно в реестр, либо писать файлы формата .reg, которые могут быть использованы установщиком.

> [!NOTE]
> Инструмент RegPkg не переименовывается и не может быть использован для регистрации VSPackage в системе пользователя.

## <a name="why-vspackages-should-not-self-register-at-install-time"></a>Почему VSPackages не должны самостоятельно регистрироваться во время установки
 Установщики VSPackage не должны полагаться на саморегистрацию. На первый взгляд, сохранение значения реестра VSPackage только в vsPackage себя кажется хорошей идеей. Учитывая, что разработчикам нужны значения реестра, доступные для их рутинной работы и тестирования, имеет смысл избежать сохранения отдельной копии данных реестра в установке. Установщик может полагаться на сам VSPackage для записи значений реестра.

 Хотя хорошо в теории, саморегистрация имеет несколько недостатков, которые делают его непригодным для установки VSPackage:

- Правильно поддерживая установку, неустановку, откат установки и откат неустановки требует, чтобы вы авторить четыре пользовательских действия для каждого управляемого VSPackage, который саморегистрируется, позвонив regPkg.

- Ваш подход к поддержке бок о бок может потребовать, чтобы вы авторить четыре пользовательских действия, [!INCLUDE[vsprvs](../../code-quality/includes/vsprvs_md.md)]которые ссылаются На RegSvr32 или RegPkg для каждой поддерживаемой версии .

- Установка с самозарегистрированными модулями не может быть безопасно откатной, поскольку нет никакого способа сказать, используются ли самостоятельно зарегистрированные клавиши другой функцией или приложением.

- Самозарегистрированные DLLs иногда ссылаются на вспомогательные DLLs, которые отсутствуют или являются неправильной версией. В отличие от этого, Windows Installer может регистрировать DLL с помощью таблиц реестров без зависимости от текущего состояния системы.

- Саморегистрационный код может быть лишен доступа к сетевым ресурсам, таким как библиотеки типов, если компонент указан как запущенный из источника и указан в таблице SelfReg. Это может привести к сбою установки компонента во время административной установки.

## <a name="see-also"></a>См. также
- [Установщик Windows](/windows/desktop/Msi/windows-installer-portal)
- [Управляемая регистрация пакетов](https://msdn.microsoft.com/library/f69e0ea3-6a92-4639-8ca9-4c9c210e58a1)
