---
title: 'Создание нового проекта: внутри, часть One | Документация Майкрософт'
ms.date: 11/04/2016
ms.topic: conceptual
helpviewer_keywords:
- projects [Visual Studio], new project dialog
- projects [Visual Studio], new project generation
ms.assetid: 66778698-0258-467d-8b8b-c351744510eb
author: madskristensen
ms.author: madsk
manager: jillfra
ms.workload:
- vssdk
ms.openlocfilehash: 41b2b229fe343c9f6d515ba757e4bd976ee7fda5
ms.sourcegitcommit: 5f6ad1cefbcd3d531ce587ad30e684684f4c4d44
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 10/22/2019
ms.locfileid: "72726530"
---
# <a name="new-project-generation-under-the-hood-part-one"></a>Создание нового проекта. Как это работает, часть 1
Когда-нибудь задумывались о том, как создать собственный тип проекта? Интересно, что происходит при создании нового проекта? Давайте посмотрим на себя и посмотрим, что происходит на самом деле.

 Существует несколько задач, которые Visual Studio координирует для вас:

- В нем отображается дерево всех доступных типов проектов.

- Он отображает список шаблонов приложений для каждого типа проекта и позволяет выбрать один из них.

- Он собирает сведения о проекте для приложения, такие как имя проекта и путь.

- Эта информация передается в фабрику проектов.

- Он создает элементы и папки проекта в текущем решении.

## <a name="the-new-project-dialog-box"></a>Диалоговое окно "новый проект"
 Все начинается с выбора типа проекта для нового проекта. Начнем с выбора пункта **создать проект** в меню **файл** . Откроется диалоговое окно **Новый проект** , которое выглядит примерно так:

 ![Диалоговое окно «Создание проекта»](../../extensibility/internals/media/newproject.gif "NewProject")

 Давайте подробнее рассмотрим. В дереве **типов проектов** перечислены различные типы проектов, которые можно создать. При выборе типа проекта, такого как **Visual C# Windows**, вы увидите список шаблонов приложений, чтобы приступить к работе. **Установленные шаблоны Visual Studio** устанавливаются Visual Studio и доступны любому пользователю компьютера. Новые создаваемые или собранные шаблоны можно добавлять в **шаблоны** и доступны только вам.

 При выборе шаблона, такого как **приложение Windows**, в диалоговом окне отображается описание типа приложения. в данном случае это **проект для создания приложения с пользовательским интерфейсом Windows**.

 В нижней части диалогового окна **Новый проект** вы увидите несколько элементов управления, которые собирают дополнительные сведения. Отображаемые элементы управления зависят от типа проекта, но в целом они включают в себя текстовое поле " **имя** проекта", текстовое поле **расположения** и связанную кнопку **обзора** , а также текстовое поле " **имя решения** " и связанное **Создание каталога для решения.** флажок.

## <a name="populating-the-new-project-dialog-box"></a>Заполнение диалогового окна "новый проект"
 Где диалоговое окно " **Новый проект** " получает сведения из? Здесь есть два механизма работы, один из которых является устаревшим. Диалоговое окно **Новый проект** объединяет и отображает сведения, полученные из обоих механизмов.

 Старый (устаревший) метод использует записи системного реестра и файлы VSDir. Этот механизм выполняется при открытии Visual Studio. В более новом методе используются файлы VSTEMPLATE. Этот механизм выполняется при инициализации Visual Studio, например при выполнении

```
devenv /setup
```

 или

```
devenv /installvstemplates
```

### <a name="project-types"></a>Типы проектов
 Позиции и имена **типов проектов** корневые узлы, такие как  **C# Visual** и **другие языки**, определяются записями системного реестра. Организация дочерних узлов, таких как **база данных** и **смарт-устройство**, отражает иерархию папок, содержащих соответствующие VSTEMPLATE-файлы. Давайте сначала рассмотрим корневые узлы.

#### <a name="project-type-root-nodes"></a>Корневые узлы типа проекта
 Когда [!INCLUDE[vsprvs](../../code-quality/includes/vsprvs_md.md)] инициализируется, он проходит через подразделы раздела системного реестра HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\VisualStudio\14.0\NewProjectTemplates\TemplateDirs для сборки и именования корневых узлов дерева **типов проектов** . Эти сведения кэшируются для последующего использования. Взгляните на ключ Темплатедирс \\ {FAE04EC1-301F-11D3-BF4B-00C04F79EFBC} \\/1. Каждая запись является идентификатором GUID VSPackage. Имя подраздела (/1) игнорируется, но его присутствие означает, что это корневой узел **типов проектов** . Корневой узел, в свою очередь, может иметь несколько подразделов, которые управляют его внешним видом в дереве **типов проектов** . Рассмотрим некоторые из них.

##### <a name="default"></a>(Значение по умолчанию)
 Это идентификатор ресурса локализованной строки, которая именует корневой узел. Строковый ресурс находится во вспомогательной библиотеке DLL, выбранной с помощью идентификатора GUID VSPackage.

 В этом примере идентификатор GUID VSPackage — это

 {FAE04EC1-301F-11D3-BF4B-00C04F79EFBC}

 и идентификатор ресурса (значение по умолчанию) корневого узла (/1) #2345

 Если вы ищете идентификатор GUID в разделе "соседние пакеты" и просматриваете подраздел Сателлитедлл, можно найти путь к сборке, содержащей строковый ресурс:

 путь установки \<Visual Studio > \VC#\VCSPackages\1033\csprojui.dll

 Чтобы проверить это, откройте проводник и перетащите файл кспрожуи. dll в каталог Visual Studio. В таблице String показано, что ресурс #2345 имеет **визуальный C#** элемент заголовка.

##### <a name="sortpriority"></a>сортприорити
 Определяет расположение корневого узла в дереве **типов проектов** .

 Сортприорити REG_DWORD 0x00000014 (20)

 Чем меньше число приоритетов, тем выше его расположение в дереве.

##### <a name="developeractivity"></a>девелоперактивити
 Если этот подраздел имеется, расположение корневого узла управляется диалоговым окном "Параметры разработчика". Например, примененная к объекту директива

 Девелоперактивити REG_SZVC#

 Указывает, что C# визуальный элемент будет корневым, если Visual Studio настроен для [!INCLUDE[vcprvc](../../code-quality/includes/vcprvc_md.md)] разработки. В противном случае он будет дочерним узлом для **других языков**.

##### <a name="folder"></a>Папка
 Если этот подраздел имеется, корневой узел становится дочерним узлом указанной папки. В разделе появится список возможных папок.

 HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\VisualStudio\11.0\NewProjectTemplates\PseudoFolders

 Например, у записи проектов баз данных есть ключ папки, соответствующий записи других типов проектов в Псеудофолдерс. Таким образом, в дереве **типов проектов** **проекты баз данных** будут дочерними узлами **других типов проектов**.

#### <a name="project-type-child-nodes-and-vstdir-files"></a>Дочерние узлы типа проекта и файлы встдир
 Расположение дочерних узлов в дереве **типов проектов** соответствует иерархии папок в папках прожекттемплатес. Для шаблонов компьютеров (**установленных шаблонов Visual Studio**) типичным расположением является \Program Files\Microsoft Visual Studio .\N\n-\ Common7\IDE\ProjectTemplates\, а для шаблонов пользователей (**Мои шаблоны**) — папка \ \ мои документы \ Visual Studio, Темплатес\прожекттемплатес \\. Иерархии папок из этих двух расположений объединяются для создания дерева **типов проектов** .

 Для Visual Studio с C# параметрами разработчика дерево **типов проектов** выглядит примерно следующим образом:

 ![Типы проектов](../../extensibility/internals/media/projecttypes.png "прожекттипес")

 Соответствующая папка Прожекттемплатес выглядит следующим образом:

 ![Шаблоны проектов](../../extensibility/internals/media/projecttemplates.png "прожекттемплатес")

 Когда откроется диалоговое окно **Новый проект** , [!INCLUDE[vsprvs](../../code-quality/includes/vsprvs_md.md)] перебирает папку прожекттемплатес и повторно создает ее структуру в дереве **типов проектов** с некоторыми изменениями:

- Корневой узел в дереве **типов проектов** определяется шаблоном приложения.

- Имя узла может быть локализовано и может содержать специальные символы.

- Порядок сортировки можно изменить.

##### <a name="finding-the-root-node-for-a-project-type"></a>Поиск корневого узла для типа проекта
 Когда Visual Studio просматривает папки Прожекттемплатес, он открывает все ZIP-файлы и извлекает файлы VSTEMPLATE. VSTEMPLATE-файл использует XML для описания шаблона приложения. Дополнительные сведения см. в разделе о [создании нового проекта: в части 2](../../extensibility/internals/new-project-generation-under-the-hood-part-two.md).

 Тег \<ProjectType > определяет тип проекта для приложения. Например, файл \CSharp\SmartDevice\WindowsCE\1033\WindowsCE-EmptyProject.zip содержит файл Емптипрожект. vstemplate с таким тегом:

```
<ProjectType>CSharp</ProjectType>
```

 Тег \<ProjectType >, а не вложенная папка в папке Прожекттемплатес, определяет корневой узел приложения в дереве **типов проектов** . В этом примере Windows CE приложения отображаются под корневым узлом **визуального C#**  элемента, и даже если вы переместит папку WindowsCE в папку VisualBasic, Windows CE приложения по-прежнему будут отображаться в корне **визуального C#**  элемента. узел.

##### <a name="localizing-the-node-name"></a>Локализация имени узла
 Когда Visual Studio просматривает папки Прожекттемплатес, он проверяет все найденные встдир файлы. Файл встдир — это XML-файл, который управляет внешним видом типа проекта в диалоговом окне **Новый проект** . В файле встдир используйте тег \<LocalizedName >, чтобы присвоить имя узлу **типы проектов** .

 Например, файл \Кшарп\датабасе\темплатеиндекс.встдир содержит следующий тег:

```
<LocalizedName Package="{462b036f-7349-4835-9e21-bec60e989b9c}" ID="4598"/>
```

 Это определяет вспомогательную библиотеку DLL и идентификатор ресурса локализованной строки, которая именует корневой узел, в данном случае это **база данных**. Локализованное имя может содержать специальные символы, недоступные для имен папок, таких как **.NET**.

 Если тег > \<LocalizedName отсутствует, тип проекта будет называться самой папкой **SmartPhone2003**.

##### <a name="finding-the-sort-order-for-a-project-type"></a>Поиск порядка сортировки для типа проекта
 Чтобы определить порядок сортировки типа проекта, файлы. встдир используют тег \<SortOrder >.

 Например, файл \Кшарп\виндовс\виндовс.встдир содержит следующий тег:

```
<SortOrder>5</SortOrder>
```

 Файл \Кшарп\датабасе\темплатеиндекс.встдир имеет тег с большим значением:

```
<SortOrder>5000</SortOrder>
```

 Чем меньше число в теге \<SortOrder >, тем выше расположение в дереве, таким образом, узел **Windows** отображается выше, чем узел **базы данных** в дереве **типов проектов** .

 Если для типа проекта не указан тег \<SortOrder >, он отображается в алфавитном порядке после всех типов проектов, содержащих спецификации \<SortOrder >.

 Обратите внимание, что в папках Мои документы (**Мои шаблоны**) нет файлов встдир. Имена типов проектов пользовательских приложений не локализуются и отображаются в алфавитном порядке.

#### <a name="a-quick-review"></a>Быстрая проверка
 Давайте изменим диалоговое окно **Новый проект** и создадим новый шаблон пользовательского проекта.

1. Добавьте вложенную папку Мипрожектноде в папку \Program Files\Microsoft Visual Studio .\n\n-\ Common7\IDE\ProjectTemplates\CSharp.

2. Создайте файл MyProject. встдир в папке Мипрожектноде с помощью любого текстового редактора.

3. Добавьте следующие строки в файл встдир:

   ```
   <TemplateDir Version="1.0.0">
       <SortOrder>6</SortOrder>
   </TemplateDir>
   ```

4. Сохраните и закройте файл встдир.

5. Создайте файл MyProject. vstemplate в папке Мипрожектноде с помощью любого текстового редактора.

6. Добавьте следующие строки в VSTEMPLATE файл.

   ```
   <VSTemplate Version="2.0.0" Type="Project" xmlns="http://schemas.microsoft.com/developer/vstemplate/2005">
       <TemplateData>
           <ProjectType>CSharp</ProjectType>
       </TemplateData>
   </VSTemplate>
   ```

7. Сохраните VSTEMPLATE файл и закройте редактор.

8. Отправьте VSTEMPLATE-файл в новую сжатую папку Мипрожектноде\мипрожект.ЗИП.

9. В окне командной строки Visual Studio введите:

    ```
    devenv /installvstemplates
    ```

   Запустите Visual Studio.

10. Откройте диалоговое окно **Создание проекта** и разверните узел **визуального C#**  проекта.

    ![мипрожектноде](../../extensibility/internals/media/myprojectnode.png "MyProjectNode")

    **Мипрожектноде** отображается как дочерний узел визуального C# элемента непосредственно под узлом Windows.

## <a name="see-also"></a>См. также
- [Создание нового проекта. Как это работает, часть 2](../../extensibility/internals/new-project-generation-under-the-hood-part-two.md)