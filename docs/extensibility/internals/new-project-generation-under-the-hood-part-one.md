---
title: 'Новое поколение проекта: Под капотом, часть первая (ru) Документы Майкрософт'
ms.date: 11/04/2016
ms.topic: conceptual
helpviewer_keywords:
- projects [Visual Studio], new project dialog
- projects [Visual Studio], new project generation
ms.assetid: 66778698-0258-467d-8b8b-c351744510eb
author: acangialosi
ms.author: anthc
manager: jillfra
ms.workload:
- vssdk
ms.openlocfilehash: aca35e85e57a07a2b411a23d81b99cff9983b9c2
ms.sourcegitcommit: 16a4a5da4a4fd795b46a0869ca2152f2d36e6db2
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/06/2020
ms.locfileid: "80707057"
---
# <a name="new-project-generation-under-the-hood-part-one"></a>Создание нового проекта. Как это работает, часть 1
Вы когда-нибудь задумывалось о том, как создать свой собственный тип проекта? Интересно, что на самом деле происходит при создании нового проекта? Давайте взглянем под капот и посмотрим, что происходит на самом деле.

 Есть несколько задач, которые Visual Studio координирует для вас:

- Он отображает дерево всех доступных типов проектов.

- Он отображает список шаблонов приложений для каждого типа проекта и позволяет выбрать один из них.

- Он собирает информацию о проекте для приложения, например название проекта и путь.

- Он передает эту информацию на проектзавода.

- Он генерирует элементы проекта и папки в текущем решении.

## <a name="the-new-project-dialog-box"></a>Новый проект Диалог Box
 Все начинается при выборе типа проекта для нового проекта. Начнем с нажатия **нового проекта** в меню **файла.** Появляется диалоговая коробка **Нового проекта,** выглядящая примерно так:

 ![Диалоговое окно "Новый проект"](../../extensibility/internals/media/newproject.gif "NewProject")

 Рассмотрим их подробнее. **В типе дерева Project** перечислены различные типы проектов, которые можно создать. При выборе типа проекта, такого как **Visual C' Windows,** вы увидите список шаблонов приложений, чтобы начать работу. **Шаблоны Visual Studio** устанавливаются Visual Studio и доступны любому пользователю вашего компьютера. Новые шаблоны, которые вы создаете или собираете, могут быть добавлены в **My Templates** и доступны только вам.

 При выборе шаблона, такого как **Windows Application,** описание типа приложения отображается в диалоговом поле; в этом случае **проект для создания приложения с пользовательским интерфейсом Windows.**

 В нижней части диалогового окна **нового проекта** вы увидите несколько элементов управления, которые собирают больше информации. Элементы управления, которые вы видите, зависят от типа проекта, но обычно они включают в себя текстовый ящик **названия** проекта, текстовый ящик **местоположения** и соответствующую кнопку **«Обзор»,** а также текстовый ящик **«Имя решения»** и связанный с ним **каталог «Создать» для** флажка решения.

## <a name="populating-the-new-project-dialog-box"></a>Заполнение нового проекта Диалог Box
 Откуда у нового диалогового ящика **проекта** получает сяротку? Здесь работают два механизма, один из которых обесточен. Диалоговая коробка **Нового проекта** объединяет и отображает информацию, полученную от обоих механизмов.

 Старый (унипраженный) метод использует записи системного реестра и файлы .vsdir. Этот механизм работает при открытии Visual Studio. Новый метод использует файлы .vstemplate. Этот механизм работает, когда Visual Studio инициализирована, например, при запуске

```
devenv /setup
```

 or

```
devenv /installvstemplates
```

### <a name="project-types"></a>Типы проектов
 Положение и названия корневых узлов **типов проекта,** таких как **Visual C и** Other **Languages,** определяются записями в реестре систем. Организация узла мидцат, таких как **База данных** и **Смарт-устройство,** отражает иерархию папок, содержащих соответствующие файлы .vstemplate. Давайте сначала взглянем на корневые узлы.

#### <a name="project-type-root-nodes"></a>Корневые узлы типа проекта
 Когда [!INCLUDE[vsprvs](../../code-quality/includes/vsprvs_md.md)] инициализировано, он пересекает подключи ключа системного реестра HKEY_LOCAL_MACHINE»SOFTWARE-Microsoft-VisualStudio-14.0-NewProjectTemplates-TemplateDirs для создания и названия корневых узлов дерева **типов проекта.** Эта информация кэшируется для последующего использования. Посмотрите на ключ\\TemplateDirs (FAE04EC1-301F-11D3-BF4B-00C04F79EFBC)\\/1. Каждая запись ЯВЛЯЕТСЯ GUID VSPackage. Имя подключаемого ключа (/1) игнорируется, но его присутствие указывает на то, что это корневой узла **типа проекта.** Корневый узло, в свою очередь, может иметь несколько подключ, которые контролируют его появление в дереве **типов проекта.** Давайте посмотрим на некоторые из них.

##### <a name="default"></a>(по умолчанию)
 Это идентификатор ресурсов локализованной строки, который называет корневой узла. Ресурс строки расположен в спутнике DLL, выбранном GUID VSPackage.

 В этом примере GUID VSPackage

 (FAE04EC1-301F-11D3-BF4B-00C04F79EFBC)

 иидентификатор ресурса (значение по умолчанию) корневого узла (/1) является #2345

 Если вы посмотрите на GUID в соседнем ключе Пакетов и изучите подключку SatelliteDll, вы можете найти путь сборки, содержащий ресурс строки:

 \<Путь установки Visual Studio>»VCSPackages»1033-csprojui.dll

 Чтобы проверить это, откройте файл Explorer и перетащите csprojui.dll в каталог Visual Studio. Таблица строк показывает, что #2345 ресурсов имеет заголовок **Visual C .**

##### <a name="sortpriority"></a>СортировкаПриоритет
 Это определяет положение корневого узла в дереве **типов проекта.**

 SortPriority REG_DWORD 0x00000014 (20)

 Чем меньше количество приоритета, тем выше положение в дереве.

##### <a name="developeractivity"></a>Активность разработчиков
 Если этот подключ присутствует, то положение корневого узла контролируется диалоговое окно настройки разработчика. Например,

 Активность разработчика REG_SZ VC #

 указывает на то, что Visual C' будет корневым узлом, если Visual Studio настроена на [!INCLUDE[vcprvc](../../code-quality/includes/vcprvc_md.md)] разработку. В противном случае, это будет детский узла **других языков.**

##### <a name="folder"></a>Папка
 Если этот подключ присутствует, то корневой узла становится узлами ребенка указанной папки. Список возможных папок отображается под ключом

 HKEY_LOCAL_MACHINE-SOFTWARE-Microsoft-VisualStudio-11.0 -NewProjectTemplates-PseudoFolders

 Например, запись проектов баз данных имеет ключ Folder, который соответствует записи других типов проектов в PseudoFolders. Таким образом, в дереве **типов проектов** **проекты базы данных** будут детским узлом **других типов проектов.**

#### <a name="project-type-child-nodes-and-vstdir-files"></a>Детские узлы типа проекта и файлы .vstdir
 Положение узлов ребенка в дереве **типов project** следует иерархии папок в папках ProjectTemplates. Для шаблонов машин **(Visual Studio установленных шаблонов**), типичный место является "Программа Файлы"Microsoft Visual Studio 14.0 "Common7"IDE -Проект шаблоны " и для шаблонов пользователей\\(**Мои шаблоны**), типичное местоположение является "Мои документы"Visual Studio 14.0 "Шаблоны"Проекты . Иерархии папок из этих двух местоположений объединяются для создания дерева **типов проекта.**

 Для Visual Studio с настройками разработчика C', дерево **типов проекта** выглядит примерно так:

 ![Типы проектов](../../extensibility/internals/media/projecttypes.png "ПроектТипы")

 Соответствующая папка ProjectTemplates выглядит следующим образом:

 ![Шаблоны проекта](../../extensibility/internals/media/projecttemplates.png "ProjectTemplates")

 При открытии окна диалога [!INCLUDE[vsprvs](../../code-quality/includes/vsprvs_md.md)] **Нового проекта,** пересекает папку ProjectTemplates и воссоздает ее структуру в дереве **типов проекта** с некоторыми изменениями:

- Корневой узло в дереве **типов проекта** определяется шаблоном приложения.

- Имя узла может быть локализовано и может содержать специальные символы.

- Порядок сортировки может быть изменен.

##### <a name="finding-the-root-node-for-a-project-type"></a>Поиск корневого узла для типа проекта
 Когда Visual Studio пересекает папки ProjectTemplates, она открывает все файлы .zip и извлекает все файлы .vstemplate. Файл .vstemplate использует XML для описания шаблона приложения. Для получения дополнительной информации, [см.](../../extensibility/internals/new-project-generation-under-the-hood-part-two.md)

 Тег \<ProjectType> определяет тип проекта для приложения. Например, файл «CSharp»SmartDevice,WindowsCE»1033»WindowsCE-EmptyProject.zip содержит файл EmptyProject.vstemplate с этим тегом:

```
<ProjectType>CSharp</ProjectType>
```

 Тег \<ProjectType>, а не субфолдер в папке ProjectTemplates определяет корневой узел приложения в дереве **типов проекта.** В этом примере приложения Windows CE будут отображаться под корневым узлом **Visual C,** и даже если вы переведете папку WindowsCE в папку VisualBasic, приложения Windows CE по-прежнему будут отображаться под корневым узлом **Visual C.**

##### <a name="localizing-the-node-name"></a>Локализация имени узла
 Когда Visual Studio пересекает папки ProjectTemplates, она исследует все файлы .vstdir, которые она находит. Файл .vstdir — это файл XML, который контролирует внешний вид типа проекта в диалоговом окне **нового проекта.** В файле .vstdir \<используйте> localizedName, чтобы назвать **узло типов project.**

 Например, файл «CSharp»Database/TemplateIndex.vstdir содержит этот тег:

```
<LocalizedName Package="{462b036f-7349-4835-9e21-bec60e989b9c}" ID="4598"/>
```

 Это определяет спутниковый DLL и идентификатор ресурсов локализованной строки, которая называет корневой узло, в данном случае, **база данных**. Локализованное имя может содержать специальные символы, которые недоступны для имен папок, таких как **.NET.**

 Если \<нет локального> тега нет, тип проекта назван самой папкой, **SmartPhone2003.**

##### <a name="finding-the-sort-order-for-a-project-type"></a>Поиск сортировки для типа проекта
 Чтобы определить порядок типа проекта, файлы .vstdir используют тег \<SortOrder>.

 Например, файл «CSharp»Windows.vstdir содержит этот тег:

```
<SortOrder>5</SortOrder>
```

 Файл «CSharp»Database-TemplateIndex.vstdir имеет тег с большим значением:

```
<SortOrder>5000</SortOrder>
```

 Чем ниже число \<в бирке SortOrder>, тем выше положение в дереве, поэтому узло **Windows** отображается выше, чем узло **базы данных** в дереве **типов проекта.**

 Если \<для типа проекта не указан тег SortOrder>, он отображается \<в алфавитном порядке в соответствии с любыми типами проектов, содержащими спецификации SortOrder>.

 Обратите внимание, что в папках **«Мои документы» (My Templates)** нет файлов .vstdir. Имена типов приложений пользователя не локализованы и отображаются в алфавитном порядке.

#### <a name="a-quick-review"></a>Быстрый обзор
 Давайте изменим диалоговую коробку **Нового проекта** и создадим новый шаблон пользовательского проекта.

1. Добавьте субфолдер MyProjectNode в папку «Файлы программы» Microsoft Visual Studio 14.0»Common7»IDE-ProjectTemplates-CSharp.

2. Создайте файл MyProject.vstdir в папке MyProjectNode с помощью любого текстового редактора.

3. Добавьте эти строки в файл .vstdir:

   ```
   <TemplateDir Version="1.0.0">
       <SortOrder>6</SortOrder>
   </TemplateDir>
   ```

4. Сохранить и закрыть файл .vstdir.

5. Создайте файл MyProject.vstemplate в папке MyProjectNode с помощью любого текстового редактора.

6. Добавьте эти строки в файл .vstemplate:

   ```
   <VSTemplate Version="2.0.0" Type="Project" xmlns="http://schemas.microsoft.com/developer/vstemplate/2005">
       <TemplateData>
           <ProjectType>CSharp</ProjectType>
       </TemplateData>
   </VSTemplate>
   ```

7. Сохранить файл.vstemplate и закрыть редактор.

8. Отправьте файл .vstemplate в новую сжатую папку MyProjectNode-MyProject.zip.

9. Из окна команды Visual Studio введите:

    ```
    devenv /installvstemplates
    ```

   Запустите Visual Studio.

10. Откройте диалоговую коробку **нового проекта** и расширьте узлы проекта **Visual C.**

    ![MyProjectNode](../../extensibility/internals/media/myprojectnode.png "MyProjectNode")

    **MyProjectNode** отображается как детский узло Visual C, как раз под узлом Windows.

## <a name="see-also"></a>См. также
- [Создание нового проекта. Как это работает, часть 2](../../extensibility/internals/new-project-generation-under-the-hood-part-two.md)
