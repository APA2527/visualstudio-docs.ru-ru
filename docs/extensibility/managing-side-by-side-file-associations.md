---
title: Управление бок о бок ассоциации файлов (ru) Документы Майкрософт
ms.date: 11/04/2016
ms.topic: conceptual
helpviewer_keywords:
- verbs, setting default
ms.assetid: 9b6df3bc-d15c-4a5d-9015-948a806193b7
author: acangialosi
ms.author: anthc
manager: jillfra
ms.workload:
- vssdk
ms.openlocfilehash: 6c284fe7ef4c2d07051a8524860583cb634e13bf
ms.sourcegitcommit: 16a4a5da4a4fd795b46a0869ca2152f2d36e6db2
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/06/2020
ms.locfileid: "80702763"
---
# <a name="manage-side-by-side-file-associations"></a>Управление бок о бок ассоциации файлов

Если ваш VSPackage предоставляет ассоциации файлов, вы должны решить, как обрабатывать бок [!INCLUDE[vsprvs](../code-quality/includes/vsprvs_md.md)] о бок установки, в которых конкретная версия должна быть вызвана, чтобы открыть файл. Несовместимые форматы файлов усугубляют проблему.

Пользователи ожидают, что новая версия продукта будет совместима с более ранними версиями, так что существующие файлы могут быть загружены в новую версию без потери данных. В идеале ваш VSPackage может как загружать, так и сохранять форматы файлов более ранних версий. Если это не так, вы должны предложить обновить формат файла до новой версии вашего VSPackage. Недостатком этого подхода является то, что обновленный файл не может быть открыт в более ранней версии.

Чтобы избежать этой проблемы, можно изменить расширения, когда форматы файлов становятся несовместимыми. Например, версия 1 вашего VSPackage может использовать расширение, *.mypkg10*, и версия 2 может использовать расширение, *.mypkg20*. Эта разница определяет VSPackage, который открывает определенный файл. Если вы добавите новые VSPackages в список программ, связанных со старым расширением, пользователи могут нажать правой кнопкой мыши файл и выбрать, чтобы открыть его в новом VSPackage. В этот момент ваш VSPackage может предложить обновить файл до нового формата или открыть файл и поддерживать совместимость с более ранними версиями VSPackage.

> [!NOTE]
> Вы можете объединить эти подходы. Например, можно предложить обратную совместимость, загрузив старый файл и предложив обновить формат файла, когда пользователь сохранит его.

## <a name="face-the-problem"></a>Лицо множеся проблема

Если вы хотите, чтобы несколько VSPackages были использовать одно и [!INCLUDE[vsprvs](../code-quality/includes/vsprvs_md.md)] то же расширение, необходимо выбрать версию, связанную с расширением. Вот две альтернативы:

- Откройте файл в последней версии, [!INCLUDE[vsprvs](../code-quality/includes/vsprvs_md.md)] установленной на компьютере пользователя.

   В этом подходе ваш установщик отвечает [!INCLUDE[vsprvs](../code-quality/includes/vsprvs_md.md)] за определение последней версии и в том числе в регистрационном входе, написанном для файла ассоциации. В пакет установщика Windows можно включить пользовательские действия для [!INCLUDE[vsprvs](../code-quality/includes/vsprvs_md.md)]установки свойства, указывающее последнюю версию.

  > [!NOTE]
  > В этом контексте "последняя" означает "последняя поддерживаемая версия". Эти записи [!INCLUDE[vsprvs](../code-quality/includes/vsprvs_md.md)]установки не будут автоматически обнаруживать последующий выпуск . Записи в [обнаружении системных требований](../extensibility/internals/detecting-system-requirements.md) и в [командах, которые должны быть запущены](../extensibility/internals/commands-that-must-be-run-after-installation.md) [!INCLUDE[vsprvs](../code-quality/includes/vsprvs_md.md)]после установки, аналогичны представленным здесь и необходимы для поддержки дополнительных версий .

   Следующие строки в таблице CustomAction устанавливают DEVENV_EXE_LATEST свойство как свойство, установленное таблицами AppSearch и RegLocator, [обсуждаемых в командах, которые должны быть запущены после установки.](../extensibility/internals/commands-that-must-be-run-after-installation.md) Строки в таблице InstallExecuteSequence запланировали пользовательские действия в начале последовательности выполнения. Значения в столбце состояния заставляют работу логики:

  - Visual Studio .NET 2002 является последней версией, если это единственная нынешняя версия.

  - Visual Studio .NET 2003 является последней версией только в том случае, если она присутствует и [!INCLUDE[vsprvs](../code-quality/includes/vsprvs_md.md)] не присутствует.

  - [!INCLUDE[vsprvs](../code-quality/includes/vsprvs_md.md)]является последней версией, если это единственная нынешняя версия.

    В результате DEVENV_EXE_LATEST содержит путь последней версии devenv.exe.

  **Строки таблицcustomAction, определяющие последнюю версию Visual Studio**

  |Действие|Type|Источник|Назначение|
  |------------|----------|------------|------------|
  |CA_SetDevenvLatest_2002|51|DEVENV_EXE_LATEST|(DEVENV_EXE_2002)|
  |CA_SetDevenvLatest_2003|51|DEVENV_EXE_LATEST|(DEVENV_EXE_2003)|
  |CA_SetDevenvLatest_2005|51|DEVENV_EXE_LATEST|(DEVENV_EXE_2005)|

  **УстановкаСтрока таблиц, определяющих последнюю версию Visual Studio**

  |Действие|Условие|Последовательность|
  |------------|---------------|--------------|
  |CA_SetDevenvLatest_2002|DEVENV_EXE_2002 И НЕ (DEVENV_EXE_2003 или DEVENV_EXE_2005)|410|
  |CA_SetDevenvLatest_2003|DEVENV_EXE_2003 И НЕ DEVENV_EXE_2005|420|
  |CA_SetDevenvLatest_2005|DEVENV_EXE_2005|430|

   Вы можете использовать DEVENV_EXE_LATEST свойство в таблице реестра пакета установки Windows, чтобы написать **значение ключа HKEY_CLASSES_ROOT*ProgId*ShellOpenCommand** по умолчанию, «DEVENV_EXE_LATEST» «%1»

- Выполнить общую программу пусковой установки, которая может сделать лучший выбор из доступных версий VSPackage.

   Разработчики [!INCLUDE[vsprvs](../code-quality/includes/vsprvs_md.md)] выбрали этот подход для обработки сложных требований нескольких форматов решений [!INCLUDE[vsprvs](../code-quality/includes/vsprvs_md.md)]и проектов, которые являются результатом многих версий . В этом подходе вы регистрируете программу пусковой установки в качестве обработчика расширения. Пусковая установка изучает файл и [!INCLUDE[vsprvs](../code-quality/includes/vsprvs_md.md)] решает, какая версия и ваш VSPackage может обрабатывать этот конкретный файл. Например, если пользователь открывает файл, который в последний раз был сохранен определенной версией вашего [!INCLUDE[vsprvs](../code-quality/includes/vsprvs_md.md)]VSPackage, пусковая установка может начать, что VSPackage в соответствующей версии. Кроме того, пользователь может настроить пусковую установку, чтобы всегда запускать последнюю версию. Пусковая установка также может побудить пользователя обновить формат файла. Если формат файла включает номер версии, пусковая установка может сообщить пользователю, если формат файла из версии, которая находится позже, чем один или несколько установленных VSPackages.

   Пусковая установка должна быть в компоненте установки Windows, который совместно со всеми версиями вашего VSPackage. Этот процесс гарантирует, что последняя версия всегда установлена и не удаляется до тех пор, пока не будут не установлены все версии вашего VSPackage. Таким образом, ассоциации файлов и другие записи реестра компонента пусковой установки сохраняются, даже если одна версия VSPackage не установлена.

## <a name="uninstall-and-file-associations"></a>Установить и файл ассоциации

Установка VSPackage, который записывает записи реестра для ассоциаций файлов, удаляет ассоциации файлов. Таким образом, расширение не имеет связанных программ. Установка Windows не "восстановить" записи реестра, которые были добавлены, когда VSPackage был установлен. Вот несколько способов исправления ассоциаций файлов пользователя:

- Используйте общий компонент пусковой установки, как описано ранее.

- Поручить пользователю запустить ремонт версии VSPackage, которую пользователь хочет владеть файловой ассоциацией.

- Предоставьте отдельную исполняемую программу, которая переписывает соответствующие записи реестра.

- Предоставьте страницу параметров конфигурации или диалоговое окно, которое позволяет пользователям выбирать ассоциации файлов и рекультивировать потерянные ассоциации. Поручить пользователям запустить его после неустановки.

## <a name="see-also"></a>См. также

- [Регистрация расширений имени файла для бок о бок развертывания](../extensibility/registering-file-name-extensions-for-side-by-side-deployments.md)
- [Регистрация глаголов для расширения имен файлов](../extensibility/registering-verbs-for-file-name-extensions.md)
