---
title: Рабочие области и языковые службы в Visual Studio | Документация Майкрософт
description: Узнайте, как языковые службы могут предоставлять пользователям открытых папок те же широкие возможности языка, которые используются при работе с решениями и проектами.
ms.custom: SEO-VS-2020
ms.date: 02/21/2018
ms.topic: conceptual
author: vukelich
ms.author: svukel
manager: viveis
ms.workload:
- vssdk
ms.openlocfilehash: 815cfb9e17fed38b519719010acd997f7fdc5242
ms.sourcegitcommit: 0c9155e9b9408fb7481d79319bf08650b610e719
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/05/2021
ms.locfileid: "97877043"
---
# <a name="workspaces-and-language-services"></a>Рабочие области и языковые службы

Языковые службы могут предоставлять пользователям [открытых папок](../ide/develop-code-in-visual-studio-without-projects-or-solutions.md) те же широкие возможности языка, которые используются при работе с решениями и проектами. Языковая служба может самостоятельно активироваться на основе расширения файла или содержимого открытого документа, хотя эта языковая служба "свободный файл" ограничена выделением синтаксиса. Дополнительные сведения необходимы, чтобы обеспечить более широкие возможности при редактировании и проверке исходного кода. Каждая языковая служба имеет собственный API для инициализации с этими дополнительными контекстуальными данными для документа. Обычно это управляется системой проекта, которая тесно связана как с языковой службой, так и с системой сборки.

## <a name="initialization"></a>Инициализация

В [рабочей области](workspaces.md)языковые службы инициализируются <xref:Microsoft.VisualStudio.Workspace.Intellisense.ILanguageServiceProvider> точкой расширения, которая специализируется только на этой языковой службе и не знает о создании сборки. Таким образом, владелец языковой службы может поддерживать одно расширение открытой папки независимо от того, сколько шаблонов существует в папках и файлах для запуска компилятора во время сборки (например, MSBuild, Makefiles и т. д.). Когда файлы, из которых был создан контекст файла, изменяются на диске, а контекст файла обновляется, поставщик языковой службы получает уведомления о обновленном наборе контекстов файлов. Затем поставщик языковой службы может обновить свою модель.

При открытии документа в редакторе Visual Studio рассматривает только поставщики языковой службы, которым требуются типы контекста файлов, для которых можно найти соответствующий поставщик контекста файла. Затем он передает контексты файла из соответствующих поставщиков в выбранный поставщик языковой службы через `ILanguageServiceProvider.InitializeAsync` . Принципы работы поставщика языковой службы с этими данными контекста файла — это сведения о реализации поставщика языковой службы, но ожидаемое взаимодействие с пользователем — это Расширенная языковая служба для открытого документа.

## <a name="using-ilanguageserviceprovider"></a>Использование Илангуажесервицепровидер

Языковая служба будет уведомлена при создании контекста файла `ContextType` , который соответствует одному из `SupportedContextTypes` значений атрибута экспорта языкового сервера.

Для поддержки языковой службы потребуется расширение:

- Уникальный `Guid` . Он будет использоваться для `SupportedContextTypes` аргументов атрибутов и в `FileContext` объекте.
- Контекст файла языка
  - Фабрика поставщиков
    - `ExportFileContextProviderAttribute` атрибут с указанным выше уникальным `Guid` в `SupportedContextTypes`
    - Реализует `IWorkspaceProviderFactory<IFileContextProvider>`
  - Реализация поставщика `IFileContextProvider.GetContextsForFileAsync`
    - Создать новый `FileContext` с `contextType` аргументом конструктора в качестве уникального `Guid`
    - Используйте `Context` свойство объекта, `FileContext` чтобы предоставить дополнительные данные `ILanguageServiceProvider`
- Языковая служба
  - Фабрика поставщиков
    - `ExportLanguageServiceProvider` атрибут с указанным выше уникальным `Guid` в `SupportedContextTypes`
    - Реализует `IWorkspaceProviderFactory<ILanguageServiceProvider>`
  - Поставщик
    - Реализует `ILanguageServiceProvider`
    - Использование `ILanguageServiceProvider.InitializeAsync` для включения языковых служб для указанных аргументов при открытии файла
    - Используется `ILanguageServiceProvider.UninitializeAsync` для отключения языковых служб для указанных аргументов при закрытии файла

>[!WARNING]
>`ILanguageServiceProvider`Методы могут вызываться рабочей областью в основном потоке. Рассмотрите возможность планирования работы в другом потоке, чтобы избежать возникновения задержек в пользовательском интерфейсе.

## <a name="language-server-protocol"></a>Протокол языкового сервера

`Microsoft.VisualStudio.Workspace.*`Интерфейсы API не являются единственным способом включения языковой службы в открытой папке. Другой вариант — использовать языковой сервер. Дополнительные сведения см. в статье о [протоколе языкового сервера](language-server-protocol.md).

## <a name="related-interfaces"></a>Связанные интерфейсы

- <xref:Microsoft.VisualStudio.Workspace.Intellisense.ILanguageServiceProvider> вызывается, когда файл с совпадающими типами файлов открывается или закрывается для редактирования.

## <a name="next-steps"></a>Дальнейшие действия

* [Рабочая область сборка](workspace-build.md) . открытая папка поддерживает системы сборки, такие как MSBuild и Makefile.