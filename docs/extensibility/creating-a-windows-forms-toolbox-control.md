---
title: Создание Windows Forms элемента управления панели элементов | Документация Майкрософт
ms.date: 3/16/2019
ms.topic: conceptual
helpviewer_keywords:
- winforms
- toolbox
- windows forms
ms.assetid: 0be6ffc1-8afd-4d02-9a5d-e27dde05fde6
author: madskristensen
ms.author: madsk
manager: jillfra
ms.workload:
- vssdk
ms.openlocfilehash: 3887a2d54f2744504f587b848bc1395090c3904c
ms.sourcegitcommit: 40d612240dc5bea418cd27fdacdf85ea177e2df3
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 05/29/2019
ms.locfileid: "66345414"
---
# <a name="create-a-windows-forms-toolbox-control"></a>Создание элемента управления панели элементов Windows Forms

Шаблон элемента управления панели элементов Windows Forms, включенный в средства расширения Visual Studio (VS SDK), позволяет создавать **элементов** элемент управления, который автоматически добавляется при установке расширения. В этом пошаговом руководстве показано, как использовать шаблон для создания элемента управления с простой счетчик, который можно передавать другим пользователям.

## <a name="prerequisites"></a>Предварительные требования

Начиная с Visual Studio 2015, не следует устанавливать пакет SDK для Visual Studio из центра загрузки. Она будет включена в качестве дополнительного компонента в программе установки Visual Studio. VS SDK также можно установить позже. Дополнительные сведения см. в разделе [установить пакет SDK для Visual Studio](../extensibility/installing-the-visual-studio-sdk.md).

## <a name="create-the-toolbox-control"></a>Создание элемента управления панели элементов

Шаблон элемента управления панели элементов Windows Forms создает неопределенный пользовательский элемент управления и предоставляет все функциональные возможности, необходимые для добавления элемента управления в **элементов**.

### <a name="create-an-extension-with-a-windows-forms-toolbox-control"></a>Создание расширения с помощью элемента управления панели элементов Windows Forms

1. Создайте проект VSIX с именем `MyWinFormsControl`. Вы найдете шаблон проекта VSIX в **новый проект** диалоговом окне, выполняя поиск «vsix».

2. При открытии проекта добавьте **элемента управления панели элементов Windows Forms** шаблон элемента с именем `Counter`. В **обозревателе решений**, щелкните правой кнопкой мыши узел проекта и выберите **добавить** > **новый элемент**. В **Добавление нового элемента** диалоговое окно, перейдите к **Visual C#**  > **расширяемости** и выберите **элемента управления панели элементов Windows Forms**

3. Это добавляет пользовательский элемент управления, `ProvideToolboxControlAttribute` <xref:Microsoft.VisualStudio.Shell.RegistrationAttribute> необходимо вставить элемент управления в **элементов**и **Microsoft.VisualStudio.ToolboxControl** запись ресурса в манифест VSIX для развертывания.

### <a name="build-a-user-interface-for-the-control"></a>Создать пользовательский интерфейс для элемента управления

`Counter` Элемент управления требует двух дочерних элементов управления: <xref:System.Windows.Forms.Label> для отображения текущего счетчика и <xref:System.Windows.Forms.Button> для сброса счетчика в 0. Нет других дочерних элементов управления требуются, так как вызывающие объекты будут увеличения значения счетчика программным способом.

#### <a name="to-build-the-user-interface"></a>Создание пользовательского интерфейса

1. В **обозревателе решений**, дважды щелкните *Counter.cs* чтобы открыть его в конструкторе.

2. Удалить **здесь!** Кнопка, которая включается по умолчанию при добавлении шаблона элемента управления панели элементов Windows Forms.

3. Из **элементов**, перетащите `Label` управления и затем `Button` управления под его в область конструктора.

4. Измените общий элемент управления на 150, 50 пикселей, а также изменить размер кнопки элемента управления до 50, номер 20 пикселей.

5. В **свойства** окна, задайте следующие значения для элементов управления в рабочей области конструирования.

    |Элемент управления|Свойство|Значение|
    |-------------|--------------|-----------|
    |`Label1`|**Text**|""|
    |`Button1`|**Name**|btnReset|
    |`Button1`|**Text**|Сбросить|

### <a name="code-the-user-control"></a>Код пользовательского элемента управления

`Counter` Управления будет предоставлять метод для увеличения значения счетчика, событие возникает в том случае, когда значение счетчика увеличивается, **Сброс** кнопку и три свойства для хранения текущего значения счетчика, отображаемого текста и необходимость отображения или скрыть **Сброс** кнопки. Атрибут `ProvideToolboxControl` определяет место на **панели элементов** , в котором будет отображаться элемент управления `Counter` .

#### <a name="to-code-the-user-control"></a>К коду пользовательского элемента управления

1. Дважды щелкните форму, чтобы открыть ее обработчик события загрузки в окне кода.

2. Выше метод обработчика событий в класс элемента управления создайте целое число для хранения значения счетчика и строки для хранения текста, отображаемого, как показано в следующем примере.

    ```csharp
    int currentValue;
    string displayText;
    ```

3. Создайте следующие объявления открытого свойства.

    ```csharp
    public int Value {
        get { return currentValue; }
    }

    public string Message {
        get { return displayText; }
        set { displayText = value; }
    }

    public bool ShowReset {
        get { return btnReset.Visible; }
        set { btnReset.Visible = value; }
    }

    ```

    Вызывающие объекты получить доступ к свойствам get и set счетчика отображаемый текст для отображения или скрытия **Сброс** кнопки. Вызывающие объекты можно получить текущее значение только для чтения `Value` свойство, но их невозможно задать значение напрямую.

4. Поместите следующий код `Load` событие элемента управления.

    ```csharp
    private void Counter_Load(object sender, EventArgs e)
    {
        currentValue = 0;
        label1.Text = Message + Value;
    }

    ```

    Установка **метка** текста в <xref:System.Windows.Forms.UserControl.Load> событие позволяет загрузить перед применением их значения свойства целевого объекта. Установка **метка** текст в конструкторе приведет пустой **метка**.

5. Создайте приведенный ниже открытый метод для увеличения значения счетчика.

    ```csharp
    public void Increment()
    {
        currentValue++;
        label1.Text = displayText + Value;
        Incremented(this, EventArgs.Empty);
    }

    ```

6. Добавьте объявление для `Incremented` событий в класс элемента управления.

    ```csharp
    public event EventHandler Incremented;
    ```

    Вызывающие объекты можно добавить обработчики к этому событию реагировать на изменения в значении счетчика.

7. Вернуться в режим конструктора и дважды щелкните **Сброс** кнопку, чтобы создать `btnReset_Click` обработчик событий, а затем введите в, как показано в следующем примере.

    ```csharp
    private void btnReset_Click(object sender, EventArgs e)
    {
        currentValue = 0;
        label1.Text = displayText + Value;
    }

    ```

8. Непосредственно над определением класса в объявлении атрибута `ProvideToolboxControl` измените значение первого параметра с `"MyWinFormsControl.Counter"` на `"General"`. Таким образом задается имя группы элементов, в которой будет размещаться элемент управления на **панели элементов**.

    В приведенном ниже примере показаны атрибут `ProvideToolboxControl` и скорректированное определение класса.

    ```csharp
    [ProvideToolboxControl("General", false)]
    public partial class Counter : UserControl
    ```

### <a name="test-the-control"></a>Тестирование элемента управления

 Для тестирования **элементов** управления, сначала протестируйте его в среде разработки и затем протестировать ее в скомпилированном приложении.

#### <a name="to-test-the-control"></a>Тестирование элемента управления

1. Нажмите клавишу **F5** для **начать отладку**.

    Эта команда выполняет сборку проекта и открывается второй экспериментальный экземпляр Visual Studio с элементом управления, установленным.

2. В экспериментальном экземпляре Visual Studio, создайте **приложение Windows Forms** проекта.

3. В **обозревателе решений**, дважды щелкните *Form1.cs* чтобы открыть его в конструкторе, если он еще не открыт.

4. В **элементов**, `Counter` элемент должен отображаться в **Общие** раздел.

5. Перетащите `Counter` в форму элемент управления, а затем выберите его. `Value`, `Message`, И `ShowReset` свойства будут отображены в **свойства** окне вместе со свойствами, которые наследуются от <xref:System.Windows.Forms.UserControl>.

6. Задайте для свойства `Message` значение `Count:`.

7. Перетащите <xref:System.Windows.Forms.Button> управления в форму и задайте свойства name и текст кнопки `Test`.

8. Дважды щелкните кнопку, чтобы открыть *Form1.cs* в представление кода и создайте обработчик щелчка.

9. В обработчик щелчка, вызовите `counter1.Increment()`.

10. В функции конструктора после вызова `InitializeComponent`, тип `counter1``.``Incremented +=` и нажмите клавишу **вкладке** дважды.

    Visual Studio создает обработчик уровне форм для `counter1.Incremented` событий.

11. Выделите `Throw` инструкции в обработчике событий, тип `mbox`и нажмите клавишу **вкладке** дважды, чтобы создать окно сообщения из фрагмента кода почтовый ящик.

12. На следующей строке, добавьте следующий `if` / `else` блок, чтобы задать видимость **Сброс** кнопки.

    ```csharp
    if (counter1.Value < 5) counter1.ShowReset = false;
    else counter1.ShowReset = true;
    ```

13. Нажмите клавишу **F5**.

    Форма откроется. `Counter` Элемент управления отображает следующий текст.

    **Число: 0**

14. Нажмите кнопку **Test**.

    Увеличения значения счетчика и Visual Studio отображает окно сообщения.

15. Закрывайте окно сообщения.

    **Сброс** кнопка будет скрыта.

16. Нажмите кнопку **теста** пока не достигнет счетчика **5** Закрытие сообщения поля каждый раз.

    **Сброс** кнопку отобразится.

17. Нажмите кнопку **Reset**.

    Сбрасывает счетчик **0**.

## <a name="next-steps"></a>Следующие шаги

При построении **элементов** элемент управления, Visual Studio создает файл с именем *ProjectName.vsix* в папке \bin\debug\ проекта. Можно развернуть элемент управления, отправив *.vsix* файла в сети или на веб-сайт. Когда пользователь открывает *.vsix* файл, элемент управления устанавливается и добавляется к Visual Studio **элементов** на компьютере пользователя. Кроме того, вы можете отправить *.vsix* файл [Visual Studio Marketplace](https://marketplace.visualstudio.com/) , чтобы пользователи могли его найти, перейдя в **средства**  >   **Расширения и обновления** диалоговое окно.

## <a name="see-also"></a>См. также

- [Расширение других частей Visual Studio](../extensibility/extending-other-parts-of-visual-studio.md)
- [Создание элемента управления панели элементов WPF](../extensibility/creating-a-wpf-toolbox-control.md)
- [Расширение других частей Visual Studio](../extensibility/extending-other-parts-of-visual-studio.md)
- [Основы разработки элементов управления Windows Forms](/dotnet/framework/winforms/controls/windows-forms-control-development-basics)
