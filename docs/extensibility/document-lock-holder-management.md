---
title: Управление контейнером блокировки документа | Документация Майкрософт
ms.date: 11/04/2016
ms.topic: conceptual
helpviewer_keywords:
- editors [Visual Studio SDK], custom - document locking
ms.assetid: fa1ce513-eb7d-42bc-b6e8-cb2433d051d5
author: gregvanl
ms.author: gregvanl
manager: jillfra
ms.workload:
- vssdk
ms.openlocfilehash: a1d0a9c94488ef5b34971faff7327cef4dc7ee05
ms.sourcegitcommit: 94b3a052fb1229c7e7f8804b09c1d403385c7630
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/23/2019
ms.locfileid: "62912820"
---
# <a name="document-lock-holder-management"></a>Управление контейнером блокировки документа

Таблице выполняющихся документов (RDT) хранит количество открытых документов и любой блокировок правки, которые у них есть. Когда программным образом он изменяется в фоновом режиме без пользователя, Просмотр открытого документа в окне документа, можно поместить блокировку редактирования документа в RDT. Эта функция часто используется конструкторами, которые изменяют несколько файлов с помощью графического интерфейса.

## <a name="document-lock-holder-scenarios"></a>Сценарии держатель блокировки документа

### <a name="file-a-has-a-dependence-on-file-b"></a>Файл «» имеет зависимость от файла «b»

Допустим, вы реализуете стандартного редактора «A» для типа файлов «a», а каждый файл типа «» есть ссылка на (или зависимость от) файл типа «b». Для файлов типа «b» существует стандартный редактор «B». Когда откроется редактор «A» файл «», он извлекает ссылку на соответствующий файл «b». Файл «b» не отображается, но можно изменить редактор «A». Редактор «A» получает ссылку на данные документа из файла «b» из <xref:Microsoft.VisualStudio.Shell.Interop.IVsRunningDocumentTable.FindAndLockDocument%2A> метод и также поддерживает блокировку редактирования файла «b». После завершения редактор «A» изменение файла «b», можно уменьшить блокировку редактирования рассчитывать на файл «b», вызвав <xref:Microsoft.VisualStudio.Shell.Interop.IVsRunningDocumentTable.UnlockDocument%2A> метод. Этот шаг можно пропустить, если бы Вы вызвали <xref:Microsoft.VisualStudio.Shell.Interop.IVsRunningDocumentTable.FindAndLockDocument%2A> метод с параметром `dwRDTLockType` присвоено [_VSRDTFLAGS. RDT_NoLock](<xref:Microsoft.VisualStudio.Shell.Interop._VSRDTFLAGS.RDT_NoLock>).

### <a name="file-b-is-opened-by-a-different-editor"></a>Файл «b» открыт в другом редакторе

В случае, если файл «b» уже открыт редактор «B» при попытке открыть его редактор «A», существует два отдельных сценария для обработки.

- Если файл «b» открыт в редакторе совместимы, необходимо иметь редактора «A» зарегистрировать блокировку редактирования документа с помощью файла «b» <xref:Microsoft.VisualStudio.Shell.Interop.IVsRunningDocumentTable.RegisterDocumentLockHolder%2A> метод. После завершения изменения файла «b» в редакторе «A» отменить регистрацию документа изменить блокировку с помощью <xref:Microsoft.VisualStudio.Shell.Interop.IVsRunningDocumentTable.UnregisterDocumentLockHolder%2A> метод.

- Если недопустимым образом открыт файл «b», вы можете позволить попытки открытия файла «b» «» сбой, или можно разрешить представление, связанное с редактором «A» частично открыть и отобразить соответствующее сообщение об ошибке редактором. Сообщение об ошибке должно предлагать пользователю закрыть файл «b» в несовместимом редакторе, а затем снова откройте файл «» с использованием редактора «A». Вы также можете реализовать [!INCLUDE[vsipsdk](../extensibility/includes/vsipsdk_md.md)] метод <xref:Microsoft.VisualStudio.Shell.Interop.IVsRunningDocumentTable2.QueryCloseRunningDocument%2A> для запроса у пользователя закрыть файл «b», который открыт в несовместимом редакторе. Если пользователь закрывает файл «b», открытие файла «» в редакторе «A» продолжается обычным образом.

## <a name="additional-document-edit-lock-considerations"></a>Рекомендации по блокировку редактирования дополнительных документов

Разное поведение возникает в том случае, если редактор «A» является единственным редактора, который содержит документ изменить блокировка на файл «b», чем в случае редактора «B» также содержит документ изменить блокировку на файл «b». В [!INCLUDE[vsprvs](../code-quality/includes/vsprvs_md.md)], **конструктор классов** является примером визуальный конструктор, который не удерживает блокировку редактирования в связанном файле кода. То есть если пользователь имеет схему классов открыть в режиме конструктора и соответствующим файлом кода открыть одновременно, и если пользователь изменяет файл кода, но не сохраняет изменения, изменения также будут потеряны в файл схемы (.cd) класса. Если **конструктор классов** имеет единственный документ изменить блокировка на файл кода, пользователю не предлагается для сохранения изменений, при закрытии файла кода. IDE предлагает пользователю сохранить изменения только в том случае, когда пользователь закрывает **конструктор классов**. Сохраненные изменения отражаются в обоих файлах. Если оба **конструктор классов** и редакторе кода файл удерживаются блокировок правки документа в файле кода, то пользователю предлагается сохранить при закрытии файла кода или формы. На этом этапе сохраненные изменения отражаются в форме и файл кода. Дополнительные сведения о схемах классов см. в разделе [работать со схемами классов (конструктор классов)](../ide/class-designer/designing-and-viewing-classes-and-types.md).

Обратите внимание, что если вам нужно поместить блокировку редактирования документа для нередактирующему, необходимо реализовать <xref:Microsoft.VisualStudio.Shell.Interop.IVsDocumentLockHolder> интерфейс.

Много раз дизайнера UI, вносят изменения в файлы кода программным образом вносит изменения в более чем одного файла. В таких случаях <xref:Microsoft.VisualStudio.Shell.Interop.IVsUIShell2.SaveItemsViaDlg%2A> метод обрабатывает сохранение одного или нескольких документов с помощью параметра **вы хотите сохранить изменения следующих элементов?** диалоговое окно.

## <a name="see-also"></a>См. также

- [таблице выполняющихся документов](../extensibility/internals/running-document-table.md)
- [Сохранение состояния и в таблице выполняющихся документов](../extensibility/internals/persistence-and-the-running-document-table.md)