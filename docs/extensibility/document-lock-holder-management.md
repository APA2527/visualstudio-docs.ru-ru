---
title: Управление блокировкой документов (ru) Документы Майкрософт
ms.date: 11/04/2016
ms.topic: conceptual
helpviewer_keywords:
- editors [Visual Studio SDK], custom - document locking
ms.assetid: fa1ce513-eb7d-42bc-b6e8-cb2433d051d5
author: acangialosi
ms.author: anthc
manager: jillfra
ms.workload:
- vssdk
ms.openlocfilehash: f9dd520f8ad5cab1f0cfee890c4bcc388c204bb1
ms.sourcegitcommit: 16a4a5da4a4fd795b46a0869ca2152f2d36e6db2
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/06/2020
ms.locfileid: "80712124"
---
# <a name="document-lock-holder-management"></a>Управление держателем блокировки документов

Таблица ходовых документов (RDT) поддерживает подсчет открытых документов и любые блокировки для их декретирования. Блокировка редактирования на документе может быть размещена в RDT, когда он программно редактируется в фоновом режиме, не видя пользователем открытого документа в окне документа. Эта функциональность часто используется дизайнерами, которые модифицируют несколько файлов через графический пользовательский интерфейс.

## <a name="document-lock-holder-scenarios"></a>Сценарии держателя блокировки документов

### <a name="file-a-has-a-dependence-on-file-b"></a>Файл "а" имеет зависимость от файла "b"

Рассмотрим ситуацию, когда вы реализуете стандартный редактор "A" для типа файла "a", и каждый файл типа "a" имеет ссылку (или зависимость от) файла типа "b". Стандартный редактор "B" существует для файлов типа "b". Когда редактор "А" открывает файл "a", он получает ссылку на соответствующий файл "b". Файл "b" не отображается, но редактор "А" может изменить его. Редактор "А" получает ссылку на данные документа файла "b" из <xref:Microsoft.VisualStudio.Shell.Interop.IVsRunningDocumentTable.FindAndLockDocument%2A> метода, а также поддерживает блокировку редактирования в файле "b". После того, как редактор "A" будет сделано изменение файла "b" вы можете decrement блокировки блокировки отсчета на файле "b" путем вызова метода. <xref:Microsoft.VisualStudio.Shell.Interop.IVsRunningDocumentTable.UnlockDocument%2A> Вы можете пропустить этот шаг, <xref:Microsoft.VisualStudio.Shell.Interop.IVsRunningDocumentTable.FindAndLockDocument%2A> если вы `dwRDTLockType` назвали метод с набором параметра, чтобы [_VSRDTFLAGS. RDT_NoLock](<xref:Microsoft.VisualStudio.Shell.Interop._VSRDTFLAGS.RDT_NoLock>).

### <a name="file-b-is-opened-by-a-different-editor"></a>Файл "b" открывается другим редактором

В случае, если файл "b" уже открыт редактором "B", когда редактор "А" пытается открыть его, существует два отдельных сценария для обработки:

- Если файл "b" открыт в совместимом редакторе, необходимо зарегистрировать блокировку редактора "А" <xref:Microsoft.VisualStudio.Shell.Interop.IVsRunningDocumentTable.RegisterDocumentLockHolder%2A> в файле "b" с помощью метода. После того, как редактор "A" будет сделан, изменяя файл "b", отменить регистрацию блокировки изменения документа с помощью метода. <xref:Microsoft.VisualStudio.Shell.Interop.IVsRunningDocumentTable.UnregisterDocumentLockHolder%2A>

- Если файл "b" открыт несовместимым способом, можно либо допустить, чтобы попытка открытия файла "b" редактором "A" потерпела неудачу, либо вы можете частично открыть представление, связанное с редактором "А", и отобразить соответствующее сообщение об ошибке. Сообщение об ошибке должно поручить пользователю закрыть файл "b" в несовместимом редакторе, а затем повторно открыть файл "a" с помощью редактора "A". Можно также реализовать [!INCLUDE[vsipsdk](../extensibility/includes/vsipsdk_md.md)] <xref:Microsoft.VisualStudio.Shell.Interop.IVsRunningDocumentTable2.QueryCloseRunningDocument%2A> метод, чтобы побудить пользователя закрыть файл "b", который открыт в несовместимом редакторе. Если пользователь закрывает файл "b", открытие файла "a" в редакторе "A" продолжается в обычном режиме.

## <a name="additional-document-edit-lock-considerations"></a>Дополнительные учетные соображения блокировки документов

Вы получаете различное поведение, если редактор "А" является единственным редактором, который имеет блокировку изменения документа в файле "b", чем если бы редактор "B" также содержит блокировку изменения документа в файле "b". В [!INCLUDE[vsprvs](../code-quality/includes/vsprvs_md.md)], **Класс Дизайнер** является примером визуального дизайнера, который не держит блокировку редактирования на связанный файл кода. То есть, если пользователь имеет диаграмму класса открытой в представлении проектирования и связанный файл кода, открытый одновременно, и если пользователь изменяет файл кода, но не сохраняет изменения, изменения также теряются в файле диаграммы класса (.cd). Если **у разработчика класса** есть единственный блокировок кода, в файле кода нет необходимости сохранять изменения при закрытии файла кода. IDE просит пользователя сохранить изменения только после того, как пользователь закроет **класс ный конструктор.** Сохраненные изменения отражаются в обоих файлах. Если и **конструктор класса,** и редактор файла кода удерживали блокировки документов в файле кода, то пользователю предлагается сохранить при закрытии файла кода или формы. В этот момент сохраненные изменения отражаются как в форме, так и в файле кода. Для получения дополнительной информации [Work with class diagrams (Class Designer)](../ide/class-designer/designing-and-viewing-classes-and-types.md)о диаграммах классов см.

Обратите внимание, что если вам необходимо разместить блокировку изменения на документе <xref:Microsoft.VisualStudio.Shell.Interop.IVsDocumentLockHolder> для нередактора, необходимо реализовать интерфейс.

Many times a UI designer that modifies code files programmatically makes changes to more than one file. В таких <xref:Microsoft.VisualStudio.Shell.Interop.IVsUIShell2.SaveItemsViaDlg%2A> случаях метод обрабатывает сохранение одного или нескольких документов с помощью **«Хотите сохранить изменения в следующих элементах?диалоговое** поле».

## <a name="see-also"></a>См. также

- [Запуск таблицы документов](../extensibility/internals/running-document-table.md)
- [Настойчивость и работа таблицы документов](../extensibility/internals/persistence-and-the-running-document-table.md)
