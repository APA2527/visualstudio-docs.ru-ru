---
title: Компоненты редактора
ms.date: 11/04/2016
ms.topic: conceptual
helpviewer_keywords:
- editors [Visual Studio SDK], new - architecture
ms.assetid: 822cbb8d-7ab4-40ee-bd12-44016ebcce81
author: acangialosi
ms.author: anthc
manager: jillfra
ms.workload:
- vssdk
ms.openlocfilehash: bba0b5192df53b6ec837b0030c7b236bf8e08dea
ms.sourcegitcommit: 16a4a5da4a4fd795b46a0869ca2152f2d36e6db2
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/06/2020
ms.locfileid: "80710317"
---
# <a name="inside-the-editor"></a>Внутри редактора

Редактор состоит из нескольких различных подсистем, которые предназначены для того, чтобы держать текстовую модель редактора отдельно от текстового представления и пользовательского интерфейса.

В этих разделах описывают различные аспекты редактора:

- [Обзор подсистем](../extensibility/inside-the-editor.md#overview-of-the-subsystems)

- [Текстовая модель](../extensibility/inside-the-editor.md#the-text-model)

- [Текстовое представление](../extensibility/inside-the-editor.md#the-text-view)

В этих разделах описаны особенности редактора:

- [Теги и классификаторы](../extensibility/inside-the-editor.md#tags-and-classifiers)

- [Украшения](../extensibility/inside-the-editor.md#adornments)

- [Проекция](../extensibility/inside-the-editor.md#projection)

- [Структуризация](../extensibility/inside-the-editor.md#outlining)

- [Привязки мыши](../extensibility/inside-the-editor.md#mouse-bindings)

- [Операции редактора](../extensibility/inside-the-editor.md#editor-operations)

- [IntelliSense](../extensibility/inside-the-editor.md#intellisense)

## <a name="overview-of-the-subsystems"></a>Обзор подсистем

### <a name="text-model-subsystem"></a>Подсистема текстовой модели

Подсистема текстовой модели отвечает за представление текста и позволяет его манипулирование. Подсистема текстовой модели <xref:Microsoft.VisualStudio.Text.ITextBuffer> содержит интерфейс, который описывает последовательность символов, которые должны отображаться редактором. Этот текст может быть изменен, отслеживается и иным образом манипулировать во многих отношениях. Текстовая модель также предоставляет типы для следующих аспектов:

- Служба, которая связывает текст с файлами и управляет чтением и записью в файловой системе.

- Различающая сяграющая служба, которая находит минимальные различия между двумя последовательностями объектов.

- Система описания текста в буфере с точки зрения подмножества текста в других буферах.

Подсистема текстовой модели свободна от концепций пользовательского интерфейса (UI). Например, он не отвечает за форматирование текста или компоновку текста, и он не имеет знаний о визуальных украшениях, которые могут быть связаны с текстом.

Публичные типы подсистемы текстовых моделей содержатся в *Microsoft.VisualStudio.Text.Data.dll* и *Microsoft.VisualStudio.CoreUtility.dll*, которые зависят только от базовой библиотеки .NET Framework и Рамочной инфраструктуры (MEF).

### <a name="text-view-subsystem"></a>Подсистема представления текста

Подсистема представления текста отвечает за форматирование и отображение текста. Типы в этой подсистеме делятся на два слоя, в зависимости от того, полагаются ли типы на Фонд презентации Windows (WPF). Наиболее важными типами являются <xref:Microsoft.VisualStudio.Text.Editor.ITextView> и <xref:Microsoft.VisualStudio.Text.Editor.IWpfTextView>, которые контролируют набор текстовых строк, которые должны быть отображены, а также карета, выбор, и средства для украшения текста с помощью элементов UI WPF. Эта подсистема также обеспечивает поля вокруг области отображения текста. Эти поля могут быть расширены, и может содержать различные виды контента и визуальные эффекты. Примерами полей являются дисплеи номеров строк и прокрутки баров.

Публичные типы подсистемы представления текста содержатся в *Microsoft.VisualStudio.Text.UI.dll* и *Microsoft.VisualStudio.Text.UI.Wpf.dll*. Первая сборка содержит независимые для платформы элементы, а вторая — элементы, специфичные для WPF.

### <a name="classification-subsystem"></a>Подсистема классификации

Подсистема классификации отвечает за определение свойств шрифта для текста. Классификатор разбивает текст на разные классы, например, "ключевое слово" или "комментарий". Карта формата классификации соотносит эти классы с фактическими свойствами шрифта, например, "Blue Consolas 10 pt". Эта информация используется текстовым представлением при форматировании и визуализации текста. Метки, которые описаны более подробно позже в этой теме, позволяет данным быть связаны с диапазонами текста.

Публичные типы классификационной подсистемы содержатся в Microsoft.VisualStudio.Text.Logic.dll, и они взаимодействуют с визуальными аспектами классификации, которые содержатся в Microsoft.VisualStudio.Text.UI.Wpf.dll.

### <a name="operations-subsystem"></a>Подсистема операций

Подсистема операций определяет поведение редактора. Он обеспечивает реализацию команд редактора Visual Studio и системы отменить.

## <a name="a-closer-look-at-the-text-model-and-the-text-view"></a>Более пристальный взгляд на текстовую модель и текстовое представление

### <a name="the-text-model"></a>Текстовая модель

Подсистема текстовой модели состоит из различных групп типов текста. К ним относятся текстовый буфер, текстовые снимки и пролеты текста.

#### <a name="text-buffers-and-text-snapshots"></a>Текстовые буферы и текстовые снимки

Интерфейс <xref:Microsoft.VisualStudio.Text.ITextBuffer> представляет собой последовательность символов Unicode, которые кодируются с помощью UTF-16, `String` который является кодированием, используемым типом в рамке .NET. Текстовый буфер может сохраняться в качестве документа файловой системы, но это не требуется.

Используется <xref:Microsoft.VisualStudio.Text.ITextBufferFactoryService> для создания пустого буфера текста или буфера текста, который <xref:System.IO.TextReader>инициализируется из строки или из . Текстовый буфер может сохраняться в файловой системе как. <xref:Microsoft.VisualStudio.Text.ITextDocument>

Любой поток может отсеивать текстовый буфер <xref:Microsoft.VisualStudio.Text.ITextBuffer.TakeThreadOwnership%2A>до тех пор, пока поток не возьмет на себя ответственность за текстовый буфер, позвонив. После этого только этот поток может выполнять правки.

Текстовый буфер может проходить через множество версий в течение своего срока службы. Новая версия генерируется каждый раз, когда буфер <xref:Microsoft.VisualStudio.Text.ITextSnapshot> редактируется, и неизменяемый представляет содержимое этой версии буфера. Поскольку текстовые снимки неизменяемы, вы можете получить доступ к моментальному снимку текста на любом потоке без ограничений, даже если буфер текста, который он представляет, продолжает меняться.

#### <a name="text-snapshots-and-text-snapshot-lines"></a>Текстовые снимки и строки моментального текста

Содержимое моментального снимка можно просматривать как последовательность символов или как последовательность строк. Символы и линии индексируются с нуля. Пустой снимок текста содержит ноль символов и одну пустую строку. Линия разграничена любой действительной последовательностью разрыва строки Unicode или началом или концом буфера. Символы разрыва строк явно представлены в моментальном снимке текста, и разрывы строк в моментальном снимке текста не все должны быть одинаковыми.

> [!NOTE]
> Для получения дополнительной информации о линейных персонажей в редакторе Visual Studio [см.](../ide/encodings-and-line-breaks.md)

Строка текста представлена объектом, <xref:Microsoft.VisualStudio.Text.ITextSnapshotLine> который может быть получен из моментального снимка текста для определенного номера строки или для конкретного положения персонажа.

#### <a name="snapshotpoints-snapshotspans-and-normalizedsnapshotspancollections"></a>SnapshotPoints, SnapshotSpans, и нормализованныеSnapshotSpanCollections

A <xref:Microsoft.VisualStudio.Text.SnapshotPoint> представляет положение персонажа в моментальном снимке. Позиция гарантированно находится между нулем и длиной снимка. A <xref:Microsoft.VisualStudio.Text.SnapshotSpan> представляет промежуток текста в моментальном снимке. Его конечная позиция гарантированно находится между нулем и длиной снимка. Состоит <xref:Microsoft.VisualStudio.Text.NormalizedSnapshotSpanCollection> из набора <xref:Microsoft.VisualStudio.Text.SnapshotSpan> объектов из одного и того же снимка.

#### <a name="spans-and-normalizedspancollections"></a>Спанс и нормализованныеSpanКоллекции

A <xref:Microsoft.VisualStudio.Text.Span> представляет собой интервал, который может быть применен к пролету текста в моментальном снимке текста. Позиции моментального снимка на нулевом уровне, поэтому диапазоны могут начинаться в любой позиции, включая ноль. Имущество `End` пролета равно сумме его `Start` имущества `Length` и его имущества. A `Span` не включает символ, индексируется `End` свойством. Например, пролет, который имеет Старт-5 и Длина No3, имеет End'8, и включает в себя символы на позициях 5, 6 и 7. Нотация для этого диапазона составляет 5..8.

Два диапазона пересекаются, если у них есть какие-либо общие позиции, включая позицию Конца. Таким образом, пересечение No 3, 5) и No 2, 7) составляет 3, 5) и пересечение No 3, 5) и No 5, 7) составляет 5, 5. (Обратите внимание, что No 5, 5) является пустой промежуток.)

Два пролета перекрываются, если у них есть общие позиции, за исключением позиции End. Пустой пролет никогда не перекрывает другой диапазон, и перекрытие двух пролетов никогда не бывает пустым.

A <xref:Microsoft.VisualStudio.Text.NormalizedSpanCollection> — это список диапазонов в порядке стартовых свойств пролетов. В списке сливаются перекрывающиеся или примыкания пролеты. Например, с учетом набора пролетов (5..9), 0..1, 3..6 и 9..10, нормализованный список пролетов составляет 0..1, 3..10.

#### <a name="itextedit-textversion-and-text-change-notifications"></a>Уведомления об изменениях ITextEdit, TextVersion и текстовых изменений

Содержимое буфера текста может быть <xref:Microsoft.VisualStudio.Text.ITextEdit> изменено с помощью объекта. Создание такого объекта (с `CreateEdit()` помощью <xref:Microsoft.VisualStudio.Text.ITextBuffer>одного из методов ) начинается текстовая транзакция, состоящая из текстовых редактирований. Каждое редактирование является заменой некоторого пролета текста в буфере строкой. Координаты и содержание каждого отправления являются выраженными относительно снимка буфера при начале транзакции. Объект <xref:Microsoft.VisualStudio.Text.ITextEdit> корректирует координаты правок, на которые влияют другие правки в той же транзакции.

Например, рассмотрим буфер текста, содержащий эту строку:

```
abcdefghij
```

Примените транзакцию, содержащую два редактирования, одно редактирование, которое заменяет пролет на 2..4) с помощью символа `X` `Y`и второе редактирование, которое заменяет пролет на 6..9) с помощью символа . Результатом является этот буфер:

```
abXefYj
```

Координаты для второго отправления были вычислены в отношении содержимого буфера в начале транзакции, до применения первого отправления.

Изменения в буфере вступают <xref:Microsoft.VisualStudio.Text.ITextEdit> в силу, `Apply()` когда объект совершается, вызывая его метод. Если было хотя бы одно непустое <xref:Microsoft.VisualStudio.Text.ITextVersion> редикцию, создается новое, создается новое <xref:Microsoft.VisualStudio.Text.ITextSnapshot> и возникает одно `Changed` событие. Каждая текстовая версия имеет другой текстовый снимок. Моментальный снимок текста представляет полное состояние буфера текста после транзакции редактирования, но текстовая версия описывает только изменения от одного снимка к другому. Как правило, текстовые снимки предназначены для использования один раз, а затем отбрасываются, в то время как текстовые версии должны оставаться в живых в течение некоторого времени.

Текстовая версия <xref:Microsoft.VisualStudio.Text.INormalizedTextChangeCollection>содержит . В этой коллекции описаны изменения, которые при применении к моментальному снимку производят последующий снимок. Каждый <xref:Microsoft.VisualStudio.Text.ITextChange> в коллекции содержит положение характера изменения, заменяемую строку и строку замены. Заменяемые строки пусты для основной вставки, а строка замены пуста для основного удаления. Нормализованная коллекция `null` всегда предназначена для последней версии буфера текста.

Только <xref:Microsoft.VisualStudio.Text.ITextEdit> один объект может быть мгновенно для буфера текста в любое время, и все редактирования текста должны быть выполнены на потоке, который владеет буфером текста (если собственность была востребована). От редактирования текста можно отказаться, позвонив по его `Cancel` методу или `Dispose` методу.

<xref:Microsoft.VisualStudio.Text.ITextBuffer>также `Insert()`предоставляет `Delete()`, `Replace()` и методы, которые <xref:Microsoft.VisualStudio.Text.ITextEdit> напоминают те, которые находятся на интерфейсе. Вызов этих имеет тот же <xref:Microsoft.VisualStudio.Text.ITextEdit> эффект, что и создание объекта, совершение аналогичного вызова, а затем применение edit.

#### <a name="tracking-points-and-tracking-spans"></a>Точки отслеживания и пролеты отслеживания

An <xref:Microsoft.VisualStudio.Text.ITrackingPoint> представляет положение символов в буфере текста. Если буфер редактируется таким образом, что положение персонажа смещается, точка отслеживания смещается вместе с ним. Например, если точка слежения относится к позиции 10 в буфере, и пять символов вставляются в начале буфера, точка слежения затем относится к позиции 15. Если вставка происходит именно в положении, обозначенном точкой слежения, ее поведение определяется ее, <xref:Microsoft.VisualStudio.Text.PointTrackingMode>которая может быть либо `Positive` или `Negative`. Если режим отслеживания положительный, точка слежения относится к тому же символу, который находится в конце вставки. Если режим отслеживания отрицательный, точка слежения относится к первому вставленного символу в исходном положении. Если символ в позиции, представленной точкой отслеживания, удаляется, точка отслеживания смещается на первый символ, который следует за удаленным диапазоном. Например, если точка отслеживания относится к персонажу в положении 5, а символы на позициях 3-6 удаляются, точка отслеживания относится к персонажу в позиции 3.

An <xref:Microsoft.VisualStudio.Text.ITrackingSpan> представляет собой диапазон символов, а не только одну позицию. Его поведение определяется <xref:Microsoft.VisualStudio.Text.SpanTrackingMode>его . Если режим отслеживания прожектов [SpanTrackingMode.EdgeInclusive](xref:Microsoft.VisualStudio.Text.SpanTrackingMode.EdgeInclusive), диапазон отслеживания растет, чтобы включить текст, вставленный по его краям. Если режим отслеживания прожека span [SpanTrackingMode.EdgeExclusive](xref:Microsoft.VisualStudio.Text.SpanTrackingMode.EdgeExclusive), то пролет отслеживания не включает текст, вставленный по краям. Однако, если режим отслеживания диапазона [SpanTrackingMode.EdgePositive](xref:Microsoft.VisualStudio.Text.SpanTrackingMode.EdgePositive), вставка толкает текущее положение к началу, и если режим отслеживания диапазона [SpanTrackingMode.EdgeNegative](xref:Microsoft.VisualStudio.Text.SpanTrackingMode.EdgeNegative), вставка толкает текущее положение к концу.

Вы можете получить положение точки слежения или пролет диапазона отслеживания для любого снимка буфера текста, к которому они принадлежат. Точки слежения и пролеты отслеживания могут быть безопасно отображены из любого потока.

#### <a name="content-types"></a>Типы содержимого

Типы содержимого являются механизмом определения различных видов содержимого. Тип содержимого может быть типфайла, например "текст", "код" или "двоичный", или тип технологии, такой как "xml", "vb" или "c". Например, слово «использование» является ключевым словом как в C,», так и в Visual Basic, но не в других языках программирования. Таким образом, определение этого ключевого слова будет ограничено типами контента "c" и "vb".

Типы содержимого используются в качестве фильтра для украшений и других элементов редактора. Многие функции редактора и точки расширения определяются в типе содержимого. Например, окраска текста отличается для простых текстовых файлов, файлов XML и Visual Basic исходного кода. Буферы текста обычно назначаются типу содержимого при их создании, и тип содержимого буфера текста может быть изменен.

Типы содержимого могут многократно наследовать по другим типам содержимого. Позволяет <xref:Microsoft.VisualStudio.Utilities.ContentTypeDefinition> указать несколько базовых типов в качестве родителей данного типа содержимого.

Разработчики могут определить свои собственные типы <xref:Microsoft.VisualStudio.Utilities.IContentTypeRegistryService>контента и зарегистрировать их с помощью . Многие функции редактора могут быть определены в <xref:Microsoft.VisualStudio.Utilities.ContentTypeAttribute>отношении конкретного типа содержимого с помощью . Например, поля редактора, украшения и обработчики мыши могут быть определены таким образом, чтобы они применялись только к редакторам, отображающих определенные типы содержимого.

### <a name="the-text-view"></a>Текстовое представление

Часть шаблона представления представления модели (MVC) определяет представление текста, форматирование представления, графические элементы, такие как панель прокрутки, и карету. Все элементы презентации редактора Visual Studio основаны на WPF.

#### <a name="text-views"></a>Текстовые представления

Интерфейс <xref:Microsoft.VisualStudio.Text.Editor.ITextView> представляет собой независимую платформу представления текстового представления. Он используется в основном для отображения текстовых документов в окне, но он также может быть использован для других целей, например, в инструментарии.

Текстовое представление ссылается на различные виды текстовых буферов. Свойство <xref:Microsoft.VisualStudio.Text.Editor.ITextView.TextViewModel%2A> относится <xref:Microsoft.VisualStudio.Text.Editor.ITextViewModel> к объекту, который указывает на эти три различных буфера текста: буфер данных, который является буфером верхнего уровня данных, буфер редактирования, в котором происходит редактирование, и визуальный буфер, который является буфером, отображаемым в текстовом представлении.

Текст отформатирован на основе классификаторов, которые прикреплены к базовому буферу текста, и украшен с помощью поставщиков украшений, которые прилагаются к самому текстовому представлению.

#### <a name="the-text-view-coordinate-system"></a>Система координат текстового представления

Система коморектора текстового представления определяет позиции в текстовом представлении. В этой системе координат значение x 0.0 соответствует левому краю отображаемого текста, а значение y 0.0 соответствует верхнему краю отображаемого текста. Координаты x увеличиваются слева направо, а у координаты — сверху вниз.

Порт представления (часть текста, видимая в текстовом окне) не может быть прокрутен таким же образом горизонтально, поскольку он прокручивается вертикально. Порт обзора прокручивается горизонтально, изменяя левую координату так, чтобы он двигался по отношению к поверхности чертежа. Однако порт представления может быть прокрутлен вертикально только путем <xref:Microsoft.VisualStudio.Text.Editor.ITextView.LayoutChanged> изменения отрисованный текст, что приводит к поднятию события.

Расстояние в системе координат соответствует логическим пикселям. Если поверхность отрисовывания текста отображается без преобразования масштабирования, то одна единица в системе координат текста соответствует одному пикселю на дисплее.

#### <a name="margins"></a>Поля

Интерфейс <xref:Microsoft.VisualStudio.Text.Editor.ITextViewMargin> представляет собой маржу и позволяет контролировать видимость поля и ее размера. Есть четыре предопределенных поля, которые называются "Top", "Левый", "Правый", и "Нижний" и прикреплены к верхней, нижней, левой или правой кромки зрения. Эти поля представляют собой контейнеры, в которые могут быть размещены другие поля. Интерфейс определяет методы, которые возвращают размер поля и видимость поля. Поля представляют собой визуальные элементы, которые предоставляют дополнительную информацию о текстовом представлении, к которому они прикреплены. Например, маржа строки-номера отображает номера строк для представления текста. Глиф наяразница отображает элементы uI.

Интерфейс <xref:Microsoft.VisualStudio.Text.Editor.IWpfTextViewMarginProvider> обрабатывает создание и размещение маржи. Маржи могут быть заказаны в отношении других маржи. Поля с более высоким приоритетом расположены ближе к текстовому представлению. Например, если есть две левые маржи, маржа A и маржа B, а маржа B имеет более низкий приоритет, чем маржа A, маржа B отображается слева от маржи A.

#### <a name="the-text-view-host"></a>Хост текстового представления

Интерфейс <xref:Microsoft.VisualStudio.Text.Editor.IWpfTextViewHost> содержит текстовое представление и любые примыкания украшения, которые сопровождают представление, например, прокрутки баров. Хост текстового представления также содержит поля, прикрепленные к границе представления.

#### <a name="formatted-text"></a>Форматированный текст

Текст, отображаемый в <xref:Microsoft.VisualStudio.Text.Formatting.ITextViewLine> текстовом представлении, состоит из объектов. Каждая строка просмотра текста соответствует одной строке текста в текстовом представлении. Длинные строки в базовом буфере текста могут быть либо частично скрыты (если обертывание слов не включено), либо разбиты на несколько строк представления текста. Интерфейс <xref:Microsoft.VisualStudio.Text.Formatting.ITextViewLine> содержит методы и свойства для картирования между координатами и символами, а также для украшений, которые могут быть связаны с линией.

<xref:Microsoft.VisualStudio.Text.Formatting.ITextViewLine>объекты создаются <xref:Microsoft.VisualStudio.Text.Formatting.IFormattedLineSource> с помощью интерфейса. Если вы просто обеспокоены текстом, который в настоящее время отображается в представлении, вы можете проигнорировать источник форматирования. Если вас интересует формат текста, который не отображается в представлении (например, для поддержки разреза и пасты с богатым текстом), можно использовать <xref:Microsoft.VisualStudio.Text.Formatting.IFormattedLineSource> для формата текста в буфере текста.

Текст овое представление <xref:Microsoft.VisualStudio.Text.ITextSnapshotLine> форматирует по одному.

## <a name="editor-features"></a>Возможности редактора

Функции редактора разработаны таким образом, что определение функции отделено от его реализации. Редактор включает в себя следующие функции:

- Теги и классификаторы

- Украшения

- Проекция

- Структуризация

- Мышь и ключевые привязки

- Операции и примитивы

- IntelliSense

### <a name="tags-and-classifiers"></a>Теги и классификаторы

Теги являются маркерами, которые связаны с пролетом текста. Они могут быть представлены по-разному, например, с помощью текстовой окраски, подчеркивания, графики или всплывающих ups. Классификаторы являются одним из видов тегов.

Другие виды тегов для <xref:Microsoft.VisualStudio.Text.Tagging.TextMarkerTag> <xref:Microsoft.VisualStudio.Text.Tagging.OutliningRegionTag> выделения текста, для изложения и <xref:Microsoft.VisualStudio.Text.Tagging.ErrorTag> для компиляции ошибок.

#### <a name="classification-types"></a>Типы классификации

Интерфейс <xref:Microsoft.VisualStudio.Text.Classification.IClassificationType> представляет собой класс эквивалентности, который является абстрактной категорией текста. Типы классификаций могут многократно наследовать по другим типам классификации. Например, классификация языков программирования может включать "ключевое слово", "комментарий" и "идентификатор", которые все наследуют от "кода". Типы классификации естественных языков могут включать "существительное", "глагол" и "прилагательное", которые все они наследуют от "естественного языка".

#### <a name="classifications"></a>Классификация

Классификация — это экземпляр определенного типа классификации, обычно напротяжениванивом между текстом. A <xref:Microsoft.VisualStudio.Text.Classification.ClassificationSpan> используется для представления классификации. Диапазон классификации можно рассматривать как метку, которая охватывает определенный диапазон текста и сообщает системе, что этот диапазон текста имеет определенный тип классификации.

#### <a name="classifiers"></a>Классификаторы

A <xref:Microsoft.VisualStudio.Text.Classification.IClassifier> — это механизм, который разбивает текст на набор классификаций. Классификаторы должны быть определены для определенных типов содержимого и мгновенно для конкретных буферов текста. Клиенты <xref:Microsoft.VisualStudio.Text.Classification.IClassifier> должны реализовать для участия в классификации текста.

#### <a name="classifier-aggregators"></a>Агрегаторы классификаторов

Агрегатор классификатора — это механизм, объединяющий все классификаторы для одного буфера текста в один набор классификаций. Например, классификатор c и классификатор английского языка могут создавать классификацию по сравнению с комментарием в файле C'. Рассмотрим этот комментарий:

```
// This method produces a classifier
```

Классификатор C' может обозначить весь диапазон в качестве комментария, а классификатор английского языка может классифицировать «производит» как «глагол» и «метод» как «существитель». Агрегатор производит набор недублирующих классификаций, и тип набора основан на всех вкладах.

Агрегатор классификатора также является классификатором, поскольку он разбивает текст на набор классификаций. Агрегатор классификатора также гарантирует отсутствие перекрывающихся классификаций и отсортировку классификаций. Индивидуальные классификаторы могут свободно возвращать любой набор классификаций, в любом порядке, и перекрывающихся в любом случае.

#### <a name="classification-formatting-and-text-coloring"></a>Форматирование классификации и окраска текста

Форматирование текста является примером функции, построенной на классификации текста. Он используется слоем представления текста для определения отображения текста в приложении. Область форматирования текста зависит от WPF, но логическое определение классификаций не является.

Формат классификации представляет собой набор свойств форматирования для определенного типа классификации. Эти форматы наследуются от формата родительского типа классификации.

An <xref:Microsoft.VisualStudio.Text.Classification.IClassificationFormatMap> — это карта от типа классификации до набора свойств форматирования текста. Реализация карты формата в редакторе обрабатывает весь экспорт форматов классификации.

### <a name="adornments"></a>Украшения

Украшения представляют собой графические эффекты, которые не имеют прямого отношения к шрифту и цвету символов в текстовом представлении. Например, красный squiggle подчеркивают, что используется для обозначения некомпиляции кода во многих языках программирования является встроенным украшением, а наборы инструментов являются всплывающими украшениями. Украшения являются производными <xref:System.Windows.UIElement> <xref:Microsoft.VisualStudio.Text.Tagging.ITag>от и реализации. Два специализированных типа тега <xref:Microsoft.VisualStudio.Text.Tagging.SpaceNegotiatingAdornmentTag>украшения являются, для украшений, которые занимают то <xref:Microsoft.VisualStudio.Text.Tagging.ErrorTag>же пространство, как текст в представлении, и , для squiggle подчеркнуть.

Встроенные украшения — это графика, которая является частью отформатированных текстовых представлений. Они организованы в разных слоях порядка. Есть три встроенных слоя, следующим образом: текст, карета и выбор. Тем не менее, разработчики могут определить больше слоев и навести порядок в порядке друг с другом. Три вида встроенных украшений являются текстовы-относительными украшениями (которые перемещаются при перемещении текста и удаляются при удалении текста), украшениями view-relative (которые имеют отношение к нетекстовым частям представления) и контролируемыми владельцем украшениями (разработчик должен управлять их размещением).

Всплывающие украшения — это графика, которая отображается в небольшом окне над текстовым представлением, например, на примере инструментов.

### <a name="projection"></a><a name="projection"></a>Проекции

Проекция — это метод построения другого типа буфера текста, который на самом деле не хранит текст, а вместо этого комбинирует текст из других текстовых буферов. Например, буфер проекции может быть использован для совмещения текста с двумя другими буферами и представления результата, как если бы он находится в одном буфере, или для сокрытия частей текста в одном буфере. Буфер проекции может выступать в качестве исходного буфера для другого буфера проекции. Набор буферов, связанных проекцией, может быть построен для перенастройки текста различными способами. (Такой набор также известен как *буферный график*.) Функция сизложенительная функция Visual Studio реализована с помощью проекционного буфера для сокрытия рухнувшего текста, а редактор Visual Studio для ASP.NET страниц использует проекцию для поддержки встроенных языков, таких как Visual Basic и C.

An <xref:Microsoft.VisualStudio.Text.Projection.IProjectionBuffer> создается <xref:Microsoft.VisualStudio.Text.Projection.IProjectionBufferFactoryService>с помощью . Буфер проекции представлен упорядоченной последовательностью объектов, <xref:Microsoft.VisualStudio.Text.ITrackingSpan> которые известны как *пролеты исходных источников.* Содержимое этих пролетов представлено как последовательность символов. Текстовые буферы, из которых нарисованы исходные пролеты, называются *исходными буферами.* Клиенты проекционного буфера не должны знать, что он отличается от обычного буфера текста.

Буфер проекции слушает события изменения текста в буферах исхода. Когда текст в исходном диапазоне изменяется, буфер проекции отображает измененные координаты текста к своим координатам и поднимает соответствующие события изменения текста. Например, рассмотрим буферы источников A и B с таким содержанием:

```
A: ABCDE
B: vwxyz
```

Если буфер проекции P формируется из двух диапазонов текста, один из которого есть весь буфер A, а другой, который имеет все буфера B, то P имеет следующее содержание:

```
P: ABCDEvwxyz
```

Если подстрока `xy` удалена из буфера B, буфер P повышает событие, указывавальное, что символы на позициях 7 и 8 были удалены.

Буфер проекции также можно редактировать напрямую. Он распространяет edaits к соответствующим буферам источника. Например, если строка вставляется в буфер P в положении 6 (исходное положение символа "v"), вставка распространяется в буфер B в положении 1.

Существуют ограничения на пролеты исхода, которые способствуют буферу проекции. Пролеты источников могут не перекрываться; место в буфере проекции не может сопоставить более чем одно место в любом буфере источника, а местоположение в буфере источника не может сопоставить более чем одно место в буфере проекции. В отношении буфера источника не допускается никаких циркуляров.

События возникают при изменении набора исходных буферов для буфера проекции и при изменении набора исходных диапазонов.
Буфер elision является особым видом проекционного буфера. Он в первую очередь используется для изложения и для операций, которые расширяют и разрушают блоки текста. Буфер elision основан только на одном буфере источника, и пролеты в буфере elision должны быть упорядочены так же, как они упорядочены в буфере источника.

#### <a name="the-buffer-graph"></a>Диаграмма буфера

Интерфейс <xref:Microsoft.VisualStudio.Text.Projection.IBufferGraph> позволяет сопоставление на графике проекционных буферов. Все текстовые буферы и проекционные буферы собираются в направленном ациклическом графике, подобно абстрактному дереву синтаксиса, которое производится составитером языка. График определяется верхним буфером, который может быть любым текстовым буфером. Диаграмма буфера может отображаться от точки верхнего буфера до точки в буфере источника или от пролета в верхнем буфере до набора пролетов в буфере источника. Аналогичным образом, он может отображать точку или пролет от буфера источника до точки верхнего буфера. Диаграммы буфера создаются <xref:Microsoft.VisualStudio.Text.Projection.IBufferGraphFactoryService>с помощью .

#### <a name="events-and-projection-buffers"></a>События и буферы проекций

При изменении буфера проекции изменения отправляются из буфера проекции в зависимые от него буферы. После того, как все буферы изменены, события изменения буфера будут подняты, начиная с самого глубокого буфера.

### <a name="outlining"></a>Структуризация

Изложение — это возможность расширения или сворачивания различных блоков текста в текстовом представлении. Изложение определяется как <xref:Microsoft.VisualStudio.Text.Tagging.ITag>своего рода, так же, как украшения определяются. A <xref:Microsoft.VisualStudio.Text.Tagging.OutliningRegionTag> — это тег, определяющий область текста, которая может быть расширена или разрушена. Для использования с изложением, <xref:Microsoft.VisualStudio.Text.Outlining.IOutliningManagerService> вы <xref:Microsoft.VisualStudio.Text.Outlining.IOutliningManager>должны импортировать, чтобы получить . Менеджер с изложением перечисляет, разрушает и расширяет различные блоки, <xref:Microsoft.VisualStudio.Text.Outlining.ICollapsible> которые представлены как объекты, и соответственно поднимает события.

### <a name="mouse-bindings"></a>Привязки мыши

Мышь привязывает ссылку движения мыши на различные команды. Привязки мыши определяются с <xref:Microsoft.VisualStudio.Text.Editor.IMouseProcessorProvider>помощью, и <xref:Microsoft.VisualStudio.Text.Editor.IKeyProcessorProvider>ключевые привязки определяются с помощью . Автоматически <xref:Microsoft.VisualStudio.Text.Editor.IWpfTextViewHost> мгновенно все привязки и соединяет их с событиями мыши в представлении.

Интерфейс <xref:Microsoft.VisualStudio.Text.Editor.IMouseProcessor> содержит обработчики событий перед процессом и после процесса для различных событий мыши. Для обработки одного из событий можно переопределить некоторые <xref:Microsoft.VisualStudio.Text.Editor.MouseProcessorBase>из методов в .

### <a name="editor-operations"></a>Операции редактора

Операции редактора могут быть использованы для автоматизации взаимодействия с редактором, для работы по сценарию или для других целей. Вы можете <xref:Microsoft.VisualStudio.Text.Operations.IEditorOperationsFactoryService> импортировать операции доступа <xref:Microsoft.VisualStudio.Text.Editor.ITextView>на данном . Затем эти объекты можно использовать для изменения выделения, прокрутки представления или перемещения внимательности в различные части представления.

### <a name="intellisense"></a>IntelliSense

IntelliSense поддерживает завершение оператора, помощь в подписи (также известную как информация о параметрах), Быструю информацию и лампочки.

Завершение выполнения заявления предоставляет всплывающие списки потенциальных завершений для имен методов, элементов XML и других элементов кодирования или разметки. Как правило, жест пользователя вызывает сеанс завершения. Сеанс отображает список потенциальных завершений, и пользователь может выбрать один или отклонить список. Отвечает <xref:Microsoft.VisualStudio.Language.Intellisense.ICompletionBroker> за создание и запуск <xref:Microsoft.VisualStudio.Language.Intellisense.ICompletionSession>. <xref:Microsoft.VisualStudio.Language.Intellisense.ICompletionSource> Вычисляет <xref:Microsoft.VisualStudio.Language.Intellisense.CompletionSet> элементы завершения сеанса.

## <a name="see-also"></a>См. также

- [Языковой сервис и точки расширения редактора](../extensibility/language-service-and-editor-extension-points.md)
- [Импорт редактора](../extensibility/editor-imports.md)
