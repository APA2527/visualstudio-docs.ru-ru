---
title: Заполнение наборов данных с помощью адаптеров таблицы
ms.date: 11/04/2016
ms.topic: conceptual
dev_langs:
- VB
- CSharp
helpviewer_keywords:
- datasets [Visual Basic]
- datasets [Visual Basic], loading data
- data retrieval
- retrieving data
- datasets [Visual Basic], filling
- data [Visual Studio], retrieving
- data [Visual Studio], datasets
ms.assetid: 55f3bfbe-db78-4486-add3-c62f49e6b9a0
author: ghogen
ms.author: ghogen
manager: jillfra
ms.workload:
- data-storage
ms.openlocfilehash: a79f7b781944bb93a60794e748eefb9375723384
ms.sourcegitcommit: 95f26af1da51d4c83ae78adcb7372b32364d8a2b
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/13/2020
ms.locfileid: "79301197"
---
# <a name="fill-datasets-by-using-tableadapters"></a>Заполнение наборов данных с помощью адаптеров таблицы

Компонент TableAdapter заполняет набор данных из базы данных на основе одного или нескольких запросов или сохраненных процедур, которые вы указываете. TableAdapters также может выполнять добавления, обновления и удаления в базе данных для упорных изменений, которые вы вносят в набор данных. Вы также можете выдавать глобальные команды, не связанные с какой-либо конкретной таблицей.

> [!NOTE]
> TableAdapters создаются дизайнерами Visual Studio. Если вы создаете наборы данных программно, используйте DataAdapter, который является классом .NET.

Для получения подробной информации об операциях TableAdapter можно перейти непосредственно к одной из следующих тем:

|Раздел|Описание|
|-----------|-----------------|
|[Создание и настройка адаптеров таблиц](../data-tools/create-and-configure-tableadapters.md)|Как использовать дизайнеров для создания и настройки TableAdapters|
|[Создание параметризованных запросов адаптера таблицы](../data-tools/create-parameterized-tableadapter-queries.md)|Как дать возможность пользователям предоставить аргументы процедурам или запросам TableAdapter|
|[Непосредственный доступ к базе данных с помощью адаптера таблицы](../data-tools/directly-access-the-database-with-a-tableadapter.md)|Как использовать методы Dbdirect НастольныхАдалеров|
|[Отключение ограничений при заполнении набора данных](../data-tools/turn-off-constraints-while-filling-a-dataset.md)|Как работать с ограничениями из-за рубежа при обновлении данных|
|[Практическое руководство. Расширение функциональных возможностей адаптера таблицы](../data-tools/fill-datasets-by-using-tableadapters.md)|Как добавить пользовательский код в TableAdapters|
|[Считывание XML-данных в набор данных](../data-tools/read-xml-data-into-a-dataset.md)|Как работать с XML|

<a name="tableadapter-overview"></a>

## <a name="tableadapter-overview"></a>Общие сведения об адаптере таблиц

TableAdapters — это компоненты, созданные конструкторами, которые подключаются к базе данных, заходят запросы или хранят процедуры и заполняют их DataTable с возвращенными данными. TableAdapters также отправляют обновленные данные из приложения обратно в базу данных. Вы можете запускать столько запросов, сколько хотите на TableAdapter, если они возвращают данные, соответствующие схеме таблицы, с которой связан TableAdapter. Следующая диаграмма показывает, как TableAdapters взаимодействуют с базами данных и другими объектами в памяти:

![Поток данных в клиентском приложении](../data-tools/media/clientdatadiagram.gif)

В то время как TableAdapters разработаны с **конструктором набора данных,** классы TableAdapter не генерируются как вложенные классы <xref:System.Data.DataSet>. Они расположены в отдельных пространствах имен, которые специфичны для каждого набора данных. Например, если у вас `NorthwindDataSet`есть набор данных с <xref:System.Data.DataTable>именем, `NorthwindDataSet` то TableAdapters, связанные с s в пространстве `NorthwindDataSetTableAdapters` имен, будут находиться в пространстве имен. Чтобы получить доступ к определенному TableAdapter программно, необходимо объявить новый экземпляр TableAdapter. Пример:

[!code-csharp[VbRaddataTableAdapters#7](../data-tools/codesnippet/CSharp/fill-datasets-by-using-tableadapters_1.cs)]
[!code-vb[VbRaddataTableAdapters#7](../data-tools/codesnippet/VisualBasic/fill-datasets-by-using-tableadapters_1.vb)]

## <a name="associated-datatable-schema"></a>Схема Associated DataTable

При создании TableAdapter используется начальная процедура запроса или сохранени для определения схемы связанного <xref:System.Data.DataTable>с TableAdapter . Вы запустите эту начальную процедуру запроса или `Fill` сохранены, позвонив в <xref:System.Data.DataTable>метод TableAdapter (который заполняет связанный TableAdapter). Любые изменения, внесенные в основной запрос TableAdapter, отражены в схеме связанной таблицы данных. Например, удаление столбца из основного запроса также удаляет столбец из связанной таблицы данных. Если какие-либо дополнительные запросы в TableAdapter используют сяогают запоны S'L, которые возвращают столбцы, которые не входят в основной запрос, разработчик пытается синхронизировать изменения столбца между основным запросом и дополнительными запросами.

## <a name="tableadapter-update-commands"></a>Команды обновления TableAdapter

Функциональность обновления TableAdapter зависит от того, сколько информации доступно в основном запросе в **Мастере Столовой Адаптер.** Например, настольные адаптеры, настроенные для получения `JOIN`значений из нескольких таблиц (с использованием значений, представлений или результатов агрегированных функций, изначально не создаются с возможностью отправки обновлений обратно в базовую базу данных. Тем не менее, `INSERT`вы `UPDATE`можете `DELETE` настроить, и команды вручную в окне **свойств.**

## <a name="tableadapter-queries"></a>запросы TableAdapter

![TableAdapter с несколькими запросами](../data-tools/media/tableadapter.gif)

TableAdapters может содержать несколько запросов для заполнения связанных с ними таблиц данных. Можно определить столько запросов для TableAdapter, сколько требует сярприза, до тех пор, пока каждый запрос возвращает данные, соответствующие той же схеме, что и связанная с ним таблица данных. Эта возможность позволяет TableAdapter загружать различные результаты на основе различных критериев.

Например, если приложение содержит таблицу с именами клиентов, можно создать запрос, который заполняет таблицу с каждым именем клиента, который начинается с определенной буквы, а другой, который заполняет таблицу со всеми клиентами, которые находятся в том же состоянии. Для заполнения `Customers` таблицы клиентами в данном состоянии можно создать `FillByState` запрос, который использует `SELECT * FROM Customers WHERE State = @State`параметр для государственного значения следующим образом: . Вы запустите запрос, `FillByState` позвонив по методу `CustomerTableAdapter.FillByState("WA")`и пройдя в значении параметра следующим образом: .

В дополнение к добавлению запросов, возвращающие данные той же схемы, что и таблица данных TableAdapter, можно добавить запросы, возвращающие значения scalar (single). Например, запрос, возвращающий количество клиентов ()`SELECT Count(*) From Customers` `CustomersTableAdapter,` действителен для тех, которые возвращаются, несмотря на то, что возвращенные данные не соответствуют схеме таблицы.

## <a name="clearbeforefill-property"></a>Недвижимость ClearBeforeFill

По умолчанию каждый раз, когда вы заполните запрос для заполнения таблицы данных TableAdapter, существующие данные очищаются, и в таблицу загружаются только результаты запроса. Установите `ClearBeforeFill` свойство `false` TableAdapter, если вы хотите добавить или объединить данные, возвращенные из запроса в существующие данные в таблице данных. Независимо от того, очищаетесь ли данные, необходимо явно отправлять обновления обратно в базу данных, если вы хотите сохранить их. Поэтому не забудьте сохранить все изменения в данных в таблице перед запуском другого запроса, который заполняет таблицу. Для получения дополнительной информации [см.](../data-tools/update-data-by-using-a-tableadapter.md)

## <a name="tableadapter-inheritance"></a>Наследование TableAdapter

TableAdapters расширяют функциональность стандартных адаптеров данных, инкапсулируя настроенный <xref:System.Data.Common.DataAdapter> класс. По умолчанию TableAdapter наследует <xref:System.ComponentModel.Component> из класса и не <xref:System.Data.Common.DataAdapter> может быть отлит в класс. Отображивание таблицыAdapter <xref:System.Data.Common.DataAdapter> <xref:System.InvalidCastException> в класс приводит к ошибке. Чтобы изменить базовый класс TableAdapter, можно указать класс, который вытекает из <xref:System.ComponentModel.Component> свойства **базового класса** TableAdapter в **конструкторе набора данных.**

## <a name="tableadapter-methods-and-properties"></a>Методы и свойства TableAdapter

Класс TableAdapter не является типом .NET. Это означает, что вы не можете найти его в документации или **браузере объекта.** Он создан во время проектирования, когда вы используете одного из упомянутых ранее мастеров. Имя, присвоенное TableAdapter при его создании, основано на названии таблицы, с которыми вы работаете. Например, при создании TableAdapter на основе таблицы `Orders`в базе данных `OrdersTableAdapter`с именем, называется TableAdapter . Название класса TableAdapter может быть изменено с помощью свойства **«Имя»** в **«Конструкторе данных».**

Ниже приведены широко используемые методы и свойства TableAdapters:

|Участник|Описание|
|------------|-----------------|
|`TableAdapter.Fill`|Заполняет связанную таблицу данных TableAdapter с результатами `SELECT` команды TableAdapter.|
|`TableAdapter.Update`|Отправляет изменения обратно в базу данных и возвращает целый ряд, представляющий количество строк, затронутых обновлением. Для получения дополнительной информации [см.](../data-tools/update-data-by-using-a-tableadapter.md)|
|`TableAdapter.GetData`|Возвращает новый, <xref:System.Data.DataTable> заполненный данными.|
|`TableAdapter.Insert`|Создает новую строку в таблице данных. Для получения дополнительной информации смотрите [вставьте новые записи в базу данных](../data-tools/insert-new-records-into-a-database.md).|
|`TableAdapter.ClearBeforeFill`|Определяет, опустела ли таблица данных `Fill` до вызова одного из методов.|

## <a name="tableadapter-update-method"></a>Метод обновления TableAdapter

TableAdapters используют команды данных для чтения и записи из базы данных. Используйте начальный `Fill` (основной) запрос TableAdapter в качестве основы для создания схемы связанной `UpdateCommand`таблицы данных, а `TableAdapter.Update` `InsertCommand`также , и `DeleteCommand` команды, которые связаны с методом. Вызов метода `Update` TableAdapter выполняет операторы, созданные при первоначальной настройке TableAdapter, а не один из дополнительных запросов, добавленных мастером **конфигурации conry TableAdapter.**

При использовании TableAdapter он эффективно выполняет те же операции с командами, которые обычно выполняются. Например, при вызове метода `Fill` адаптера адаптер запускает `SelectCommand` команду данных в своем <xref:System.Data.SqlClient.SqlDataReader>свойстве и использует считыватель данных (например), чтобы загрузить результат, установленный в таблицу данных. Аналогичным образом, при вызове `Update` метода адаптера он `UpdateCommand`выполняет `InsertCommand`соответствующую команду (в , и свойства) `DeleteCommand` для каждой измененной записи в таблице данных.

> [!NOTE]
> При наличии достаточной информации в `InsertCommand` `UpdateCommand`основном `DeleteCommand` запросе, команды и команды создаются по умолчанию при создании TableAdapter. Если основной запрос TableAdapter — это больше, чем `SELECT` однотаблица, возможно, что дизайнер `InsertCommand` `UpdateCommand`не `DeleteCommand`сможет генерировать и. Если эти команды не генерируются, при запуске `TableAdapter.Update` метода может возникнуть ошибка.

## <a name="tableadapter-generatedbdirectmethods"></a>ТаблицаAdapter GenerateDbDirectMethods

В дополнение `InsertCommand` `UpdateCommand`к `DeleteCommand`, и , TableAdapters создаются с методами, которые можно запустить непосредственно против базы данных. Вы можете вызвать`TableAdapter.Insert`эти `TableAdapter.Update`методы (, и) `TableAdapter.Delete`непосредственно для манипулирования данными в базе данных. Это означает, что вы можете вызвать эти `TableAdapter.Update` отдельные методы из кода вместо вызова для обработки вставок, обновлений и удалений, ожидающих для связанной таблицы данных.

Если вы не хотите создавать эти прямые методы, установите свойство TableAdapter `false` **GenerateDbDirectMethods** (в окне **свойств свойств свойств).** Дополнительные запросы, добавленные в TableAdapter, являются автономными — они не генерируют эти методы.

## <a name="tableadapter-support-for-nullable-types"></a>Поддержка TableAdapter для недействительных типов

TableAdapters поддерживают недействительные типы `Nullable(Of T)` и `T?`. Дополнительные сведения о типах, допускающих значение NULL, в Visual Basic см. в разделе [Типы значений, допускающие значение NULL](/dotnet/visual-basic/programming-guide/language-features/data-types/nullable-value-types). Для получения дополнительной информации о недействительных типах в C, [см.](/dotnet/csharp/programming-guide/nullable-types/using-nullable-types)

<a name="tableadaptermanager-reference"></a>

## <a name="tableadaptermanager-reference"></a>Справка TableAdapterManager

По умолчанию класс TableAdapterManager генерируетпри расписку при создании набора данных, содержащего соответствующие таблицы. Чтобы предотвратить сгенерание класса, `Hierarchical Update` измените значение свойства набора данных на ложное. Когда вы перетаскиваете таблицу, которая имеет отношение к дизайн-поверхности страницы формы Windows или WPF, Visual Studio объявляет переменную участника класса. Если вы не используете связывание данных, вы должны вручную объявить переменную.

Класс TableAdapterManager не является типом .NET. Таким образом, вы не можете найти его в документации. Он создан во время проектирования как часть процесса создания набора данных.

Ниже приведены часто используемые методы `TableAdapterManager` и свойства класса:

|Участник|Описание|
|------------|-----------------|
|Метод`UpdateAll`|Сохраняет все данные из всех таблиц данных.|
|Свойство `BackUpDataSetBeforeUpdate`|Определяет, следует ли создать резервную копию набора данных `TableAdapterManager.UpdateAll` перед выполнением метода. Логических.|
|*таблицаНаимя* `TableAdapter` свойства|Представляет адаптер таблицы. Генерируемый TableAdapterManager содержит `TableAdapter` свойство для каждого, которым он управляет. Например, набор данных с таблицей заказчиков и заказов `CustomersTableAdapter` генерируется с помощью TableAdapterManager, который содержит и `OrdersTableAdapter` свойства.|
|Свойство `UpdateOrder`|Контролирует порядок индивидуальных команд вставки, обновления и удаления. Установите это в одно из `TableAdapterManager.UpdateOrderOption` значений в перечислении.<br /><br /> По `UpdateOrder` умолчанию, устанавливается **insertUpdateDelete**. Это означает, что вставки, затем обновления, а затем удаления выполняются для всех таблиц в наборе данных.|

## <a name="security"></a>Безопасность

При использовании команд данных с набором свойств CommandType внимательно проверяйте <xref:System.Data.CommandType.Text>информацию, отправленную от клиента, прежде чем передавать ее в базу данных. Злоумышленники могут попытаться отправить (внедрить) модифицированные или добавочные инструкции SQL и получить незаконный доступ к базе данных или повредить ее. Перед передачей пользовательского ввода в базу данных всегда убедитесь, что информация действительна. Наилучшей практикой является всегда использовать параметризированные запросы или сохраненные процедуры, когда это возможно.

## <a name="see-also"></a>См. также раздел

- [Инструменты набора данных](../data-tools/dataset-tools-in-visual-studio.md)
