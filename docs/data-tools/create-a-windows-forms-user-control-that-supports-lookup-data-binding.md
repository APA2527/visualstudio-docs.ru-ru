---
title: Использование таблиц подстановки в привязке данных - элементов управления Windows Forms | Документация Майкрософт
ms.date: 11/04/2016
ms.topic: conceptual
dev_langs:
- VB
- CSharp
helpviewer_keywords:
- data binding, user controls
- LookupBindingPropertiesAttribute class, examples
- user controls [Visual Basic], creating
ms.assetid: c48b4d75-ccfc-4950-8b14-ff8adbfe4208
author: gewarren
ms.author: gewarren
manager: jillfra
ms.workload:
- data-storage
ms.openlocfilehash: fc8c29ae4d146a0ec66a362fd6fb99251d726906
ms.sourcegitcommit: 94b3a052fb1229c7e7f8804b09c1d403385c7630
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/23/2019
ms.locfileid: "62567563"
---
# <a name="create-a-windows-forms-user-control-that-supports-lookup-data-binding"></a>Создание пользовательского элемента управления Windows Forms с подстановочной привязкой данных

При отображении данных на формах Windows Forms вы можете выбрать имеющиеся элементы управления в **области элементов** или создать пользовательские элементы управления, если вашему приложению требуется функциональность, отсутствующая в стандартных элементах управления. В этом пошаговом руководстве демонстрируется создание элемента управления, реализующего <xref:System.ComponentModel.LookupBindingPropertiesAttribute>. Элементы управления, реализующие <xref:System.ComponentModel.LookupBindingPropertiesAttribute>, могут содержать три свойства, которые можно привязать к данным. Такие элементы управления похожи на <xref:System.Windows.Forms.ComboBox>.

Дополнительные сведения о создании элементов управления, см. в разделе [управляет разработки Windows Forms во время разработки](/dotnet/framework/winforms/controls/developing-windows-forms-controls-at-design-time).

При создании элементов управления для использования в сценариях привязки к данным необходимо реализовать один из следующих атрибутов привязки к данным.

|Использование атрибута привязки данных|
| - |
|Реализуйте <xref:System.ComponentModel.DefaultBindingPropertyAttribute> на простых элементах управления, таких как <xref:System.Windows.Forms.TextBox>, которые отображают отдельный столбец (или свойство) данных. Дополнительные сведения см. в разделе [создать пользовательский элемент управления Windows Forms, который поддерживает простую привязку данных](../data-tools/create-a-windows-forms-user-control-that-supports-simple-data-binding.md).|
|Реализуйте <xref:System.ComponentModel.ComplexBindingPropertiesAttribute> на элементах управления, таких как <xref:System.Windows.Forms.DataGridView>, которые отображают списки (или таблицы) данных. Дополнительные сведения см. в разделе [создать пользовательский элемент управления Windows Forms, который поддерживает сложную привязку данных](../data-tools/create-a-windows-forms-user-control-that-supports-complex-data-binding.md).|
|Реализуйте <xref:System.ComponentModel.LookupBindingPropertiesAttribute> на элементах управления, таких как <xref:System.Windows.Forms.ComboBox>, которые отображают списки (или таблицы) данных, но также должны представлять отдельный столбец или отдельное свойство. (Этот процесс описан в данном пошаговом руководстве.)|

В этом пошаговом руководстве создается элемент управления поиска, который привязан к данным из двух таблиц. В данном примере используются таблицы `Customers` и `Orders` из учебной базы данных "Борей". Элемент управления поиском привязан к `CustomerID` из `Orders` таблицы. Это значение используется для поиска `CompanyName` из `Customers` таблицы.

В этом пошаговом руководстве вы узнаете, как:

- Создание **приложения Windows Forms**.

- Добавление нового **пользовательского элемента управления** в проект.

- Визуальное проектирование пользовательского элемента управления.

- Реализация атрибута `LookupBindingProperty`.

- Создание набора данных с помощью **конфигурации источника данных** мастера.

- Настройка столбца **CustomerID** таблицы **Orders** в окне **Источники данных** для использования нового элемента управления.

- Создание формы для отображения данных в новом элементе управления.

## <a name="prerequisites"></a>Предварительные требования

В этом пошаговом руководстве используется SQL Server Express LocalDB и базе данных Northwind.

1. Если у вас нет SQL Server Express LocalDB, установите его из [странице загрузки SQL Server Express](https://www.microsoft.com/sql-server/sql-server-editions-express), либо с помощью **установщик Visual Studio**. В **установщик Visual Studio**, можно установить SQL Server Express LocalDB как часть **хранение и обработка данных** рабочей нагрузки, или в качестве отдельного компонента.

2. Установка образца базы данных "Борей", выполнив следующие действия:

    1. В Visual Studio откройте **обозреватель объектов SQL Server** окна. (Обозреватель объектов SQL Server устанавливается как часть **хранение и обработка данных** рабочей нагрузки в установщике Visual Studio.) Разверните **SQL Server** узла. Щелкните правой кнопкой мыши на локальном экземпляре LocalDB и выберите **новый запрос**.

       Откроется окно редактора запросов.

    2. Копировать [скрипт Northwind Transact-SQL](https://github.com/MicrosoftDocs/visualstudio-docs/blob/master/docs/data-tools/samples/northwind.sql?raw=true) в буфер обмена. Этот сценарий T-SQL создает базу данных "Борей" с нуля и заполняет ее данными.

    3. Вставьте сценарий T-SQL в редакторе запросов, а затем выберите **Execute** кнопки.

       Через некоторое время выполнения запроса отобразятся и создания базы данных Northwind.

## <a name="create-a-windows-forms-app-project"></a>Создайте проект приложения Windows Forms

Первым шагом является создание **приложение Windows Forms** проекта.

1. В Visual Studio на **файл** меню, выберите **New** > **проекта**.

2. Разверните **Visual C#** или **Visual Basic** левой панели, а затем выберите **Windows Desktop**.

3. В средней области выберите **приложения Windows Forms** тип проекта.

4. Назовите проект **LookupControlWalkthrough**, а затем выберите **ОК**.

     Создается проект **LookupControlWalkthrough**, который добавляется в **Обозреватель решений**.

## <a name="add-a-user-control-to-the-project"></a>Добавление пользовательского элемента управления в проект

В данном руководстве элемент управления поиска создается из **пользовательского элемента управления**, поэтому добавьте в проект **LookupControlWalkthrough** элемент **Пользовательский элемент управления**.

1. В меню **Проект** выберите пункт **Добавить пользовательский элемент управления**.

2. Тип `LookupBox` в **имя** области, а затем выберите **добавить**.

     Элемент управления **LookupBox** добавляется в **Обозреватель решений** и открывается в конструкторе.

## <a name="design-the-lookupbox-control"></a>Порядок проектирования элемента управления LookupBox

Для создания элемента управления LookupBox, перетащите <xref:System.Windows.Forms.ComboBox> из **элементов** в область конструктора пользовательского элемента управления.

## <a name="add-the-required-data-binding-attribute"></a>Добавьте необходимый атрибут привязки данных

Для элементов управления поиска, поддерживающих привязку к данным, можно реализовать <xref:System.ComponentModel.LookupBindingPropertiesAttribute>.

1. Переключите элемент управления **LookupBox** в представление кода. (В меню **Вид** выберите **Код**.)

2. Замените код в `LookupBox` следующим кодом:

     [!code-vb[VbRaddataDisplaying#5](../data-tools/codesnippet/VisualBasic/create-a-windows-forms-user-control-that-supports-lookup-data-binding_1.vb)]
     [!code-csharp[VbRaddataDisplaying#5](../data-tools/codesnippet/CSharp/create-a-windows-forms-user-control-that-supports-lookup-data-binding_1.cs)]

3. В меню **Построение** выберите пункт **Построить решение**.

## <a name="create-a-data-source-from-your-database"></a>Создать источник данных из базы данных

В этом шаге **Мастер настройки источника данных** используется для создания источника данных на основе таблиц `Customers` и `Orders` в учебной базе данных "Борей".

1. Чтобы открыть **источников данных** окна на **данных** меню, щелкните **Показать источники данных**.

2. В окне **Источники данных** выберите **Добавить новый источник данных**, чтобы запустить **Мастер настройки источника данных**.

3. На странице **Выбор типа источника данных** выберите элемент **База данных** и нажмите **Далее**.

4. На странице **Выбор подключения к базе данных** выполните одно из следующих действий:

    - Если подключение к учебной базе данных Northwind доступно в раскрывающемся списке, то выберите его.

    - Выберите **Новое подключение** для открытия диалогового окна **Добавить/изменить подключение**.

5. Если базе данных требуется пароль, выберите параметр для включения конфиденциальных данных и нажмите кнопку **Далее**.

6. На **сохранение подключения в файле конфигурации приложения** щелкните **Далее**.

7. Разверните узел **Таблицы** на странице **Выбор объектов базы данных**.

8. Выберите таблицы `Customers` и `Orders` и нажмите кнопку **Готово**.

     Объект **NorthwindDataSet** добавляется в проект, и таблицы `Customers` и `Orders` отображаются в окне **Источники данных**.

## <a name="set-the-customerid-column-of-the-orders-table-to-use-the-lookupbox-control"></a>Установите для столбца CustomerID таблицы заказов на использование элемента управления LookupBox

Вы можете задать создаваемый элемент управления в окне **Источники данных** перед перетаскиванием элементов на форму.

1. Откройте **Form1** в конструкторе.

2. Разверните узел **Customers** в окне **Источники данных**.

3. Разверните узел **Orders** (в узле **Customers** под столбцом **Fax**).

4. Щелкните стрелку раскрывающегося списка в узле **Orders** и выберите **Сведения** в списке элементов управления.

5. Щелкните стрелку раскрывающегося списка в столбце **CustomerID** (в узле **Orders**) и выберите **Настройка**.

6. Выберите **LookupBox** в списке **Связанные элементы управления** диалогового окна **Настройка данных интерфейса пользователя**.

7. Нажмите кнопку **ОК**.

8. Щелкните стрелку раскрывающегося списка в столбце **CustomerID** и выберите **LookupBox**.

## <a name="add-controls-to-the-form"></a>Добавление элементов управления на форму

Вы можете создавать элементы управления с привязкой к данным с помощью перетаскивания элементов из окна **Источники данных** на форму **Form1**.

Чтобы создать элементы управления с привязкой данных в форме Windows, перетащите **заказы** узел из **источников данных** окна в форму Windows и убедитесь, что **LookupBox** элемент управления используется для отображения данных в `CustomerID` столбца.

## <a name="bind-the-control-to-look-up-companyname-from-the-customers-table"></a>Привязка элемента управления для поиска CompanyName из таблицы Customers

Для настройки привязок поиска, выберите главный **клиентов** узел в **источников данных** окно и перетащите его в поле со списком в поле **CustomerIDLookupBox** на **Form1**.

При этом задается привязка к данным для отображения `CompanyName` из таблицы `Customers` с сохранением значения `CustomerID` из таблицы `Orders`.

## <a name="run-the-application"></a>Запуск приложения

- Нажмите клавишу **F5** для запуска приложения.

- Перейдите по нескольким записям и проверьте, что `CompanyName` отображается в элементе управления `LookupBox`.

## <a name="see-also"></a>См. также

- [Привязка элементов управления Windows Forms к данным в Visual Studio](../data-tools/bind-windows-forms-controls-to-data-in-visual-studio.md)