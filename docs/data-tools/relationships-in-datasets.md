---
title: Создание связей между наборами данных
description: Создание связей между наборами данных в Visual Studio. Общие сведения об объектах и ограничениях DataRelation. Вручную создать связь данных в Диспетчере наборов данных.
ms.custom: SEO-VS-2020
ms.date: 11/04/2016
ms.topic: how-to
f1_keywords:
- vbData.Microsoft.VSDesigner.DataSource.DesignRelation
- vbdata.Microsoft.VSDesigner.DataSource.DesignRelation
helpviewer_keywords:
- relationships, about relationships
- datasets [Visual Basic], relationships
- relationships, datasets
ms.assetid: cfe274f0-71fe-40f6-994e-7c7f6273c9ba
author: ghogen
ms.author: ghogen
manager: jmartens
ms.workload:
- data-storage
ms.openlocfilehash: 92e1a03a9a72b550c77aa734c4a9ff2d0b184839
ms.sourcegitcommit: ae6d47b09a439cd0e13180f5e89510e3e347fd47
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 02/08/2021
ms.locfileid: "99866610"
---
# <a name="create-relationships-between-datasets"></a>Создание связей между наборами данных
Набор данных, содержащий связанные таблицы данных, использует <xref:System.Data.DataRelation> объекты для представления связи «родители-потомки» между таблицами и для возвращения связанных записей друг от друга. При добавлении связанных таблиц в наборы данных с помощью **мастера настройки источника** или **Конструктор наборов данных** создает и настраивает <xref:System.Data.DataRelation> объект.

<xref:System.Data.DataRelation>Объект выполняет две функции:

- Он может сделать доступными записи, связанные с записью, с которой вы работаете. Он предоставляет дочерние записи в родительской записи ( <xref:System.Data.DataRow.GetChildRows%2A> ) и родительской записи при работе с дочерней записью ( <xref:System.Data.DataRow.GetParentRow%2A> ).

- Он может применять ограничения для ссылочной целостности, например удалять связанные дочерние записи при удалении родительской записи.

Важно понимать разницу между истинным соединением и функцией <xref:System.Data.DataRelation> объекта. В случае истинного объединения записи берутся из родительской и дочерней таблиц и помещаются в один плоский набор записей. При использовании <xref:System.Data.DataRelation> объекта новый набор записей не создается. Вместо этого DataRelation отслеживает связь между таблицами и сохраняет синхронизацию родительских и дочерних записей.

## <a name="datarelation-objects-and-constraints"></a>Объекты и ограничения DataRelation
<xref:System.Data.DataRelation>Объект также используется для создания и принудительного применения следующих ограничений.

- Ограничение UNIQUE, которое гарантирует, что столбец в таблице не содержит дубликатов.

- Ограничение внешнего ключа, которое можно использовать для поддержания ссылочной целостности между родительской и дочерней таблицами в наборе данных.

Ограничения, указываемые в <xref:System.Data.DataRelation> объекте, реализуются путем автоматического создания соответствующих объектов или настройки свойств. При создании ограничения внешнего ключа с помощью <xref:System.Data.DataRelation> объекта экземпляры <xref:System.Data.ForeignKeyConstraint> класса добавляются в <xref:System.Data.DataRelation> <xref:System.Data.DataRelation.ChildKeyConstraint%2A> свойство объекта.

Ограничение UNIQUE реализуется либо путем простого присвоения <xref:System.Data.DataColumn.Unique%2A> свойству столбца данных значения `true` или путем добавления экземпляра <xref:System.Data.UniqueConstraint> класса к <xref:System.Data.DataRelation> <xref:System.Data.DataRelation.ParentKeyConstraint%2A> свойству объекта. Сведения о приостановке ограничений в наборе данных см. в разделе Отключение [ограничений при заполнении набора данных](../data-tools/turn-off-constraints-while-filling-a-dataset.md).

### <a name="referential-integrity-rules"></a>Правила ссылочной целостности
В рамках ограничения внешнего ключа можно указать правила ссылочной целостности, применяемые в трех точках:

- При обновлении родительской записи

- При удалении родительской записи

- Когда изменение принято или отклонено

Правила, которые можно сделать, указаны в <xref:System.Data.Rule> перечислении и перечислены в следующей таблице.

|Правило ограничения внешнего ключа|Действие|
| - |------------|
|<xref:System.Data.Rule.Cascade>|Изменения (обновление или удаление), внесенные в родительскую запись, также вносятся в связанные записи в дочерней таблице.|
|<xref:System.Data.Rule.SetNull>|Дочерние записи не удаляются, но внешний ключ в дочерних записях имеет значение <xref:System.DBNull> . С помощью этого параметра дочерние записи можно оставить как потерянные, т. е. они не имеют связи с родительскими записями. **Примечание.** Использование этого правила может привести к недопустимым данным в дочерней таблице.|
|<xref:System.Data.Rule.SetDefault>|Внешнему ключу в связанных дочерних записях присваивается значение по умолчанию (как установлено <xref:System.Data.DataColumn.DefaultValue%2A> свойством столбца).|
|<xref:System.Data.Rule.None>|В связанные дочерние записи не вносятся изменения. При использовании этого параметра дочерние записи могут содержать ссылки на недопустимые родительские записи.|

Дополнительные сведения об обновлениях в таблицах наборов данных см. в разделе [Сохранение данных в базе данных](../data-tools/save-data-back-to-the-database.md).

### <a name="constraint-only-relations"></a>Отношения только для ограничений
При создании <xref:System.Data.DataRelation> объекта можно указать, что отношение должно использоваться только для принудительного применения ограничений, то есть оно также не будет использоваться для доступа к связанным записям. Этот параметр можно использовать для создания набора данных, который является немного более эффективным и содержит меньше методов, чем один с возможностью связанных записей. Однако доступ к связанным записям будет невозможен. Например, отношение только с ограничением не позволяет удалить родительскую запись, которая по-прежнему имеет дочерние записи, и вы не сможете получить доступ к дочерним записям через родительский элемент.

## <a name="manually-creating-a-data-relation-in-the-dataset-designer"></a>Создание связи данных вручную в конструктор наборов данных
При создании таблиц данных с помощью средств проектирования данных в Visual Studio связи создаются автоматически, если данные могут быть собраны из источника данных. При добавлении вручную таблиц данных из вкладки **набор данных** **панели элементов** может потребоваться создать связь вручную. Сведения о создании <xref:System.Data.DataRelation> объектов программным путем см. в разделе [Добавление связей](/dotnet/framework/data/adonet/dataset-datatable-dataview/adding-datarelations)данных.

Связи между таблицами данных отображаются в виде линий в **Конструктор наборов данных** с глифом "один ко многим". По умолчанию имя связи не отображается в области конструктора.

[!INCLUDE[note_settings_general](../data-tools/includes/note_settings_general_md.md)]

#### <a name="to-create-a-relationship-between-two-data-tables"></a>Создание связи между двумя таблицами данных

1. Откройте свой набор данных в **Конструкторе наборов данных**. Дополнительные сведения см. [в разделе Пошаговое руководство. Создание набора данных в конструктор наборов данных](walkthrough-creating-a-dataset-with-the-dataset-designer.md).

2. Перетащите объект **связи** с панели элементов **набора данных** на дочернюю таблицу данных в связи.

     Откроется диалоговое окно **связь** с заполнением поля **дочерней таблицы** таблицей, в которую перетаскивается объект **связи** .

3. Выберите родительскую таблицу из поля **Родительская таблица** . Родительская таблица содержит записи на стороне «один» связи «один ко многим».

4. Убедитесь, что в поле **дочерняя таблица** отображается правильная дочерняя таблица. Дочерняя таблица содержит записи на стороне «многие» связи «один ко многим».

5. Введите имя связи в поле **имя** или оставьте имя по умолчанию на основе выбранных таблиц. Это имя фактического <xref:System.Data.DataRelation> объекта в коде.

6. Выберите столбцы, которые объединяют таблицы в списках **Ключевые столбцы** и **Внешние ключевые столбцы** .

7. Выберите, следует ли создать связь, ограничение или и то, и другое.

8. Установите или снимите флажок **Вложенная связь** . При выборе этого параметра свойству присваивается значение <xref:System.Data.DataRelation.Nested%2A> `true` , после чего дочерние строки отношения вкладываются в родительский столбец, когда эти строки записываются в виде XML-данных или синхронизируются с <xref:System.Xml.XmlDataDocument> . Дополнительные сведения см. в разделе [вложенность связей](/dotnet/framework/data/adonet/dataset-datatable-dataview/nesting-datarelations)данных.

9. Задайте правила, которые должны применяться при внесении изменений в записи в этих таблицах. Для получения дополнительной информации см. <xref:System.Data.Rule>.

10. Нажмите кнопку **ОК** , чтобы создать связь. Линия связи появится в конструкторе между двумя таблицами.

#### <a name="to-display-a-relation-name-in-the-dataset-designer"></a>Отображение имени отношения в конструктор наборов данных

1. Откройте свой набор данных в **Конструкторе наборов данных**. Дополнительные сведения см. [в разделе Пошаговое руководство. Создание набора данных в конструктор наборов данных](walkthrough-creating-a-dataset-with-the-dataset-designer.md).

2. В меню **данные** выберите команду **Показать связи меток** , чтобы отобразить имя связи. Очистите эту команду, чтобы скрыть имя связи.

## <a name="see-also"></a>См. также раздел

- [Создание и настройка наборов данных в Visual Studio](../data-tools/create-and-configure-datasets-in-visual-studio.md)
