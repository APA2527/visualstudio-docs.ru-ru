---
title: Практическое руководство. Публикация приложения WPF с включенными визуальными стилями | Документация Майкрософт
ms.date: 11/04/2016
ms.topic: conceptual
ms.assetid: 73b22b02-fc75-42aa-82d3-51fdcaf8e5c8
author: mikejo5000
ms.author: mikejo
manager: jillfra
ms.workload:
- multiple
ms.openlocfilehash: 4ed9a9a349f2496343a9a9828cd436d8d4015aa9
ms.sourcegitcommit: 94b3a052fb1229c7e7f8804b09c1d403385c7630
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/23/2019
ms.locfileid: "62898351"
---
# <a name="how-to-publish-a-wpf-application-with-visual-styles-enabled"></a>Практическое руководство. Публикация приложения WPF с включенными визуальными стилями

Визуальные стили включить внешний вид стандартные элементы управления для меняться в зависимости от темы, выбранного пользователем. По умолчанию визуальные стили не включены для приложений Windows Presentation Foundation (WPF), поэтому их необходимо включить вручную. Тем не менее Включение визуальных стилей для приложения WPF и публикации решения приводит к ошибке. В этом разделе описывается устранение этой ошибки и процесс для публикации приложения WPF с включенными визуальными стилями. Дополнительные сведения о стилях см. в разделе [Общие сведения о визуальных стилей](/windows/desktop/Controls/visual-styles-overview). Дополнительные сведения о сообщении об ошибке, см. в разделе [Устранение ошибок в развертываниях ClickOnce](../deployment/troubleshooting-specific-errors-in-clickonce-deployments.md).

 Чтобы устранить эту ошибку и опубликовать решение, необходимо выполнить следующие задачи:

- [Опубликуйте решение без включенными визуальными стилями](#publish-the-solution-without-visual-styles-enabled).

- [Создать файл манифеста](#create-a-manifest-file).

- [Внедрение файла манифеста в исполняемый файл опубликованного решения](#embed-the-manifest-file-into-the-executable-file-of-the-published-solution).

- [Подписание манифестов приложения и развертывания](#sign-the-application-and-deployment-manifests).

  Затем можно переместить опубликованные файлы в расположение, из которого требуется конечным пользователям для установки приложения.

## <a name="publish-the-solution-without-visual-styles-enabled"></a>Опубликуйте решение без включенными визуальными стилями

1. Убедитесь, что проект не имеет включенными визуальными стилями. Во-первых проверьте следующий код XML файла манифеста для проекта. Если имеется XML, заключен в тег комментария XML.

     По умолчанию не включены визуальные стили.

    ```xml
    <dependency>
        <dependentAssembly>
            <assemblyIdentity type="win32" name="Microsoft.Windows.Common-Controls" version="6.0.0.0" processorArchitecture="*" publicKeyToken="6595b64144ccf1df" language="*" />
        </dependentAssembly>
    </dependency>
    ```

     Следующие процедуры показывают, как открыть файл манифеста, связанный с проектом.

    **Чтобы открыть файл манифеста в проекте Visual Basic**

    1. В строке меню выберите **проекта**, *имя_проекта* **свойства**, где *имя_проекта* имя проекта WPF.

         Отображаются на страницах свойств для проекта WPF.

    2. На **приложения** вкладке, выберите **просмотреть параметры Windows**.

         Файл app.manifest открывается в **редактор кода**.

    **Чтобы открыть файл манифеста в проекте C#**

    1. В строке меню выберите **проекта**, *имя_проекта* **свойства**, где *имя_проекта* имя проекта WPF.

         Отображаются на страницах свойств для проекта WPF.

    2. На **приложения** вкладке, запомните или запишите имя, которое отображается в поле манифеста. Это имя манифеста, который связан с проектом.

        > [!NOTE]
        > Если **внедрить манифест с параметрами по умолчанию** или **создать приложение без манифеста** отображаются в поле манифеста не включены визуальные стили. Если имя файла манифеста, отображается в поле манифеста, перейдите к следующему шагу в этой процедуре.

    3. В **обозревателе решений** выберите **Показать все файлы**.

         Эта кнопка показывает все элементы проекта, включая те, которые были исключены и те, которые обычно скрыты. Файл манифеста отображается как элемент проекта.

2. Создайте и опубликуйте решение. Дополнительные сведения о том, как опубликовать решение, см. в разделе [как: опубликовать приложение ClickOnce с помощью мастера публикации](../deployment/how-to-publish-a-clickonce-application-using-the-publish-wizard.md).

## <a name="create-a-manifest-file"></a>Создать файл манифеста

1. Вставьте следующий код XML в файл блокнота.

     Этот XML-документ описывает сборку, содержащую элементы управления, которые поддерживает стили оформления.

    ```xml
    <?xml version="1.0" encoding="utf-8"?>
    <asmv1:assembly manifestVersion="1.0"
        xmlns="urn:schemas-microsoft-com:asm.v1"
        xmlns:asmv1="urn:schemas-microsoft-com:asm.v1"
        xmlns:asmv2="urn:schemas-microsoft-com:asm.v2"
        xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
        <dependency>
            <dependentAssembly>
                <assemblyIdentity type="win32" name="Microsoft.Windows.Common-Controls" version="6.0.0.0" processorArchitecture="*" publicKeyToken="6595b64144ccf1df" language="*" />
            </dependentAssembly>
        </dependency>
    </asmv1:assembly>
    ```

2. В блокноте, выберите **файл**, а затем нажмите кнопку **Сохранить как**.

3. В **Сохранить как** отображаемое в диалоговом окне **тип** стрелку раскрывающегося списка выберите **все файлы**.

4. В **имя файла** поле, назовите файл и добавьте *.manifest* в конец имени файла. Например: *themes.manifest*.

5. Выберите **Обзор папок** , выберите любую папку, а затем нажмите кнопку **Сохранить**.

    > [!NOTE]
    > В оставшихся процедурах предполагается, что этот файл называется *themes.manifest* и что файл сохраняется в *C:\temp* на локальном компьютере.

## <a name="embed-the-manifest-file-into-the-executable-file-of-the-published-solution"></a>Внедрение файла манифеста в исполняемый файл опубликованного решения

1. Откройте **Командная строка Visual Studio**.

    Дополнительные сведения об открытии **Командная строка Visual Studio**, см. в разделе [командные строки](/dotnet/framework/tools/developer-command-prompt-for-vs).

   > [!NOTE]
   > Остальные шаги на следующих допущениях о решении:
   >
   > - Имя решения — **MyWPFProject**.
   > - Решение находится в следующем каталоге: `%UserProfile%\Documents\Visual Studio 2010\Projects\`.
   >
   > - Решение публикуется в следующий каталог: `%UserProfile%\Documents\Visual Studio 2010\Projects\publish`.
   > - Самую последнюю версию файлов опубликованного приложения находится в следующем каталоге: `%UserProfile%\Documents\Visual Studio 2010\Projects\publish\Application Files\WPFApp_1_0_0_0`
   >
   > У вас нет использовать имя или расположение каталогов, описанных выше. Имя и местах, описанных выше, используются только для иллюстрации шаги, необходимые для публикации решения.

2. В командной строке измените путь к каталогу, который содержит самую последнюю версию файлов опубликованного приложения. Ниже приведен пример этого шага.

   ```cmd
   cd "%UserProfile%\Documents\Visual Studio 2010\Projects\MyWPFProject\publish\Application Files\WPFApp_1_0_0_0"
   ```

3. В командной строке выполните следующую команду, чтобы внедрить файл манифеста в исполняемый файл приложения.

   ```cmd
   mt -manifest c:\temp\themes.manifest -outputresource:MyWPFApp.exe.deploy
   ```

## <a name="sign-the-application-and-deployment-manifests"></a>Подписание манифестов приложения и развертывания

1. В командной строке выполните следующую команду, чтобы удалить *.deploy* расширения из исполняемого файла в текущем каталоге.

   ```cmd
   ren MyWPFApp.exe.deploy MyWPFApp.exe
   ```

   > [!NOTE]
   > В этом примере предполагается, что только один файл имеет *.deploy* расширение файла. Убедитесь, что переименовать все файлы в этом каталоге, *.deploy* расширение файла.

2. В командной строке выполните следующую команду, чтобы подписать манифест приложения.

   ```cmd
   mage -u MyWPFApp.exe.manifest -cf ..\..\..\MyWPFApp_TemporaryKey.pfx
   ```

   > [!NOTE]
   > В этом примере предполагается, что вы подпишите манифест с помощью *.pfx* файл проекта. Если вы не входите манифест, можно опустить `-cf` параметр, используемый в этом примере. Если вы входите манифест с помощью сертификата, требующий пароль, укажите `-password` параметр (`For example: mage -u MyWPFApp.exe.manifest -cf ..\..\..\MyWPFApp_TemporaryKey.pfx - password Password`).

3. В командной строке выполните следующую команду, чтобы добавить *.deploy* расширение к имени файла, который был переименован на предыдущем шаге этой процедуры.

   ```
   ren MyWPFApp.exe MyWPFApp.exe.deploy
   ```

   > [!NOTE]
   > В этом примере предполагается, что только один файл было *.deploy* расширение файла. Убедитесь, что переименовать все файлы в этом каталоге, ранее имевший *.deploy* расширение имени файла.

4. В командной строке выполните следующую команду, чтобы подписать манифест развертывания.

   ```
   mage -u ..\..\MyWPFApp.application -appm MyWPFApp.exe.manifest -cf ..\..\..\MyWPFApp_TemporaryKey.pfx
   ```

   > [!NOTE]
   > В этом примере предполагается, что вы подпишите манифест с помощью *.pfx* файл проекта. Если вы не входите манифест, можно опустить `-cf` параметр, используемый в этом примере. Если вы входите манифест с помощью сертификата, требующий пароль, укажите `-password` параметра, как в следующем примере:`For example: mage -u MyWPFApp.exe.manifest -cf ..\..\..\MyWPFApp_TemporaryKey.pfx - password Password`.

   После выполнения этих действий опубликованные файлы можно переместить в расположение, из которого требуется конечным пользователям для установки приложения. Если вы собираетесь обновить решение часто, можно переместить эти команды в сценарий и запустите скрипт, каждый раз при публикации новой версии.

## <a name="see-also"></a>См. также

-[Устранение неполадок, приводящих к определенным ошибкам в развертываниях ClickOnce](../deployment/troubleshooting-specific-errors-in-clickonce-deployments.md)
- [Общие сведения о визуальных стилей](/windows/desktop/Controls/visual-styles-overview)
- [Включение визуальных стилей](/windows/desktop/Controls/cookbook-overview)
- [Командные строки](/dotnet/framework/tools/developer-command-prompt-for-vs)
