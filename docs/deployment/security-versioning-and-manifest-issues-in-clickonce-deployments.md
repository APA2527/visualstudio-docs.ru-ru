---
title: Проблемы безопасности, управления версиями и манифеста в развертывании ClickOnce
ms.date: 11/04/2016
ms.topic: conceptual
dev_langs:
- VB
- CSharp
- C++
helpviewer_keywords:
- versioning, ClickOnce applications
- ClickOnce applications, Windows Vista User Account Control
- ClickOnce applications, versioning issues
- security, ClickOnce applications
- Windows 7, ClickOnce deployments
- ClickOnce applications, manifest issues
- User Account Control, ClickOnce applications
- Windows Vista, ClickOnce deployments
- manifests [ClickOnce]
- ClickOnce applications, security issues
author: mikejo5000
ms.author: mikejo
manager: jillfra
ms.workload:
- multiple
ms.openlocfilehash: bb2ec5229132265feb1095c9ee921d73a1568dd2
ms.sourcegitcommit: 6cfffa72af599a9d667249caaaa411bb28ea69fd
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 09/02/2020
ms.locfileid: "66745609"
---
# <a name="security-versioning-and-manifest-issues-in-clickonce-deployments"></a>Вопросы безопасности, контроля версий и манифестов в развертываниях ClickOnce

Существует множество проблем с [!INCLUDE[ndptecclick](../deployment/includes/ndptecclick_md.md)] безопасностью, управлением версиями приложений, синтаксисом манифеста и семантикой, которая может вызвать сбой [!INCLUDE[ndptecclick](../deployment/includes/ndptecclick_md.md)] развертывания.

## <a name="clickonce-and-windows-vista-user-account-control"></a>Управление учетными записями пользователей ClickOnce и Windows Vista

В [!INCLUDE[windowsver](../deployment/includes/windowsver_md.md)] приложения по умолчанию выполняются от имени обычного пользователя, даже если текущий пользователь вошел в систему с учетной записью, обладающей разрешениями администратора. Если приложение должно выполнить действие, требующее разрешений администратора, оно сообщает операционной системе, что затем пользователю предлагается ввести учетные данные администратора. Эта функция, именуемая контролем учетных записей пользователей (UAC), запрещает приложениям вносить изменения, которые могут повлиять на всю операционную систему без явного утверждения пользователем. Приложения Windows объявляют, что им требуется это повышение прав, указывая `requestedExecutionLevel` атрибут в `trustInfo` разделе манифеста приложения.

Из-за риска предоставления приложений для атак с повышением безопасности [!INCLUDE[ndptecclick](../deployment/includes/ndptecclick_md.md)] приложения не могут запрашивать повышение прав, если для клиента включен контроль учетных записей. Любое [!INCLUDE[ndptecclick](../deployment/includes/ndptecclick_md.md)] приложение, которое пытается установить его `requestedExecutionLevel` атрибут в `requireAdministrator` или `highestAvailable` не будет устанавливаться в [!INCLUDE[windowsver](../deployment/includes/windowsver_md.md)] .

В некоторых случаях [!INCLUDE[ndptecclick](../deployment/includes/ndptecclick_md.md)] приложение может попытаться запуститься с разрешениями администратора из-за логики обнаружения установщика [!INCLUDE[windowsver](../deployment/includes/windowsver_md.md)] . В этом случае можно задать `requestedExecutionLevel` атрибуту в манифесте приложения значение `asInvoker` . Это приведет к тому, что приложение будет выполняться без повышения прав. [!INCLUDE[vs_orcas_long](../debugger/includes/vs_orcas_long_md.md)] автоматически добавляет этот атрибут ко всем манифестам приложения.

При разработке приложения, для которого требуются права администратора на протяжении всего жизненного цикла приложения, следует рассмотреть возможность развертывания приложения с помощью технологии установщик Windows (MSI). Дополнительные сведения см. в статье [установщик Windows основы](../extensibility/internals/windows-installer-basics.md).

## <a name="online-application-quotas-and-partial-trust-applications"></a>Квоты интерактивных приложений и приложения с частичным доверием

Если [!INCLUDE[ndptecclick](../deployment/includes/ndptecclick_md.md)] приложение работает в режиме «в сети», а не через установку, оно должно разместиться в пределах квоты, установленной для интерактивных приложений. Кроме того, сетевое приложение, работающее в режиме частичного доверия, например с ограниченным набором разрешений безопасности, не может быть больше половины размера квоты.

Дополнительные сведения и инструкции по изменению квоты интерактивных приложений см. в статье [Общие сведения о кэше ClickOnce](../deployment/clickonce-cache-overview.md).

## <a name="versioning-issues"></a>Вопросы управления версиями

Если присвоить сборке строгие имена и увеличить номер версии сборки в соответствии с обновлением приложения, могут возникнуть проблемы. Любая сборка, скомпилированная со ссылкой на сборку со строгим именем, должна быть перекомпилирована, либо сборка попытается сослаться на старую версию. Сборка попытается выполнить это, так как сборка использует старое значение версии в своем запросе привязки.

Например, предположим, что у вас есть сборка со строгим именем в собственном проекте с версией 1.0.0.0. После компиляции сборки добавьте ее в качестве ссылки на проект, содержащий основное приложение. Если обновить сборку, увеличить версию до 1.0.0.1 и попытаться развернуть ее без повторной компиляции приложения, приложение не сможет загрузить сборку во время выполнения.

Эта ошибка может возникать, только если вы редактируете [!INCLUDE[ndptecclick](../deployment/includes/ndptecclick_md.md)] манифесты вручную; эта ошибка не возникает при создании развертывания с помощью Visual Studio.

## <a name="specify-individual-net-framework-assemblies-in-the-manifest"></a>Указание отдельных сборок .NET Framework в манифесте

Приложению не удастся загрузиться, если развертывание было вручную изменено [!INCLUDE[ndptecclick](../deployment/includes/ndptecclick_md.md)] для ссылки на более старую версию .NET Framework сборки. Например, если вы добавили ссылку на сборку System.Net для версии .NET Framework до версии, указанной в манифесте, возникнет ошибка. В общем случае не следует пытаться указывать ссылки на отдельные .NET Framework сборки, так как версия .NET Framework, для которой выполняется приложение, указывается в качестве зависимости в манифесте приложения.

## <a name="manifest-parsing-issues"></a>Проблемы синтаксического анализа манифеста

Файлы манифеста, используемые в, [!INCLUDE[ndptecclick](../deployment/includes/ndptecclick_md.md)] являются XML-файлами и должны быть правильно сформированными и допустимыми: они должны соблюдать синтаксические правила XML и использовать только элементы и атрибуты, определенные в соответствующей схеме XML.

Что может вызвать проблемы в файле манифеста — выбор имени приложения, содержащего специальный символ, например одинарную или двойную кавычки. Имя приложения является частью его [!INCLUDE[ndptecclick](../deployment/includes/ndptecclick_md.md)] удостоверения. [!INCLUDE[ndptecclick](../deployment/includes/ndptecclick_md.md)] в настоящее время не выполняет синтаксический анализ удостоверений, содержащих специальные символы. Если не удается активировать приложение, убедитесь, что для имени используются только буквенные и цифровые символы, и повторите попытку развертывания.

Если вы вручную редактировали манифесты развертывания или приложения, возможно, они были случайно повреждены. Поврежденный манифест будет препятствовать правильной [!INCLUDE[ndptecclick](../deployment/includes/ndptecclick_md.md)] установке. Можно отлаживать такие ошибки во время выполнения, щелкнув **сведения** в диалоговом окне **Ошибка ClickOnce** и прочитав сообщение об ошибке в журнале. В журнале появится одно из следующих сообщений:

- Описание синтаксической ошибки, номер строки и позицию символа, где произошла ошибка.

- Имя элемента или атрибута, используемого при нарушении схемы манифеста. Если вы вручную добавили XML-код в манифесты, вам потребуется сравнить внесенные вами дополнения со схемами манифеста. Дополнительные сведения см. в разделе [манифест развертывания ClickOnce](../deployment/clickonce-deployment-manifest.md) и [манифест приложения ClickOnce](../deployment/clickonce-application-manifest.md).

- Конфликт ИДЕНТИФИКАТОРов. Ссылки на зависимости в манифестах развертывания и приложений должны быть уникальными как в `name` атрибутах, так и в `publicKeyToken` . Если оба атрибута совпадают между любыми двумя элементами в манифесте, синтаксический анализ манифеста не будет выполнен.

## <a name="precautions-when-manually-changing-manifests-or-applications"></a>Меры предосторожности при изменении манифестов или приложений вручную

При обновлении манифеста приложения необходимо повторно подписать манифест приложения и манифест развертывания. Манифест развертывания содержит ссылку на манифест приложения, который содержит хэш этого файла и его цифровую подпись.

### <a name="precautions-with-deployment-provider-usage"></a>Меры предосторожности при использовании поставщика развертывания

[!INCLUDE[ndptecclick](../deployment/includes/ndptecclick_md.md)]Манифест развертывания имеет `deploymentProvider` свойство, которое указывает на полный путь к расположению, из которого приложение должно устанавливаться и обслуживаться.

```xml
<deploymentProvider codebase="http://myserver/myapp.application" />
```

Этот путь задается при [!INCLUDE[ndptecclick](../deployment/includes/ndptecclick_md.md)] создании приложения и является обязательным для установленных приложений. Путь указывает на стандартное расположение, в котором [!INCLUDE[ndptecclick](../deployment/includes/ndptecclick_md.md)] установщик будет устанавливать приложение, и выполнить поиск обновлений. Если вы используете команду **xcopy** для копирования [!INCLUDE[ndptecclick](../deployment/includes/ndptecclick_md.md)] приложения в другое расположение, но не изменяете `deploymentProvider` свойство, [!INCLUDE[ndptecclick](../deployment/includes/ndptecclick_md.md)] будет по-прежнему возвращаться к исходному расположению при попытке загрузить приложение.

Если требуется переместить или скопировать приложение, необходимо также обновить `deploymentProvider` путь, чтобы клиент фактически устанавливался из нового расположения. Обновление этого пути в основном является проблемой, если установлены приложения. Для интерактивных приложений, которые всегда запускаются по исходному URL-адресу, установка параметра `deploymentProvider` является необязательной. Если `deploymentProvider` задано значение, оно будет учитываться; в противном случае URL-адрес, используемый для запуска приложения, будет использоваться в качестве базового URL-адреса для скачивания файлов приложения.

> [!NOTE]
> Каждый раз при обновлении манифеста необходимо также подписать его снова.

## <a name="see-also"></a>См. также раздел

[Устранение неполадок при развертывании ClickOnce](../deployment/troubleshooting-clickonce-deployments.md) 
 [Безопасные приложения ClickOnce](../deployment/securing-clickonce-applications.md) 
 [Выбор стратегии развертывания ClickOnce](../deployment/choosing-a-clickonce-deployment-strategy.md)
