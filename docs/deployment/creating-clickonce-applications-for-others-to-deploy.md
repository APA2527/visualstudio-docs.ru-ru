---
title: Создание приложений ClickOnce для развертывания другими пользователями | Документация Майкрософт
description: Узнайте о клиентах, размещенных в приложениях ClickOnce, разработанных в .NET Framework 3,5 и предыдущих версиях .NET Framework.
ms.custom: SEO-VS-2020
ms.date: 11/04/2016
ms.topic: conceptual
dev_langs:
- VB
- CSharp
- C++
helpviewer_keywords:
- preserved branding information
- useManifestForTrust element
- customer deployments [ClickOnce]
- multiple ClickOnce deployment and branding
- ClickOnce applications, previous .NET Framework versions
- application manifests [ClickOnce]
- <useManifestForTrust> element
- manifests [ClickOnce]
- trust applications, ClickOnce
- ClickOnce applications, deployed by others
- ClickOnce applications, previous .NET Framework
ms.assetid: d20766c7-4ef3-45ab-8aa0-3f15b61eccaa
author: mikejo5000
ms.author: mikejo
manager: jillfra
ms.workload:
- multiple
ms.openlocfilehash: 7379038d1c2bf203f7787e69408ddd9b2e30f372
ms.sourcegitcommit: 0893244403aae9187c9375ecf0e5c221c32c225b
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 11/09/2020
ms.locfileid: "94383005"
---
# <a name="create-clickonce-applications-for-others-to-deploy"></a>Создание приложений ClickOnce для развертывания другими пользователями
Не все разработчики, создающие развертывания ClickOnce, планируют развертывание самих приложений. Многие из них просто упаковывают свои приложения с помощью ClickOnce, а затем передают файлы клиенту, например крупную корпорацию. Клиент отвечает за размещение приложения в своей сети. В этом разделе обсуждаются некоторые проблемы, связанные с такими развертываниями в версиях .NET Framework до версии 3,5. Затем описывается новое решение, предоставляемое с помощью новой функции "использовать манифест для доверия" в .NET Framework 3,5. Наконец, она завершается рекомендуемыми стратегиями создания развертываний ClickOnce для клиентов, которые по-прежнему используют более старые версии .NET Framework.

## <a name="issues-involved-in-creating-deployments-for-customers"></a>Проблемы, связанные с созданием развертываний для клиентов
 При планировании предоставления развертывания клиенту возникает несколько проблем. Первая ошибка касается подписывания кода. Чтобы развертывать по сети, манифест развертывания и манифест приложения для развертывания ClickOnce должны быть подписаны цифровым сертификатом. Это вызовет вопрос, следует ли использовать сертификат разработчика или сертификат клиента при подписывании манифестов.

 Вопрос, какой сертификат следует использовать, является критически важным, так как удостоверение приложения ClickOnce основано на цифровой подписи манифеста развертывания. Если разработчик подписывает манифест развертывания, это может привести к конфликтам, если клиент является крупной компанией, и более одного отделения компании развертывает настроенную версию приложения.

 Например, предположим, что в Adventure Works есть финансовый отдел и отдел кадров. Оба отдела отнимаются лицензией приложения ClickOnce от корпорации Майкрософт, которое создает отчеты на основе данных, хранящихся в базе данных SQL. Корпорация Майкрософт предоставляет каждому отделу версию приложения, настроенную для их данных. Если приложения подписаны одним и тем же сертификатом Authenticode, то пользователь, пытающийся использовать оба приложения, получит сообщение об ошибке, так как ClickOnce будет рассматривать второе приложение как идентичное первому. В этом случае клиент может столкнуться с непредсказуемыми и нежелательными побочными эффектами, которые включают потери данных, хранящихся локально в приложении.

 Дополнительная проблема, связанная с подписыванием кода, — это `deploymentProvider` элемент в манифесте развертывания, который сообщает ClickOnce, где искать обновления приложения. Этот элемент необходимо добавить в манифест развертывания перед его подписыванием. Если этот элемент добавляется позже, манифест развертывания должен быть подписан повторно.

### <a name="require-the-customer-to-sign-the-deployment-manifest"></a>Требовать, чтобы клиент подписывания манифеста развертывания
 Одним из решений этой проблемы неуникальных развертываний является то, что разработчик подписывает манифест приложения, а клиент подписывает манифест развертывания. Хотя этот подход работает, он предоставляет другие проблемы. Поскольку сертификат Authenticode должен оставаться защищенным ресурсом, клиент не может просто предоставить сертификат разработчику для подписания развертывания. Хотя клиент может подписать манифест развертывания самостоятельно с помощью средств, доступных в пакете SDK для .NET Framework, это может потребовать больше технических знаний, чем клиент готов или может предоставить. В таких случаях разработчик обычно создает приложение, веб-сайт или другой механизм, с помощью которого клиент может отправить свою версию приложения для подписания.

### <a name="the-impact-of-customer-signing-on-clickonce-application-security"></a>Влияние подписи клиента на безопасность приложений ClickOnce
 Даже если разработчик и клиент согласны, что клиент должен подписывать манифест приложения, это вызывает другие проблемы, связанные с удостоверением приложения, особенно в том случае, если оно применяется к развертыванию доверенных приложений. (Дополнительные сведения об этой функции см. в разделе [Общие сведения о развертывании доверенных приложений](../deployment/trusted-application-deployment-overview.md).) Предположим, что компания Adventure Works хочет настроить клиентские компьютеры таким образом, чтобы любое приложение, предоставляемое корпорацией Майкрософт, выполнялось с полным доверием. Если компания Adventure Works подписывает манифест развертывания, то ClickOnce будет использовать подпись безопасности Adventure Work для определения уровня доверия приложения.

## <a name="create-customer-deployments-by-using-application-manifest-for-trust"></a>Создание клиентских развертываний с помощью манифеста приложения для доверия
 Технология ClickOnce в .NET Framework 3,5 содержит новую функцию, которая предоставляет разработчикам и клиентам новое решение для сценария того, как должны быть подписаны манифесты. Манифест приложения ClickOnce поддерживает новый элемент с именем `<useManifestForTrust>` , который позволяет разработчику указать, что цифровая подпись манифеста приложения должна использоваться для принятия решений о доверии. Разработчик использует средства упаковки ClickOnce, такие как *Mage.exe* , *MageUI.exe* и Visual Studio, чтобы включить этот элемент в манифест приложения, а также внедрить имя издателя и имя приложения в манифест.

 При использовании `<useManifestForTrust>` манифест развертывания не обязательно должен быть подписан сертификатом Authenticode, выданным центром сертификации. Вместо этого его можно подписать с помощью имени самозаверяющего сертификата. Самозаверяющий сертификат создается как клиентом, так и разработчиком с помощью стандартных средств пакета .NET Framework SDK, а затем применяется к манифесту развертывания с помощью стандартных средств развертывания ClickOnce. Дополнительные сведения см. в разделе [MakeCert](/windows/desktop/SecCrypto/makecert).

 Использование самозаверяющего сертификата для манифеста развертывания предоставляет несколько преимуществ. Избавляя пользователя от необходимости получать или создавать собственный сертификат Authenticode, `<useManifestForTrust>` упрощает развертывание для клиента, одновременно позволяя разработчику поддерживать собственное удостоверение фирменной символики в приложении. Результатом является набор подписанных развертываний, которые более безопасны и имеют уникальные удостоверения приложений. Это устраняет потенциальный конфликт, который может возникнуть при развертывании одного приложения для нескольких клиентов.

 Пошаговые инструкции по созданию развертывания ClickOnce с `<useManifestForTrust>` включенным параметром см. [в разделе Пошаговое руководство. Развертывание вручную приложения ClickOnce, которое не требует повторного подписания и сохраняет сведения о фирменной символике](../deployment/walkthrough-manually-deploying-a-clickonce-app-no-re-signing-required.md).

### <a name="how-application-manifest-for-trust-works-at-run-time"></a>Как манифест приложения для доверия работает во время выполнения
 Чтобы лучше понять, как использование манифеста приложения для доверия работает во время выполнения, рассмотрим следующий пример. Приложение ClickOnce, предназначенное для .NET Framework 3,5, создается корпорацией Майкрософт. Манифест приложения использует `<useManifestForTrust>` элемент и подписывается корпорацией Майкрософт. Adventure Works подписывает манифест развертывания с помощью самозаверяющего сертификата. Клиенты Adventure Works настраиваются на доверие любому приложению, подписанному корпорацией Майкрософт.

 Когда пользователь щелкает ссылку на манифест развертывания, ClickOnce устанавливает приложение на компьютер пользователя. Сведения о сертификате и развертывании определяют, что приложение является уникальным для ClickOnce на клиентском компьютере. Если пользователь пытается установить одно приложение повторно из другого расположения, ClickOnce может использовать это удостоверение, чтобы определить, что приложение уже существует на клиенте.

 Затем ClickOnce проверяет сертификат Authenticode, используемый для подписания манифеста приложения, который определяет уровень доверия, предоставляемый технологией ClickOnce. Поскольку компания Adventure Works настроила своим клиентам возможность доверять любому приложению, подписанному корпорацией Майкрософт, этому приложению ClickOnce предоставляется полное доверие. Дополнительные сведения см. в разделе [Общие сведения о развертывании доверенных приложений](../deployment/trusted-application-deployment-overview.md).

## <a name="create-customer-deployments-for-earlier-versions"></a>Создание клиентских развертываний для более ранних версий
 Что если разработчик развертывает приложения ClickOnce для клиентов, использующих более старые версии .NET Framework? В следующих разделах приведено несколько рекомендуемых решений, а также преимущества и недостатки каждого из них.

### <a name="sign-deployments-on-behalf-of-customer"></a>Подписывать развертывания от имени клиента
 Одна из возможных стратегий развертывания состоит в том, чтобы разработчику было проще создать механизм для подписи развертываний от имени своих клиентов с помощью собственного закрытого ключа клиента. Это не позволяет разработчику управлять закрытыми ключами или несколькими пакетами развертывания. Разработчик просто предоставляет одно и то же развертывание для каждого клиента. Клиент может настроить его для своей среды с помощью службы подписывания.

 Одним из недостатков этого метода является время и затраты, которые необходимо выполнить для его реализации. Хотя такая служба может быть построена с помощью средств, предоставляемых в пакете SDK для .NET Framework, она позволяет увеличить время разработки в жизненном цикле продукта.

 Как отмечалось ранее в этом разделе, другой недостаток заключается в том, что каждая версия приложения клиента будет иметь одинаковое удостоверение приложения, что может привести к конфликтам. Если это важно, разработчик может изменить поле имени, которое используется при создании манифеста развертывания, чтобы присвоить каждому приложению уникальное имя. Это приведет к созданию отдельного удостоверения для каждой версии приложения и исключению потенциальных конфликтов удостоверений. Это поле соответствует `-Name` аргументу для Mage.exe и в поле **имя** на вкладке **имя** в MageUI.exe.

 Например, предположим, что разработчик создал приложение с именем Application1. Вместо создания отдельного развертывания с полем имени, для которого задано значение Application1, разработчик может создать несколько развертываний с вариацией для конкретного клиента, например Application1-Customers a, Application1-службу и т. д.

### <a name="deploy-using-a-setup-package"></a>Развертывание с помощью пакета установки
 Вторая возможная стратегия развертывания — создание проекта Microsoft Setup для выполнения первоначального развертывания приложения ClickOnce. Это может быть указано в одном из нескольких форматов: в качестве исполняемого файла установки MSI (. EXE) или в виде CAB-файла вместе с пакетным скриптом.

 С помощью этого метода разработчик предоставил клиенту развертывание, включающее файлы приложения, манифест приложения и манифест развертывания, который служит шаблоном. Клиент запускает программу установки, которая запрашивает URL-адрес развертывания (расположение сервера или общей папки, откуда пользователи будут устанавливать приложение ClickOnce), а также цифровой сертификат. Приложение установки также может запросить дополнительные параметры конфигурации ClickOnce, например интервал проверки обновлений. После сбора этой информации программа установки создаст реальный манифест развертывания, подпишите его и опубликует приложение ClickOnce в указанном расположении сервера.

 В этом случае клиент может подписать манифест развертывания тремя способами:

1. Клиент может использовать действительный сертификат, выданный центром сертификации (ЦС).

2. В качестве варианта такого подхода клиент может подписать манифест развертывания с помощью самозаверяющего сертификата. Недостатком этого способа является то, что приложение будет отображать слова «Неизвестный издатель», когда пользователю будет предложено установить его. Однако преимущество заключается в том, что он не позволяет небольшим клиентам тратить время и деньги, необходимые для сертификата, выданного центром сертификации.

3. Наконец, разработчик может включить свой собственный самозаверяющий сертификат в пакет установки. В этом разделе представлены потенциальные проблемы с удостоверением приложения, о которых говорилось ранее в этой статье.

   Недостаток метода проекта развертывания установки — это время и затраты, необходимые для создания пользовательского приложения развертывания.

### <a name="have-customer-generate-deployment-manifest"></a>Создание манифеста развертывания клиентом
 Третья возможная стратегия развертывания заключается в том, чтобы передать клиенту только файлы приложения и манифест приложения. В этом сценарии клиент несет ответственность за использование пакета SDK .NET Framework для создания и подписи манифеста развертывания.

 Недостаток этого метода заключается в том, что он требует от клиента установки средств пакета SDK для .NET Framework, а также для разработчика или системного администратора, который будет квалифицирован на их использование. Некоторые клиенты могут запросить решение, которое не требует каких-либо технических усилий с их стороны.

## <a name="see-also"></a>См. также
- [Развертывание приложений ClickOnce для тестирования и рабочих серверов без повторного подписывания](../deployment/deploying-clickonce-applications-for-testing-and-production-without-resigning.md)
- [Пошаговое руководство. Развертывание приложения ClickOnce вручную](../deployment/walkthrough-manually-deploying-a-clickonce-application.md)
- [Пошаговое руководство. Развертывание вручную приложения ClickOnce, которое не нуждается в повторном подписывании и сохраняет фирменную символику](../deployment/walkthrough-manually-deploying-a-clickonce-app-no-re-signing-required.md)