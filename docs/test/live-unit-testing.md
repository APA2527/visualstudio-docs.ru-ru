---
title: Live Unit Testing
ms.date: 03/07/2017
ms.topic: conceptual
helpviewer_keywords:
- Visual Studio ALM
- Live Unit Testing
author: rpetrusha
ms.author: ronpet
ms.workload:
- dotnet
ms.openlocfilehash: e4ace476a2454c7f6735f19cd07f222d6c06564e
ms.sourcegitcommit: b60a00ac3165364ee0e53f7f6faef8e9fe59ec4a
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 09/11/2019
ms.locfileid: "70913337"
---
# <a name="live-unit-testing-with-visual-studio"></a>Live Unit Testing в Visual Studio

В процессе разработки приложения функция Live Unit Testing автоматически выполняет все затронутые модульные тесты в фоновом режиме и отображает результаты и объем протестированного кода в интегрированной среде разработки Visual Studio в режиме реального времени. При изменении кода эта функция предоставляет отчет о том, как внесенные изменения повлияли на имеющиеся и покрывается ли новый добавленный код одним или несколькими имеющимися тестами. За счет этого вы не забудете написать модульные тесты при исправлении ошибок или добавлении новых функций.

> [!NOTE]
> Функция Live Unit Testing доступна в проектах C# и Visual Basic, предназначенных для .NET Core или .NET Framework, в выпуске Visual Studio Enterprise.

Используемая для тестирования функция Live Unit Testing сохраняет данные о состоянии тестов. Благодаря этой возможности функция Live Unit Testing обеспечивает высокую производительность наряду с динамическим выполнением тестов в ответ на изменения в коде.

## <a name="supported-test-frameworks"></a>Поддерживаемые тестовые платформы
Функция Live Unit Testing работает на трех известных платформах модульного тестирования, приведенных в таблице ниже. В этой таблице также приведены сведения о минимальной поддерживаемой версии адаптеров и платформ. Платформы модульного тестирования доступны на сайте NuGet.org.

|Тестовая платформа  |Минимальная версия адаптера Visual Studio  |Минимальная версия платформы  |
|---------|---------|---------|
|xUnit.net |xunit.runner.visualstudio версии 2.2.0-beta3-build1187 |xunit 1.9.2 |
|NUnit |NUnit3TestAdapter версии 3.5.1 |NUnit версии 3.5.0 |
|MSTest |MSTest.TestAdapter 1.1.4-preview |MSTest.TestFramework 1.0.5-preview |

Если у вас есть старые тестовые проекты на основе MSTest, которые ссылаются на `Microsoft.VisualStudio.QualityTools.UnitTestFramework`, и вы не хотите переходить на более новые пакеты NuGet MSTest, выполните обновление до Visual Studio 2017 версии 15.4 или более поздней.

В некоторых случаях, чтобы обеспечить работу Live Unit Testing, вам потребуется явным образом восстановить пакеты NuGet, на которые ссылается проект в решении. Это можно сделать, выполнив сборку решения явным образом (в меню верхнего уровня Visual Studio выберите **Пересобрать решение** > **Собрать**) или восстановив пакеты в решении (щелкните решение правой кнопкой мыши и выберите пункт **Восстановить пакеты NuGet**) перед включением Living Unit Testing.

## <a name="configure-live-unit-testing"></a>Настройка Live Unit Testing

Чтобы настроить Live Unit Testing, в меню верхнего уровня Visual Studio выберите **Сервис** > **Параметры**, а затем в левой области диалогового окна **Параметры** щелкните **Live Unit Testing**.

> [!TIP]
> После включения функции Live Unit Testing (см. следующий раздел [Запуск, приостановка и остановка функции Live Unit Testing](#start-pause-and-stop-live-unit-testing)) можно также открыть диалоговое окно **Параметры**, выбрав **Тест** > **Live Unit Testing** > **Параметры**.

На следующем рисунке показаны параметры конфигурации Live Unit Testing, доступные в этом диалоговом окне:

  ![Изображение](./media/lut-options.png)

С помощью этих параметров вы можете настроить следующее:

- Будет ли функция Live Unit Testing приостанавливаться во время сборки и отладки решения.

- Будет ли функция Live Unit Testing приостанавливаться, если заряд батареи системы опустится ниже установленного порогового значения.

- Будет ли функция Live Unit Testing запускаться автоматически после открытия решения.

- Следует ли включить отладочный символ и создание комментариев к XML-документации.

- Каталог, в котором хранятся сохраняемые данные.

- Возможность удалять все сохраненные данные. Это полезно, когда функция Live Unit Testing работает непредсказуемо, что влечет за собой вероятное повреждение данных.

- Интервал, после которого истекает время ожидания тестового случая. По умолчанию — 30 секунд.

- Максимальное число процессов тестирования, создаваемых Live Unit Testing.

- Максимальный объем памяти, которую могут использовать процессы Live Unit Testing.

- Уровень информации, записываемой функцией Live Unit Testing в окно **Выходные данные**.

   Доступные значения: **None** (данные журналов не записываются), **Error** (записываются только сообщения об ошибках), **Info** (значение по умолчанию, записываются сообщения об ошибках и информационные сообщения) или **Verbose** (записываются все сведения).

   Можно также отобразить подробные выходные данные в окне **Выходные данные** в Live Unit Testing, задав для переменной среды уровня пользователя `VS_UTE_DIAGNOSTICS` значение 1 и перезапустив Visual Studio.

   Чтобы записывать подробные сообщения журнала MSBuild из Live Unit Testing в файл, в качестве значения переменной среды уровня пользователя `LiveUnitTesting_BuildLog` задайте имя файла для хранения журнала.

## <a name="start-pause-and-stop-live-unit-testing"></a>Запуск, приостановка и остановка функции Live Unit Testing

Чтобы включить Live Unit Testing, в меню верхнего уровня Visual Studio выберите **Тест** > **Live Unit Testing** > **Запустить**. После включения Live Unit Testing в меню **Live Unit Testing** параметр **Запустить** можно изменить на следующие параметры: **Пауза**, **Остановить** и **Сбросить очистку**.

> [!NOTE]
> При запуске Live Unit Testing в решении, не содержащем проект модульного теста, параметры **Пауза**, **Остановить** и **Reset Clean** (Сбросить очистку) отображаются в меню **Live Unit Testing**, но сама эта функция не запускается. В окне **Вывод** отображается сообщение, начинающееся со слов "No supported test adapters are referenced by this solution..." (Это решение не ссылается на поддерживаемые адаптеры тестов...).

Вы можете в любой момент временно или полностью остановить работу этой функции. Это можно сделать, например, если вы выполняете рефакторинг и знаете, что тестирование будет нарушено на некоторое время. В меню Live Unit Testing доступны три следующих параметра:

- **Пауза**. Этот параметр временно приостанавливает работу функции Live Unit Testing.

    В этом случае визуализация покрытия не отображается в редакторе, но все собранные данные сохраняются. Чтобы возобновить работу этой функции, в меню Live Unit Testing выберите **Продолжить**. Функция Live Unit Testing выполнит необходимую работу с учетом всех внесенных во время приостановки изменений и обновит глиф должным образом.

- **Остановить**. Этот параметр полностью останавливает работу функции Live Unit Testing. Все собранные данные будут удалены.

- **Сброс очистки**. Этот параметр останавливает работу Live Unit Testing, удаляет сохраненные данные и перезапускает Live Unit Testing.

- **Параметры**. Этот элемент интерфейса открывает диалоговое окно **Параметры** (см. раздел [Настройка Live Unit Testing](#configure-live-unit-testing)).

## <a name="view-coverage-visualization-in-the-editor-as-you-type"></a>Просмотр визуализации покрытия в редакторе при вводе

После включения функция Live Unit Testing обновляет каждую строку кода в редакторе Visual Studio, чтобы показать, покрывается ли написанный код модульными тестами и завершились ли эти тесты успешно.  На следующем рисунке показаны строки кода с выполненными тестами и тестами, завершившимися сбоем, а также строки кода, не покрытые тестами. Строки с зеленым значком "✓" прошли все тесты, строки с красным значком "x" не прошли один или несколько тестов, а строки с синим значком "➖" не охвачены ни одним из тестов.

  ![Изображение](./media/lut-codewindow.png)

Визуализация покрытия Live Unit Testing изменяется сразу же после изменения кода в редакторе. Во время обработки правок визуализация изменяется, указывая, что данные не обновлены. В этом случае под символами успешного выполнения, сбоя и символом непокрытых строк появляется значок круглого таймера.

  ![Изображение](./media/lut-codeupdating.png)

## <a name="get-information-on-successful-or-failed-tests"></a>Получение сведений об удачных и неудачных тестах

Наведя указатель мыши на символ удачного или неудачного выполнения в окне кода, вы можете увидеть, сколько тестов выполнялось в этой строке. Если щелкнуть этот символ, отобразится состояние отдельных тестов, как показано на следующем рисунке:

  ![Изображение](./media/lut-failedinfo.png)

Кроме отображения имен и результатов тестов подсказка позволяет повторно запустить набор тестов или запустить набор тестов с помощью отладчика. Если в подсказке выбрать один или несколько тестов, можно также запустить или выполнить отладку только для них. Это позволяет отлаживать тесты, оставаясь в окне с кодом. При отладке кроме возможности наблюдения всех настроенных точек останова, вы также можете запрограммировать приостановку, когда отладчик выполняет метод [`Assert`](/dotnet/api/microsoft.visualstudio.testtools.unittesting.assert), возвращающий непредвиденный результат.

Если навести указатель мыши на непройденный тест в подсказке, она развернется. Здесь вы можете просмотреть дополнительные сведения, как показано на следующем рисунке: Дважды щелкнув непройденный тест в подсказке, вы перейдете к нему.

  ![Изображение](./media/lut-failedmsg.png)

При переходе к непройденному тесту функция Live Unit Testing также визуально информирует в подписи метода о пройденных тестах (указатель в виде наполовину полной колбы с зеленым значком "✓"), о сбое (наполовину полная колба с красным значком "🞩") или о неохваченных функцией Live Unit Testing тестах (наполовину полная колба с синим значком "➖"). Невключенные в тестирование методы теста не обозначаются значком. На следующем рисунке показаны все четыре типа методов.

  ![Изображение](media/lut-testsource.png)

## <a name="diagnose-and-correct-test-failures"></a>Диагностика и устранение сбоев тестов

В окне непройденного теста вы можете с легкостью отладить код продукта, внести изменения и продолжить разработку приложения. Так как функция Live Unit Testing выполняется в фоновом режиме, ее не нужно останавливать и перезапускать при отладке, внесении правок и продолжении цикла.

Например, сбой теста, показанный на предыдущем рисунке, вызван неверным предположением в методе теста о том, что при передаче в метод <xref:System.Char.IsLower%2A?displayProperty=fullName> неалфавитных символов возвращается значение `true`. После исправления метода теста все тесты были пройдены. В ходе выполнения мы не приостанавливали и не останавливали работу функции Live Unit Testing.

## <a name="live-unit-testing-and-test-explorer"></a>Live Unit Testing и обозреватель тестов

Как правило, **обозреватель тестов** предоставляет интерфейс, позволяющий выполнять и отлаживать тесты, а также анализировать их результаты. Функция Live Unit Testing интегрируется с **обозревателем тестов**. Когда эта функция отключена или остановлена, **обозреватель тестов** отображает состояние модульных тестов во время последнего запуска тестирования. При изменении исходного кода тесты необходимо выполнить повторно. И напротив, если функция Live Unit Testing включена, состояние модульных тестов в **обозревателе тестов** сразу же обновляется. В этом случае модульные тесты не нужно выполнять явным образом.

> [!NOTE]
> Чтобы открыть **обозреватель тестов**, выберите элементы **Тест** > **Окна** > **Обозреватель тестов** в меню верхнего уровня Visual Studio.

Вы можете заметить, что в окне **обозревателя тестов** некоторые тесты затемнены. Например, если включить функцию Live Unit Testing после открытия ранее сохраненного проекта, в окне **обозревателя тестов** будет затемнено все, кроме непройденных тестов, как показано на следующем рисунке. Это значит, что Live Unit Testing повторно запустила непройденные тесты, но не запускала пройденные, так как сохраненные данные Live Unit Testing указывают на отсутствие изменений с момента последнего выполнения тестов.

  ![Изображение](media/lut-test-explorer.png)

Вы можете повторно запустить любой затемненный тест, выбрав команду **Запустить все** или **Запустить** в меню **обозревателя тестов**. Также можно выбрать один или несколько тестов в меню **обозревателя тестов**, щелкнув правой кнопкой мыши и выбрав во всплывающем меню **Выполнить выбранные тесты** или **Отладить выбранные тесты**. По мере выполнения тесты перемещаются наверх.

Между автоматическим выполнением с обновлением результатов теста с помощью функции Live Unit Testing и явным выполнением тестов в **обозревателе тестов** есть некоторые различия. Эти отличия описаны ниже.

- Во время выполнения и отладки тестов из окна обозревателя тестов используются обычные двоичные файлы, а при использовании функции Live Unit Testing — инструментированные двоичные файлы.
- При выполнении тестов функция Live Unit Testing не создает домен приложения, а использует домен по умолчанию. При выполнении тестов в окне **обозревателя тестов** домен приложения создается.
- Функция Live Unit Testing выполняет тесты из разных сборок последовательно. В окне **обозревателя тестов** можно выбрать режим параллельного выполнения нескольких тестов.

## <a name="live-unit-testing-and-large-solutions"></a>Live Unit Testing и крупные решения

Если решение содержит 10 и более проектов, когда вы запускаете Live Unit Testing при отсутствии сохраненных данных или выбираете элементы **Тест** > **Live Unit Testing** > **Сброс очистки** в меню верхнего уровня Visual Studio, Visual Studio отображает следующее диалоговое окно. Оно содержит предупреждение о том, что динамическое выполнение большого числа тестов в крупных проектах может повлиять на производительность. Если нажать кнопку **ОК**, Live Unit Testing выполнит все тесты в решении. Если нажать кнопку **Отменить**, можно выбрать тесты для выполнения. Сведения о том, как это сделать, см. в разделе [Добавление и исключение тестовых проектов и методов теста](#include-and-exclude-test-projects-and-test-methods).

![Диалоговое окно Live Unit Testing для крупных проектов](media/lut-large-project.png)

## <a name="include-and-exclude-test-projects-and-test-methods"></a>Добавление и исключение тестовых проектов и методов теста

В решениях с большим количеством тестовых проектов вы можете контролировать, какие проекты и отдельные методы в проекте могут использоваться в функции Live Unit Testing. Например, если у вас есть решение с сотнями тестовых проектов, вы можете выбрать только целевой набор, который будет использоваться с этой функцией. Это можно сделать несколькими способами в зависимости от того, следует ли исключить все тесты в проекте или решении, включить или исключить большую часть тестов либо исключить отдельные тесты. Функция Live Unit Testing сохраняет состояние включения или исключения и запоминает его после закрытия и повторного открытия решения.

**Исключение всех тестов в проекте или решении**

Чтобы выбрать отдельные проекты в модульных тестах, запустите Live Unit Testing и выполните следующие действия:

1. В **обозревателе решений** щелкните решение правой кнопкой мыши и выберите **Динамические тесты** > **Исключить**, чтобы исключить все решение.
1. Щелкните правой кнопкой мыши каждый тестовый проект, который вы хотите добавить в тесты, и выберите **Динамические тесты** > **Включить**.

**Исключение отдельных тестов в окне редактора кода**

Включать и исключать отдельные методы теста можно в окне редактора кода. Щелкните правой кнопкой мыши в сигнатуре метода теста в окне редактора кода и выберите **Динамические тесты** > **Включить [выбранный метод]** , **Динамические тесты** > **Исключить [выбранный метод]** или **Динамические тесты** > **Исключить все, кроме [выбранный метод]** , где "выбранный метод" — это имя метода, выбранное в окне с кодом.

**Исключение тестов программным способом**

Вы также можете отменить создание отчетов о покрытии в Live Unit Testing для некоторых методов, классов или структур, применив к ним атрибут <xref:System.Diagnostics.CodeAnalysis.ExcludeFromCodeCoverageAttribute>.

Чтобы исключить отдельные методы из Live Unit Testing, также можно использовать следующие атрибуты:

- Для xUnit: `[Trait("Category", "SkipWhenLiveUnitTesting")]`
- Для NUnit: `[Category("SkipWhenLiveUnitTesting")]`
- Для MSTest: `[TestCategory("SkipWhenLiveUnitTesting")]`

Из Live Unit Testing можно также исключить всю сборку тестов.

- Для xUnit: `[assembly: AssemblyTrait("Category", "SkipWhenLiveUnitTesting")]`
- Для NUnit: `[assembly: Category("SkipWhenLiveUnitTesting")]`
- Для MSTest: `[assembly: TestCategory("SkipWhenLiveUnitTesting")]`

## <a name="see-also"></a>См. также

- [Средства тестирования кода](https://visualstudio.microsoft.com/vs/testing-tools/)
- [Блог о функции Live Unit Testing](https://go.microsoft.com/fwlink/?linkid=842514)
- [Динамическое модульное тестирование: вопросы и ответы](live-unit-testing-faq.md)
- [Видео на Channel 9. Функция Live Unit Testing в Visual Studio](https://channel9.msdn.com/Events/Visual-Studio/Visual-Studio-2017-Launch/T105)
