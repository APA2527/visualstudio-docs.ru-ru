---
title: Создание приложения OpenGL ES в Android и iOS | Документация Майкрософт
ms.custom: ''
ms.date: 10/09/2019
ms.technology: vs-ide-mobile
ms.topic: conceptual
dev_langs:
- C++
ms.assetid: 76a67886-df57-4a81-accb-2e3c2eaf607b
author: corob-msft
ms.author: corob
manager: jillfra
ms.workload:
- xplat-cplusplus
ms.openlocfilehash: a15902278e9a73488b315729a2db6e8fb5d53935
ms.sourcegitcommit: 8a96a65676fd7a2a03b0803d7eceae65f3fa142b
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 10/18/2019
ms.locfileid: "72588923"
---
# <a name="build-an-opengl-es-application-on-android-and-ios"></a>Создание приложения OpenGL ES в Android и iOS

Вы можете создавать решения Visual Studio и проекты для приложений iOS и Android с общим кодом. В этой статье приведены пошаговые инструкции по разработке шаблона приложения, который служит для создания как простейшего приложения iOS, так и приложения Android Native Activity. Приложения имеют общий код C++, который использует технологию OpenGL ES для отображения одинакового анимированного вращающегося куба на обеих платформах. OpenGL ES (GLES) — это интерфейс API двухмерной и трехмерной графики, который поддерживается многими мобильными устройствами.

## <a name="requirements"></a>Требования

Перед созданием приложения OpenGL ES для iOS и Android убедитесь в том, что выполняются все требования к системе. Установите рабочую нагрузку разработки мобильных приложений на языке C++ в Visual Studio Installer, если еще не сделали этого. Для получения шаблонов OpenGL ES, а также для создания приложения для iOS, включите дополнительные инструменты разработки C++ для iOS. Чтобы создать приложение для Android, установите средства разработки C++ для Android и требуемые сторонние средства: Android NDK, Apache Ant и Google Android Emulator. Чтобы повысить производительность эмулятора на платформах Intel, рекомендуем также установить Intel Hardware Accelerated Execution Manager (HAXM). После этого настройте Intel HAXM и Android Emulator для запуска в своей системе. Дополнительные сведения и подробные инструкции смотрите в статье [Установка Visual C++ для разработки кроссплатформенных мобильных приложений на языке C++](../cross-platform/install-visual-cpp-for-cross-platform-mobile-development.md).

Для сборки и тестирования приложения iOS вам потребуется компьютер Mac, настроенный в соответствии с инструкциями по установке. Дополнительные сведения о настройке компьютера для разработки приложений iOS см. в разделе [Установка и настройка средств для разработки с помощью iOS](../cross-platform/install-and-configure-tools-to-build-using-ios.md).

## <a name="create-a-new-opengles-application-project"></a>Создание проекта приложения OpenGLES

В этом учебнике вы сначала создадите проект приложения OpenGL ES, а затем соберете и запустите приложение по умолчанию в эмуляторе Android. Затем выполните сборку приложения для iOS и запустите его на устройстве iOS.

::: moniker range="vs-2017"

1. В Visual Studio последовательно выберите **Файл** > **Создать** > **Проект**.

1. В диалоговом окне **Новый проект** в разделе **Шаблоны** выберите **Visual C++**  > **Кроссплатформенный**, а затем выберите шаблон **Приложение OpenGLES (Android, iOS)** .

1. Присвойте приложению имя, например *MyOpenGLESApp*, а затем нажмите кнопку **ОК**.

   ![Новый проект "Приложение OpenGLES"](../cross-platform/media/cppmdd_opengles_newproj.PNG "CPPMDD_OpenGLES_NewProj")

   Visual Studio создаст новое решение и откроет обозреватель решений.

   ![MyOpenGLESApp в обозревателе решений](../cross-platform/media/cppmdd_opengles_solexpl.PNG "CPPMDD_OpenGLES_SolExpl")

::: moniker-end

::: moniker range=">=vs-2019"

1. В Visual Studio последовательно выберите **Файл** > **Создать** > **Проект**.

1. В диалоговом окне **Создание нового проекта** выберите шаблон **Приложение OpenGLES (Android, iOS)** и нажмите кнопку **Далее**.

1. В диалоговом окне **Настройка нового проекта** введите имя в поле **Имя проекта**, например *MyOpenGLESApp*, и нажмите **Создать**.

   Visual Studio создаст новое решение и откроет обозреватель решений.

   ![MyOpenGLESApp в обозревателе решений](../cross-platform/media/cppmdd_opengles_solexpl.PNG "CPPMDD_OpenGLES_SolExpl")

::: moniker-end

Новое решение приложения OpenGL ES включает в себя три проекта библиотек и два проекта приложений. В папке Libraries находится проект общего кода и два проекта под конкретные платформы, которые ссылаются на общий код.

- `MyOpenGLESApp.Android.NativeActivity` содержит ссылки и связующий код, который реализует приложение в качестве Native Activity для Android. Точки входа из связующего кода реализованы в файле *main.cpp*, который включает общий код из `MyOpenGLESApp.Shared`. Предкомпилированные заголовки находятся в файле *pch.h*. Этот проект приложения Native Activity компилируется в файл общей библиотеки (с расширением *.so*), который передается в проект `MyOpenGLESApp.Android.Packaging`.

- `MyOpenGLESApp.iOS.StaticLibrary` создает файл статической библиотеки iOS (с расширением *.a*), который содержит общий код из `MyOpenGLESApp.Shared`. Файл связан с приложением, созданным проектом `MyOpenGLESApp.iOS.Application`.

- `MyOpenGLESApp.Shared` содержит общий код, работающий на разных платформах. В нем используются макросы препроцессора для условной компиляции кода под конкретную платформу. Общий код передается по ссылке на проект в `MyOpenGLESApp.Android.NativeActivity` и `MyOpenGLESApp.iOS.StaticLibrary`.

Решение включает два проекта для создания приложений для платформ Android и iOS.

- `MyOpenGLESApp.Android.Packaging` создает файл с расширением *.apk* для развертывания на устройстве или в эмуляторе Android. Этот файл содержит ресурсы и файл AndroidManifest.xml, в котором задаются свойства манифеста. В него также входит файл *build.xml*, управляющий процессом сборки Ant. По умолчанию он задан как начальный проект, который можно развернуть и запустить непосредственно из Visual Studio.

- `MyOpenGLESApp.iOS.Application` содержит ресурсы и код прилипания Objective-C для создания приложения iOS, которое ссылается на код статической библиотеки C++ в `MyOpenGLESApp.iOS.StaticLibrary`. Этот проект создает пакет сборки, который передается на компьютер Mac средой Visual Studio и удаленным агентом. При сборке этого проекта среда Visual Studio отправляет файлы и команды для сборки и развертывания приложения на компьютере Mac.

## <a name="build-and-run-the-android-app"></a>Сборка и запуск приложения Android

Решение, созданное с помощью шаблона, задает приложение Android в качестве проекта по умолчанию.  Вы можете выполнить сборку и запуск этого приложения, чтобы проверить его установку и настройку. Для первоначального теста запустите приложение в одном из профилей устройств, установленных эмулятором для Android. Если вы предпочитаете тестировать приложение на другой платформе, загрузите целевой эмулятор или подключите устройство к компьютеру.

### <a name="to-build-and-run-the-android-native-activity-app"></a>Сборка и запуск приложения Android Native Activity

1. Выберите пункт **x86** в раскрывающемся списке **Платформы решения**, если он еще не выбран.

   ![Установка Платформы решения на x86](../cross-platform/media/cppmdd_opengles_solutionplat.png "CPPMDD_OpenGLES_SolutionPlat")

   Используйте 32-разрядную платформу (x86) в качестве целевой для эмулятора. Чтобы выполнить сборку для устройства, выберите платформу решения, соответствующую процессору устройства. Если список **Платформы решения** не отображается, щелкните пункт **Платформы решения** в списке **Добавить или удалить кнопки** и выберите свою платформу.

1. В **обозревателе решений** откройте контекстное меню для проекта `MyOpenGLESApp.Android.Packaging` и выберите пункт **Собрать**.

   ![Проект сборки упаковки Android](../cross-platform/media/cppmdd_opengles_andbuild.png "CPPMDD_OpenGLES_AndBuild")

   В окне "Выходные данные" отображаются выходные данные процесса сборки для общей библиотеки Android и приложения Android.

   ![Выходные данные сборки для проектов Android](../cross-platform/media/cppmdd_opengles_andoutput.png "CPPMDD_OpenGLES_AndOutput")

1. Выберите один из профилей эмулируемого устройства Android в качестве цели развертывания.

   ![Выбор целевого объекта развертывания](../cross-platform/media/cppmdd_opengles_pickemulator.png "CPPMDD_OpenGLES_PickEmulator")

   Если вы установили другие эмуляторы или подключили устройство Android, то можете выбрать их в раскрывающемся списке платформы развертывания. Для запуска приложения платформа решения сборки должна совпадать с платформой целевого устройства.

1. Нажмите **F5**, чтобы начать отладку, или **Shift**+**F5** для запуска без отладки.

   Visual Studio запускает эмулятор, который за несколько секунд загружает и развертывает код. Так выглядит экран приложения в эмуляторе Android:

   ![Приложение, выполняющееся в эмуляторе Android](../cross-platform/media/cppmdd_opengles_andemulator.png "CPPMDD_OpenGLES_AndEmulator")

   После запуска приложения можно задать точки останова и использовать отладчик для проверки кода, языковых стандартов и контрольных значений.

1. Для остановки отладки нажмите **SHIFT**+**F5**.

   Эмулятор является отдельным процессом, который продолжает выполняться. Вы можете изменять, компилировать и развертывать код несколько раз в одном эмуляторе. Ваше приложение находится в коллекции приложений эмулятора, откуда его можно запускать напрямую.

   Созданные проекты приложения Android Native Activity и библиотеки помещают общий код C++ в динамическую библиотеку, которая включает связующий код для взаимодействия с платформой Android. Большая часть кода приложения находится в библиотеке, а манифест, ресурсы и инструкции сборки — в проекте упаковки. Общий код вызывается из main.cpp в проекте NativeActivity. Более подробную информацию о программировании Android Native Activity см. на странице [Concepts](https://developer.android.com/ndk/guides/concepts.html) (Основные понятия) в Android Developer NDK.

   Visual Studio выполняет сборку проектов Android Native Activity с помощью пакета Android NDK, в котором в качестве набора инструментов платформы используется Clang. Visual Studio сопоставляет свойства в проекте NativeActivity с параметрами, которые используются для компиляции, компоновки и отладки на целевой платформе. Чтобы получить подробные сведения, откройте диалоговое окно **Страницы свойств** для проекта MyOpenGLESApp.Android.NativeActivity. Более подробную информацию о параметрах командной строки см. в [руководстве пользователя компилятора Clang](http://clang.llvm.org/docs/UsersManual.html).

## <a name="build-and-run-the-ios-app-on-an-ios-device"></a>Сборка и запуск приложения для iOS на устройстве iOS

Проект приложения iOS создается и редактируется в Visual Studio, но из-за лицензионных ограничений его сборку и развертывание необходимо выполнять с компьютера Mac. Visual Studio взаимодействует с удаленным агентом, запущенным на компьютере Mac, для передачи файлов проекта и выполнения команд сборки, развертывания и отладки. Перед сборкой приложения iOS настройте компьютер Mac и среду Visual Studio для обмена данными. Подробные инструкции см. в разделе [Установка и настройка средств для разработки с помощью iOS](../cross-platform/install-and-configure-tools-to-build-using-ios.md). Когда удаленный агент будет запущен на компьютере Mac и сопряжен с Visual Studio, вы сможете выполнить сборку и запуск приложения iOS, чтобы проверить установку и настройку.

Чтобы развернуть приложение для iOS на устройстве iOS, необходимо настроить автоматическое подписывание в Xcode на компьютере Mac. Функция автоматического подписывания управляет этим процессом и отвечает за создание профиля подготовки для подписывания сборки приложения.

### <a name="to-set-up-automatic-signing-on-xcode"></a>Настройка автоматического подписывания в Xcode

1. Установите [Xcode](https://developer.apple.com/xcode/) на компьютер Mac, если его у вас еще нет.

1. Откройте приложение Xcode на компьютере Mac.

1. Создайте проект Xcode для **приложения с одним представлением**. При создании проекта заполните обязательные поля. Значения могут быть произвольными, так как проект используется только для создания профиля подготовки, с помощью которого в дальнейшем будет подписываться сборка приложения.

1. Добавьте свой идентификатор Apple ID, зарегистрированной в учетной записи [программы для разработчиков Apple](https://developer.apple.com/programs/), в Xcode. Ваш идентификатор Apple ID используется как удостоверение подписывания приложений. Чтобы добавить удостоверение подписывания в Xcode, откройте меню **Xcode** и выберите пункт **Preferences** (Настройки). Выберите **Accounts** (Учетные записи) и нажмите кнопку добавления (+), чтобы добавить свой идентификатор Apple ID. См. подробные инструкции в статье о [добавлении учетной записи Apple ID](https://help.apple.com/xcode/mac/current/#/devaf282080a).

1. В разделе общих параметров в проекте Xcode измените значение **идентификатора пакета** на `com.<NameOfVSProject>`, где `<NameOfVSProject>` — это имя созданного вами проекта решения Visual Studio. Например, если в Visual Studio вы создали проект с именем `MyOpenGLESApp`, установите для **идентификатора пакета** значение `com.MyOpenGLESApp`.

   ![Идентификатор пакета Xcode](../cross-platform/media/cppmdd-opengles-iosxcodeid.png "CPPMDD_OpenGLES_iOSXcodeId")

1. Чтобы включить автоматическое подписывание, установите флажок Automatically manage signing (Автоматическое управление подписыванием)**.

   ![Автоматическое подписывание Xcode](../cross-platform/media/cppmdd-opengles-iosxcodesign.png "CPPMDD_OpenGLES_iOSXcodeSign")

1. Выберите имя команды для идентификатора Apple ID, которое вы задали для **команды** разработки.

   ![Команда Xcode](../cross-platform/media/cppmdd-opengles-iosxcodeteam.png "CPPMDD_OpenGLES_iOSXcodeTeam")

### <a name="to-build-and-run-the-ios-app-on-an-ios-device"></a>Сборка и запуск приложения для iOS на устройстве iOS

1. Запустите удаленный агент на компьютере Mac и проверьте, сопряжена ли среда Visual Studio с удаленным агентом. Чтобы запустить удаленный агент, откройте окно приложения "Терминал" и введите `vcremote`. Более подробную информацию см. в разделе [Настройка удаленного агента в Visual Studio](../cross-platform/install-and-configure-tools-to-build-using-ios.md#ConfigureVS).

   ![Окно терминала Mac, в котором выполняется команда vcremote](../cross-platform/media/cppmdd_common_vcremote.png "CPPMDD_common_vcremote")

1. Подключите устройство iOS к компьютеру Mac. При первом подключении устройства к компьютеру поступает оповещение с вопросом, является ли компьютер доверенным для получения доступа к устройству. Укажите, что компьютер Mac является доверенным для устройства.

1. В Visual Studio в раскрывающемся списке **Платформы решения** выберите платформу решения, соответствующую процессору вашего устройства, если такая платформа еще не выбрана. В этом примере используется процессор **ARM64**.

   ![Установка ARM64 в качестве платформы решения](../cross-platform/media/cppmdd-opengles-pickplatformarm64.png "CPPMDD_OpenGLES_SolutionPlatARM64")

1. В обозревателе решений откройте контекстное меню проекта MyOpenGLESApp.iOS.Application и выберите **Выгрузить проект**, чтобы выгрузить проект.

1. Снова откройте контекстное меню выгруженного проекта MyOpenGLESApp.iOS.Application и выберите **Edit project.pbxproj** (Изменить project.pbxproj), чтобы изменить файл проекта. В файле `project.pbxproj` найдите атрибут `buildSettings` и добавьте `DEVELOPMENT_TEAM`, используя свой идентификатор Apple Team ID. На следующем снимке экрана показан пример значения `123456ABC` для идентификатора Apple Team ID. Можно найти значение идентификатора Apple Team ID в Xcode. Перейдите к разделу **параметров сборки** и наведите указатель на имя группы разработки, чтобы отобразилась подсказка. В подсказке будет указан идентификатор команды.

   ![Установка команды развертывания](../cross-platform/media/cppmdd-opengles-iosdevelopmentteam.png "CPPMDD_OpenGLES_iOSDevelopmentTeam")

1. Закройте файл `project.pbxproj`, откройте контекстное меню выгруженного проекта MyOpenGLESApp.iOS.Application и выберите **Перезагрузить проект**, чтобы перезагрузить проект.

1. Теперь выполните сборку проекта MyOpenGLESApp.iOS.Application. Для этого откройте его контекстное меню и выберите **Сборка**.

   ![Создание проекта приложения для iOS](../cross-platform/media/cppmdd_opengles_iosbuild.png "CPPMDD_OpenGLES_iOSBuild")

   В окне "Выходные данные" отображаются выходные данные процесса сборки для статической библиотеки iOS и приложения iOS. На компьютере Mac в окне "Терминал", в котором выполняется удаленный агент, отображается команда и действие передачи файлов.

   Возможно, на компьютере Mac вам будет предложено разрешить средству подписывания кода доступ к цепочке ключей. Чтобы продолжить, нажмите **Разрешить**.

1. Выберите свое устройство iOS на панели инструментов, чтобы запустить приложение на устройстве, подключенном к компьютеру Mac. Если приложение не запускается, проверьте, предоставляет ли устройство развернутому приложению разрешение на запуск. Чтобы предоставить это разрешение, последовательно выберите на устройстве **Параметры** > **Общие** > **Управления устройствами**. Выберите учетную запись для разработки приложений, сделайте ее доверенной и проверьте приложение. Попытайтесь еще раз запустить приложение из Visual Studio.

   ![iOS-приложение на устройстве iOS](../cross-platform/media/cppmdd-opengles-iosdevice.png "CPPMDD_OpenGLES_iOSDevice")

   После запуска приложения можно задать точки останова и использовать отладчик Visual Studio для проверки локальных значений, стека вызовов и контрольных значений.

   ![Отладчик в точке останова в приложении iOS](../cross-platform/media/cppmdd_opengles_iosdebug.png "CPPMDD_OpenGLES_iOSDebug")

1. Для остановки отладки нажмите **SHIFT**+**F5**.

   Созданные проекты приложения и библиотеки iOS помещают код C++ в статическую библиотеку, которая реализует только общий код. Большая часть кода приложения находится в проекте `Application`. Вызовы кода общей библиотеки в этом проекте шаблона осуществляются в файле *GameViewController.m*. Для сборки приложения iOS среда Visual Studio использует набор средств платформы Xcode, которому требуется взаимодействовать с удаленным клиентом, запущенным на компьютере Mac.

   Visual Studio передает файлы проекта и отправляет команды удаленному клиенту для сборки приложения с помощью Xcode. Удаленный клиент отправляет сведения о состоянии сборки обратно среде Visual Studio. После успешного завершения сборки приложения можно использовать Visual Studio для отправки команд на выполнение и отладку приложения. Отладчик Visual Studio управляет работой приложения на устройстве iOS, подключенном к компьютеру Mac. Visual Studio сопоставляет свойства в проекте StaticLibrary с параметрами, которые используются для компиляции, компоновки и отладки на целевой платформе iOS. Чтобы получить подробную информацию о параметрах командной строки компилятора, откройте диалоговое окно **Страницы свойств** для проекта MyOpenGLESApp.iOS.StaticLibrary.

## <a name="customize-your-apps"></a>Настройка приложений

Вы можете изменить общий код C++, чтобы добавить или изменить общие функциональные возможности. Необходимо изменить вызовы общего кода в проектах `MyOpenGLESApp.Android.NativeActivity` и `MyOpenGLESApp.iOS.Application` для сопоставления. Для указания разделов общего кода, предназначенных для конкретной платформы, можно использовать макросы препроцессора. При выполнении сборки для Android предварительно определен макрос препроцессора `__ANDROID__` . При выполнении сборки для iOS предварительно определен макрос препроцессора `__APPLE__` .

Чтобы увидеть подсказку IntelliSense для конкретной платформы проекта, выберите проект в раскрывающемся списке переключателя контекстов на панели навигации в верхней части окна редактора.

![Раскрывающийся список переключателя контекстов проекта в редакторе](../cross-platform/media/cppmdd_opengles_contextswitcher.png)

Проблемы, найденные IntelliSense в коде текущего проекта, подчеркиваются красной волнистой линией. Проблемы в других проектах подчеркиваются фиолетовой волнистой линией. Visual Studio не поддерживает выделение кода цветом и технологию IntelliSense для файлов с кодом Java и Objective-C. Однако вы все же можете изменять исходные файлы и ресурсы для настройки имени приложения, значка и других особенностей реализации.
