---
title: Настройка проекта C++ для IntelliSense
ms.date: 10/08/2018
ms.topic: conceptual
author: corob-msft
ms.author: corob
manager: markl
ms.workload:
- cplusplus
ms.openlocfilehash: 610f3d92d86e227973be9c481adaf830d3d16737
ms.sourcegitcommit: 5caad925ca0b5d136416144a279e984836d8f28c
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 09/07/2020
ms.locfileid: "89509891"
---
# <a name="configure-a-c-project-for-intellisense"></a>Настройка проекта C++ для IntelliSense

Иногда может понадобиться вручную настроить проект C++ для правильной работы функции IntelliSense. Для проектов MSBuild (на основе файлов с расширением .vcxproj) можно настроить параметры в свойствах проекта. Для других типов проектов нужно настроить параметры в файле CppProperties.json, находящемся в корневом каталоге проекта. Иногда требуется создать файл указаний, чтобы помочь IntelliSense понять определения макросов. Интегрированная среда разработки Visual Studio помогает найти и исправить проблемы с функцией IntelliSense.

## <a name="single-file-intellisense"></a>IntelliSense для одного файла

Когда вы открываете файл, который не включен в проект, Visual Studio предоставляет определенную поддержку IntelliSense, но по умолчанию ошибки не подчеркиваются волнистой линией. Если на **панели навигации** указано *Прочие файлы*, это может быть причиной того, что ошибочный код не подчеркивается волнистой линией или не определен макрос препроцессора.

## <a name="check-the-error-list"></a>Проверка списка ошибок

Если файл не открыт в режиме одного файла и функция IntelliSense работает неправильно, сначала нужно проверить окно "Список ошибок". Чтобы увидеть все ошибки IntelliSense в текущем исходном файле вместе со всеми включенными файлами заголовков, выберите в раскрывающемся списке **Сборка и IntelliSense**:

!["Сборка и IntelliSense" в окне "Список ошибок"](media/vcpp-intellisense-error-list.png)

В IntelliSense отображается не более 1000 ошибок. Если файлы заголовков, включенные в исходный файл, содержат более 1000 ошибок, в самом начале исходного файла отображается только один маркер ошибки в виде волнистой линии.

## <a name="ensure-include-paths-are-correct"></a>Проверка правильности путей #include

### <a name="msbuild-projects"></a>Проекты MSBuild

Если вы запускаете сборку проектов вне интегрированной среды разработки Visual Studio и сборка выполняется успешно, но IntelliSense работает неправильно, возможно, среда командной строки не согласована с параметрами проекта для одной или нескольких конфигураций. Щелкните правой кнопкой мыши узел проекта в **обозревателе решений** и убедитесь, что все пути **#include** правильно указаны для текущей конфигурации и платформы. Если для всех конфигураций и платформ используются одинаковые пути, выберите **Все конфигурации** и **Все платформы**, а затем проверьте правильность путей.

![Включаемые каталоги VC++](media/vcpp-intellisense-include-paths.png)

Чтобы просмотреть текущие значения макросов сборки, например **VC_IncludePath**, выберите строку "Включаемые каталоги" и щелкните раскрывающийся список справа. Затем выберите **\<Edit>** и нажмите кнопку **Макросы**.

### <a name="makefile-projects"></a>Проекты, использующие файл makefile

Для проектов Makefile, которые основаны на шаблоне проектов NMake, выберите на левой панели **NMake**, а затем **Путь поиска включаемых файлов** в категории **IntelliSense**:

![Пути включаемых файлов в проекте Makefile](media/vcpp-intellisense-makefile-include-paths.png)

### <a name="open-folder-projects"></a>Проекты в виде папок

При работе с проектами CMake убедитесь, что пути #include в файле CMakeLists.txt указаны правильно для всех конфигураций. Для других типов проектов возможно, потребуется использовать файл CppProperties.json. Дополнительные сведения см. в статье о [настройке IntelliSense с помощью файла CppProperties.json](/cpp/build/open-folder-projects-cpp#configure-code-navigation-with-cpppropertiesjson). Убедитесь, что пути указаны правильно для всех конфигураций, определенных в этом файле.

Если в файле CppProperties.json есть синтаксическая ошибка, функция IntelliSense для затронутых файлов будет работать неправильно. В окне вывода Visual Studio будет отображаться ошибка.

## <a name="tag-parser-issues"></a>Ошибки анализа тегов

Анализатор тегов — это анализатор кода C++ с нечеткой логикой, который используется для просмотра и навигации. Он работает очень быстро, но не пытается полностью интерпретировать каждую конструкции кода.

Например, он не вычисляет значения макросов препроцессора и поэтому может неправильно анализировать код, в котором они активно используются. Когда анализатор тегов встречает незнакомую конструкцию кода, он может пропустить всю эту область кода.

Есть два типичных проявления этой проблемы в Visual Studio:

1. Если на панели навигации отображается корневой макрос, значит, текущее определение функции пропущено:

   ![Анализатор тегов пропускает определение функции](media/vcpp-intellisense-tag-parser-macro.png)

1. Интегрированная среда разработки предлагает создать определение для функции, которая уже определена:

   ![Анализатор тегов предлагает определить существующую функцию](media/vcpp-intellisense-tag-parser-function.png)

Чтобы устранить подобные проблемы, создайте файл с именем **cpp.hint** в корневом каталоге решения. Дополнительные сведения см. в статье [Файлы подсказок](/cpp/build/reference/hint-files).

Ошибки анализатора тегов отображаются в окне **Список ошибок**.

## <a name="validate-project-settings-with-diagnostic-logging"></a>Проверка параметров проекта с помощью журнала ведения диагностики

Чтобы проверить, использует ли компилятор IntelliSense правильные параметры, например включаемые пути и макросы препроцессора, включите журнал ведения диагностики для командных строк IntelliSense в разделе **Средства > Параметры > Текстовый редактор > C/C++ > Дополнительно > Запись данных диагностики**. Установите следующие значения параметров: **Включить ведение журнала** — True, **Уровень ведения журналов** — 5 (самый подробный) и **Фильтр ведения журналов** — 8 (журнал IntelliSense).

В окне вывода теперь будут показаны командные строки, которые передаются в компилятор IntelliSense. Пример выходных данных:

```output
[IntelliSense] Configuration Name: Debug|Win32
[IntelliSense] Toolset IntelliSense Identifier:
[IntelliSense] command line options:
/c
/I.
/IC:\Repo\Includes
/DWIN32
/DDEBUG
/D_DEBUG
/Zc:wchar_t-
/Zc:forScope
/Yustdafx.h
```

Возможно, эти сведения помогут определить, почему IntelliSense выдает неточную информацию. Например, если включаемая папка вашего проекта содержит строку **$(MyVariable)\Include**, а в журнале диагностики в качестве включенного пути отображается **/I\Include**, значит, переменная **$(MyVariable)** не была вычислена и была удалена из окончательного включаемого пути.

## <a name="about-the-intellisense-build"></a>Компиляция IntelliSense

Visual Studio использует выделенный компилятор C++ для создания и обслуживания базы данных, используемой для всех функций IntelliSense. Чтобы синхронизировать базу данных IntelliSense с кодом, после определенных изменений в параметрах проекта или в исходных файлах Visual Studio автоматически запускает в фоновом режиме задачи компиляции только для IntelliSense.

Но иногда Visual Studio может не обновлять базу данных IntelliSense своевременно. Например, после выполнения команды **git pull** или **git checkout** Visual Studio может потребоваться вплоть до часа для того, чтобы обнаружить изменения в файлах. Вы можете принудительно запустить повторное сканирование всех файлов решения. Для этого щелкните правой кнопкой мыши узел проекта в **обозревателе решений** и выберите **Повторить сканирование решения**.

## <a name="troubleshooting-intellisense-build-failures"></a>Устранение ошибок компиляции IntelliSense

При компиляции IntelliSense не создаются двоичные файлы, но она также может завершиться с ошибкой. Одна из возможных причин ошибки — использование пользовательских файлов с расширениями .props или .targets. В Visual Studio 2017 версии 15.6 и более поздней ошибки сборки только для IntelliSense отображаются в окне вывода. Чтобы их увидеть, в раскрывающемся списке **Показать выходные данные из** выберите **Решение**:

![Окно вывода для ошибок решения](media/vcpp-intellisense-output-window.png)

Сообщение об ошибке может содержать указание включить трассировку во время разработки:

```output
error: Designtime build failed for project 'E:\src\MyProject\MyProject.vcxproj',
configuration 'Debug|x64'. IntelliSense might be unavailable.
Set environment variable TRACEDESIGNTIME=true and restart
Visual Studio to investigate.
```

Если присвоить переменной среды TRACEDESIGNTIME значение true и перезапустить Visual Studio, вы найдете в каталоге %TEMP% файл журнала, который может помочь при диагностике ошибки компиляции.

Дополнительные сведения о переменной среды TRACEDESIGNTIME см. в статьях о [Roslyn](https://github.com/dotnet/roslyn/blob/master/docs/wiki/Diagnosing-Project-System-Build-Errors.md) и [общей системе проектов](https://github.com/dotnet/project-system/blob/master/docs/design-time-builds.md). Сведения в этих статьях относятся и к проектам C++.

## <a name="see-also"></a>См. также раздел

- [IntelliSense для Visual C++](visual-cpp-intellisense.md)
