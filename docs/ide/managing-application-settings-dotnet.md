---
title: Управление параметрами приложения (.NET)
ms.date: 11/04/2016
ms.topic: conceptual
f1_keywords:
- msvse_settingsdesigner.err.nameblank
helpviewer_keywords:
- application settings [Visual Studio]
author: gewarren
ms.author: gewarren
manager: jillfra
ms.workload:
- multiple
ms.openlocfilehash: 0627a96bf100232987ace5a42430310912f97b8c
ms.sourcegitcommit: e98db44f3a33529b0ba188d24390efd09e548191
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 09/25/2019
ms.locfileid: "71252090"
---
# <a name="manage-application-settings-net"></a>Управление параметрами приложения (.NET)

Параметры приложений позволяют динамически хранить данные приложения. Параметры позволяют хранить на клиентском компьютере информацию, которая не должна включаться в код приложения (например, строку подключения), настройки пользователя и другие сведения, необходимые во время выполнения.

Параметры приложения заменяют динамические свойства, используемые в более ранних версиях Visual Studio.

Каждый параметр приложения должен иметь уникальное имя. Именем может быть любая комбинация букв, цифр или символов подчеркивания, которая не начинается с цифры и не содержит пробелов. Для изменения имени служит свойство `Name`.

Параметры приложения могут храниться в виде любого типа данных, который может быть сериализован в формат XML или имеет метод `TypeConverter`, реализующий `ToString`/`FromString`. Наиболее распространенными типами являются `String`, `Integer`и `Boolean`, но можно также хранить значения как <xref:System.Drawing.Color>, <xref:System.Object>или в виде строки подключения.

Параметры приложений также содержат значение. Значение задается с помощью свойства **Value** и должно соответствовать типу данных параметра.

Кроме того, параметры приложений могут быть связаны со свойством формы или элемента управления во время разработки.

Существуют два типа параметров приложений в зависимости от области действия:

- Параметры, область действия которых ограничивается приложением, могут использоваться для хранения такой информации, как URL-адрес для веб-службы или строка подключения к базе данных. Эти значения связаны с приложением. Следовательно, пользователи не могут изменять их во время выполнения.

- Параметры, область действия которых ограничивается пользователем, можно использовать для хранения такой информации, как сохранение последнего положения формы или предпочитаемых настроек шрифта. Пользователи могут изменять эти значения во время выполнения.

Можно изменить тип параметра с помощью свойства **Scope** .

Система работы с проектами хранит параметры приложений в двух файлах XML:

- файле *app.config*, который создается во время разработки при создании первого параметра приложения;

- файле *user.config*, который создается во время выполнения, когда работающий с приложением пользователь изменяет значение любого параметра пользователя.

Обратите внимание, что изменения параметров пользователей не записываются на диск, если только приложение специально не вызовет для этого метод.

## <a name="create-application-settings-at-design-time"></a>Создание параметров приложения во время разработки

В режиме разработки можно создавать параметры приложения двумя способами: с помощью страницы **Параметры** **Конструктора проектов**либо с помощью окна **Свойства** формы или элемента управления, которое позволяет привязать параметр к свойству.

При создании параметра, область действия которого ограничивается приложением (например строки подключения к базе данных или ссылки на ресурсы сервера), [!INCLUDE[vsprvs](../code-quality/includes/vsprvs_md.md)] сохраняет его в файл *app.config* с тегом `<applicationSettings>`. (Строки подключения сохраняются под тегом `<connectionStrings>` .)

При создании параметра, область действия которого ограничивается пользователем (например, шрифта по умолчанию, домашней страницы или размера окна), [!INCLUDE[vsprvs](../code-quality/includes/vsprvs_md.md)] сохраняет ее в файл *app.config* с тегом `<userSettings>`.

> [!IMPORTANT]
> При хранении строк подключения в файле в *app.config* нужно предпринимать меры предосторожности, чтобы избегать раскрытия конфиденциальной информации, такой как пароли или пути сервера, содержащейся в строке подключения.
>
> Если информация для строки подключения берется из внешнего источника (например пользователь задает идентификатор пользователя и пароль), то необходимо следить за тем, чтобы значения, которые используются для составления строки подключения, не содержали дополнительных параметров строки подключения, изменяющих действие подключения.
>
> Рассмотрите возможность использования функции защищенной конфигурации для шифрования секретной информации в файле конфигурации. Дополнительные сведения см. в разделе [Защита сведений о подключении](/dotnet/framework/data/adonet/protecting-connection-information).

> [!NOTE]
> Из-за отсутствия модели файла конфигурации для библиотек классов, параметры приложений не применяются для проектов библиотек классов. Исключением является Visual Studio Tools для проекта Office DLL, который может иметь файл конфигурации.

## <a name="use-customized-settings-files"></a>Использование настраиваемых файлов параметров

Для удобства управления группами параметров в проект можно добавить индивидуальные файлы настроек. Содержащиеся в одном файле параметры загружаются и сохраняются как единое целое. Хранение параметров в отдельных файлах для часто и редко используемых групп позволяет сэкономить время на загрузке и сохранении параметров.

Например, можно добавить в проект такой файл, как *SpecialSettings.settings*. Хотя класс `SpecialSettings` и не открыт для доступа через пространство имен `My` , но функция **Просмотр кода** позволяет прочесть индивидуальный файл параметров, содержащий `Partial Class SpecialSettings`.

**Конструктор параметров** сначала ищет файл *Settings.settings*, создаваемый системой работы с проектами. **Конструктор проектов** по умолчанию отображает этот файл на вкладке **Параметры**. Файл *Settings.Settings* находится в папке *Мои проекты*, предназначенной для проектов [!INCLUDE[vbprvb](../code-quality/includes/vbprvb_md.md)], и в папке *Свойства*, предназначенной для проектов [!INCLUDE[csprcs](../data-tools/includes/csprcs_md.md)]. Затем **конструктор проектов** ищет другие файлы параметров в корневой папке проекта. Таким образом, индивидуальный файл параметров следует помещать туда же. Если добавить файл с расширением *SETTINGS* в другое место проекта, **конструктор проектов** не сможет его найти.

## <a name="access-or-change-application-settings-at-run-time-in-visual-basic"></a>Доступ или изменение параметров приложения во время выполнения в Visual Basic

В проектах Visual Basic во время выполнения доступ к параметрам приложения можно получить с помощью объекта `My.Settings`. На странице **Параметры** нажмите кнопку **Просмотреть код**, чтобы просмотреть файл *Settings.vb*. Файл *Settings.vb* определяет класс `Settings`, который позволяет обрабатывать эти события в классе параметров: <xref:System.Configuration.ApplicationSettingsBase.SettingChanging>, <xref:System.Configuration.ApplicationSettingsBase.PropertyChanged>, <xref:System.Configuration.ApplicationSettingsBase.SettingsLoaded> и <xref:System.Configuration.ApplicationSettingsBase.SettingsSaving>. Обратите внимание, что класс `Settings` в файле *Settings.vb* является разделяемым классом, который отображает только принадлежащий пользователю код, а не весь сгенерированный класс. Дополнительную информацию о доступе к параметрам приложения с помощью объекта `My.Settings` см. в разделе [Доступ к параметрам приложения (.NET Framework)](/dotnet/visual-basic/developing-apps/programming/app-settings/accessing-application-settings).

Значения любого изменяемого пользователем во время выполнения приложения параметра, область действия которого ограничивается пользователем (например, положение формы), хранятся в файле *user.config*. Обратите внимание, что значения по умолчанию по-прежнему сохраняются в файл *app.config*.

Если во время выполнения изменены какие-либо параметры, область действия которых ограничивается пользователем, например при тестировании приложения, и требуется восстановить их значения по умолчанию, нажмите кнопку **Синхронизировать**.

Настоятельно рекомендуется использовать для доступа к параметрам объект `My.Settings` и файл *SETTINGS* по умолчанию. Это связано с тем, что можно использовать **конструктор параметров** для задания свойств параметрам и, кроме того, настройки пользователей автоматически сохраняются перед завершением работы приложения. Однако приложение Visual Basic может получить доступ к настройкам напрямую. В этом случае необходим доступ к классу `MySettings` и использование настраиваемого файла *SETTINGS* в корневой папке проекта. Нужно сохранить пользовательские параметры до завершения работы приложения, как это было бы сделано для приложения C#. Это описано в следующем разделе.

<!-- markdownlint-disable MD003 MD020 -->
## <a name="access-or-change-application-settings-at-run-time-in-c"></a>Доступ или изменение параметров приложения во время выполнения в C#
<!-- markdownlint-enable MD003 MD020 -->

В языках, отличных от Visual Basic, например C#, доступ к классу `Settings` необходимо осуществлять напрямую, как показано в приведенном ниже примере [!INCLUDE[csprcs](../data-tools/includes/csprcs_md.md)].

```csharp
Properties.Settings.Default.FirstUserSetting = "abc";
```

Нужно явным образом вызывать метод `Save` этого класса-оболочки, чтобы сохранить параметры пользователя. Обычно это выполняется в обработчике событий `Closing` главной формы. В приведенном ниже примере C# показан вызов метода `Save`.

```csharp
Properties.Settings.Default.Save();
```

Общие сведения о доступе к параметрам приложений с помощью класса `Settings` см. в разделе [Общие сведения о параметрах приложений (.NET Framework)](/dotnet/framework/winforms/advanced/application-settings-overview). Информацию об итерации параметров см. в этой [записи форума](https://social.msdn.microsoft.com/Forums/vstudio/40fbb470-f1e8-4a02-a4a0-9f62b54d0fc4/is-this-possible-propertiessettingsdefault?forum=csharpgeneral).

## <a name="see-also"></a>См. также

- [Доступ к параметрам приложения (.NET Framework)](/dotnet/visual-basic/developing-apps/programming/app-settings/accessing-application-settings)
