---
title: Принцип работы функции "Локальный процесс с Kubernetes"
ms.technology: vs-azure
ms.date: 06/02/2020
ms.topic: conceptual
description: Описываются процессы использования функции "Локальный процесс с Kubernetes" для подключения компьютера разработчика к кластеру Kubernetes.
keywords: Локальный процесс с Kubernetes, Docker, Kubernetes, Azure, контейнеры
monikerRange: '>=vs-2019'
ms.openlocfilehash: adde9d8ecab93bdb6f0aebbd74730ef60bd80cf6
ms.sourcegitcommit: 510a928153470e2f96ef28b808f1d038506cce0c
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 07/17/2020
ms.locfileid: "86454386"
---
# <a name="how-local-process-with-kubernetes-works"></a>Принцип работы функции "Локальный процесс с Kubernetes"

Локальный процесс с Kubernetes позволяет выполнять и отлаживать код на компьютере разработки, подключенном к кластеру Kubernetes, в котором находятся остальные приложения или службы. Например, при наличии масштабной архитектуры микрослужб со множеством взаимозависимых служб и баз данных репликация этих зависимостей на компьютере разработки может представлять сложность. Кроме того, сборка и развертывание кода в кластере Kubernetes при каждом изменении кода в процессе внутреннего цикла разработки могут занимать много времени и затруднять использование отладчика.

Функция "Локальный процесс с Kubernetes" избавляет от необходимости выполнять сборку кода и развертывать его в кластере благодаря прямому подключению между компьютером разработки и кластером. Подключение компьютера разработки к кластеру во время отладки позволяет быстро тестировать и разрабатывать службу в контексте полного приложения, не создавая конфигурацию Docker или Kubernetes.

Локальный процесс с Kubernetes перенаправляет трафик между подключенным кластером Kubernetes и компьютером разработки. Это перенаправление трафика позволяет коду на компьютере разработки и службам, работающим в кластере Kubernetes, взаимодействовать так, как если бы они находились в одном кластере Kubernetes. Локальный процесс с Kubernetes также позволяет реплицировать переменные среды и подключенные тома, доступные модулям pod в кластере Kubernetes, на компьютере разработки. Наличие доступа к переменным среды и подключенным томам на компьютере разработки позволяет быстро работать с кодом, не реплицируя эти зависимости вручную.

## <a name="using-local-process-with-kubernetes"></a>Использование функции "Локальный процесс с Kubernetes"

Чтобы использовать функцию "Локальный процесс с Kubernetes" в Visual Studio, требуется [Visual Studio 2019][visual-studio] версии 16.7, предварительная версия 4, или более поздней версии в ОС Windows 10 с установленной рабочей нагрузкой *ASP.NET и разработка веб-приложений* и [расширением "Локальный процесс Kubernetes"][lpk-extension]. При использовании функции "Локальный процесс с Kubernetes" для установления подключения к кластеру Kubernetes можно настроить перенаправление всего входящего и исходящего трафика для существующего модуля pod в кластере на компьютер разработки.

> [!NOTE]
> При использовании функции "Локальный процесс с Kubernetes" вам будет предложено ввести имя службы, трафик которой должен перенаправляться на компьютер разработки. Это удобный способ для указания перенаправляемого модуля pod. Перенаправление между кластером Kubernetes и компьютером разработки осуществляется только для модуля pod.

Когда функция "Локальный процесс с Kubernetes" устанавливает подключение к кластеру, она выполняет следующие действия:

* Выводит запрос на настройку службы, которую следует заменить в кластере, порта на компьютере разработки, который следует использовать для кода, и задачи запуска для кода. Настройка выполняется один раз.
* Заменяет контейнер в модуле pod в кластере контейнером удаленного агента, который перенаправляет трафик на компьютер разработки.
* Выполняет команду [kubectl port-forward][kubectl-port-forward] на компьютере разработки для перенаправления трафика с компьютера разработки в удаленный агент, запущенный в кластере.
* Собирает сведения о среде из кластера с помощью удаленного агента. Эти сведения включают в себя переменные среды, видимые службы, подключенные тома и подключенные секреты.
* Настраивает среду в Visual Studio так, чтобы служба на компьютере разработки могла получать доступ к переменным так же, как если бы она выполнялась в кластере.  
* Обновляет файл hosts, сопоставляя службы в кластере с локальными IP-адресами на компьютере разработки. Эти записи в файле hosts позволяют коду, выполняющемуся на компьютере разработки, совершать запросы к другим службам, работающим в кластере. Чтобы обновить файл hosts, функция "Локальный процесс с Kubernetes" запрашивает у администратора права доступа на компьютере разработки при подключении к кластеру.
* Начинает выполнять и отлаживать код на компьютере разработки. При необходимости функция "Локальный процесс с Kubernetes" освобождает необходимые порты на компьютере разработки, останавливая использующие их службы или процессы.

После установления подключения к кластеру можно выполнять и отлаживать код на локальном компьютере без использования контейнеров, причем код может напрямую взаимодействовать с остальным кластером. Весь сетевой трафик, получаемый удаленным агентом, перенаправляется на локальный порт, указанный во время подключения, чтобы выполняемый локально код мог принимать и обрабатывать его. Переменные среды, тома и секреты из кластера доступны коду, выполняемому на компьютере разработки. Кроме того, благодаря добавлению записей в файл hosts и перенаправлению портов на компьютере разработки посредством функции "Локальный процесс с Kubernetes" ваш код может отправлять сетевой трафик в службы, работающие в кластере, используя их имена, и этот трафик перенаправляется в службы, работающие в кластере. Трафик маршрутизируется между компьютером разработки и кластером в течение всего времени подключения.

## <a name="diagnostics-and-logging"></a>Диагностика и ведение журнала

При использовании функции "Локальный процесс с Kubernetes" для подключения к кластеру журналы диагностики из кластера записываются во [временный каталог][azds-tmp-dir] на компьютере разработки.

## <a name="limitations"></a>Ограничения

Локальный процесс с Kubernetes имеет следующие ограничения:

* Локальный процесс с Kubernetes перенаправляет на компьютер разработки трафик только одной службы. Локальный процесс с Kubernetes нельзя использовать для перенаправления трафика одновременно нескольких служб.
* Для подключения к службе она должна быть основана на одном модуле pod. Нельзя подключиться к службе с несколькими модулями pod, например службе с репликами.
* Для успешного подключения с помощью функции "Локальный процесс с Kubernetes" в модуле pod должен выполняться только один контейнер. Функция "Локальный процесс с Kubernetes" не может подключаться к службам с модулями pod, имеющими дополнительные контейнеры, например контейнеры расширения, внедренные сетками служб.
* Функции "Локальный процесс с Kubernetes" требуется повышенный уровень разрешений на компьютере разработки для изменения файла hosts.

## <a name="next-steps"></a>Следующие шаги

Чтобы приступить к использованию функции "Локальный процесс с Kubernetes" для подключения локального компьютера разработки к кластеру, обратитесь к статье [Использование функции "Локальный процесс с Kubernetes"](local-process-kubernetes.md).

[azds-cli]: /azure/dev-spaces/how-to/install-dev-spaces#install-the-client-side-tools
[azds-tmp-dir]: /azure/dev-spaces/troubleshooting#before-you-begin
[azure-cli]: /cli/azure/install-azure-cli?view=azure-cli-latest
[local-process-kubernetes-vs]: local-process-kubernetes.md
[kubectl-port-forward]: https://kubernetes.io/docs/reference/generated/kubectl/kubectl-commands#port-forward
[visual-studio]: https://visualstudio.microsoft.com/downloads/
[lpk-extension]: https://marketplace.visualstudio.com/items?itemName=ms-azuretools.mindaro