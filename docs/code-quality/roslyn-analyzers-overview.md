---
title: Анализ кода с помощью анализаторов Roslyn
ms.date: 10/03/2019
ms.topic: overview
helpviewer_keywords:
- code analysis, managed code
- analyzers
- Roslyn analyzers
- code analyzers
author: mikejo5000
ms.author: mikejo
manager: jillfra
ms.workload:
- dotnet
ms.openlocfilehash: 78a47cb2a5aefd7d20e0b8087f5f3ad735716175
ms.sourcegitcommit: 2975d722a6d6e45f7887b05e9b526e91cffb0bcf
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/20/2020
ms.locfileid: "79431284"
---
# <a name="overview-of-source-code-analyzers"></a>Обзор анализаторов исходного кода

Анализаторы кода .NET Compiler Platform ("Roslyn") выполняют анализ стиля, качества, удобства, структуры и других характеристик кода C# или Visual Basic, а также выявляют проблемы в нем.

- Некоторые анализаторы встроены в Visual Studio. Идентификатор диагностики или код для этих анализаторов имеет формат IDExxxx, например IDE0067. Большинство таких встроенных анализаторов изучают [стиль кода](../ide/code-styles-and-code-cleanup.md), и вы можете настроить соответствующие предпочтения на [странице параметров текстового редактора](../ide/code-styles-and-code-cleanup.md) или в [файле EditorConfig](../ide/editorconfig-code-style-settings-reference.md). Несколько встроенных анализаторов изучают качество кода.

- Вы можете установить дополнительные анализаторы в виде пакета NuGet или расширения Visual Studio. Пример:

  - [Анализаторы FxCop](../code-quality/install-fxcop-analyzers.md), рекомендованные корпорацией Майкрософт
  - Анализаторы сторонних разработчиков, такие как [StyleCop](https://www.nuget.org/packages/StyleCop.Analyzers/), [Roslynator](https://www.nuget.org/packages/Roslynator.Analyzers/), [XUnit Analyzers](https://www.nuget.org/packages/xunit.analyzers/) и [Sonar Analyzer](https://www.nuget.org/packages/SonarAnalyzer.CSharp/)

Если анализатор обнаруживает нарушения правил, они помечаются в редакторе кода (*волнистая линия* под соответствующим кодом) и в окне "Список ошибок".

Многие правила анализатора или *диагностические средства* имеют одно или несколько связанных *исправлений кода*, которые можно применить для устранения проблемы. Все диагностические средства анализатора, встроенные в Visual Studio, имеют соответствующие исправления кода. Исправления кода отображаются в меню со значком лампочки вместе с другими типами [быстрых действий](../ide/quick-actions.md). Сведения об этих исправлениях кода см. в разделе [Распространенные быстрые действия](../ide/common-quick-actions.md).

![Нарушение анализа и исправление кода быстрого действия](../code-quality/media/built-in-analyzer-code-fix.png)

## <a name="source-code-analysis-versus-legacy-analysis"></a>Сравнение анализа исходного кода и устаревшей функции анализа

Анализ исходного кода в анализаторах Roslyn заменяет [устаревшую функцию анализа](../code-quality/code-analysis-for-managed-code-overview.md) для управляемого кода. Множество правил устаревшей функции анализа уже были переписаны в виде анализаторов кода Roslyn. Для более новых шаблонов проектов, таких как проекты .NET Core и .NET Standard, устаревшая функция анализа просто недоступна.

Как и в случае нарушений правил устаревшей функции анализа, нарушения анализа исходного кода отображаются в Visual Studio в окне списка ошибок. Кроме того, нарушения анализа исходного кода выделяются в редакторе кода с помощью *волнистых линий* под соответствующим кодом. Цвет волнистой линии зависит [параметра серьезности](../code-quality/use-roslyn-analyzers.md#rule-severity) правила. На следующем изображении показаны три нарушения&mdash;одно красное, одно зеленое и одно серое:

![Волнистые линии в редакторе кода в Visual Studio](media/diagnostics-severity-colors.png)

Анализаторы кода изучают код не только во время сборки (как устаревшая функция анализа, если она включена), но и в реальном времени по мере ввода. Можно настроить область выполнения динамического анализа кода только для текущего документа, для всех открытых документов или для всего решения. См. практическое руководство по [ Настройка области динамического анализа кода](./configure-live-code-analysis-scope-managed-code.md).

> [!TIP]
> Ошибки и предупреждения времени сборки из анализаторов кода отображаются только в том случае, если анализаторы установлены как пакет NuGet. Встроенные анализаторы (например, IDE0067 и IDE0068) никогда не запускаются во время сборки.

Анализаторы кода Roslyn не только сообщают о тех же типах проблем, что и устаревшая функция анализа, но и упрощают исправление одного или всех экземпляров нарушений в файле или проекте. Эти действия называются *исправлениями кода*. Исправления кода зависят от конкретной интегрированной среды разработки; в Visual Studio они реализуются как [Быстрые действия](../ide/quick-actions.md). Не все диагностические средства анализатора имеют соответствующее исправление кода.

> [!NOTE]
> Для выпусков, предшествующих Visual Studio 2019 версии 16.5, параметр **Анализ** > **Запустить анализ кода** используется в устаревшей функции анализа. Начиная с Visual Studio 2019 версии 16.5, параметр меню **Запустить анализ кода** выполняет анализаторы Roslyn для выбранного проекта или решения.

Чтобы различить нарушения из анализаторов кода и устаревшей функции анализа в списке ошибок, используйте столбец **Средство**. Если его значение соответствует одной из сборок анализаторов в **обозревателе решений**, например **Microsoft.CodeQuality.Analyzers**, нарушение поступает из анализатора кода. В противном случае нарушение поступает из устаревшей функции анализа.

![Столбец "Средство" в списке ошибок](media/code-analysis-tool-in-error-list.png)

> [!TIP]
> Свойство MSBuild **RunCodeAnalysis** в файле проекта используется только для устаревшей функции анализа. Чтобы установить анализаторы, в файле проекта назначьте свойству **RunCodeAnalysis** значение **false**, чтобы запретить использование устаревшей функции анализа после сборки.
>
> ```xml
> <RunCodeAnalysis>false</RunCodeAnalysis>
> ```

## <a name="nuget-package-versus-vsix-extension"></a>Сравнение пакета NuGet и расширения VSIX

Анализаторы кода Roslyn можно установить для отдельного проекта с помощью пакета NuGet. Некоторые из них также доступны в виде расширения Visual Studio. В этом случае они применяются к любому решению, открытому в Visual Studio. Между этими двумя способами [установки анализаторов](../code-quality/install-roslyn-analyzers.md) существуют некоторые ключевые различия.

### <a name="scope"></a>Область

Если анализаторы устанавливаются как расширение Visual Studio, они применяются на уровне решения и ко всем экземплярам Visual Studio. Если анализаторы устанавливаются в виде пакета NuGet, что является предпочтительным, они применяются только к проекту, где установлен данный пакет NuGet. В командных окружениях анализаторы, установленные как пакеты NuGet, входят в область для *всех разработчиков*, работающих над этим проектом.

### <a name="build-errors"></a>Ошибки сборки

Чтобы применить правила во время сборки, например с помощью командной строки или в составе сборки непрерывной интеграции (CI), установите анализаторы как пакет NuGet. Если установить анализатор как расширение, его предупреждения и ошибки не будут отображаться в отчете о сборке.

На следующем изображении показаны выходные данные сборки из командной строки для создания проекта, содержащего нарушение правила анализа:

![Выходные данные MSBuild с нарушением правила](media/command-line-build-analyzers.png)

### <a name="rule-severity"></a>Важность правил

Вы не можете настроить важность правил из анализаторов, которые были установлены как расширение Visual Studio. Чтобы настроить [важность правила](../code-quality/use-roslyn-analyzers.md#rule-severity), установите анализаторы как пакет NuGet.

## <a name="next-steps"></a>Следующие шаги

> [!div class="nextstepaction"]
> [Установка анализаторов кода в Visual Studio](../code-quality/install-roslyn-analyzers.md)

> [!div class="nextstepaction"]
> [Использование анализаторов кода в Visual Studio](../code-quality/use-roslyn-analyzers.md)

## <a name="see-also"></a>См. также

- [Часто задаваемые вопросы по анализаторам](analyzers-faq.md)
- [Написание собственного анализатора кода](../extensibility/getting-started-with-roslyn-analyzers.md)
- [Пакет SDK для .NET Compiler Platform](/dotnet/csharp/roslyn-sdk/)
