---
title: Серьезность и подавление правил анализатора
ms.date: 03/26/2019
ms.topic: conceptual
helpviewer_keywords:
- code analysis, managed code
- analyzers
- Roslyn analyzers
author: gewarren
ms.author: gewarren
manager: jillfra
ms.workload:
- dotnet
ms.openlocfilehash: 6362d3f14065aaf9661e85266753642e4201ca48
ms.sourcegitcommit: 209ed0fcbb8daa1685e8d6b9a97f3857a4ce1152
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/16/2019
ms.locfileid: "69548035"
---
# <a name="use-code-analyzers"></a>Использование анализаторов кода

Анализаторы кода .NET Compiler Platform ("Roslyn") анализируют код C# или Visual Basic при вводе. Каждая *Диагностика* или правило имеет серьезность по умолчанию и состояние подавления, которые могут быть перезаписаны для проекта. В этой статье рассматривается настройка серьезности правила, использование наборов правил и подавление нарушений.

## <a name="analyzers-in-solution-explorer"></a>Анализаторы в обозреватель решений

Большую часть настройки диагностики анализатора можно выполнить из **Обозреватель решений**. При [установке анализаторов](../code-quality/install-roslyn-analyzers.md) в качестве пакета NuGet узел анализаторов отображается в узле **ссылки** или **зависимости** в **Обозреватель решений**. Если развернуть **анализаторы**, а затем развернуть одну из сборок анализатора, отобразятся все диагностические сведения в сборке.

![Узел «Анализаторы» в обозреватель решений](media/analyzers-expanded-in-solution-explorer.png)

Свойства диагностики, включая ее описание и серьезность по умолчанию, можно просмотреть в окне **Свойства** . Чтобы просмотреть свойства, щелкните правило правой кнопкой мыши и выберите пункт **Свойства**или выберите правило, а затем нажмите клавишу **ALT**+**Ввод**.

![Свойства диагностики в окно свойств](media/analyzer-diagnostic-properties.png)

Чтобы просмотреть электронную документацию по диагностике, щелкните правой кнопкой мыши диагностику и выберите команду **просмотреть справку**.

Значки рядом с каждой диагностикой в **Обозреватель решений** соответствуют значкам, отображаемым в наборе правил при его открытии в редакторе:

- "i" в окружности обозначает [серьезность](#rule-severity) **информации**
- знак "!" в треугольнике указывает на [серьезность](#rule-severity) **предупреждения**
- "x" в окружности обозначает [серьезность](#rule-severity) **ошибки**
- «i» в круге на светло-цветном фоне указывает на [серьезность](#rule-severity) скрытого
- направленная вниз стрелка в окружности означает, что диагностика подавлена

![Значки диагностики в обозреватель решений](media/diagnostics-icons-solution-explorer.png)

## <a name="rule-sets"></a>Наборы правил

[Набор правил](../code-quality/using-rule-sets-to-group-code-analysis-rules.md) — это XML-файл, в котором хранятся серьезность и состояние подавления для отдельных диагностических данных.

> [!NOTE]
> Наборы правил могут включать правила как для устаревшего анализа, так и для анализаторов кода.

Чтобы изменить активный набор правил в редакторе набора правил, щелкните правой кнопкой мыши узел анализаторы **ссылок** > в **Обозреватель решений** и выберите **Открыть активный набор правил**. Если вы изменяете набор правил в первый раз, Visual Studio создает копию файла набора правил по умолчанию, называет его  *\<именем имя_проекта >. RuleSet*и добавляет его в проект. Этот настраиваемый набор правил также станет активным набором правил для вашего проекта.

Чтобы изменить активный набор правил для проекта, перейдите на вкладку **анализ кода** свойств проекта. Выберите набор правил из списка под заголовком **выполнение этого набора правил**. Чтобы открыть набор правил, выберите **Открыть**.

> [!NOTE]
> Проекты .NET Core и .NET Standard не поддерживают команды меню для наборов правил в **Обозреватель решений**, например **Открыть активный набор правил**. Чтобы указать набор правил, не используемый по умолчанию для проекта .NET Core или .NET Standard, [добавьте свойство **кодеаналисисрулесет** ](using-rule-sets-to-group-code-analysis-rules.md#specify-a-rule-set-for-a-project) в файл проекта вручную. Вы по-прежнему можете настроить правила в наборе правил в пользовательском интерфейсе редактора набора правил Visual Studio.

## <a name="rule-severity"></a>Важность правил

При [установке анализаторов](../code-quality/install-roslyn-analyzers.md) в качестве пакета NuGet можно настроить серьезность правил анализатора или *диагностики*. В следующей таблице показаны параметры серьезности для диагностики.

|Серьезность|Поведение во время сборки|Поведение редактора|
|-|-|-|
|Error|Нарушения отображаются как *ошибки* в **Список ошибок** и в выходных данных сборки в командной строке, что приводит к сбою сборки.|Код, вызвавший ошибку, подчеркнут красной волнистой линией и отмечен небольшим красным прямоугольником на полосе прокрутки.|
|Предупреждение|Нарушения отображаются как *предупреждения* в **Список ошибок** и в выходных данных сборки в командной строке, но не вызывают сбой сборок.|Код, вызвавший ошибку, подчеркнут зеленой волнистой линией и отмечен маленьким зеленым прямоугольником на полосе прокрутки.|
|Info|Нарушения отображаются как *сообщения* в **Список ошибок**, а не все в выходных данных сборки в командной строке.|Код, вызвавший ошибку, подчеркивается серой волнистой линией и отмечается небольшим серым прямоугольником в полосе прокрутки.|
|Hidden|Не является видимым для пользователя.|Не является видимым для пользователя. Однако в модуль диагностики интегрированной среды разработки сообщается о диагностике.|
|Отсутствуют|Полностью подавлен.|Полностью подавлен.|

Кроме того, можно сбросить уровень серьезности правила, задав для него значение **по умолчанию**. Каждая диагностика имеет серьезность по умолчанию, которую можно увидеть в окне " **Свойства** ".

На следующем снимке экрана показаны три различных нарушения диагностики в редакторе кода с тремя разными уровнями серьезности. Обратите внимание на цвет волнистой линии, а также на маленькое поле в полосе прокрутки справа.

![Ошибка, предупреждение и нарушение сведений в редакторе кода](media/diagnostics-severity-colors.png)

На следующем снимке экрана показаны те же три нарушения, которые отображаются в **Список ошибок**:

![Ошибка, предупреждение и нарушение сведений в Список ошибок](media/diagnostics-severities-in-error-list.png)

Серьезность правила можно изменить с **Обозреватель решений**или в  *\<файле имя_проекта >. RuleSet* , который добавляется в решение после изменения серьезности правила в **Обозреватель решений**.

![Файл набора правил в обозреватель решений](media/ruleset-in-solution-explorer.png)

### <a name="set-rule-severity-from-solution-explorer"></a>Установка серьезности правила с обозреватель решений

1. В **Обозреватель решений**разверните узел > **анализаторы** ссылок (**анализаторы** **зависимостей** > для проектов .NET Core).

1. Разверните сборку, содержащую правило, для которого нужно задать серьезность.

1. Щелкните правило правой кнопкой мыши и выберите пункт **задать серьезность набора правил**. Во всплывающем меню выберите один из параметров серьезности.

   Уровень серьезности для правила сохраняется в файле активного набора правил.

### <a name="set-rule-severity-in-the-rule-set-file"></a>Задание серьезности правила в файле набора правил

1. Откройте файл [набора правил](analyzer-rule-sets.md) , дважды щелкнув его в **Обозреватель решений**, выберите **Открыть активный набор правил** в контекстном меню узла **анализаторы** или щелкните **Открыть** на странице свойств **анализ кода** для. проект.

1. Перейдите к правилу, развернув его содержащую его сборку.

1. В столбце **действие** выберите значение, чтобы открыть раскрывающийся список, и выберите нужную важность из списка.

   ![Файл набора правил открыт в редакторе](media/ruleset-file-in-editor.png)

## <a name="suppress-violations"></a>Подавлять нарушения

Существует несколько способов подавления нарушений правил.

- В меню **анализ**

  Выберите **анализ** > **выполнение анализа кода и подавление активных проблем** в строке меню, чтобы отключить все текущие нарушения. Иногда это называется "задания базовых показателей".

- Из **Обозреватель решений**

  Чтобы отключить нарушение в **Обозреватель решений**, установите для правила серьезность **нет**.

- Из **редактора набора правил**

  Чтобы отключить нарушение в редакторе набора правил, снимите флажок рядом с его именем или **действием** set значение **нет**.

- В **редакторе кода**

  Чтобы предотвратить нарушение в редакторе кода, поместите курсор в строку кода с нарушением и нажмите клавишу **CTRL**+ **.** , чтобы открыть меню **быстрые действия** . Установите флажок **подавлять какскскскс** > **в файле источника/в подавлении**.

  ![Подавлять диагностику в меню быстрых действий](media/suppress-diagnostic-from-editor.png)

- Из **Список ошибок**

  Можно отключить одну или несколько диагностических сведений из **Список ошибок** , выбрав те из них, которые необходимо отключить, и затем щелкнуть правой кнопкой мыши и выбрать пункт **подавлять** > **в файле источника/в подавлении**.

  - При подавлении **в исходном**коде открывается диалоговое окно **предварительного просмотра изменений** , в котором отображается C# предварительный просмотр [#pragma предупреждения](/dotnet/csharp/language-reference/preprocessor-directives/preprocessor-pragma-warning) или Visual Basic [#Disable предупреждения](/dotnet/visual-basic/language-reference/directives/directives) , добавленные в исходный код.

    ![Предварительный просмотр добавления #pragma предупреждения в файл кода](media/pragma-warning-preview.png)

  - Если выбрать параметр **в файле подавления**, откроется диалоговое окно **Предварительный просмотр изменений** , в котором <xref:System.Diagnostics.CodeAnalysis.SuppressMessageAttribute> будет показан предварительный просмотр атрибута, добавленного в глобальный файл подавления.

    ![Предварительный просмотр добавления атрибута SuppressMessage в файл подавления](media/preview-changes-in-suppression-file.png)

  В диалоговом окне **Просмотр изменений** нажмите кнопку **Применить**.

  > [!NOTE]
  > Если в **Обозреватель решений**не отображается пункт подавить, то, скорее всего, это произошло из-за сборки, а не для интерактивного анализа. **Список ошибок** отображает диагностические или нарушения правил, как в реальном коде, так и в сборке. Так как диагностика сборки может быть устаревшей, например, если вы изменили код, чтобы устранить нарушение, но оно не было перестроено, вы не сможете отключить эти диагностические данные от **Список ошибок**. Диагностика из интерактивного анализа или IntelliSense всегда актуальны с текущими источниками и могут быть подавлены из **Список ошибок**. Чтобы исключить диагностику *сборки* из выбора, переключите фильтр источника **Список ошибок** с **сборки + IntelliSense** на **IntelliSense**. Затем выберите диагностику, которую необходимо отключить, и продолжайте, как описано выше.
  >
  > ![Фильтр источника Список ошибок в Visual Studio](media/error-list-filter.png)

## <a name="command-line-usage"></a>Использование командной строки

При сборке проекта в командной строке нарушения правил появляются в выходных данных сборки, если выполняются следующие условия.

- Анализаторы устанавливаются как пакет NuGet, а не как расширение VSIX.

- В коде проекта нарушается одно или несколько правил.

- [Серьезность](#rule-severity) нарушенного правила задана как **предупреждение**, и в этом случае нарушения не приводят к сбою сборки, или **Ошибка**, в этом случае нарушения могут привести к сбою сборки.

Уровень детализации выходных данных сборки не влияет на отображение нарушений правил. Даже при неавтоматическом уровне детализации нарушения правил появляются в выходных данных сборки.

> [!TIP]
> Если вы привыкли выполнять анализ прежних версий из командной строки с помощью программы *FxCopCmd. exe* или MSBuild с флагом **рункодеаналисис** , вот как это сделать с анализаторами кода.

Чтобы просмотреть нарушения анализатора в командной строке при сборке проекта с помощью MSBuild, выполните следующую команду:

```cmd
msbuild myproject.csproj /target:rebuild /verbosity:minimal
```

На следующем рисунке показаны выходные данные сборки из командной строки из сборки проекта, который содержит нарушение правил анализатора.

![Выходные данные MSBuild с нарушением правила](media/command-line-build-analyzers.png)

## <a name="dependent-projects"></a>Зависимые проекты

В проекте .NET Core при добавлении ссылки на проект, который содержит анализаторы NuGet, эти анализаторы автоматически добавляются в зависимый проект. Чтобы отключить такое поведение, например, если зависимый проект является проектом модульного теста, пометьте пакет NuGet как частный в *CSPROJ* -или *VBPROJ* -файле проекта, на который указывает ссылка, установив атрибут **PrivateAssets** :

```xml
<PackageReference Include="Microsoft.CodeAnalysis.FxCopAnalyzers" Version="2.9.0" PrivateAssets="all" />
```

## <a name="see-also"></a>См. также

- [Обзор анализаторов кода в Visual Studio](../code-quality/roslyn-analyzers-overview.md)
- [Отправка ошибки анализатора кода](https://github.com/dotnet/roslyn-analyzers/issues)
- [Использование наборов правил](../code-quality/using-rule-sets-to-group-code-analysis-rules.md)
- [Подавлять предупреждения анализа кода](../code-quality/in-source-suppression-overview.md)
