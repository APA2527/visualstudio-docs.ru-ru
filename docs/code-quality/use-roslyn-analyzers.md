---
title: Серьезность и подавление правил анализатора
ms.date: 09/23/2019
ms.topic: conceptual
helpviewer_keywords:
- code analysis, managed code
- analyzers
- Roslyn analyzers
author: jillre
ms.author: jillfra
manager: jillfra
ms.workload:
- dotnet
ms.openlocfilehash: 6cd4d5517dae889387ec632df57c90485bd366b0
ms.sourcegitcommit: a8e8f4bd5d508da34bbe9f2d4d9fa94da0539de0
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 10/19/2019
ms.locfileid: "72649051"
---
# <a name="use-code-analyzers"></a>Использование анализаторов кода

Анализаторы кода .NET Compiler Platform ("Roslyn") анализируют код C# или Visual Basic при вводе. Каждая *Диагностика* или правило имеет серьезность по умолчанию и состояние подавления, которые могут быть перезаписаны для проекта. В этой статье рассматривается настройка серьезности правила, использование наборов правил и подавление нарушений.

## <a name="analyzers-in-solution-explorer"></a>Анализаторы в обозреватель решений

Большую часть настройки диагностики анализатора можно выполнить из **Обозреватель решений**. При [установке анализаторов](../code-quality/install-roslyn-analyzers.md) в качестве пакета NuGet узел **анализаторов** отображается в узле **ссылки** или **зависимости** в **Обозреватель решений**. Если развернуть **анализаторы**, а затем развернуть одну из сборок анализатора, отобразятся все диагностические сведения в сборке.

![Узел «Анализаторы» в обозреватель решений](media/analyzers-expanded-in-solution-explorer.png)

Свойства диагностики, включая ее описание и серьезность по умолчанию, можно просмотреть в окне **Свойства** . Чтобы просмотреть свойства, щелкните правило правой кнопкой мыши и выберите пункт **Свойства**или выберите правило, а затем нажмите клавиши **ALT** +**Ввод**.

![Свойства диагностики в окно свойств](media/analyzer-diagnostic-properties.png)

Чтобы просмотреть электронную документацию по диагностике, щелкните правой кнопкой мыши диагностику и выберите команду **просмотреть справку**.

Значки рядом с каждой диагностикой в **Обозреватель решений** соответствуют значкам, отображаемым в наборе правил при его открытии в редакторе:

- "x" в окружности обозначает [серьезность](#rule-severity) **ошибки**
- знак "!" в треугольнике указывает на [серьезность](#rule-severity) **предупреждения**
- "i" в окружности обозначает [серьезность](#rule-severity) **информации**
- «i» в круге на светло-цветном фоне указывает на [серьезность](#rule-severity) **скрытого**
- направленная вниз стрелка в окружности означает, что диагностика подавлена

![Значки диагностики в обозреватель решений](media/diagnostics-icons-solution-explorer.png)

## <a name="rule-severity"></a>Важность правил

::: moniker range=">=vs-2019"

При [установке анализаторов](../code-quality/install-roslyn-analyzers.md) в качестве пакета NuGet можно настроить серьезность правил анализатора или *диагностики*. Начиная с Visual Studio 2019 версии 16,3, можно настроить серьезность правила [в файле EditorConfig](#set-rule-severity-in-an-editorconfig-file). Можно также изменить уровень серьезности правила [с Обозреватель решений](#set-rule-severity-from-solution-explorer) или [в файле набора правил](#set-rule-severity-in-the-rule-set-file).

::: moniker-end

::: moniker range="vs-2017"

При [установке анализаторов](../code-quality/install-roslyn-analyzers.md) в качестве пакета NuGet можно настроить серьезность правил анализатора или *диагностики*. Серьезность правила можно изменить [с Обозреватель решений](#set-rule-severity-from-solution-explorer) или [в файле набора правил](#set-rule-severity-in-the-rule-set-file).

::: moniker-end

В следующей таблице показаны различные параметры серьезности.

| Уровень серьезности (обозреватель решений) | Серьезность (файл EditorConfig) | Поведение во время сборки | Поведение редактора |
|-|-|-|
| Error | `error` | Нарушения отображаются как *ошибки* в список ошибок и в выходных данных сборки в командной строке, что приводит к сбою сборки.| Код, вызвавший ошибку, подчеркнут красной волнистой линией и отмечен небольшой красной рамкой в полосе прокрутки. |
| Предупреждение | `warning` | Нарушения отображаются как *предупреждения* в список ошибок и в выходных данных сборки в командной строке, но не вызывают сбой сборок. | Код, вызвавший ошибку, подчеркивается зеленой волнистой линией и отмечается маленьким зеленым прямоугольником в полосе прокрутки. |
| Info | `suggestion` | Нарушения отображаются как *сообщения* в список ошибок, а не все в выходных данных сборки в командной строке. | Код, вызвавший ошибку, подчеркивается серой волнистой линией и отмечается небольшим серым прямоугольником в полосе прокрутки. |
| Hidden | `silent` | Не является видимым для пользователя. | Не является видимым для пользователя. Однако в модуль диагностики интегрированной среды разработки сообщается о диагностике. |
| Отсутствуют | `none` | Полностью подавлен. | Полностью подавлен. |
| Значение по умолчанию | `default` | Соответствует уровню серьезности по умолчанию для правила. Чтобы определить, какое значение используется для правила по умолчанию, просмотрите окно свойств. | Соответствует уровню серьезности по умолчанию для правила. |

На следующем снимке экрана редактора кода показаны три разных нарушения с разными уровнями серьезности. Обратите внимание на цвет волнистой линии и маленький цветной квадрат в полосе прокрутки справа.

![Ошибка, предупреждение и нарушение сведений в редакторе кода](media/diagnostics-severity-colors.png)

На следующем снимке экрана показаны те же три нарушения, которые отображаются в Список ошибок:

![Ошибка, предупреждение и нарушение сведений в Список ошибок](media/diagnostics-severities-in-error-list.png)

::: moniker range=">=vs-2019"

### <a name="set-rule-severity-in-an-editorconfig-file"></a>Задание серьезности правила в файле EditorConfig

(Visual Studio 2019 версии 16,3 и более поздних версий)

Общий синтаксис для указания серьезности правила в файле EditorConfig выглядит следующим образом:

`dotnet_diagnostic.<rule ID>.severity = <severity>`

Настройка степени серьезности правила в файле EditorConfig имеет приоритет над любым уровнем серьезности, установленным в наборе правил или в обозреватель решений. Можно [вручную](#manually-configure-rule-severity) настроить серьезность в файле EditorConfig или [автоматически](#automatically-configure-rule-severity) с помощью лампочки, отображаемой рядом с нарушением.

#### <a name="manually-configure-rule-severity"></a>Настройка важности правила вручную

1. Если у вас еще нет файла EditorConfig для проекта, [добавьте его](../ide/create-portable-custom-editor-options.md#add-an-editorconfig-file-to-a-project).

2. Добавьте запись для каждого правила, которое требуется настроить, с соответствующим расширением файла. Например, чтобы задать для [CA1822](ca1822.md) уровень серьезности `error` для C# файлов, запись выглядит следующим образом:

   ```ini
   [*.cs]
   dotnet_diagnostic.CA1822.severity = error
   ```

> [!NOTE]
> Для анализаторов кода интегрированной среды разработки можно также настроить их в файле EditorConfig, используя другой синтаксис, например `dotnet_style_qualification_for_field = false:suggestion`. Однако если задать серьезность с помощью синтаксиса `dotnet_diagnostic`, он имеет приоритет. Дополнительные сведения см. в разделе [языковые соглашения для EditorConfig](../ide/editorconfig-language-conventions.md).

#### <a name="automatically-configure-rule-severity"></a>Автоматически настроить серьезность правила

Visual Studio предоставляет удобный способ настройки серьезности правила из меню лампочки [быстрые действия](../ide/quick-actions.md) .

1. После возникновения нарушения наведите указатель мыши на нарушение в редакторе и откройте меню лампочки. Или наведите курсор на строку и нажмите клавиши **Ctrl** + **.** (точка).

2. В меню лампочки выберите пункт **настроить или отключить проблемы** > **настроить \<rule идентификатор > серьезность**.

   ![Настройка серьезности правила из меню лампочки в Visual Studio](media/configure-rule-severity.png)

3. В нем выберите один из параметров серьезности.

   ![Настройка серьезности правила в качестве предложения](media/configure-rule-severity-suggestion.png)

   Visual Studio добавляет запись в файл EditorConfig, чтобы настроить правило на запрошенном уровне, как показано в поле предварительного просмотра.

   > [!TIP]
   > Если в проекте еще нет файла EditorConfig, Visual Studio создаст его.

::: moniker-end

### <a name="set-rule-severity-from-solution-explorer"></a>Установка серьезности правила с обозреватель решений

1. В **Обозреватель решений**разверните **ссылки**  > **analyzers** (или **зависимости**  > **анализаторы** для проектов .NET Core).

1. Разверните сборку, содержащую правило, для которого нужно задать серьезность.

1. Щелкните правило правой кнопкой мыши и выберите пункт **задать серьезность набора правил**. Во всплывающем меню выберите один из параметров серьезности.

   Уровень серьезности для правила сохраняется в файле активного набора правил.

### <a name="set-rule-severity-in-the-rule-set-file"></a>Задание серьезности правила в файле набора правил

![Файл набора правил в обозреватель решений](media/ruleset-in-solution-explorer.png)

1. Откройте файл активного набора правил, дважды щелкнув его в **Обозреватель решений**, выбрав пункт **Открыть активный набор правил** в контекстном меню узла **ссылки**  > **анализаторы** или щелкнув **Открыть** в **коде.** Страница свойств «анализ» для проекта.

   Если вы изменяете набор правил в первый раз, Visual Studio создает копию файла набора правил по умолчанию, называет его *\<projectname >. RuleSet*и добавляет его в проект. Этот настраиваемый набор правил также станет активным набором правил для вашего проекта.

   > [!NOTE]
   > Проекты .NET Core и .NET Standard не поддерживают команды меню для наборов правил в **Обозреватель решений**, например **Открыть активный набор правил**. Чтобы указать набор правил, не используемый по умолчанию для проекта .NET Core или .NET Standard, [добавьте свойство **кодеаналисисрулесет** ](using-rule-sets-to-group-code-analysis-rules.md#specify-a-rule-set-for-a-project) в файл проекта вручную. Вы по-прежнему можете настроить правила в наборе правил в пользовательском интерфейсе редактора набора правил Visual Studio.

1. Перейдите к правилу, развернув его содержащую его сборку.

1. В столбце **действие** выберите значение, чтобы открыть раскрывающийся список, и выберите нужную важность из списка.

   ![Файл набора правил открыт в редакторе](media/ruleset-file-in-editor.png)

## <a name="suppress-violations"></a>Подавлять нарушения

Существует несколько способов подавления нарушений правил.

::: moniker range=">=vs-2019"

- В **файле EditorConfig**

  Задайте `none` серьезности, например `dotnet_diagnostic.CA1822.severity = none`.

- В меню **анализ**

  Выберите **анализ**  > **Сборка и подавление активных проблем** в строке меню, чтобы отключить все текущие нарушения. Иногда это называется "задания базовых показателей".

::: moniker-end

::: moniker range="vs-2017"

- В меню **анализ**

  Выберите **анализ**  > **запустить анализ кода и подавлять активные проблемы** в строке меню, чтобы отключить все текущие нарушения. Иногда это называется "задания базовых показателей".

::: moniker-end

- Из **Обозреватель решений**

  Задайте для правила серьезность **нет**.

- Из **редактора набора правил**

  Снимите флажок рядом с именем или задайте для параметра **действие** значение **нет**.

- В **редакторе кода**

  Поместите курсор в строку кода с нарушением и нажмите клавишу **Ctrl** +**period (.)** , чтобы открыть меню **быстрые действия** . Установите флажок **ПОДАВЛЯТЬ какскскскс**  > **в файле источника/в подавлении**.

  ![Подавлять диагностику в меню быстрых действий](media/suppress-diagnostic-from-editor.png)

- Из **Список ошибок**

  Выберите правила, которые необходимо отключить, щелкните правой кнопкой мыши и выберите пункт **подавлять**  > **в файле источника/в подавлении**.

  - При подавлении **в исходном**коде открывается диалоговое окно **предварительного просмотра изменений** , в котором отображается C# предварительный просмотр [#pragma предупреждения](/dotnet/csharp/language-reference/preprocessor-directives/preprocessor-pragma-warning) или Visual Basic [#Disable предупреждения](/dotnet/visual-basic/language-reference/directives/directives) , добавленные в исходный код.

    ![Предварительный просмотр добавления #pragma предупреждения в файл кода](media/pragma-warning-preview.png)

  - Если выбрать параметр **в файле подавления**, откроется диалоговое окно **Предварительный просмотр изменений** , в котором будет показан предварительный просмотр атрибута <xref:System.Diagnostics.CodeAnalysis.SuppressMessageAttribute>, добавляемого в глобальный файл подавления.

    ![Предварительный просмотр добавления атрибута SuppressMessage в файл подавления](media/preview-changes-in-suppression-file.png)

  В диалоговом окне **Просмотр изменений** нажмите кнопку **Применить**.

  > [!NOTE]
  > Если в **Обозреватель решений**не отображается пункт **подавить** , то, скорее всего, это произошло из-за сборки, а не для интерактивного анализа. **Список ошибок** отображает диагностические или нарушения правил, как в реальном коде, так и в сборке. Так как диагностика сборки может быть устаревшей, например, если вы изменили код, чтобы устранить нарушение, но оно не было перестроено, вы не сможете отключить эти диагностические данные от **Список ошибок**. Диагностика из интерактивного анализа или IntelliSense всегда актуальны с текущими источниками и могут быть подавлены из **Список ошибок**. Чтобы исключить диагностику *сборки* из выбора, переключите фильтр источника **Список ошибок** с **сборки + IntelliSense** на **IntelliSense**. Затем выберите диагностику, которую необходимо отключить, и продолжайте, как описано выше.
  >
  > ![Фильтр источника Список ошибок в Visual Studio](media/error-list-filter.png)

## <a name="command-line-usage"></a>Использование командной строки

При сборке проекта в командной строке нарушения правил появляются в выходных данных сборки, если выполняются следующие условия.

- Анализаторы устанавливаются как пакет NuGet, а не как расширение VSIX.

- В коде проекта нарушается одно или несколько правил.

- [Серьезность](#rule-severity) нарушенного правила задана как **предупреждение**, и в этом случае нарушения не приводят к сбою сборки, или **Ошибка**, в этом случае нарушения могут привести к сбою сборки.

Уровень детализации выходных данных сборки не влияет на отображение нарушений правил. Даже при **неавтоматическом** уровне детализации нарушения правил появляются в выходных данных сборки.

> [!TIP]
> Если вы привыкли выполнять анализ прежних версий из командной строки с помощью программы *FxCopCmd. exe* или MSBuild с флагом **рункодеаналисис** , вот как это сделать с анализаторами кода.

Чтобы просмотреть нарушения анализатора в командной строке при сборке проекта с помощью MSBuild, выполните следующую команду:

```cmd
msbuild myproject.csproj /target:rebuild /verbosity:minimal
```

На следующем изображении показаны выходные данные сборки из командной строки для создания проекта, содержащего нарушение правила анализа:

![Выходные данные MSBuild с нарушением правила](media/command-line-build-analyzers.png)

## <a name="dependent-projects"></a>Зависимые проекты

В проекте .NET Core при добавлении ссылки на проект, который содержит анализаторы NuGet, эти анализаторы автоматически добавляются в зависимый проект. Чтобы отключить такое поведение, например, если зависимый проект является проектом модульного теста, пометьте пакет NuGet как частный в *CSPROJ* -или *VBPROJ* -файле проекта, на который указывает ссылка, установив атрибут **PrivateAssets** :

```xml
<PackageReference Include="Microsoft.CodeAnalysis.FxCopAnalyzers" Version="2.9.0" PrivateAssets="all" />
```

## <a name="see-also"></a>См. также

- [Обзор анализаторов кода в Visual Studio](../code-quality/roslyn-analyzers-overview.md)
- [Отправка ошибки анализатора кода](https://github.com/dotnet/roslyn-analyzers/issues)
- [Использование наборов правил](../code-quality/using-rule-sets-to-group-code-analysis-rules.md)
- [Подавлять предупреждения анализа кода](../code-quality/in-source-suppression-overview.md)
