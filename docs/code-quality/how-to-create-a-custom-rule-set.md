---
title: Создание набора правил анализа пользовательского кода
ms.date: 11/02/2018
ms.topic: how-to
f1_keywords:
- vs.codeanalysis.addremoverulesets
helpviewer_keywords:
- rule sets
author: mikejo5000
ms.author: mikejo
manager: jillfra
ms.workload:
- multiple
ms.openlocfilehash: 81462db07941c73b847c009ef8353b00d28fff4f
ms.sourcegitcommit: 48e93538f1e352fc1f972b642bb5fcce2f6834a2
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 06/25/2020
ms.locfileid: "85371915"
---
# <a name="customize-a-rule-set"></a>Настройка набора правил

Вы можете создать настраиваемый набор правил в соответствии с потребностями конкретного проекта для анализа кода.

## <a name="create-a-custom-rule-set-from-an-existing-rule-set"></a>Создание набора настраиваемых правил на основе существующего набора правил

Чтобы создать настраиваемый набор правил, можно открыть набор встроенных правил в **редакторе набора правил**. Здесь можно добавлять или удалять определенные правила, а также изменять действия, выполняемые при нарушении правил &mdash; , например выводить предупреждение или ошибку.

1. В **Обозреватель решений**щелкните правой кнопкой мыши проект и выберите пункт **свойства**.

2. На странице **Свойства** выберите вкладку **анализ кода** .

::: moniker range="vs-2017"

3. В раскрывающемся списке **выполнить этот набор правил** выполните одно из следующих действий.

::: moniker-end

::: moniker range=">=vs-2019"

3. В раскрывающемся списке **активные правила** выполните одно из следующих действий.

::: moniker-end

   - Выберите набор правил, который требуется настроить.

     \- или -

   - Выберите, **\<Browse>** чтобы указать существующий набор правил, отсутствующий в списке.

4. Выберите **Открыть** , чтобы отобразить правила в редакторе набора правил.

> [!NOTE]
> Если у вас есть проект .NET Core или .NET Standard, процесс немного отличается, так как отсутствует вкладка свойств **анализ кода** . выполните действия, чтобы [скопировать предопределенный набор правил в проект и установить его в качестве активного набора правил](analyzer-rule-sets.md). После копирования набора правил [его можно изменить в редакторе набора правил Visual Studio](working-in-the-code-analysis-rule-set-editor.md) , открыв его из **Обозреватель решений**.

## <a name="create-a-new-rule-set"></a>Создать новый набор правил

Новый файл набора правил можно создать в диалоговом окне " **Создание файла** ":

1. Выберите **файл**  >  **создать**  >  **файл**или нажмите клавиши **CTRL** + **N**.

2. В диалоговом окне **новый файл** выберите категорию **Общие** слева и выберите **набор правил анализа кода**.

3. Щелкните **Open**(Открыть).

   Новый *RuleSet* – файл откроется в редакторе набора правил.

## <a name="create-a-custom-rule-set-from-multiple-rule-sets"></a>Создание настраиваемого набора правил на основе нескольких наборов правил

> [!NOTE]
> Следующая процедура не применяется к проектам .NET Core, у которых нет вкладки свойств **анализ кода** .

1. В **Обозреватель решений**щелкните правой кнопкой мыши проект и выберите пункт **свойства**.

2. На странице **Свойства** выберите вкладку **анализ кода** .

::: moniker range="vs-2017"

3. Выберите **\<Choose multiple rule sets>** пункт **запустить этот набор правил**.

::: moniker-end

::: moniker range=">=vs-2019"

3. Выберите **\<Choose multiple rule sets>** из **активных правил**.

::: moniker-end

4. В диалоговом окне **Добавление или удаление наборов правил** выберите наборы правил, которые необходимо включить в новый набор правил.

   ![Диалоговое окно «Добавление или удаление наборов правил»](media/add-remove-rule-sets.png)

5. Выберите **Сохранить как**, введите имя для *RuleSet* -файла и нажмите кнопку **сохранить**.

   Новый набор правил выбран в списке **выполнить этот набор правил** .

6. Выберите **Открыть** , чтобы открыть новый набор правил в редакторе набора правил.

## <a name="rule-precedence"></a>Приоритет правил

- Если одно и то же правило присутствует в наборе правил с разными уровнями серьезности несколько раз, компилятор выдает ошибку. Пример:

   ```xml
   <RuleSet Name="Rules for ClassLibrary21" Description="Code analysis rules for ClassLibrary21.csproj." ToolsVersion="15.0">
     <Rules AnalyzerId="Microsoft.Analyzers.ManagedCodeAnalysis" RuleNamespace="Microsoft.Rules.Managed">
       <Rule Id="CA1021" Action="Warning" />
       <Rule Id="CA1021" Action="Error" />
     </Rules>
   </RuleSet>
   ```

- Если одно и то же правило указано в наборе правил с *одинаковой* степенью серьезности, в **Список ошибок**может появиться следующее предупреждение:

   **CA0063: не удалось загрузить файл набора правил " \[ ваш]. RuleSet" или один из его зависимых файлов набора правил. Файл не соответствует схеме набора правил.**

- Если набор правил включает дочерний набор правил с помощью тега **include** , а дочерний и родительский правила содержат одно и то же правило, но с разными уровнями серьезности, приоритет имеет уровень серьезности в родительском наборе правил. Пример:

   ```xml
   <!-- Parent rule set -->
   <?xml version="1.0" encoding="utf-8"?>
   <RuleSet Name="Rules for ClassLibrary21" Description="Code analysis rules for ClassLibrary21.csproj." ToolsVersion="15.0">
     <Include Path="classlibrary_child.ruleset" Action="Default" />
     <Rules AnalyzerId="Microsoft.Analyzers.ManagedCodeAnalysis" RuleNamespace="Microsoft.Rules.Managed">
       <Rule Id="CA1021" Action="Warning" /> <!-- Overrides CA1021 severity from child rule set -->
     </Rules>
   </RuleSet>

   <!-- Child rule set -->
   <?xml version="1.0" encoding="utf-8"?>
   <RuleSet Name="Rules from child" Description="Code analysis rules from child." ToolsVersion="15.0">
     <Rules AnalyzerId="Microsoft.Analyzers.ManagedCodeAnalysis" RuleNamespace="Microsoft.Rules.Managed">
       <Rule Id="CA1021" Action="Error" />
     </Rules>
   </RuleSet>
   ```

## <a name="name-and-description"></a>Имя и описание

Чтобы изменить отображаемое имя набора правил, открытого в редакторе, откройте окно « **Свойства** », выбрав в строке меню пункт « **Просмотр**  >  **свойств»** . Введите отображаемое имя в поле **имя** . Можно также ввести описание набора правил.

## <a name="next-steps"></a>Дальнейшие действия

Теперь, когда у вас есть набор правил, необходимо настроить правила, добавив или удалив правила или изменив серьезность нарушений правил.

> [!div class="nextstepaction"]
> [Изменение правил в редакторе набора правил](../code-quality/working-in-the-code-analysis-rule-set-editor.md)

## <a name="see-also"></a>См. также

- [Практическое руководство. Настройка анализа кода для проекта управляемого кода](../code-quality/how-to-configure-code-analysis-for-a-managed-code-project.md)
- [Справочник по набору правил анализа кода](../code-quality/rule-set-reference.md)
