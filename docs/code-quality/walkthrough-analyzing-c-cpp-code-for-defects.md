---
title: Пошаговое руководство. Анализ кода C/C++ на наличие дефектов
ms.date: 11/04/2016
ms.topic: conceptual
helpviewer_keywords:
- C/C++, code analysis
- code analysis, walkthroughs
- code, analyzing C/C++
- code analysis tool, walkthroughs
author: mikeblome
ms.author: mblome
manager: wpickett
ms.workload:
- cplusplus
ms.openlocfilehash: acfa1e274b7c0744c2d9968682960b1cd50e0044
ms.sourcegitcommit: 94b3a052fb1229c7e7f8804b09c1d403385c7630
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/23/2019
ms.locfileid: "62820341"
---
# <a name="walkthrough-analyzing-cc-code-for-defects"></a>Пошаговое руководство. Анализ кода C/C++ на наличие дефектов

В этом пошаговом руководстве показано, как для анализа кода C/C++ на возможные дефекты кода с помощью средства анализа кода для кода C/C++.

- Запустите анализ кода для машинного кода.
- Анализ предупреждений о дефектах кода.
- Рассматривать предупреждения как ошибки.
- Включите исходный код для улучшения анализа дефектов кода.

## <a name="prerequisites"></a>Предварительные требования

- Копия [демонстрационного](../code-quality/demo-sample.md).
- Базовое представление о C/C++.

### <a name="to-run-code-defect-analysis-on-native-code"></a>Чтобы выполнить анализ дефектов кода в машинный код

1. Откройте демонстрационное решение в [!INCLUDE[vsprvs](../code-quality/includes/vsprvs_md.md)].

     Решение Demo теперь заполняет **обозревателе решений**.

2. В меню **Построить** выберите пункт **Перестроить решение**.

     Выполняется сборка решения без ошибок и предупреждений.

3. В **обозревателе решений**, выберите проект CodeDefects.

4. В меню **Проект** выберите пункт **Свойства**.

     **Страницы свойств CodeDefects** диалоговое окно.

5. Нажмите кнопку **анализ кода**.

6. Нажмите кнопку **включить анализ кода для C/C++ при сборке** "флажок".

7. Перестройте проект CodeDefects.

     Предупреждения анализа кода отображаются в **список ошибок**.

### <a name="to-analyze-code-defect-warnings"></a>Анализ предупреждений о дефектах кода

1. На **представление** меню, щелкните **список ошибок**.

     В зависимости от профиля разработчика, выбранного в [!INCLUDE[vsprvs](../code-quality/includes/vsprvs_md.md)], возможно, чтобы они указывали **Other Windows** на **представление** меню, а затем щелкните **список ошибок**.

2. В **список ошибок**, дважды щелкните следующее предупреждение:

     Предупреждение C6230: Неявное приведение между семантически различными типами: использование HRESULT в логическом контексте.

     В редакторе кода отображается строка, вызвавшая предупреждение в функции `bool ProcessDomain()`. Это предупреждение означает, что значение HRESULT используется в операторе «if» в там, где ожидается логическое значение.

3. Устраните это предупреждение с помощью макроса SUCCEEDED. Ваш код должен выглядеть следующим образом:

   ```cpp
   if (SUCCEEDED (ReadUserAccount()) )
   ```

4. В **список ошибок**, дважды щелкните следующее предупреждение:

     Предупреждение C6282: Неверный оператор: присвоение константы в контекст теста. Был == предназначен?

5. Исправьте это предупреждение, проверка на равенство. Код должен выглядеть аналогично следующему коду:

   ```cpp
   if ((len == ACCOUNT_DOMAIN_LEN) || (g_userAccount[len] != '\\'))
   ```

### <a name="to-treat-warning-as-an-error"></a>Чтобы обрабатывать предупреждения как ошибки

1. В файле Bug.cpp, добавьте следующий `#pragma` инструкцию в начало файла, чтобы предупреждение C6001 как ошибка:

   ```cpp
   #pragma warning (error: 6001)
   ```

2. Перестройте проект CodeDefects.

     В **список ошибок**, предупреждение C6001 теперь отображается как ошибка.

3. Исправьте оставшиеся две ошибки C6001 в **список ошибок** путем инициализации `i` и `j` 0.

4. Перестройте проект CodeDefects.

     Сборка проекта выполняется без предупреждения или ошибки.

### <a name="to-correct-the-source-code-annotation-warnings-in-annotationc"></a>Для устранения предупреждений заметки исходного кода в файле annotation.c

1. В обозревателе решений выберите проект заметок.

2. В меню **Проект** выберите пункт **Свойства**.

     **Страницы свойств заметок** диалоговое окно.

3. Нажмите кнопку **анализ кода**.

4. Выберите **включить анализ кода для C/C++ при сборке** "флажок".

5. Перестройте проект заметок.

6. В **список ошибок**, дважды щелкните следующее предупреждение:

     Предупреждение C6011: Разыменование указателя NULL «newNode».

     Это предупреждение указывает вызывающим неспособность проверяйте возвращаемое значение. В этом случае вызов **AllocateNode** могут возвращать значение NULL (см. в разделе annotations.h заголовочный файл для объявления функции для AllocateNode).

7. Откройте файл annotations.cpp.

8. Чтобы устранить это предупреждение, используйте оператор «if» для тестирования возвращаемое значение. Ваш код должен выглядеть следующим образом:

   ```cpp
   if (NULL != newNode)
   {
   newNode->data = value;
   newNode->next = 0;
   node->next = newNode;
   }
   ```

9. Перестройте проект заметок.

     Сборка проекта выполняется без предупреждения или ошибки.

### <a name="to-use-source-code-annotation"></a>Чтобы использовать примечания исходного кода

1. Добавление заметок формальные параметры и возвращаемое значение функции `AddTail` с помощью пред- и постусловий, как показано в следующем примере:

   ```cpp
   [returnvalue:SA_Post (Null=SA_Maybe)] LinkedList* AddTail
   (
   [SA_Pre(Null=SA_Maybe)] LinkedList* node,
   int value
   )
   ```

2. Перестройте проект заметок.

3. В **список ошибок**, дважды щелкните следующее предупреждение:

     Предупреждение C6011: Разыменования указателя NULL «узел».

     Это предупреждение указывает, что переданный в функцию узел может иметь значение null, а номер строки, где возникло предупреждение.

4. Чтобы устранить это предупреждение, используйте оператор «if» для тестирования возвращаемое значение. Ваш код должен выглядеть следующим образом:

   ```cpp
   . . .
   LinkedList *newNode = NULL;
   if (NULL == node)
   {
        return NULL;
        . . .
   }
   ```

5. Перестройте проект заметок.

     Сборка проекта выполняется без предупреждения или ошибки.

## <a name="see-also"></a>См. также

[Пошаговое руководство: Проверка управляемого кода на наличие дефектов кода](../code-quality/walkthrough-analyzing-managed-code-for-code-defects.md)
[анализ кода для C/C++](../code-quality/code-analysis-for-c-cpp-overview.md)
