---
title: 'CA1021: не используйте параметры out'
ms.date: 11/04/2016
ms.topic: reference
f1_keywords:
- CA1021
- AvoidOutParameters
helpviewer_keywords:
- AvoidOutParameters
- CA1021
ms.assetid: 970f2304-842c-4fb7-9734-f3871da8d479
author: mikejo5000
ms.author: mikejo
manager: jillfra
ms.workload:
- multiple
ms.openlocfilehash: 579b04f26af972ac025b0bfc07bc8dc9eb636d12
ms.sourcegitcommit: 98421670ed0b8170aaa32d3d6f8681298f401a1d
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/18/2020
ms.locfileid: "81638031"
---
# <a name="ca1021-avoid-out-parameters"></a>CA1021: не используйте параметры out

|||
|-|-|
|TypeName|AvoidOutParameters|
|CheckId|CA1021|
|Категория|Microsoft.Design|
|Критическое изменение|Критическое|

## <a name="cause"></a>Причина:
Общественный или защищенный метод в `out` публичном типе имеет параметр.

По умолчанию это правило смотрит только на внешне видимые типы, но это [настраивается.](#configurability)

## <a name="rule-description"></a>Описание правила
Прохождение типов по `out` `ref`ссылке (с использованием или) требует опыта с указателями, понимания того, как различаются типы значений и типов ссылок, и обработки методов с несколькими значениями возврата. Кроме того, `out` разница `ref` между параметрами не является широко понятой.

Когда эталонный тип передается "по ссылке", метод намерен использовать параметр для возврата другого экземпляра объекта. Передача эталонного типа по ссылке также известна как использование двойного указателя, указателя на указатель или двойное направление. Используя конвенцию вызова по умолчанию, которая передается "по значению", параметр, который принимает тип ссылки, уже получает указатель на объект. Указатель, а не объект, на который он указывает, передается по значению. Прохождение за значение означает, что метод не может изменить указатель, чтобы он указать на новый экземпляр эталонного типа. Тем не менее, он может изменить содержимое объекта, на который он указывает. Для большинства приложений этого достаточно и дает желаемое поведение.

Если метод должен вернуть другой экземпляр, используйте значение возврата метода для достижения этой цели. Просмотрите <xref:System.String?displayProperty=fullName> класс для различных методов, работающих на строках, и верните новый экземпляр строки. При использовании этой модели абонент должен решить, сохраняется ли исходный объект.

Хотя значения возврата являются обычным явлением и широко `out` `ref` используются, правильное применение и параметры требуют промежуточных навыков проектирования и кодирования. Архитекторы библиотеки, которые проектируют для широкой `out` аудитории, не должны ожидать, что пользователи овладеют работой с параметрами или `ref` параметрами.

## <a name="how-to-fix-violations"></a>Устранение нарушений
Чтобы исправить нарушение этого правила, вызванное типом значения, необходимо, чтобы метод вернул объект в качестве значения возврата. Если метод должен вернуть несколько значений, редизайн его, чтобы вернуть один экземпляр объекта, который содержит значения.

Чтобы исправить нарушение этого правила, вызванное типом ссылки, убедитесь, что желаемое поведение должно вернуть новый экземпляр ссылки. Если это так, метод должен использовать его значение возврата для этого.

## <a name="when-to-suppress-warnings"></a>Когда подавлять предупреждения
Можно с уверенностью подавить предупреждение из этого правила. Однако такая конструкция может вызвать проблемы с удобством использования.

## <a name="configurability"></a>Настраиваемость

Если вы работаете с помощью [анализаторов FxCop](install-fxcop-analyzers.md) (а не с помощью устаревшего анализа), можно настроить часть базы кода для выполнения этого правила, исходя из их доступности. Например, чтобы указать, что правило должно работать только на непубличной поверхности API, добавьте следующую пару значений ключа в файл .editorconfig в проекте:

```ini
dotnet_code_quality.ca1021.api_surface = private, internal
```

Эту опцию можно настроить только для этого правила, для всех правил или для всех правил этой категории (Дизайн). Для получения дополнительной информации [см.](configure-fxcop-analyzers.md)

## <a name="example"></a>Пример
В следующей библиотеке отображается две реализации класса, которая генерирует ответы на отзывы пользователя. Первая реализация`BadRefAndOut`() заставляет пользователя библиотеки управлять тремя значениями возврата. Вторая реализация`RedesignedRefAndOut`() упрощает пользовательский опыт, возвращая экземпляр`ReplyData`класса контейнера (), который управляет данными как единое целое.

[!code-csharp[FxCop.Design.NoRefOrOut#1](../code-quality/codesnippet/CSharp/ca1021-avoid-out-parameters_1.cs)]

## <a name="example"></a>Пример
Следующее приложение иллюстрирует опыт пользователя. Вызов в переработанную библиотеку (метод)`UseTheSimplifiedClass` более прост, и информация, возвращенная методом, легко управляется. Выход из этих двух методов идентичен.

[!code-csharp[FxCop.Design.TestNoRefOrOut#1](../code-quality/codesnippet/CSharp/ca1021-avoid-out-parameters_2.cs)]

## <a name="example"></a>Пример
В следующем примере `ref` библиотека иллюстрирует, как используются параметры для эталонных типов, и отображается лучший способ реализации этой функциональности.

[!code-csharp[FxCop.Design.RefByRefNo#1](../code-quality/codesnippet/CSharp/ca1021-avoid-out-parameters_3.cs)]

## <a name="example"></a>Пример
Следующее приложение вызывает каждый метод в библиотеке, чтобы продемонстрировать поведение.

[!code-csharp[FxCop.Design.TestRefByRefNo#1](../code-quality/codesnippet/CSharp/ca1021-avoid-out-parameters_4.cs)]

В этом примере выводятся следующие данные:

```txt
Changing pointer - passed by value:
12345
12345
Changing pointer - passed by reference:
12345
12345 ABCDE
Passing by return value:
12345 ABCDE
```

## <a name="try-pattern-methods"></a>Попробуйте методы шаблона

### <a name="description"></a>Описание
Методы, реализующие шаблон **Try\<Something>,** такие как, <xref:System.Int32.TryParse%2A?displayProperty=fullName>не повышают это нарушение. В следующем примере показана структура (тип <xref:System.Int32.TryParse%2A?displayProperty=fullName> значения), которая реализует метод.

### <a name="code"></a>Код
[!code-csharp[FxCop.Design.TryPattern#1](../code-quality/codesnippet/CSharp/ca1021-avoid-out-parameters_5.cs)]

## <a name="related-rules"></a>Похожие правила
[CA1045: не передавайте типы по ссылке](../code-quality/ca1045.md)
