---
title: Пользовательские политики возврата с анализом кода для управляемого кода
ms.date: 11/04/2016
ms.topic: conceptual
f1_keywords:
- vs.code.analysis.selecttfsrulesets
- vs.code.analysis.browsefortfsruleset
- vs.code.analysis.policyeditor
ms.assetid: fd029003-5671-4b24-8b6f-032e0a98b2e8
author: gewarren
ms.author: gewarren
manager: jillfra
ms.workload:
- dotnet
ms.openlocfilehash: 88703f14091628b1fc13c405ac4fabf48307aac7
ms.sourcegitcommit: 485ffaedb1ade71490f11cf05962add1718945cc
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 10/16/2019
ms.locfileid: "72448870"
---
# <a name="implement-custom-code-analysis-check-in-policies-for-managed-code"></a>Реализация настраиваемых политик возврата с анализом кода для управляемого кода

Политика возврата с анализом кода задает набор правил, которые должны выполняться членами проекта Azure DevOps в исходном коде перед возвратом в систему управления версиями. Корпорация Майкрософт предоставляет набор стандартных *наборов правил* , которые группируют правила анализа кода в функциональные области. *Пользовательские наборы правил политики возврата* определяют набор правил анализа кода, характерных для конкретного проекта. Набор правил хранится в RuleSet-файле.

Политики возврата задаются на уровне проекта Azure DevOps и задаются расположением RULESET-файла в дереве системы управления версиями. На расположение системы управления версиями настраиваемого набора правил политики Team Policy не налагаются никакие ограничения.

Анализ кода настраивается для отдельных проектов кода в окне "Свойства" для каждого проекта. Настраиваемый набор правил для проекта кода определяется физическим расположением RULESET-файла на локальном компьютере. При указании RuleSet-файла, расположенного на том же диске, что и проект кода, Visual Studio использует относительный путь к файлу в конфигурации проекта.

Рекомендуемым методом создания набора настраиваемых правил для проекта Azure DevOps является сохранение RuleSet-файла политики возврата в особой папке, которая не является частью какого-либо проекта кода. Если файл сохраняется в выделенной папке, можно применить разрешения, которые ограничивают права на изменение файла правил, и можно легко переместить структуру каталогов, содержащую проект, в другой каталог или компьютер.

## <a name="create-the-project-custom-check-in-rule-set"></a>Создание набора правил пользовательского возврата для проекта

Чтобы создать настраиваемый набор правил для проекта Azure DevOps, сначала создайте специальную папку для правила политики возврата, установленного в **Обозреватель управления исходным кодом**. Затем создается файл набора правил и добавляется файл в систему управления версиями. Наконец, укажите набор правил в качестве политики возврата к анализу кода для проекта.

> [!NOTE]
> Чтобы создать папку в проекте Azure DevOps, сначала необходимо связать корневой каталог проекта с расположением на локальном компьютере.

### <a name="to-create-the-version-control-folder-for-the-check-in-policy-rule-set"></a>Создание папки системы управления версиями для набора правил политики возврата

1. В Team Explorer разверните узел проекта и выберите пункт **система управления версиями**.

2. В области **папки** щелкните правой кнопкой мыши проект и выберите пункт **создать папку**.

3. В основной области системы управления версиями щелкните правой кнопкой мыши **создать папку**, выберите команду **Переименовать**и введите имя папки набора правил.

### <a name="to-create-the-check-in-policy-rule-set"></a>Создание набора правил политики возврата

1. В меню **файл** наведите указатель мыши на пункт **создать**и выберите пункт **файл**.

2. В списке **категории** выберите **Общие**.

3. В списке **шаблоны** дважды щелкните **набор правил анализа кода**.

4. [Укажите правила](../code-quality/how-to-create-a-custom-rule-set.md) , которые следует включить в набор правил, а затем сохраните файл набора правил в созданной папке набора правил.

### <a name="to-add-the-rule-set-file-to-version-control"></a>Добавление файла набора правил в систему управления версиями

1. В **Обозреватель управления исходным кодом**щелкните правой кнопкой мыши новую папку и выберите команду **Добавить элементы в папку**.

     Дополнительные сведения см. в разделе [Git и Azure Repos](/azure/devops/repos/git/overview?view=vsts).

2. Щелкните созданный файл набора правил и нажмите кнопку **Готово**.

     Файл будет добавлен в систему управления версиями и извлечен вами.

3. В окне сведения о **Обозреватель управления исходным кодом** щелкните правой кнопкой мыши имя файла и выберите пункт **Вернуть ожидающие изменения**.

4. В диалоговом окне **Возврат** можно добавить комментарий и нажать кнопку **вернуть**.

    > [!NOTE]
    > Если вы уже настроили политику возврата с анализом кода для проекта Azure DevOps и выбрали **принудительный возврат для включения только файлов, которые являются частью текущего решения**, вы запустите предупреждение об ошибке политики. В диалоговом окне сбой политики выберите **Переопределить сбой политики и продолжить возврат**. Добавьте обязательный комментарий и нажмите кнопку **ОК**.

### <a name="to-specify-the-rule-set-file-as-the-check-in-policy"></a>Указание файла набора правил в качестве политики возврата

1. В меню **команда** наведите указатель на пункт **Параметры проекта**и выберите пункт **система управления версиями**.

2. Щелкните **Политика возврата**и нажмите кнопку **Добавить**.

3. В списке **Политика возврата** дважды щелкните **анализ кода**и убедитесь, что установлен флажок **принудительное выполнение анализа кода для управляемого кода** .

4. В списке **выполнить этот набор правил** щелкните **\<Select набор правил из системы управления версиями >** .

5. Введите путь к файлу набора правил политики возврата в системе управления версиями.

     Путь должен соответствовать следующему синтаксису:

     **$/** `TeamProjectName` **/** `VersionControlPath`

    > [!NOTE]
    > Путь можно скопировать с помощью одной из следующих процедур в **Обозреватель управления исходным кодом**.

    - В области **папки** щелкните папку, содержащую файл набора правил. Скопируйте путь управления версиями в папку, которая отображается в поле **источник** , и введите имя файла набора правил вручную.

    - В окне Сведения щелкните правой кнопкой мыши файл набора правил и выберите пункт **Свойства**. На вкладке **Общие** скопируйте значение в поле **имя сервера**.

## <a name="synchronize-code-projects-to-the-check-in-policy-rule-set"></a>Синхронизация проектов кода с набором правил политики возврата

Набор правил политики возврата проекта указывается в качестве набора правил анализа кода для конфигурации проекта кода в диалоговом окне Свойства проекта кода. Если набор правил расположен на том же диске, что и проект кода, то для указания набора правил при выборе пути из диалогового окна файла используется относительный путь. Относительный путь позволяет перенести параметры свойств проекта на другие компьютеры, использующие аналогичные структуры управления локальной версией.

### <a name="to-specify-a-project-rule-set-as-the-rule-set-of-a-code-project"></a>Указание набора правил проекта в качестве набора правил для проекта кода

1. При необходимости извлеките папку и файл набора правил политики возврата из системы управления версиями.

   Этот шаг можно выполнить в **Обозреватель управления исходным кодом** , щелкнув правой кнопкой мыши папку набора правил и выбрав пункт **получить последнюю версию**.

2. В **Обозреватель решений**щелкните правой кнопкой мыши проект кода и выберите пункт **свойства**.

3. **Щелкните анализ кода**.

4. При необходимости выберите соответствующие параметры в списках **Конфигурация** и **платформа** .

::: moniker range="vs-2017"

5. Чтобы выполнить анализ кода при каждом построении проекта кода с использованием указанной конфигурации, выберите **Включить анализ кода при сборке**.

::: moniker-end

::: moniker range=">=vs-2019"

5. Чтобы выполнить анализ кода при каждом построении проекта кода с использованием указанной конфигурации, выберите **выполнить в сборке** в разделе **двоичные анализаторы** .

::: moniker-end

6. В списке **выполнить этот набор правил** щелкните **\<Browse >** .

8. Выберите локальную версию файла набора правил политики возврата.
